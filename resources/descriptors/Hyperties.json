{
  "HypertyChat": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXIKCnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTsKdmFyIHF1ZXVlID0gW107CnZhciBkcmFpbmluZyA9IGZhbHNlOwp2YXIgY3VycmVudFF1ZXVlOwp2YXIgcXVldWVJbmRleCA9IC0xOwoKZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkgewogICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZHJhaW5pbmcgPSBmYWxzZTsKICAgIGlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7CiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgfQogICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIGRyYWluUXVldWUoKTsKICAgIH0KfQoKZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsKICAgIGlmIChkcmFpbmluZykgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChjbGVhblVwTmV4dFRpY2spOwogICAgZHJhaW5pbmcgPSB0cnVlOwoKICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7CiAgICB3aGlsZSAobGVuKSB7CiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7CiAgICAgICAgcXVldWUgPSBbXTsKICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgfQogICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7Cn0KCnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwogICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHsKICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApOwogICAgfQp9OwoKLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0cwpmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgIHRoaXMuZnVuID0gZnVuOwogICAgdGhpcy5hcnJheSA9IGFycmF5Owp9Ckl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOwp9Owpwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInOwpwcm9jZXNzLmJyb3dzZXIgPSB0cnVlOwpwcm9jZXNzLmVudiA9IHt9Owpwcm9jZXNzLmFyZ3YgPSBbXTsKcHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzCnByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCmZ1bmN0aW9uIG5vb3AoKSB7fQoKcHJvY2Vzcy5vbiA9IG5vb3A7CnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLm9uY2UgPSBub29wOwpwcm9jZXNzLm9mZiA9IG5vb3A7CnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CnByb2Nlc3MuZW1pdCA9IG5vb3A7Cgpwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwp9OwoKcHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJy8nOwp9Owpwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTsKfTsKcHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAwOwp9OwoKfSx7fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoZ2xvYmFsKXsKInVzZSBzdHJpY3QiOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyoqCiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgoqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQoqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgoqCiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoqCiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKKgoqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKiovCgovLyBEaXN0cmlidXRpb24gZmlsZSBmb3IgSHlwZXJ0eURpc2NvdmVyeS5qcwovLyB2ZXJzaW9uOiAwLjIuMAoKIWZ1bmN0aW9uIChlKSB7CiAgaWYgKCJvYmplY3QiID09ICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBtb2R1bGUpIG1vZHVsZS5leHBvcnRzID0gZSgpO2Vsc2UgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kKSBkZWZpbmUoW10sIGUpO2Vsc2UgewogICAgdmFyIHQ7dCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogdGhpcywgdC5IeXBlcnR5RGlzY292ZXJ5ID0gZSgpOwogIH0KfShmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIGUodCwgciwgbikgewogICAgZnVuY3Rpb24gbyhjLCBzKSB7CiAgICAgIGlmICghcltjXSkgewogICAgICAgIGlmICghdFtjXSkgewogICAgICAgICAgdmFyIHUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmU7aWYgKCFzICYmIHUpIHJldHVybiB1KGMsICEwKTtpZiAoaSkgcmV0dXJuIGkoYywgITApO3ZhciBhID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBjICsgIiciKTt0aHJvdyBhLmNvZGUgPSAiTU9EVUxFX05PVF9GT1VORCIsIGE7CiAgICAgICAgfXZhciBmID0gcltjXSA9IHsgZXhwb3J0czoge30gfTt0W2NdWzBdLmNhbGwoZi5leHBvcnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHIgPSB0W2NdWzFdW2VdO3JldHVybiBvKHIgPyByIDogZSk7CiAgICAgICAgfSwgZiwgZi5leHBvcnRzLCBlLCB0LCByLCBuKTsKICAgICAgfXJldHVybiByW2NdLmV4cG9ydHM7CiAgICB9Zm9yICh2YXIgaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZSwgYyA9IDA7IGMgPCBuLmxlbmd0aDsgYysrKSB7CiAgICAgIG8obltjXSk7CiAgICB9cmV0dXJuIG87CiAgfSh7IDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL2pzb24vc3RyaW5naWZ5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiOiA2IH1dLCAyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDcgfV0sIDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIjogOCB9XSwgNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgci5fX2VzTW9kdWxlID0gITAsIHJbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksCiAgICAgICAgICBpID0gbihvKTtyWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgdmFyIG4gPSB0W3JdO24uZW51bWVyYWJsZSA9IG4uZW51bWVyYWJsZSB8fCAhMSwgbi5jb25maWd1cmFibGUgPSAhMCwgInZhbHVlIiBpbiBuICYmIChuLndyaXRhYmxlID0gITApLCAoMCwgaVsiZGVmYXVsdCJdKShlLCBuLmtleSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfXJldHVybiBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgcmV0dXJuIHIgJiYgZSh0LnByb3RvdHlwZSwgciksIG4gJiYgZSh0LCBuKSwgdDsKICAgICAgICB9OwogICAgICB9KCk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDIgfV0sIDY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvX2NvcmUiKSwKICAgICAgICAgIG8gPSBuLkpTT04gfHwgKG4uSlNPTiA9IHsgc3RyaW5naWZ5OiBKU09OLnN0cmluZ2lmeSB9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBvLnN0cmluZ2lmeS5hcHBseShvLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2IH1dLCA3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSIpO3ZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy9fY29yZSIpLk9iamVjdDt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLmRlZmluZVByb3BlcnR5KGUsIHQsIHIpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2LCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSI6IDcxIH1dLCA4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyIpLCBlKCIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiKSwgZSgiLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIiksIGUoIi4uL21vZHVsZXMvZXM2LnByb21pc2UiKSwgdC5leHBvcnRzID0gZSgiLi4vbW9kdWxlcy9fY29yZSIpLlByb21pc2U7CiAgICB9LCB7ICIuLi9tb2R1bGVzL19jb3JlIjogMTYsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogNzIsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogNzMsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA3NCwgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDc1IH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhIGZ1bmN0aW9uISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHt9OwogICAgfSwge31dLCAxMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBuKSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpIHx8IHZvaWQgMCAhPT0gbiAmJiBuIGluIGUpIHRocm93IFR5cGVFcnJvcihyICsgIjogaW5jb3JyZWN0IGludm9jYXRpb24hIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDEyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1sZW5ndGgiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pbmRleCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByLCBjKSB7CiAgICAgICAgICB2YXIgcywKICAgICAgICAgICAgICB1ID0gbih0KSwKICAgICAgICAgICAgICBhID0gbyh1Lmxlbmd0aCksCiAgICAgICAgICAgICAgZiA9IGkoYywgYSk7aWYgKGUgJiYgciAhPSByKSB7CiAgICAgICAgICAgIGZvciAoOyBhID4gZjspIHsKICAgICAgICAgICAgICBpZiAocyA9IHVbZisrXSwgcyAhPSBzKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBmb3IgKDsgYSA+IGY7IGYrKykgewogICAgICAgICAgICBpZiAoKGUgfHwgZiBpbiB1KSAmJiB1W2ZdID09PSByKSByZXR1cm4gZSB8fCBmIHx8IDA7CiAgICAgICAgICB9cmV0dXJuICFlICYmIC0xOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbmRleCI6IDYxLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tbGVuZ3RoIjogNjQgfV0sIDE0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19jb2YiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgidG9TdHJpbmdUYWciKSwKICAgICAgICAgIGkgPSAiQXJndW1lbnRzIiA9PSBuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpLAogICAgICAgICAgYyA9IGZ1bmN0aW9uIGMoZSwgdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gZVt0XTsKICAgICAgICB9IGNhdGNoIChyKSB7fQogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsIHIsIHM7cmV0dXJuIHZvaWQgMCA9PT0gZSA/ICJVbmRlZmluZWQiIDogbnVsbCA9PT0gZSA/ICJOdWxsIiA6ICJzdHJpbmciID09IHR5cGVvZiAociA9IGModCA9IE9iamVjdChlKSwgbykpID8gciA6IGkgPyBuKHQpIDogIk9iamVjdCIgPT0gKHMgPSBuKHQpKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LmNhbGxlZSA/ICJBcmd1bWVudHMiIDogczsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fd2tzIjogNjggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAxNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMi40LjAiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDE3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19hLWZ1bmN0aW9uIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBpZiAobihlKSwgdm9pZCAwID09PSB0KSByZXR1cm4gZTtzd2l0Y2ggKHIpIHtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgcik7CiAgICAgICAgICAgIH07Y2FzZSAyOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIsIG4pIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIsIG4pOwogICAgICAgICAgICB9O2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuLCBvKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuLCBvKTsKICAgICAgICAgICAgfTt9cmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlLmFwcGx5KHQsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5IH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDE5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vX2ZhaWxzIikoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19mYWlscyI6IDIzIH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9fZ2xvYmFsIikuZG9jdW1lbnQsCiAgICAgICAgICBpID0gbihvKSAmJiBuKG8uY3JlYXRlRWxlbWVudCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaSA/IG8uY3JlYXRlRWxlbWVudChlKSA6IHt9OwogICAgICB9OwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAiY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mIi5zcGxpdCgiLCIpOwogICAgfSwge31dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYyA9IGUoIi4vX2hpZGUiKSwKICAgICAgICAgIHMgPSAicHJvdG90eXBlIiwKICAgICAgICAgIHUgPSBmdW5jdGlvbiB1KGUsIHQsIHIpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgICAgZiwKICAgICAgICAgICAgXywKICAgICAgICAgICAgbCA9IGUgJiB1LkYsCiAgICAgICAgICAgIGQgPSBlICYgdS5HLAogICAgICAgICAgICBwID0gZSAmIHUuUywKICAgICAgICAgICAgdiA9IGUgJiB1LlAsCiAgICAgICAgICAgIHkgPSBlICYgdS5CLAogICAgICAgICAgICBoID0gZSAmIHUuVywKICAgICAgICAgICAgYiA9IGQgPyBvIDogb1t0XSB8fCAob1t0XSA9IHt9KSwKICAgICAgICAgICAgbSA9IGJbc10sCiAgICAgICAgICAgIGcgPSBkID8gbiA6IHAgPyBuW3RdIDogKG5bdF0gfHwge30pW3NdO2QgJiYgKHIgPSB0KTtmb3IgKGEgaW4gcikgewogICAgICAgICAgZiA9ICFsICYmIGcgJiYgdm9pZCAwICE9PSBnW2FdLCBmICYmIGEgaW4gYiB8fCAoXyA9IGYgPyBnW2FdIDogclthXSwgYlthXSA9IGQgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZ1thXSA/IHJbYV0gOiB5ICYmIGYgPyBpKF8sIG4pIDogaCAmJiBnW2FdID09IF8gPyBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdCA9IGZ1bmN0aW9uIHQoX3QsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIGUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGUoKTtjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90KTtjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90LCByKTt9cmV0dXJuIG5ldyBlKF90LCByLCBuKTsKICAgICAgICAgICAgICB9cmV0dXJuIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfTtyZXR1cm4gdFtzXSA9IGVbc10sIHQ7CiAgICAgICAgICB9KF8pIDogdiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBfID8gaShGdW5jdGlvbi5jYWxsLCBfKSA6IF8sIHYgJiYgKChiLnZpcnR1YWwgfHwgKGIudmlydHVhbCA9IHt9KSlbYV0gPSBfLCBlICYgdS5SICYmIG0gJiYgIW1bYV0gJiYgYyhtLCBhLCBfKSkpOwogICAgICAgIH0KICAgICAgfTt1LkYgPSAxLCB1LkcgPSAyLCB1LlMgPSA0LCB1LlAgPSA4LCB1LkIgPSAxNiwgdS5XID0gMzIsIHUuVSA9IDY0LCB1LlIgPSAxMjgsIHQuZXhwb3J0cyA9IHU7CiAgICB9LCB7ICIuL19jb3JlIjogMTYsICIuL19jdHgiOiAxNywgIi4vX2dsb2JhbCI6IDI1LCAiLi9faGlkZSI6IDI3IH1dLCAyMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiAhIWUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gITA7CiAgICAgICAgfQogICAgICB9OwogICAgfSwge31dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBvID0gZSgiLi9faXRlci1jYWxsIiksCiAgICAgICAgICBpID0gZSgiLi9faXMtYXJyYXktaXRlciIpLAogICAgICAgICAgYyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGUoIi4vX3RvLWxlbmd0aCIpLAogICAgICAgICAgdSA9IGUoIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIiksCiAgICAgICAgICBhID0ge30sCiAgICAgICAgICBmID0ge30sCiAgICAgICAgICByID0gdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIF8sIGwpIHsKICAgICAgICB2YXIgZCwKICAgICAgICAgICAgcCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgeSwKICAgICAgICAgICAgaCA9IGwgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZTsKICAgICAgICB9IDogdShlKSwKICAgICAgICAgICAgYiA9IG4ociwgXywgdCA/IDIgOiAxKSwKICAgICAgICAgICAgbSA9IDA7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGgpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgaXRlcmFibGUhIik7aWYgKGkoaCkpIHsKICAgICAgICAgIGZvciAoZCA9IHMoZS5sZW5ndGgpOyBkID4gbTsgbSsrKSB7CiAgICAgICAgICAgIGlmICh5ID0gdCA/IGIoYyhwID0gZVttXSlbMF0sIHBbMV0pIDogYihlW21dKSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgZm9yICh2ID0gaC5jYWxsKGUpOyAhKHAgPSB2Lm5leHQoKSkuZG9uZTspIHsKICAgICAgICAgIGlmICh5ID0gbyh2LCBiLCBwLnZhbHVlLCB0KSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICB9CiAgICAgIH07ci5CUkVBSyA9IGEsIHIuUkVUVVJOID0gZjsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fY3R4IjogMTcsICIuL19pcy1hcnJheS1pdGVyIjogMzIsICIuL19pdGVyLWNhbGwiOiAzNCwgIi4vX3RvLWxlbmd0aCI6IDY0LCAiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiOiA2OSB9XSwgMjU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgd2luZG93Lk1hdGggPT0gTWF0aCA/IHdpbmRvdyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZiA6IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7Im51bWJlciIgPT0gdHlwZW9mIF9fZyAmJiAoX19nID0gbik7CiAgICB9LCB7fV0sIDI2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDI3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uZihlLCB0LCBvKDEsIHIpKTsKICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIGVbdF0gPSByLCBlOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwIH1dLCAyODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2dsb2JhbCIpLmRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgIH0sIHsgIi4vX2dsb2JhbCI6IDI1IH1dLCAyOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9ICFlKCIuL19kZXNjcmlwdG9ycyIpICYmICFlKCIuL19mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSgiLi9fZG9tLWNyZWF0ZSIpKCJkaXYiKSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZmFpbHMiOiAyMyB9XSwgMzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHZhciBuID0gdm9pZCAwID09PSByO3N3aXRjaCAodC5sZW5ndGgpIHtjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBuID8gZSgpIDogZS5jYWxsKHIpO2Nhc2UgMToKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0pIDogZS5jYWxsKHIsIHRbMF0pO2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0pO2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0pO2Nhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pO31yZXR1cm4gZS5hcHBseShyLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2NvZiIpO3QuZXhwb3J0cyA9IE9iamVjdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN0cmluZyIgPT0gbihlKSA/IGUuc3BsaXQoIiIpIDogT2JqZWN0KGUpOwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUgfV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pdGVyYXRvcnMiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGkgPSBBcnJheS5wcm90b3R5cGU7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlICYmIChuLkFycmF5ID09PSBlIHx8IGlbb10gPT09IGUpOwogICAgICB9OwogICAgfSwgeyAiLi9faXRlcmF0b3JzIjogMzksICIuL193a3MiOiA2OCB9XSwgMzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAib2JqZWN0IiA9PSAodHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpKSA/IG51bGwgIT09IGUgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBlOwogICAgICB9OwogICAgfSwge31dLCAzNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIG8gPyB0KG4ocilbMF0sIHJbMV0pIDogdChyKTsKICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICB2YXIgYyA9IGVbInJldHVybiJdO3Rocm93IHZvaWQgMCAhPT0gYyAmJiBuKGMuY2FsbChlKSksIGk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIgfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1jcmVhdGUiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi9fc2V0LXRvLXN0cmluZy10YWciKSwKICAgICAgICAgIGMgPSB7fTtlKCIuL19oaWRlIikoYywgZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuKGMsIHsgbmV4dDogbygxLCByKSB9KSwgaShlLCB0ICsgIiBJdGVyYXRvciIpOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3LCAiLi9fb2JqZWN0LWNyZWF0ZSI6IDQyLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fc2V0LXRvLXN0cmluZy10YWciOiA1NSwgIi4vX3drcyI6IDY4IH1dLCAzNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuL19saWJyYXJ5IiksCiAgICAgICAgICBvID0gZSgiLi9fZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi9fcmVkZWZpbmUiKSwKICAgICAgICAgIGMgPSBlKCIuL19oaWRlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faXRlcmF0b3JzIiksCiAgICAgICAgICBhID0gZSgiLi9faXRlci1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgXyA9IGUoIi4vX29iamVjdC1ncG8iKSwKICAgICAgICAgIGwgPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGQgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBwID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgdiA9ICJrZXlzIiwKICAgICAgICAgIHkgPSAidmFsdWVzIiwKICAgICAgICAgIGggPSBmdW5jdGlvbiBoKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBiLCBtLCBnLCBqKSB7CiAgICAgICAgYShyLCB0LCBiKTt2YXIgeCwKICAgICAgICAgICAgdywKICAgICAgICAgICAgaywKICAgICAgICAgICAgTyA9IGZ1bmN0aW9uIE8oZSkgewogICAgICAgICAgaWYgKCFkICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSB2OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHk6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIE0gPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIFAgPSBtID09IHksCiAgICAgICAgICAgIFMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBUID0gRVtsXSB8fCBFW3BdIHx8IG0gJiYgRVttXSwKICAgICAgICAgICAgQSA9IFQgfHwgTyhtKSwKICAgICAgICAgICAgVSA9IG0gPyBQID8gTygiZW50cmllcyIpIDogQSA6IHZvaWQgMCwKICAgICAgICAgICAgQyA9ICJBcnJheSIgPT0gdCA/IEUuZW50cmllcyB8fCBUIDogVDtpZiAoQyAmJiAoayA9IF8oQy5jYWxsKG5ldyBlKCkpKSwgayAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiAoZihrLCBNLCAhMCksIG4gfHwgcyhrLCBsKSB8fCBjKGssIGwsIGgpKSksIFAgJiYgVCAmJiBULm5hbWUgIT09IHkgJiYgKFMgPSAhMCwgQSA9IGZ1bmN0aW9uIEEoKSB7CiAgICAgICAgICByZXR1cm4gVC5jYWxsKHRoaXMpOwogICAgICAgIH0pLCBuICYmICFqIHx8ICFkICYmICFTICYmIEVbbF0gfHwgYyhFLCBsLCBBKSwgdVt0XSA9IEEsIHVbTV0gPSBoLCBtKSBpZiAoeCA9IHsgdmFsdWVzOiBQID8gQSA6IE8oeSksIGtleXM6IGcgPyBBIDogTyh2KSwgZW50cmllczogVSB9LCBqKSBmb3IgKHcgaW4geCkgewogICAgICAgICAgdyBpbiBFIHx8IGkoRSwgdywgeFt3XSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKGQgfHwgUyksIHQsIHgpO3JldHVybiB4OwogICAgICB9OwogICAgfSwgeyAiLi9fZXhwb3J0IjogMjIsICIuL19oYXMiOiAyNiwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXItY3JlYXRlIjogMzUsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX2xpYnJhcnkiOiA0MCwgIi4vX29iamVjdC1ncG8iOiA0NiwgIi4vX3JlZGVmaW5lIjogNTIsICIuL19zZXQtdG8tc3RyaW5nLXRhZyI6IDU1LCAiLi9fd2tzIjogNjggfV0sIDM3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChjKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgYyA9IGlbbl0oKTtjLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IHIgPSAhMCB9OwogICAgICAgICAgfSwgaVtuXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICB9LCBlKGkpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9cmV0dXJuIHI7CiAgICAgIH07CiAgICB9LCB7ICIuL193a3MiOiA2OCB9XSwgMzg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiB7IHZhbHVlOiB0LCBkb25lOiAhIWUgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7fTsKICAgIH0sIHt9XSwgNDA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBpID0gbi5NdXRhdGlvbk9ic2VydmVyIHx8IG4uV2ViS2l0TXV0YXRpb25PYnNlcnZlciwKICAgICAgICAgIGMgPSBuLnByb2Nlc3MsCiAgICAgICAgICBzID0gbi5Qcm9taXNlLAogICAgICAgICAgdSA9ICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShjKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHQsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGEgPSBmdW5jdGlvbiBhKCkgewogICAgICAgICAgdmFyIG4sIG87Zm9yICh1ICYmIChuID0gYy5kb21haW4pICYmIG4uZXhpdCgpOyBlOykgewogICAgICAgICAgICBvID0gZS5mbiwgZSA9IGUubmV4dDt0cnkgewogICAgICAgICAgICAgIG8oKTsKICAgICAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgICAgIHRocm93IGUgPyByKCkgOiB0ID0gdm9pZCAwLCBpOwogICAgICAgICAgICB9CiAgICAgICAgICB9dCA9IHZvaWQgMCwgbiAmJiBuLmVudGVyKCk7CiAgICAgICAgfTtpZiAodSkgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBjLm5leHRUaWNrKGEpOwogICAgICAgIH07ZWxzZSBpZiAoaSkgewogICAgICAgICAgdmFyIGYgPSAhMCwKICAgICAgICAgICAgICBfID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBpKGEpLm9ic2VydmUoXywgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIF8uZGF0YSA9IGYgPSAhZjsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChzICYmIHMucmVzb2x2ZSkgewogICAgICAgICAgdmFyIGwgPSBzLnJlc29sdmUoKTtyID0gZnVuY3Rpb24gcigpIHsKICAgICAgICAgICAgbC50aGVuKGEpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBvLmNhbGwobiwgYSk7CiAgICAgICAgfTtyZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBvID0geyBmbjogbiwgbmV4dDogdm9pZCAwIH07dCAmJiAodC5uZXh0ID0gbyksIGUgfHwgKGUgPSBvLCByKCkpLCB0ID0gbzsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUsICIuL19nbG9iYWwiOiAyNSwgIi4vX3Rhc2siOiA2MCB9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX29iamVjdC1kcHMiKSwKICAgICAgICAgIGkgPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIiksCiAgICAgICAgICBjID0gZSgiLi9fc2hhcmVkLWtleSIpKCJJRV9QUk9UTyIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoKSB7fSwKICAgICAgICAgIHUgPSAicHJvdG90eXBlIiwKICAgICAgICAgIF9hID0gZnVuY3Rpb24gYSgpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUoIi4vX2RvbS1jcmVhdGUiKSgiaWZyYW1lIiksCiAgICAgICAgICAgIG4gPSBpLmxlbmd0aCwKICAgICAgICAgICAgbyA9ICI+Ijtmb3IgKHIuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZSgiLi9faHRtbCIpLmFwcGVuZENoaWxkKHIpLCByLnNyYyA9ICJqYXZhc2NyaXB0OiIsIHQgPSByLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQsIHQub3BlbigpLCB0LndyaXRlKCI8c2NyaXB0PmRvY3VtZW50LkY9T2JqZWN0PC9zY3JpcHQiICsgbyksIHQuY2xvc2UoKSwgX2EgPSB0LkY7IG4tLTspIHsKICAgICAgICAgIGRlbGV0ZSBfYVt1XVtpW25dXTsKICAgICAgICB9cmV0dXJuIF9hKCk7CiAgICAgIH07dC5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciByO3JldHVybiBudWxsICE9PSBlID8gKHNbdV0gPSBuKGUpLCByID0gbmV3IHMoKSwgc1t1XSA9IG51bGwsIHJbY10gPSBlKSA6IHIgPSBfYSgpLCB2b2lkIDAgPT09IHQgPyByIDogbyhyLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZW51bS1idWcta2V5cyI6IDIxLCAiLi9faHRtbCI6IDI4LCAiLi9fb2JqZWN0LWRwcyI6IDQ0LCAiLi9fc2hhcmVkLWtleSI6IDU2IH1dLCA0MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1wcmltaXRpdmUiKSwKICAgICAgICAgIGMgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7ci5mID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHQgPSBpKHQsICEwKSwgbihyKSwgbykgdHJ5IHsKICAgICAgICAgIHJldHVybiBjKGUsIHQsIHIpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9aWYgKCJnZXQiIGluIHIgfHwgInNldCIgaW4gcikgdGhyb3cgVHlwZUVycm9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEiKTtyZXR1cm4gInZhbHVlIiBpbiByICYmIChlW3RdID0gci52YWx1ZSksIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2Rlc2NyaXB0b3JzIjogMTksICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19vYmplY3Qta2V5cyIpO3QuZXhwb3J0cyA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgbyhlKTtmb3IgKHZhciByLCBjID0gaSh0KSwgcyA9IGMubGVuZ3RoLCB1ID0gMDsgcyA+IHU7KSB7CiAgICAgICAgICBuLmYoZSwgciA9IGNbdSsrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL19vYmplY3Qta2V5cyI6IDQ4IH1dLCA0NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LXBpZSIpLAogICAgICAgICAgbyA9IGUoIi4vX3Byb3BlcnR5LWRlc2MiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pb2JqZWN0IiksCiAgICAgICAgICBjID0gZSgiLi9fdG8tcHJpbWl0aXZlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO3IuZiA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBhIDogZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoZSA9IGkoZSksIHQgPSBjKHQsICEwKSwgdSkgdHJ5IHsKICAgICAgICAgIHJldHVybiBhKGUsIHQpOwogICAgICAgIH0gY2F0Y2ggKHIpIHt9cmV0dXJuIHMoZSwgdCkgPyBvKCFuLmYuY2FsbChlLCB0KSwgZVt0XSkgOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9faGFzIjogMjYsICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fb2JqZWN0LXBpZSI6IDQ5LCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19oYXMiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIiksCiAgICAgICAgICBjID0gT2JqZWN0LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSA9IG8oZSksIG4oZSwgaSkgPyBlW2ldIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5jb25zdHJ1Y3RvciAmJiBlIGluc3RhbmNlb2YgZS5jb25zdHJ1Y3RvciA/IGUuY29uc3RydWN0b3IucHJvdG90eXBlIDogZSBpbnN0YW5jZW9mIE9iamVjdCA/IGMgOiBudWxsOwogICAgICB9OwogICAgfSwgeyAiLi9faGFzIjogMjYsICIuL19zaGFyZWQta2V5IjogNTYsICIuL190by1vYmplY3QiOiA2NSB9XSwgNDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19hcnJheS1pbmNsdWRlcyIpKCExKSwKICAgICAgICAgIGMgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG8oZSksCiAgICAgICAgICAgIHUgPSAwLAogICAgICAgICAgICBhID0gW107Zm9yIChyIGluIHMpIHsKICAgICAgICAgIHIgIT0gYyAmJiBuKHMsIHIpICYmIGEucHVzaChyKTsKICAgICAgICB9Zm9yICg7IHQubGVuZ3RoID4gdTspIHsKICAgICAgICAgIG4ocywgciA9IHRbdSsrXSkgJiYgKH5pKGEsIHIpIHx8IGEucHVzaChyKSk7CiAgICAgICAgfXJldHVybiBhOwogICAgICB9OwogICAgfSwgeyAiLi9fYXJyYXktaW5jbHVkZXMiOiAxMywgIi4vX2hhcyI6IDI2LCAiLi9fc2hhcmVkLWtleSI6IDU2LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA0ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LWtleXMtaW50ZXJuYWwiKSwKICAgICAgICAgIG8gPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIik7dC5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihlLCBvKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2VudW0tYnVnLWtleXMiOiAyMSwgIi4vX29iamVjdC1rZXlzLWludGVybmFsIjogNDcgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgci5mID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CiAgICB9LCB7fV0sIDUwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4geyBlbnVtZXJhYmxlOiAhKDEgJiBlKSwgY29uZmlndXJhYmxlOiAhKDIgJiBlKSwgd3JpdGFibGU6ICEoNCAmIGUpLCB2YWx1ZTogdCB9OwogICAgICB9OwogICAgfSwge31dLCA1MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faGlkZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyBpbiB0KSB7CiAgICAgICAgICByICYmIGVbb10gPyBlW29dID0gdFtvXSA6IG4oZSwgbywgdFtvXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3IH1dLCA1MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2hpZGUiKTsKICAgIH0sIHsgIi4vX2hpZGUiOiAyNyB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lzLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgaSA9IGZ1bmN0aW9uIGkoZSwgdCkgewogICAgICAgIGlmIChvKGUpLCAhbih0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbiA9IGUoIi4vX2N0eCIpKEZ1bmN0aW9uLmNhbGwsIGUoIi4vX29iamVjdC1nb3BkIikuZihPYmplY3QucHJvdG90eXBlLCAiX19wcm90b19fIikuc2V0LCAyKSwgbih0LCBbXSksIHIgPSAhKHQgaW5zdGFuY2VvZiBBcnJheSk7CiAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGkoZSwgdCksIHIgPyBlLl9fcHJvdG9fXyA9IHQgOiBuKGUsIHQpLCBlOwogICAgICAgICAgfTsKICAgICAgICB9KHt9LCAhMSkgOiB2b2lkIDApLCBjaGVjazogaSB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19jdHgiOiAxNywgIi4vX2lzLW9iamVjdCI6IDMzLCAiLi9fb2JqZWN0LWdvcGQiOiA0NSB9XSwgNTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX29iamVjdC1kcCIpLAogICAgICAgICAgYyA9IGUoIi4vX2Rlc2NyaXB0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi9fd2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2Ygb1tlXSA/IG9bZV0gOiBuW2VdO2MgJiYgdCAmJiAhdFtzXSAmJiBpLmYodCwgcywgeyBjb25maWd1cmFibGU6ICEwLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9IH0pOwogICAgICB9OwogICAgfSwgeyAiLi9fY29yZSI6IDE2LCAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2dsb2JhbCI6IDI1LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL193a3MiOiA2OCB9XSwgNTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1kcCIpLmYsCiAgICAgICAgICBvID0gZSgiLi9faGFzIiksCiAgICAgICAgICBpID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBlICYmICFvKGUgPSByID8gZSA6IGUucHJvdG90eXBlLCBpKSAmJiBuKGUsIGksIHsgY29uZmlndXJhYmxlOiAhMCwgdmFsdWU6IHQgfSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19oYXMiOiAyNiwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fd2tzIjogNjggfV0sIDU2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19zaGFyZWQiKSgia2V5cyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3NoYXJlZCI6IDU3LCAiLi9fdWlkIjogNjcgfV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIG8gPSAiX19jb3JlLWpzX3NoYXJlZF9fIiwKICAgICAgICAgIGkgPSBuW29dIHx8IChuW29dID0ge30pO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlbZV0gfHwgKGlbZV0gPSB7fSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2EtZnVuY3Rpb24iKSwKICAgICAgICAgIGkgPSBlKCIuL193a3MiKSgic3BlY2llcyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGMgPSBuKGUpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDAgPT09IGMgfHwgdm9pZCAwID09IChyID0gbihjKVtpXSkgPyB0IDogbyhyKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5LCAiLi9fYW4tb2JqZWN0IjogMTIsICIuL193a3MiOiA2OCB9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgcyA9IFN0cmluZyhvKHQpKSwKICAgICAgICAgICAgICB1ID0gbihyKSwKICAgICAgICAgICAgICBhID0gcy5sZW5ndGg7cmV0dXJuIDAgPiB1IHx8IHUgPj0gYSA/IGUgPyAiIiA6IHZvaWQgMCA6IChpID0gcy5jaGFyQ29kZUF0KHUpLCA1NTI5NiA+IGkgfHwgaSA+IDU2MzE5IHx8IHUgKyAxID09PSBhIHx8IChjID0gcy5jaGFyQ29kZUF0KHUgKyAxKSkgPCA1NjMyMCB8fCBjID4gNTczNDMgPyBlID8gcy5jaGFyQXQodSkgOiBpIDogZSA/IHMuc2xpY2UodSwgdSArIDIpIDogKGkgLSA1NTI5NiA8PCAxMCkgKyAoYyAtIDU2MzIwKSArIDY1NTM2KTsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9fdG8taW50ZWdlciI6IDYyIH1dLCA2MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBzID0gZSgiLi9faW52b2tlIiksCiAgICAgICAgICB1ID0gZSgiLi9faHRtbCIpLAogICAgICAgICAgYSA9IGUoIi4vX2RvbS1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIF8gPSBmLnByb2Nlc3MsCiAgICAgICAgICBsID0gZi5zZXRJbW1lZGlhdGUsCiAgICAgICAgICBkID0gZi5jbGVhckltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBmLk1lc3NhZ2VDaGFubmVsLAogICAgICAgICAgdiA9IDAsCiAgICAgICAgICB5ID0ge30sCiAgICAgICAgICBoID0gIm9ucmVhZHlzdGF0ZWNoYW5nZSIsCiAgICAgICAgICBiID0gZnVuY3Rpb24gYigpIHsKICAgICAgICB2YXIgZSA9ICt0aGlzO2lmICh5Lmhhc093blByb3BlcnR5KGUpKSB7CiAgICAgICAgICB2YXIgdCA9IHlbZV07ZGVsZXRlIHlbZV0sIHQoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBtID0gZnVuY3Rpb24gbShlKSB7CiAgICAgICAgYi5jYWxsKGUuZGF0YSk7CiAgICAgIH07bCAmJiBkIHx8IChsID0gZnVuY3Rpb24gbChlKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLCByID0gMTsgYXJndW1lbnRzLmxlbmd0aCA+IHI7KSB7CiAgICAgICAgICB0LnB1c2goYXJndW1lbnRzW3IrK10pOwogICAgICAgIH1yZXR1cm4geVsrK3ZdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcygiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZSA6IEZ1bmN0aW9uKGUpLCB0KTsKICAgICAgICB9LCBuKHYpLCB2OwogICAgICB9LCBkID0gZnVuY3Rpb24gZChlKSB7CiAgICAgICAgZGVsZXRlIHlbZV07CiAgICAgIH0sICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShfKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBfLm5leHRUaWNrKGMoYiwgZSwgMSkpOwogICAgICB9IDogcCA/IChvID0gbmV3IHAoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gbSwgbiA9IGMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogZi5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFmLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGYucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtLCAhMSkpIDogbiA9IGggaW4gYSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIHUuYXBwZW5kQ2hpbGQoYSgic2NyaXB0IikpW2hdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdS5yZW1vdmVDaGlsZCh0aGlzKSwgYi5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQoYyhiLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogbCwgY2xlYXI6IGQgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fY3R4IjogMTcsICIuL19kb20tY3JlYXRlIjogMjAsICIuL19nbG9iYWwiOiAyNSwgIi4vX2h0bWwiOiAyOCwgIi4vX2ludm9rZSI6IDMwIH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWF4LAogICAgICAgICAgaSA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgPSBuKGUpLCAwID4gZSA/IG8oZSArIHQsIDApIDogaShlLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3RvLWludGVnZXIiOiA2MiB9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IE1hdGguY2VpbCwKICAgICAgICAgIG8gPSBNYXRoLmZsb29yO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGUgPSArZSkgPyAwIDogKGUgPiAwID8gbyA6IG4pKGUpOwogICAgICB9OwogICAgfSwge31dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2RlZmluZWQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuKG8oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9faW9iamVjdCI6IDMxIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgPiAwID8gbyhuKGUpLCA5MDA3MTk5MjU0NzQwOTkxKSA6IDA7CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbnRlZ2VyIjogNjIgfV0sIDY1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4IH1dLCA2NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIW4oZSkpIHJldHVybiBlO3ZhciByLCBvO2lmICh0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIChyID0gZS50b1N0cmluZykgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudmFsdWVPZikgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICghdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudG9TdHJpbmcpICYmICFuKG8gPSByLmNhbGwoZSkpKSByZXR1cm4gbzt0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwogICAgICB9OwogICAgfSwgeyAiLi9faXMtb2JqZWN0IjogMzMgfV0sIDY3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSAwLAogICAgICAgICAgbyA9IE1hdGgucmFuZG9tKCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN5bWJvbCgiLmNvbmNhdCh2b2lkIDAgPT09IGUgPyAiIiA6IGUsICIpXyIsICgrK24gKyBvKS50b1N0cmluZygzNikpOwogICAgICB9OwogICAgfSwge31dLCA2ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpLAogICAgICAgICAgaSA9IGUoIi4vX2dsb2JhbCIpLlN5bWJvbCwKICAgICAgICAgIGMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBpLAogICAgICAgICAgcyA9IHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBjICYmIGlbZV0gfHwgKGMgPyBpIDogbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9O3Muc3RvcmUgPSBuOwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19zaGFyZWQiOiA1NywgIi4vX3VpZCI6IDY3IH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY2xhc3NvZiIpLAogICAgICAgICAgbyA9IGUoIi4vX3drcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vX2NvcmUiKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPSBlID8gZVtvXSB8fCBlWyJAQGl0ZXJhdG9yIl0gfHwgaVtuKGUpXSA6IHZvaWQgMDsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjggfV0sIDcwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX2FkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vX2l0ZXItc3RlcCIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLAogICAgICAgICAgYyA9IGUoIi4vX3RvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuL19pdGVyLWRlZmluZSIpKEFycmF5LCAiQXJyYXkiLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHRoaXMuX3QgPSBjKGUpLCB0aGlzLl9pID0gMCwgdGhpcy5fayA9IHQ7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuX3QsCiAgICAgICAgICAgIHQgPSB0aGlzLl9rLAogICAgICAgICAgICByID0gdGhpcy5faSsrO3JldHVybiAhZSB8fCByID49IGUubGVuZ3RoID8gKHRoaXMuX3QgPSB2b2lkIDAsIG8oMSkpIDogImtleXMiID09IHQgPyBvKDAsIHIpIDogInZhbHVlcyIgPT0gdCA/IG8oMCwgZVtyXSkgOiBvKDAsIFtyLCBlW3JdXSk7CiAgICAgIH0sICJ2YWx1ZXMiKSwgaS5Bcmd1bWVudHMgPSBpLkFycmF5LCBuKCJrZXlzIiksIG4oInZhbHVlcyIpLCBuKCJlbnRyaWVzIik7CiAgICB9LCB7ICIuL19hZGQtdG8tdW5zY29wYWJsZXMiOiAxMCwgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19pdGVyLXN0ZXAiOiAzOCwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZXhwb3J0Iik7bihuLlMgKyBuLkYgKiAhZSgiLi9fZGVzY3JpcHRvcnMiKSwgIk9iamVjdCIsIHsgZGVmaW5lUHJvcGVydHk6IGUoIi4vX29iamVjdC1kcCIpLmYgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZXhwb3J0IjogMjIsICIuL19vYmplY3QtZHAiOiA0MyB9XSwgNzI6IFtmdW5jdGlvbiAoZSwgdCwgcikge30sIHt9XSwgNzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fbGlicmFyeSIpLAogICAgICAgICAgcyA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgdSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYSA9IGUoIi4vX2NsYXNzb2YiKSwKICAgICAgICAgIGYgPSBlKCIuL19leHBvcnQiKSwKICAgICAgICAgIF8gPSBlKCIuL19pcy1vYmplY3QiKSwKICAgICAgICAgIGwgPSAoZSgiLi9fYW4tb2JqZWN0IiksIGUoIi4vX2EtZnVuY3Rpb24iKSksCiAgICAgICAgICBkID0gZSgiLi9fYW4taW5zdGFuY2UiKSwKICAgICAgICAgIHAgPSBlKCIuL19mb3Itb2YiKSwKICAgICAgICAgIHYgPSAoZSgiLi9fc2V0LXByb3RvIikuc2V0LCBlKCIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIikpLAogICAgICAgICAgeSA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBoID0gZSgiLi9fbWljcm90YXNrIikoKSwKICAgICAgICAgIGIgPSAiUHJvbWlzZSIsCiAgICAgICAgICBtID0gcy5UeXBlRXJyb3IsCiAgICAgICAgICBnID0gcy5wcm9jZXNzLAogICAgICAgICAgX2ogPSBzW2JdLAogICAgICAgICAgZyA9IHMucHJvY2VzcywKICAgICAgICAgIHggPSAicHJvY2VzcyIgPT0gYShnKSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KCkge30sCiAgICAgICAgICBrID0gISFmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciB0ID0gX2oucmVzb2x2ZSgxKSwKICAgICAgICAgICAgICByID0gKHQuY29uc3RydWN0b3IgPSB7fSlbZSgiLi9fd2tzIikoInNwZWNpZXMiKV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlKHcsIHcpOwogICAgICAgICAgfTtyZXR1cm4gKHggfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgUHJvbWlzZVJlamVjdGlvbkV2ZW50KSAmJiB0LnRoZW4odykgaW5zdGFuY2VvZiByOwogICAgICAgIH0gY2F0Y2ggKG4pIHt9CiAgICAgIH0oKSwKICAgICAgICAgIE8gPSBmdW5jdGlvbiBPKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSA9PT0gdCB8fCBlID09PSBfaiAmJiB0ID09PSBpOwogICAgICB9LAogICAgICAgICAgTSA9IGZ1bmN0aW9uIE0oZSkgewogICAgICAgIHZhciB0O3JldHVybiBfKGUpICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mICh0ID0gZS50aGVuKSA/IHQgOiAhMTsKICAgICAgfSwKICAgICAgICAgIFAgPSBmdW5jdGlvbiBQKGUpIHsKICAgICAgICByZXR1cm4gTyhfaiwgZSkgPyBuZXcgUyhlKSA6IG5ldyBvKGUpOwogICAgICB9LAogICAgICAgICAgUyA9IG8gPSBmdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCwgcjt0aGlzLnByb21pc2UgPSBuZXcgZShmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCB8fCB2b2lkIDAgIT09IHIpIHRocm93IG0oIkJhZCBQcm9taXNlIGNvbnN0cnVjdG9yIik7dCA9IGUsIHIgPSBuOwogICAgICAgIH0pLCB0aGlzLnJlc29sdmUgPSBsKHQpLCB0aGlzLnJlamVjdCA9IGwocik7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4geyBlcnJvcjogdCB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIFQgPSBmdW5jdGlvbiBUKGUsIHQpIHsKICAgICAgICBpZiAoIWUuX24pIHsKICAgICAgICAgIGUuX24gPSAhMDt2YXIgciA9IGUuX2M7aChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSBlLl92LCBvID0gMSA9PSBlLl9zLCBpID0gMCwgYyA9IGZ1bmN0aW9uIGModCkgewogICAgICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICBjID0gbyA/IHQub2sgOiB0LmZhaWwsCiAgICAgICAgICAgICAgICAgIHMgPSB0LnJlc29sdmUsCiAgICAgICAgICAgICAgICAgIHUgPSB0LnJlamVjdCwKICAgICAgICAgICAgICAgICAgYSA9IHQuZG9tYWluO3RyeSB7CiAgICAgICAgICAgICAgICBjID8gKG8gfHwgKDIgPT0gZS5faCAmJiBDKGUpLCBlLl9oID0gMSksIGMgPT09ICEwID8gciA9IG4gOiAoYSAmJiBhLmVudGVyKCksIHIgPSBjKG4pLCBhICYmIGEuZXhpdCgpKSwgciA9PT0gdC5wcm9taXNlID8gdShtKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBNKHIpKSA/IGkuY2FsbChyLCBzLCB1KSA6IHMocikpIDogdShuKTsKICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICB1KGYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGMocltpKytdKTsKICAgICAgICAgICAgfWUuX2MgPSBbXSwgZS5fbiA9ICExLCB0ICYmICFlLl9oICYmIEEoZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBBID0gZnVuY3Rpb24gQShlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0LAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICBvID0gZS5fdjtpZiAoVShlKSAmJiAodCA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB4ID8gZy5lbWl0KCJ1bmhhbmRsZWRSZWplY3Rpb24iLCBvLCBlKSA6IChyID0gcy5vbnVuaGFuZGxlZHJlamVjdGlvbikgPyByKHsgcHJvbWlzZTogZSwgcmVhc29uOiBvIH0pIDogKG4gPSBzLmNvbnNvbGUpICYmIG4uZXJyb3IgJiYgbi5lcnJvcigiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIiwgbyk7CiAgICAgICAgICB9KSwgZS5faCA9IHggfHwgVShlKSA/IDIgOiAxKSwgZS5fYSA9IHZvaWQgMCwgdCkgdGhyb3cgdC5lcnJvcjsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgICAgIFUgPSBmdW5jdGlvbiBVKGUpIHsKICAgICAgICBpZiAoMSA9PSBlLl9oKSByZXR1cm4gITE7Zm9yICh2YXIgdCwgciA9IGUuX2EgfHwgZS5fYywgbiA9IDA7IHIubGVuZ3RoID4gbjspIHsKICAgICAgICAgIGlmICh0ID0gcltuKytdLCB0LmZhaWwgfHwgIVUodC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBDID0gZnVuY3Rpb24gQyhlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0O3ggPyBnLmVtaXQoInJlamVjdGlvbkhhbmRsZWQiLCBlKSA6ICh0ID0gcy5vbnJlamVjdGlvbmhhbmRsZWQpICYmIHQoeyBwcm9taXNlOiBlLCByZWFzb246IGUuX3YgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuX2QgfHwgKHQuX2QgPSAhMCwgdCA9IHQuX3cgfHwgdCwgdC5fdiA9IGUsIHQuX3MgPSAyLCB0Ll9hIHx8ICh0Ll9hID0gdC5fYy5zbGljZSgpKSwgVCh0LCAhMCkpOwogICAgICB9LAogICAgICAgICAgTCA9IGZ1bmN0aW9uIEwoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICByID0gdGhpcztpZiAoIXIuX2QpIHsKICAgICAgICAgIHIuX2QgPSAhMCwgciA9IHIuX3cgfHwgcjt0cnkgewogICAgICAgICAgICBpZiAociA9PT0gZSkgdGhyb3cgbSgiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsodCA9IE0oZSkpID8gaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7IF93OiByLCBfZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIHUoTCwgbiwgMSksIHUoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIuX3YgPSBlLCByLl9zID0gMSwgVChyLCAhMSkpOwogICAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgICBSLmNhbGwoeyBfdzogciwgX2Q6ICExIH0sIG4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTtrIHx8IChfaiA9IGZ1bmN0aW9uIGooZSkgewogICAgICAgIGQodGhpcywgX2osIGIsICJfaCIpLCBsKGUpLCBuLmNhbGwodGhpcyk7dHJ5IHsKICAgICAgICAgIGUodShMLCB0aGlzLCAxKSwgdShSLCB0aGlzLCAxKSk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgUi5jYWxsKHRoaXMsIHQpOwogICAgICAgIH0KICAgICAgfSwgbiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHRoaXMuX2MgPSBbXSwgdGhpcy5fYSA9IHZvaWQgMCwgdGhpcy5fcyA9IDAsIHRoaXMuX2QgPSAhMSwgdGhpcy5fdiA9IHZvaWQgMCwgdGhpcy5faCA9IDAsIHRoaXMuX24gPSAhMTsKICAgICAgfSwgbi5wcm90b3R5cGUgPSBlKCIuL19yZWRlZmluZS1hbGwiKShfai5wcm90b3R5cGUsIHsgdGhlbjogZnVuY3Rpb24gdGhlbihlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IFAodih0aGlzLCBfaikpO3JldHVybiByLm9rID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IGUgOiAhMCwgci5mYWlsID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdCAmJiB0LCByLmRvbWFpbiA9IHggPyBnLmRvbWFpbiA6IHZvaWQgMCwgdGhpcy5fYy5wdXNoKHIpLCB0aGlzLl9hICYmIHRoaXMuX2EucHVzaChyKSwgdGhpcy5fcyAmJiBUKHRoaXMsICExKSwgci5wcm9taXNlOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSwgUyA9IGZ1bmN0aW9uIFMoKSB7CiAgICAgICAgdmFyIGUgPSBuZXcgbigpO3RoaXMucHJvbWlzZSA9IGUsIHRoaXMucmVzb2x2ZSA9IHUoTCwgZSwgMSksIHRoaXMucmVqZWN0ID0gdShSLCBlLCAxKTsKICAgICAgfSksIGYoZi5HICsgZi5XICsgZi5GICogIWssIHsgUHJvbWlzZTogX2ogfSksIGUoIi4vX3NldC10by1zdHJpbmctdGFnIikoX2osIGIpLCBlKCIuL19zZXQtc3BlY2llcyIpKGIpLCBpID0gZSgiLi9fY29yZSIpW2JdLCBmKGYuUyArIGYuRiAqICFrLCBiLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gUCh0aGlzKSwKICAgICAgICAgICAgICByID0gdC5yZWplY3Q7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqIChjIHx8ICFrKSwgYiwgeyByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKGUpIHsKICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX2ogJiYgTyhlLmNvbnN0cnVjdG9yLCB0aGlzKSkgcmV0dXJuIGU7dmFyIHQgPSBQKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqICEoayAmJiBlKCIuL19pdGVyLWRldGVjdCIpKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX2ouYWxsKGUpWyJjYXRjaCJdKHcpOwogICAgICB9KSksIGIsIHsgYWxsOiBmdW5jdGlvbiBhbGwoZSkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgIHIgPSBQKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgbyA9IHIucmVqZWN0LAogICAgICAgICAgICAgIGkgPSBFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHIgPSBbXSwKICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgYyA9IDE7cChlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgcyA9IGkrKywKICAgICAgICAgICAgICAgICAgdSA9ICExO3IucHVzaCh2b2lkIDApLCBjKyssIHQucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB1IHx8ICh1ID0gITAsIHJbc10gPSBlLCAtLWMgfHwgbihyKSk7CiAgICAgICAgICAgICAgfSwgbyk7CiAgICAgICAgICAgIH0pLCAtLWMgfHwgbihyKTsKICAgICAgICAgIH0pO3JldHVybiBpICYmIG8oaS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICByID0gUCh0KSwKICAgICAgICAgICAgICBuID0gci5yZWplY3QsCiAgICAgICAgICAgICAgbyA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBwKGUsICExLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQucmVzb2x2ZShlKS50aGVuKHIucmVzb2x2ZSwgbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7cmV0dXJuIG8gJiYgbihvLmVycm9yKSwgci5wcm9taXNlOwogICAgICAgIH0gfSk7CiAgICB9LCB7ICIuL19hLWZ1bmN0aW9uIjogOSwgIi4vX2FuLWluc3RhbmNlIjogMTEsICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2N0eCI6IDE3LCAiLi9fZXhwb3J0IjogMjIsICIuL19mb3Itb2YiOiAyNCwgIi4vX2dsb2JhbCI6IDI1LCAiLi9faXMtb2JqZWN0IjogMzMsICIuL19pdGVyLWRldGVjdCI6IDM3LCAiLi9fbGlicmFyeSI6IDQwLCAiLi9fbWljcm90YXNrIjogNDEsICIuL19yZWRlZmluZS1hbGwiOiA1MSwgIi4vX3NldC1wcm90byI6IDUzLCAiLi9fc2V0LXNwZWNpZXMiOiA1NCwgIi4vX3NldC10by1zdHJpbmctdGFnIjogNTUsICIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIjogNTgsICIuL190YXNrIjogNjAsICIuL193a3MiOiA2OCB9XSwgNzQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fc3RyaW5nLWF0IikoITApO2UoIi4vX2l0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19zdHJpbmctYXQiOiA1OSB9XSwgNzU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO2ZvciAodmFyIG4gPSBlKCIuL19nbG9iYWwiKSwgbyA9IGUoIi4vX2hpZGUiKSwgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLCBjID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIiksIHMgPSBbIk5vZGVMaXN0IiwgIkRPTVRva2VuTGlzdCIsICJNZWRpYUxpc3QiLCAiU3R5bGVTaGVldExpc3QiLCAiQ1NTUnVsZUxpc3QiXSwgdSA9IDA7IDUgPiB1OyB1KyspIHsKICAgICAgICB2YXIgYSA9IHNbdV0sCiAgICAgICAgICAgIGYgPSBuW2FdLAogICAgICAgICAgICBfID0gZiAmJiBmLnByb3RvdHlwZTtfICYmICFfW2NdICYmIG8oXywgYywgYSksIGlbYV0gPSBpLkFycmF5OwogICAgICB9CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjgsICIuL2VzNi5hcnJheS5pdGVyYXRvciI6IDcwIH1dLCA3NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoIi4vaHlwZXJ0eS1kaXNjb3ZlcnkvSHlwZXJ0eURpc2NvdmVyeSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gaVsiZGVmYXVsdCJdLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL2h5cGVydHktZGlzY292ZXJ5L0h5cGVydHlEaXNjb3ZlcnkiOiA3NyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBzID0gbihjKSwKICAgICAgICAgIHUgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHUpLAogICAgICAgICAgZiA9IGUoIi4uL3V0aWxzL3V0aWxzIiksCiAgICAgICAgICBfID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgcikgewogICAgICAgICAgKDAsIHNbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIG4gPSB0aGlzO24ubWVzc2FnZUJ1cyA9IHIsIG4uZG9tYWluID0gKDAsIGYuZGl2aWRlVVJMKSh0KS5kb21haW4sIG4uZGlzY292ZXJ5VVJMID0gdDsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImRpc2NvdmVyRGF0YU9iamVjdFBlck5hbWUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiAiZGF0YU9iamVjdDovLyIgKyBlIH0gfTtyZXR1cm4gbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShvLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgdmFyIG4gPSByLmJvZHkudmFsdWUudXJsO24gPyBlKG4pIDogdCgiRGF0YU9iamVjdCBuYW1lIGRvZXMgbm90IGV4aXN0Iik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImRpc2NvdmVySHlwZXJ0eVBlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2U6ICIsIGMsIG4sIG8pLCBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgci5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKGMsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibWVzc2FnZSByZXBseSIsIHIpO3ZhciBvID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAgIGkgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgYyA9IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBzID0gci5ib2R5LnZhbHVlO2ZvciAobyBpbiBzKSB7CiAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHNbb10ubGFzdE1vZGlmaWVkKSBpZiAodm9pZCAwID09PSBpKSBpID0gbmV3IERhdGUoc1tvXS5sYXN0TW9kaWZpZWQpLCBjID0gbztlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IG5ldyBEYXRlKHNbb10ubGFzdE1vZGlmaWVkKTtpLmdldFRpbWUoKSA8IHUuZ2V0VGltZSgpICYmIChpID0gdSwgYyA9IG8pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9Y29uc29sZS5sb2coIkxhc3QgSHlwZXJ0eTogIiwgYywgaSk7dmFyIGEgPSBjO2lmICh2b2lkIDAgPT09IGEpIHJldHVybiBuKCJVc2VyIEh5cGVydHkgbm90IGZvdW5kIik7dmFyIGYgPSB7IGlkOiBlLCBkZXNjcmlwdG9yOiBzW2FdLmRlc2NyaXB0b3IsIGh5cGVydHlVUkw6IGEgfTtjb25zb2xlLmxvZygiPT09PiBoeXBlcnR5RGlzY292ZXJ5IG1lc3NhZ2VCdW5kbGU6ICIsIGYpLCB0KGYpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkaXNjb3Zlckh5cGVydGllc1BlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2UgZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyOiAiLCBjLCBuLCBvKSwgbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShjLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlciByZXBseSIsIHIpO3ZhciBuID0gci5ib2R5LnZhbHVlO3JldHVybiBuID8gdm9pZCBlKG4pIDogdCgiVXNlciBIeXBlcnR5IG5vdCBmb3VuZCIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gXywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMiOiA3OCwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogMywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiA1IH1dLCA3ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1mdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpLAogICAgICAgICAgICByID0gIiQxLCQyLCQzIiwKICAgICAgICAgICAgbiA9IGUucmVwbGFjZSh0LCByKS5zcGxpdCgiLCIpO25bMF0gPT09IGUgJiYgKG5bMF0gPSAiaHR0cHMiLCBuWzFdID0gZSk7dmFyIG8gPSB7IHR5cGU6IG5bMF0sIGRvbWFpbjogblsxXSwgaWRlbnRpdHk6IG5bMl0gfTtyZXR1cm4gbzsKICAgICAgfWZ1bmN0aW9uIGkoZSkgewogICAgICAgIHJldHVybiBlID8gSlNPTi5wYXJzZSgoMCwgc1siZGVmYXVsdCJdKShlKSkgOiB2b2lkIDA7CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgYyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSIpLAogICAgICAgICAgcyA9IG4oYyk7ci5kaXZpZGVVUkwgPSBvLCByLmRlZXBDbG9uZSA9IGk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvanNvbi9zdHJpbmdpZnkiOiAxIH1dIH0sIHt9LCBbNzZdKSg3Nik7Cn0pOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CiJ1c2Ugc3RyaWN0IjsKCnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsKCi8qKgoqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQoqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KKgoqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioqLwoKLy8gRGlzdHJpYnV0aW9uIGZpbGUgZm9yIFN5bmNoZXIuanMKLy8gdmVyc2lvbjogMC4yLjAKCiFmdW5jdGlvbiAoZSkgewogIGlmICgib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbW9kdWxlKSBtb2R1bGUuZXhwb3J0cyA9IGUoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCBlKTtlbHNlIHsKICAgIHZhciB0O3QgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHRoaXMsIHQuU3luY2hlciA9IGUoKTsKICB9Cn0oZnVuY3Rpb24gKCkgewogIHJldHVybiBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgIGZ1bmN0aW9uIG8ocywgYSkgewogICAgICBpZiAoIXJbc10pIHsKICAgICAgICBpZiAoIXRbc10pIHsKICAgICAgICAgIHZhciBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlO2lmICghYSAmJiBjKSByZXR1cm4gYyhzLCAhMCk7aWYgKGkpIHJldHVybiBpKHMsICEwKTt2YXIgdSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgcyArICInIik7dGhyb3cgdS5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCB1OwogICAgICAgIH12YXIgbCA9IHJbc10gPSB7IGV4cG9ydHM6IHt9IH07dFtzXVswXS5jYWxsKGwuZXhwb3J0cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gdFtzXVsxXVtlXTtyZXR1cm4gbyhyID8gciA6IGUpOwogICAgICAgIH0sIGwsIGwuZXhwb3J0cywgZSwgdCwgciwgbik7CiAgICAgIH1yZXR1cm4gcltzXS5leHBvcnRzOwogICAgfWZvciAodmFyIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmUsIHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgewogICAgICBvKG5bc10pOwogICAgfXJldHVybiBvOwogIH0oeyAxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgJiYgIUFycmF5Lm9ic2VydmUgJiYgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHIgPSBlLmdldE5vdGlmaWVyLAogICAgICAgICAgICBuID0gInBlcmZvcm1DaGFuZ2UiLAogICAgICAgICAgICBvID0gIl9vcmlnaW5hbCIsCiAgICAgICAgICAgIGkgPSAic3BsaWNlIiwKICAgICAgICAgICAgcyA9IHsgcHVzaDogZnVuY3Rpb24gYyhlKSB7CiAgICAgICAgICAgIHZhciB0ID0gYXJndW1lbnRzLAogICAgICAgICAgICAgICAgcyA9IGNbb10uYXBwbHkodGhpcywgdCk7cmV0dXJuIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiBzIC0gdC5sZW5ndGgsIGFkZGVkQ291bnQ6IHQubGVuZ3RoLCByZW1vdmVkOiBbXSB9OwogICAgICAgICAgICB9KSwgczsKICAgICAgICAgIH0sIHVuc2hpZnQ6IGZ1bmN0aW9uIHUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIHMgPSB1W29dLmFwcGx5KHRoaXMsIHQpO3JldHVybiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogMCwgYWRkZWRDb3VudDogdC5sZW5ndGgsIHJlbW92ZWQ6IFtdIH07CiAgICAgICAgICAgIH0pLCBzOwogICAgICAgICAgfSwgcG9wOiBmdW5jdGlvbiBsKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgICAgICAgdCA9IGxbb10uY2FsbCh0aGlzKTtyZXR1cm4gdGhpcy5sZW5ndGggIT09IGUgJiYgcih0aGlzKVtuXShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IHRoaXMubGVuZ3RoLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzaGlmdDogZnVuY3Rpb24gZigpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHQgPSBmW29dLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMubGVuZ3RoICE9PSBlICYmIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiAwLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzcGxpY2U6IGZ1bmN0aW9uIGQoZSwgdCkgewogICAgICAgICAgICB2YXIgcyA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIGEgPSBkW29dLmFwcGx5KHRoaXMsIHMpO3JldHVybiAoYS5sZW5ndGggfHwgcy5sZW5ndGggPiAyKSAmJiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogZSwgYWRkZWRDb3VudDogcy5sZW5ndGggLSAyLCByZW1vdmVkOiBhIH07CiAgICAgICAgICAgIH0sIHRoaXMpLCBhOwogICAgICAgICAgfSB9O2ZvciAodmFyIGEgaW4gcykgewogICAgICAgICAgc1thXVtvXSA9IHQucHJvdG90eXBlW2FdLCB0LnByb3RvdHlwZVthXSA9IHNbYV07CiAgICAgICAgfXQub2JzZXJ2ZSA9IGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICByZXR1cm4gZS5vYnNlcnZlKHQsIHIsIFsiYWRkIiwgInVwZGF0ZSIsICJkZWxldGUiLCBpXSk7CiAgICAgICAgfSwgdC51bm9ic2VydmUgPSBlLnVub2JzZXJ2ZTsKICAgICAgfShPYmplY3QsIEFycmF5KTsKICAgIH0sIHt9XSwgMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9qc29uL3N0cmluZ2lmeSI6IDE3IH1dLCAzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2NyZWF0ZSI6IDE4IH1dLCA0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDE5IH1dLCA1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6IDIwIH1dLCA2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogMjEgfV0sIDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2tleXMiOiAyMiB9XSwgODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDIzIH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSI6IDI0IH1dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIjogMjUgfV0sIDExOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICByLl9fZXNNb2R1bGUgPSAhMCwgclsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgdCkpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9OwogICAgfSwge31dLCAxMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoIi4uL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtyXTtuLmVudW1lcmFibGUgPSBuLmVudW1lcmFibGUgfHwgITEsIG4uY29uZmlndXJhYmxlID0gITAsICJ2YWx1ZSIgaW4gbiAmJiAobi53cml0YWJsZSA9ICEwKSwgKDAsIGlbImRlZmF1bHQiXSkoZSwgbi5rZXksIG4pOwogICAgICAgICAgfQogICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKHQsIHIsIG4pIHsKICAgICAgICAgIHJldHVybiByICYmIGUodC5wcm90b3R5cGUsIHIpLCBuICYmIGUodCwgbiksIHQ7CiAgICAgICAgfTsKICAgICAgfSgpOwogICAgfSwgeyAiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjogNCB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKVsiZGVmYXVsdCJdO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyA9ICEwOyBvOykgewogICAgICAgICAgdmFyIGkgPSBlLAogICAgICAgICAgICAgIHMgPSB0LAogICAgICAgICAgICAgIGEgPSByO28gPSAhMSwgbnVsbCA9PT0gaSAmJiAoaSA9IEZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIGMgPSBuKGksIHMpO2lmICh2b2lkIDAgIT09IGMpIHsKICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gYykgcmV0dXJuIGMudmFsdWU7dmFyIHUgPSBjLmdldDtpZiAodm9pZCAwID09PSB1KSByZXR1cm47cmV0dXJuIHUuY2FsbChhKTsKICAgICAgICAgIH12YXIgbCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpKTtpZiAobnVsbCA9PT0gbCkgcmV0dXJuO2UgPSBsLCB0ID0gcywgciA9IGEsIG8gPSAhMCwgYyA9IGwgPSB2b2lkIDA7CiAgICAgICAgfQogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjogNSB9XSwgMTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9jcmVhdGUiKVsiZGVmYXVsdCJdLAogICAgICAgICAgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCAmJiBudWxsICE9PSB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSk7ZS5wcm90b3R5cGUgPSBuKHQgJiYgdC5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IGUsIGVudW1lcmFibGU6ICExLCB3cml0YWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAgfSB9KSwgdCAmJiAobyA/IG8oZSwgdCkgOiBlLl9fcHJvdG9fXyA9IHQpOwogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvY3JlYXRlIjogMywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfXIuX19lc01vZHVsZSA9ICEwO3ZhciBvID0gZSgiLi4vaGVscGVycy90eXBlb2YiKSwKICAgICAgICAgIGkgPSBuKG8pO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCFlKSB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiAhdCB8fCAib2JqZWN0IiAhPT0gKCJ1bmRlZmluZWQiID09IHR5cGVvZiB0ID8gInVuZGVmaW5lZCIgOiAoMCwgaVsiZGVmYXVsdCJdKSh0KSkgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCA/IGUgOiB0OwogICAgICB9OwogICAgfSwgeyAiLi4vaGVscGVycy90eXBlb2YiOiAxNiB9XSwgMTY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLmNvbnN0cnVjdG9yID09PSBuID8gInN5bWJvbCIgOiB0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSk7CiAgICAgIH0sIHIuX19lc01vZHVsZSA9ICEwOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCI6IDEwIH1dLCAxNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAobi5KU09OICYmIG4uSlNPTi5zdHJpbmdpZnkgfHwgSlNPTi5zdHJpbmdpZnkpLmFwcGx5KEpTT04sIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxIH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbi5jcmVhdGUoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiB9XSwgMTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uc2V0RGVzYyhlLCB0LCByKTsKICAgICAgfTsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJCI6IDU2IH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7ZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmdldERlc2MoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOiA4MSB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiI6IDgyIH1dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LmtleXM7CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmtleXMiOiA4MyB9XSwgMjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiI6IDg0IH1dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciKSwgZSgiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksIGUoIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSIpLCBlKCIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIiksIHQuZXhwb3J0cyA9IGUoIi4uL21vZHVsZXMvJC5jb3JlIikuUHJvbWlzZTsKICAgIH0sIHsgIi4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogODUsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogODYsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA4NywgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDg5IH1dLCAyNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCIpLCBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuU3ltYm9sOwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOiAzMSwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOiA4NSwgIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCI6IDg4IH1dLCAyNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYSBmdW5jdGlvbiEiKTtyZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHt9XSwgMjc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7fTsKICAgIH0sIHt9XSwgMjg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXMtb2JqZWN0IjogNDkgfV0sIDI5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpLAogICAgICAgICAgaSA9ICJBcmd1bWVudHMiID09IG4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICAgIH0oKSk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwgciwgcztyZXR1cm4gdm9pZCAwID09PSBlID8gIlVuZGVmaW5lZCIgOiBudWxsID09PSBlID8gIk51bGwiIDogInN0cmluZyIgPT0gdHlwZW9mIChyID0gKHQgPSBPYmplY3QoZSkpW29dKSA/IHIgOiBpID8gbih0KSA6ICJPYmplY3QiID09IChzID0gbih0KSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5jYWxsZWUgPyAiQXJndW1lbnRzIiA6IHM7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAsICIuLyQud2tzIjogNzggfV0sIDMwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAzMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMS4yLjYiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuYS1mdW5jdGlvbiIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHZvaWQgMCA9PT0gdCkgcmV0dXJuIGU7c3dpdGNoIChyKSB7Y2FzZSAxOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIpOwogICAgICAgICAgICB9O2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuKTsKICAgICAgICAgICAgfTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbiwgbykgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgciwgbiwgbyk7CiAgICAgICAgICAgIH07fXJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYS1mdW5jdGlvbiI6IDI2IH1dLCAzMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDM0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vJC5mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pLmE7CiAgICAgIH0pOwogICAgfSwgeyAiLi8kLmZhaWxzIjogMzggfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi8kLmdsb2JhbCIpLmRvY3VtZW50LAogICAgICAgICAgaSA9IG4obykgJiYgbihvLmNyZWF0ZUVsZW1lbnQpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGkgPyBvLmNyZWF0ZUVsZW1lbnQoZSkgOiB7fTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgMzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBuLmdldEtleXMoZSksCiAgICAgICAgICAgIHIgPSBuLmdldFN5bWJvbHM7aWYgKHIpIGZvciAodmFyIG8sIGkgPSByKGUpLCBzID0gbi5pc0VudW0sIGEgPSAwOyBpLmxlbmd0aCA+IGE7KSB7CiAgICAgICAgICBzLmNhbGwoZSwgbyA9IGlbYSsrXSkgJiYgdC5wdXNoKG8pOwogICAgICAgIH1yZXR1cm4gdDsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2IH1dLCAzNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5jb3JlIiksCiAgICAgICAgICBpID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgcyA9ICJwcm90b3R5cGUiLAogICAgICAgICAgYSA9IGZ1bmN0aW9uIGEoZSwgdCwgcikgewogICAgICAgIHZhciBjLAogICAgICAgICAgICB1LAogICAgICAgICAgICBsLAogICAgICAgICAgICBmID0gZSAmIGEuRiwKICAgICAgICAgICAgZCA9IGUgJiBhLkcsCiAgICAgICAgICAgIHAgPSBlICYgYS5TLAogICAgICAgICAgICBiID0gZSAmIGEuUCwKICAgICAgICAgICAgaCA9IGUgJiBhLkIsCiAgICAgICAgICAgIHYgPSBlICYgYS5XLAogICAgICAgICAgICB5ID0gZCA/IG8gOiBvW3RdIHx8IChvW3RdID0ge30pLAogICAgICAgICAgICBfID0gZCA/IG4gOiBwID8gblt0XSA6IChuW3RdIHx8IHt9KVtzXTtkICYmIChyID0gdCk7Zm9yIChjIGluIHIpIHsKICAgICAgICAgIHUgPSAhZiAmJiBfICYmIGMgaW4gXywgdSAmJiBjIGluIHkgfHwgKGwgPSB1ID8gX1tjXSA6IHJbY10sIHlbY10gPSBkICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIF9bY10gPyByW2NdIDogaCAmJiB1ID8gaShsLCBuKSA6IHYgJiYgX1tjXSA9PSBsID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBmdW5jdGlvbiB0KF90KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBlID8gbmV3IGUoX3QpIDogZShfdCk7CiAgICAgICAgICAgIH07cmV0dXJuIHRbc10gPSBlW3NdLCB0OwogICAgICAgICAgfShsKSA6IGIgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgbCA/IGkoRnVuY3Rpb24uY2FsbCwgbCkgOiBsLCBiICYmICgoeVtzXSB8fCAoeVtzXSA9IHt9KSlbY10gPSBsKSk7CiAgICAgICAgfQogICAgICB9O2EuRiA9IDEsIGEuRyA9IDIsIGEuUyA9IDQsIGEuUCA9IDgsIGEuQiA9IDE2LCBhLlcgPSAzMiwgdC5leHBvcnRzID0gYTsKICAgIH0sIHsgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZ2xvYmFsIjogNDEgfV0sIDM4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuICEhZSgpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7fV0sIDM5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY3R4IiksCiAgICAgICAgICBvID0gZSgiLi8kLml0ZXItY2FsbCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5pcy1hcnJheS1pdGVyIiksCiAgICAgICAgICBzID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgYSA9IGUoIi4vJC50by1sZW5ndGgiKSwKICAgICAgICAgIGMgPSBlKCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCB1KSB7CiAgICAgICAgdmFyIGwsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIHAgPSBjKGUpLAogICAgICAgICAgICBiID0gbihyLCB1LCB0ID8gMiA6IDEpLAogICAgICAgICAgICBoID0gMDtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcCkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBpdGVyYWJsZSEiKTtpZiAoaShwKSkgZm9yIChsID0gYShlLmxlbmd0aCk7IGwgPiBoOyBoKyspIHsKICAgICAgICAgIHQgPyBiKHMoZiA9IGVbaF0pWzBdLCBmWzFdKSA6IGIoZVtoXSk7CiAgICAgICAgfSBlbHNlIGZvciAoZCA9IHAuY2FsbChlKTsgIShmID0gZC5uZXh0KCkpLmRvbmU7KSB7CiAgICAgICAgICBvKGQsIGIsIGYudmFsdWUsIHQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1hcnJheS1pdGVyIjogNDcsICIuLyQuaXRlci1jYWxsIjogNTAsICIuLyQudG8tbGVuZ3RoIjogNzUsICIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCI6IDc5IH1dLCA0MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKS5nZXROYW1lcywKICAgICAgICAgIGkgPSB7fS50b1N0cmluZywKICAgICAgICAgIHMgPSAib2JqZWN0IiA9PSAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yod2luZG93KSkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW10sCiAgICAgICAgICBhID0gZnVuY3Rpb24gYShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBvKGUpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiBzLnNsaWNlKCk7CiAgICAgICAgfQogICAgICB9O3QuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBzICYmICJbb2JqZWN0IFdpbmRvd10iID09IGkuY2FsbChlKSA/IGEoZSkgOiBvKG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA0MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIDogRnVuY3Rpb24oInJldHVybiB0aGlzIikoKTsibnVtYmVyIiA9PSB0eXBlb2YgX19nICYmIChfX2cgPSBuKTsKICAgIH0sIHt9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHt9Lmhhc093blByb3BlcnR5O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIG4uY2FsbChlLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgNDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi8kLmRlc2NyaXB0b3JzIikgPyBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLnNldERlc2MoZSwgdCwgbygxLCByKSk7CiAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBlW3RdID0gciwgZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmRlc2NyaXB0b3JzIjogMzQsICIuLyQucHJvcGVydHktZGVzYyI6IDYxIH1dLCA0NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5nbG9iYWwiKS5kb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB9LCB7ICIuLyQuZ2xvYmFsIjogNDEgfV0sIDQ1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IHZvaWQgMCA9PT0gcjtzd2l0Y2ggKHQubGVuZ3RoKSB7Y2FzZSAwOgogICAgICAgICAgICByZXR1cm4gbiA/IGUoKSA6IGUuY2FsbChyKTtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdKSA6IGUuY2FsbChyLCB0WzBdKTtjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdKTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdKTtjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKTt9cmV0dXJuIGUuYXBwbHkociwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gT2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3RyaW5nIiA9PSBuKGUpID8gZS5zcGxpdCgiIikgOiBPYmplY3QoZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IEFycmF5LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUgJiYgKG4uQXJyYXkgPT09IGUgfHwgaVtvXSA9PT0gZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQud2tzIjogNzggfV0sIDQ4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiQXJyYXkiID09IG4oZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gKHR5cGVvZiBlID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihlKSkgPyBudWxsICE9PSBlIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5hbi1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgbykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbyA/IHQobihyKVswXSwgclsxXSkgOiB0KHIpOwogICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgIHZhciBzID0gZVsicmV0dXJuIl07dGhyb3cgdm9pZCAwICE9PSBzICYmIG4ocy5jYWxsKGUpKSwgaTsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYW4tb2JqZWN0IjogMjggfV0sIDUxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBzID0ge307ZSgiLi8kLmhpZGUiKShzLCBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuLmNyZWF0ZShzLCB7IG5leHQ6IG8oMSwgcikgfSksIGkoZSwgdCArICIgSXRlcmF0b3IiKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmhpZGUiOiA0MywgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi8kLnJlZGVmaW5lIiksCiAgICAgICAgICBzID0gZSgiLi8kLmhpZGUiKSwKICAgICAgICAgIGEgPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBjID0gZSgiLi8kLml0ZXJhdG9ycyIpLAogICAgICAgICAgdSA9IGUoIi4vJC5pdGVyLWNyZWF0ZSIpLAogICAgICAgICAgbCA9IGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgZiA9IGUoIi4vJCIpLmdldFByb3RvLAogICAgICAgICAgZCA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIHAgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBiID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgaCA9ICJrZXlzIiwKICAgICAgICAgIHYgPSAidmFsdWVzIiwKICAgICAgICAgIHkgPSBmdW5jdGlvbiB5KCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBfLCBnLCBtLCBqKSB7CiAgICAgICAgdShyLCB0LCBfKTt2YXIgJCwKICAgICAgICAgICAgTywKICAgICAgICAgICAgdyA9IGZ1bmN0aW9uIHcoZSkgewogICAgICAgICAgaWYgKCFwICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSBoOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHY6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIGsgPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIHggPSBnID09IHYsCiAgICAgICAgICAgIEMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBTID0gRVtkXSB8fCBFW2JdIHx8IGcgJiYgRVtnXSwKICAgICAgICAgICAgVCA9IFMgfHwgdyhnKTtpZiAoUykgewogICAgICAgICAgdmFyIE0gPSBmKFQuY2FsbChuZXcgZSgpKSk7bChNLCBrLCAhMCksICFuICYmIGEoRSwgYikgJiYgcyhNLCBkLCB5KSwgeCAmJiBTLm5hbWUgIT09IHYgJiYgKEMgPSAhMCwgVCA9IGZ1bmN0aW9uIFQoKSB7CiAgICAgICAgICAgIHJldHVybiBTLmNhbGwodGhpcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9aWYgKG4gJiYgIWogfHwgIXAgJiYgIUMgJiYgRVtkXSB8fCBzKEUsIGQsIFQpLCBjW3RdID0gVCwgY1trXSA9IHksIGcpIGlmICgkID0geyB2YWx1ZXM6IHggPyBUIDogdyh2KSwga2V5czogbSA/IFQgOiB3KGgpLCBlbnRyaWVzOiB4ID8gdygiZW50cmllcyIpIDogVCB9LCBqKSBmb3IgKE8gaW4gJCkgewogICAgICAgICAgTyBpbiBFIHx8IGkoRSwgTywgJFtPXSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKHAgfHwgQyksIHQsICQpO3JldHVybiAkOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuZXhwb3J0IjogMzcsICIuLyQuaGFzIjogNDIsICIuLyQuaGlkZSI6IDQzLCAiLi8kLml0ZXItY3JlYXRlIjogNTEsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQubGlicmFyeSI6IDU4LCAiLi8kLnJlZGVmaW5lIjogNjMsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChzKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgcyA9IGlbbl0oKTtzLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH0sIGlbbl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgfSwgZShpKTsKICAgICAgICB9IGNhdGNoIChhKSB7fXJldHVybiByOwogICAgICB9OwogICAgfSwgeyAiLi8kLndrcyI6IDc4IH1dLCA1NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEhZSB9OwogICAgICB9OwogICAgfSwge31dLCA1NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHt9OwogICAgfSwge31dLCA1NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gT2JqZWN0O3QuZXhwb3J0cyA9IHsgY3JlYXRlOiBuLmNyZWF0ZSwgZ2V0UHJvdG86IG4uZ2V0UHJvdG90eXBlT2YsIGlzRW51bToge30ucHJvcGVydHlJc0VudW1lcmFibGUsIGdldERlc2M6IG4uZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLCBzZXREZXNjOiBuLmRlZmluZVByb3BlcnR5LCBzZXREZXNjczogbi5kZWZpbmVQcm9wZXJ0aWVzLCBnZXRLZXlzOiBuLmtleXMsIGdldE5hbWVzOiBuLmdldE93blByb3BlcnR5TmFtZXMsIGdldFN5bWJvbHM6IG4uZ2V0T3duUHJvcGVydHlTeW1ib2xzLCBlYWNoOiBbXS5mb3JFYWNoIH07CiAgICB9LCB7fV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQudG8taW9iamVjdCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciwgaSA9IG8oZSksIHMgPSBuLmdldEtleXMoaSksIGEgPSBzLmxlbmd0aCwgYyA9IDA7IGEgPiBjOykgewogICAgICAgICAgaWYgKGlbciA9IHNbYysrXV0gPT09IHQpIHJldHVybiByOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgcyA9IGUoIi4vJC5nbG9iYWwiKSwKICAgICAgICAgIGEgPSBlKCIuLyQudGFzayIpLnNldCwKICAgICAgICAgIGMgPSBzLk11dGF0aW9uT2JzZXJ2ZXIgfHwgcy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLAogICAgICAgICAgdSA9IHMucHJvY2VzcywKICAgICAgICAgIGwgPSBzLlByb21pc2UsCiAgICAgICAgICBmID0gInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKSh1KSwKICAgICAgICAgIGQgPSBmdW5jdGlvbiBkKCkgewogICAgICAgIHZhciBlLCB0LCByO2ZvciAoZiAmJiAoZSA9IHUuZG9tYWluKSAmJiAodS5kb21haW4gPSBudWxsLCBlLmV4aXQoKSk7IG47KSB7CiAgICAgICAgICB0ID0gbi5kb21haW4sIHIgPSBuLmZuLCB0ICYmIHQuZW50ZXIoKSwgcigpLCB0ICYmIHQuZXhpdCgpLCBuID0gbi5uZXh0OwogICAgICAgIH1vID0gdm9pZCAwLCBlICYmIGUuZW50ZXIoKTsKICAgICAgfTtpZiAoZikgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgdS5uZXh0VGljayhkKTsKICAgICAgfTtlbHNlIGlmIChjKSB7CiAgICAgICAgdmFyIHAgPSAxLAogICAgICAgICAgICBiID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBjKGQpLm9ic2VydmUoYiwgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgICBiLmRhdGEgPSBwID0gLXA7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGkgPSBsICYmIGwucmVzb2x2ZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICBsLnJlc29sdmUoKS50aGVuKGQpOwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIGEuY2FsbChzLCBkKTsKICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0geyBmbjogZSwgbmV4dDogdm9pZCAwLCBkb21haW46IGYgJiYgdS5kb21haW4gfTtvICYmIChvLm5leHQgPSB0KSwgbiB8fCAobiA9IHQsIGkoKSksIG8gPSB0OwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwLCAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnRhc2siOiA3MiB9XSwgNjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vJC5mYWlscyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIgPSAoby5PYmplY3QgfHwge30pW2VdIHx8IE9iamVjdFtlXSwKICAgICAgICAgICAgcyA9IHt9O3NbZV0gPSB0KHIpLCBuKG4uUyArIG4uRiAqIGkoZnVuY3Rpb24gKCkgewogICAgICAgICAgcigxKTsKICAgICAgICB9KSwgIk9iamVjdCIsIHMpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvcmUiOiAzMSwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mYWlscyI6IDM4IH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZSksIGNvbmZpZ3VyYWJsZTogISgyICYgZSksIHdyaXRhYmxlOiAhKDQgJiBlKSwgdmFsdWU6IHQgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5yZWRlZmluZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciBpbiB0KSB7CiAgICAgICAgICBuKGUsIHIsIHRbcl0pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5yZWRlZmluZSI6IDYzIH1dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5oaWRlIik7CiAgICB9LCB7ICIuLyQuaGlkZSI6IDQzIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBlID09PSB0ID8gMCAhPT0gZSB8fCAxIC8gZSA9PT0gMSAvIHQgOiBlICE9IGUgJiYgdCAhPSB0OwogICAgICB9OwogICAgfSwge31dLCA2NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuZ2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoZSwgdCkgewogICAgICAgIGlmIChpKGUpLCAhbyh0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbyA9IGUoIi4vJC5jdHgiKShGdW5jdGlvbi5jYWxsLCBuKE9iamVjdC5wcm90b3R5cGUsICJfX3Byb3RvX18iKS5zZXQsIDIpLCBvKHQsIFtdKSwgciA9ICEodCBpbnN0YW5jZW9mIEFycmF5KTsKICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgciA9ICEwOwogICAgICAgICAgfXJldHVybiBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gcyhlLCB0KSwgciA/IGUuX19wcm90b19fID0gdCA6IG8oZSwgdCksIGU7CiAgICAgICAgICB9OwogICAgICAgIH0oe30sICExKSA6IHZvaWQgMCksIGNoZWNrOiBzIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgNjY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvcmUiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZGVzY3JpcHRvcnMiKSwKICAgICAgICAgIHMgPSBlKCIuLyQud2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gbltlXTtpICYmIHQgJiYgIXRbc10gJiYgby5zZXREZXNjKHQsIHMsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSB9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLndrcyI6IDc4IH1dLCA2NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuc2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZSAmJiAhbyhlID0gciA/IGUgOiBlLnByb3RvdHlwZSwgaSkgJiYgbihlLCBpLCB7IGNvbmZpZ3VyYWJsZTogITAsIHZhbHVlOiB0IH0pOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuaGFzIjogNDIsICIuLyQud2tzIjogNzggfV0sIDY4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBvID0gIl9fY29yZS1qc19zaGFyZWRfXyIsCiAgICAgICAgICBpID0gbltvXSB8fCAobltvXSA9IHt9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpW2VdIHx8IChpW2VdID0ge30pOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxIH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5hLWZ1bmN0aW9uIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG4oZSkuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMCA9PT0gcyB8fCB2b2lkIDAgPT0gKHIgPSBuKHMpW2ldKSA/IHQgOiBvKHIpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmEtZnVuY3Rpb24iOiAyNiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC53a3MiOiA3OCB9XSwgNzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSkgdGhyb3cgVHlwZUVycm9yKHIgKyAiOiB1c2UgdGhlICduZXcnIG9wZXJhdG9yISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGEgPSBTdHJpbmcobyh0KSksCiAgICAgICAgICAgICAgYyA9IG4ociksCiAgICAgICAgICAgICAgdSA9IGEubGVuZ3RoO3JldHVybiAwID4gYyB8fCBjID49IHUgPyBlID8gIiIgOiB2b2lkIDAgOiAoaSA9IGEuY2hhckNvZGVBdChjKSwgNTUyOTYgPiBpIHx8IGkgPiA1NjMxOSB8fCBjICsgMSA9PT0gdSB8fCAocyA9IGEuY2hhckNvZGVBdChjICsgMSkpIDwgNTYzMjAgfHwgcyA+IDU3MzQzID8gZSA/IGEuY2hhckF0KGMpIDogaSA6IGUgPyBhLnNsaWNlKGMsIGMgKyAyKSA6IChpIC0gNTUyOTYgPDwgMTApICsgKHMgLSA1NjMyMCkgKyA2NTUzNik7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQudG8taW50ZWdlciI6IDczIH1dLCA3MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBzID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYSA9IGUoIi4vJC5pbnZva2UiKSwKICAgICAgICAgIGMgPSBlKCIuLyQuaHRtbCIpLAogICAgICAgICAgdSA9IGUoIi4vJC5kb20tY3JlYXRlIiksCiAgICAgICAgICBsID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgZiA9IGwucHJvY2VzcywKICAgICAgICAgIGQgPSBsLnNldEltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBsLmNsZWFySW1tZWRpYXRlLAogICAgICAgICAgYiA9IGwuTWVzc2FnZUNoYW5uZWwsCiAgICAgICAgICBoID0gMCwKICAgICAgICAgIHYgPSB7fSwKICAgICAgICAgIHkgPSAib25yZWFkeXN0YXRlY2hhbmdlIiwKICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKCkgewogICAgICAgIHZhciBlID0gK3RoaXM7aWYgKHYuaGFzT3duUHJvcGVydHkoZSkpIHsKICAgICAgICAgIHZhciB0ID0gdltlXTtkZWxldGUgdltlXSwgdCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIGcgPSBmdW5jdGlvbiBnKGUpIHsKICAgICAgICBfLmNhbGwoZS5kYXRhKTsKICAgICAgfTtkICYmIHAgfHwgKGQgPSBmdW5jdGlvbiBkKGUpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIHIgPSAxOyBhcmd1bWVudHMubGVuZ3RoID4gcjspIHsKICAgICAgICAgIHQucHVzaChhcmd1bWVudHNbcisrXSk7CiAgICAgICAgfXJldHVybiB2WysraF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBhKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogRnVuY3Rpb24oZSksIHQpOwogICAgICAgIH0sIG4oaCksIGg7CiAgICAgIH0sIHAgPSBmdW5jdGlvbiBwKGUpIHsKICAgICAgICBkZWxldGUgdltlXTsKICAgICAgfSwgInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKShmKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBmLm5leHRUaWNrKHMoXywgZSwgMSkpOwogICAgICB9IDogYiA/IChvID0gbmV3IGIoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gZywgbiA9IHMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogbC5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFsLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGwucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBsLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBnLCAhMSkpIDogbiA9IHkgaW4gdSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIGMuYXBwZW5kQ2hpbGQodSgic2NyaXB0IikpW3ldID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgYy5yZW1vdmVDaGlsZCh0aGlzKSwgXy5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQocyhfLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogZCwgY2xlYXI6IHAgfTsKICAgIH0sIHsgIi4vJC5jb2YiOiAzMCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5kb20tY3JlYXRlIjogMzUsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaHRtbCI6IDQ0LCAiLi8kLmludm9rZSI6IDQ1IH1dLCA3MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gTWF0aC5jZWlsLAogICAgICAgICAgbyA9IE1hdGguZmxvb3I7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaXNOYU4oZSA9ICtlKSA/IDAgOiAoZSA+IDAgPyBvIDogbikoZSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQuaW9iamVjdCI6IDQ2IH1dLCA3NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBNYXRoLm1pbjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlID4gMCA/IG8obihlKSwgOTAwNzE5OTI1NDc0MDk5MSkgOiAwOwogICAgICB9OwogICAgfSwgeyAiLi8kLnRvLWludGVnZXIiOiA3MyB9XSwgNzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmRlZmluZWQiOiAzMyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IDAsCiAgICAgICAgICBvID0gTWF0aC5yYW5kb20oKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIuY29uY2F0KHZvaWQgMCA9PT0gZSA/ICIiIDogZSwgIilfIiwgKCsrbiArIG8pLnRvU3RyaW5nKDM2KSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC51aWQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZ2xvYmFsIikuU3ltYm9sO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBpICYmIGlbZV0gfHwgKGkgfHwgbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnVpZCI6IDc3IH1dLCA3OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNsYXNzb2YiKSwKICAgICAgICAgIG8gPSBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBpID0gZSgiLi8kLml0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vJC5jb3JlIikuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT0gZSA/IGVbb10gfHwgZVsiQEBpdGVyYXRvciJdIHx8IGlbbihlKV0gOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY2xhc3NvZiI6IDI5LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vJC53a3MiOiA3OCB9XSwgODA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmFkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC5pdGVyLXN0ZXAiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi8kLnRvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuLyQuaXRlci1kZWZpbmUiKShBcnJheSwgIkFycmF5IiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0aGlzLl90ID0gcyhlKSwgdGhpcy5faSA9IDAsIHRoaXMuX2sgPSB0OwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl90LAogICAgICAgICAgICB0ID0gdGhpcy5faywKICAgICAgICAgICAgciA9IHRoaXMuX2krKztyZXR1cm4gIWUgfHwgciA+PSBlLmxlbmd0aCA/ICh0aGlzLl90ID0gdm9pZCAwLCBvKDEpKSA6ICJrZXlzIiA9PSB0ID8gbygwLCByKSA6ICJ2YWx1ZXMiID09IHQgPyBvKDAsIGVbcl0pIDogbygwLCBbciwgZVtyXV0pOwogICAgICB9LCAidmFsdWVzIiksIGkuQXJndW1lbnRzID0gaS5BcnJheSwgbigia2V5cyIpLCBuKCJ2YWx1ZXMiKSwgbigiZW50cmllcyIpOwogICAgfSwgeyAiLi8kLmFkZC10by11bnNjb3BhYmxlcyI6IDI3LCAiLi8kLml0ZXItZGVmaW5lIjogNTIsICIuLyQuaXRlci1zdGVwIjogNTQsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA4MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgcmV0dXJuIGUobih0KSwgcik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQub2JqZWN0LXNhcCI6IDYwLCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgODI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1vYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRQcm90b3R5cGVPZiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDgzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQudG8tb2JqZWN0Iik7ZSgiLi8kLm9iamVjdC1zYXAiKSgia2V5cyIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDg0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZXhwb3J0Iik7bihuLlMsICJPYmplY3QiLCB7IHNldFByb3RvdHlwZU9mOiBlKCIuLyQuc2V0LXByb3RvIikuc2V0IH0pOwogICAgfSwgeyAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLnNldC1wcm90byI6IDY1IH1dLCA4NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7fSwge31dLCA4NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4sCiAgICAgICAgICBvID0gZSgiLi8kIiksCiAgICAgICAgICBpID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIHMgPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBhID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYyA9IGUoIi4vJC5jbGFzc29mIiksCiAgICAgICAgICB1ID0gZSgiLi8kLmV4cG9ydCIpLAogICAgICAgICAgbCA9IGUoIi4vJC5pcy1vYmplY3QiKSwKICAgICAgICAgIGYgPSBlKCIuLyQuYW4tb2JqZWN0IiksCiAgICAgICAgICBkID0gZSgiLi8kLmEtZnVuY3Rpb24iKSwKICAgICAgICAgIHAgPSBlKCIuLyQuc3RyaWN0LW5ldyIpLAogICAgICAgICAgYiA9IGUoIi4vJC5mb3Itb2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuc2V0LXByb3RvIikuc2V0LAogICAgICAgICAgdiA9IGUoIi4vJC5zYW1lLXZhbHVlIiksCiAgICAgICAgICB5ID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIiksCiAgICAgICAgICBfID0gZSgiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiKSwKICAgICAgICAgIGcgPSBlKCIuLyQubWljcm90YXNrIiksCiAgICAgICAgICBtID0gIlByb21pc2UiLAogICAgICAgICAgaiA9IHMucHJvY2VzcywKICAgICAgICAgICQgPSAicHJvY2VzcyIgPT0gYyhqKSwKICAgICAgICAgIF9PID0gc1ttXSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBfTyhmdW5jdGlvbiAoKSB7fSk7cmV0dXJuIGUgJiYgKHQuY29uc3RydWN0b3IgPSBPYmplY3QpLCBfTy5yZXNvbHZlKHQpID09PSB0OwogICAgICB9LAogICAgICAgICAgayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiB0KGUpIHsKICAgICAgICAgIHZhciByID0gbmV3IF9PKGUpO3JldHVybiBoKHIsIHQucHJvdG90eXBlKSwgcjsKICAgICAgICB9dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgaWYgKHIgPSBfTyAmJiBfTy5yZXNvbHZlICYmIHcoKSwgaCh0LCBfTyksIHQucHJvdG90eXBlID0gby5jcmVhdGUoX08ucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiB0IH0gfSksIHQucmVzb2x2ZSg1KS50aGVuKGZ1bmN0aW9uICgpIHt9KSBpbnN0YW5jZW9mIHQgfHwgKHIgPSAhMSksIHIgJiYgZSgiLi8kLmRlc2NyaXB0b3JzIikpIHsKICAgICAgICAgICAgdmFyIG4gPSAhMTtfTy5yZXNvbHZlKG8uc2V0RGVzYyh7fSwgInRoZW4iLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgbiA9ICEwOwogICAgICAgICAgICAgIH0gfSkpLCByID0gbjsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICByID0gITE7CiAgICAgICAgfXJldHVybiByOwogICAgICB9KCksCiAgICAgICAgICB4ID0gZnVuY3Rpb24geChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGkgJiYgZSA9PT0gX08gJiYgdCA9PT0gbiA/ICEwIDogdihlLCB0KTsKICAgICAgfSwKICAgICAgICAgIEMgPSBmdW5jdGlvbiBDKGUpIHsKICAgICAgICB2YXIgdCA9IGYoZSlbeV07cmV0dXJuIHZvaWQgMCAhPSB0ID8gdCA6IGU7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdmFyIHQ7cmV0dXJuIGwoZSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHQgPSBlLnRoZW4pID8gdCA6ICExOwogICAgICB9LAogICAgICAgICAgUyA9IGZ1bmN0aW9uIFMoZSkgewogICAgICAgIHZhciB0LCByO3RoaXMucHJvbWlzZSA9IG5ldyBlKGZ1bmN0aW9uIChlLCBuKSB7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSB0IHx8IHZvaWQgMCAhPT0gcikgdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO3QgPSBlLCByID0gbjsKICAgICAgICB9KSwgdGhpcy5yZXNvbHZlID0gZCh0KSwgdGhpcy5yZWplY3QgPSBkKHIpOwogICAgICB9LAogICAgICAgICAgVCA9IGZ1bmN0aW9uIFQoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBlKCk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHQgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBNID0gZnVuY3Rpb24gTShlLCB0KSB7CiAgICAgICAgaWYgKCFlLm4pIHsKICAgICAgICAgIGUubiA9ICEwO3ZhciByID0gZS5jO2coZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0gZS52LCBvID0gMSA9PSBlLnMsIGkgPSAwLCBhID0gZnVuY3Rpb24gYSh0KSB7CiAgICAgICAgICAgICAgdmFyIHIsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIHMgPSBvID8gdC5vayA6IHQuZmFpbCwKICAgICAgICAgICAgICAgICAgYSA9IHQucmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgYyA9IHQucmVqZWN0O3RyeSB7CiAgICAgICAgICAgICAgICBzID8gKG8gfHwgKGUuaCA9ICEwKSwgciA9IHMgPT09ICEwID8gbiA6IHMobiksIHIgPT09IHQucHJvbWlzZSA/IGMoVHlwZUVycm9yKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBFKHIpKSA/IGkuY2FsbChyLCBhLCBjKSA6IGEocikpIDogYyhuKTsKICAgICAgICAgICAgICB9IGNhdGNoICh1KSB7CiAgICAgICAgICAgICAgICBjKHUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGEocltpKytdKTsKICAgICAgICAgICAgfXIubGVuZ3RoID0gMCwgZS5uID0gITEsIHQgJiYgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQsCiAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgIG8gPSBlLnA7TihvKSAmJiAoJCA/IGouZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIiwgbiwgbykgOiAodCA9IHMub251bmhhbmRsZWRyZWplY3Rpb24pID8gdCh7IHByb21pc2U6IG8sIHJlYXNvbjogbiB9KSA6IChyID0gcy5jb25zb2xlKSAmJiByLmVycm9yICYmIHIuZXJyb3IoIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsIG4pKSwgZS5hID0gdm9pZCAwOwogICAgICAgICAgICB9LCAxKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIE4gPSBmdW5jdGlvbiBOKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUuX2QsCiAgICAgICAgICAgIG4gPSByLmEgfHwgci5jLAogICAgICAgICAgICBvID0gMDtpZiAoci5oKSByZXR1cm4gITE7Zm9yICg7IG4ubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGlmICh0ID0gbltvKytdLCB0LmZhaWwgfHwgIU4odC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuZCB8fCAodC5kID0gITAsIHQgPSB0LnIgfHwgdCwgdC52ID0gZSwgdC5zID0gMiwgdC5hID0gdC5jLnNsaWNlKCksIE0odCwgITApKTsKICAgICAgfSwKICAgICAgICAgIEQgPSBmdW5jdGlvbiBEKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IHRoaXM7aWYgKCFyLmQpIHsKICAgICAgICAgIHIuZCA9ICEwLCByID0gci5yIHx8IHI7dHJ5IHsKICAgICAgICAgICAgaWYgKHIucCA9PT0gZSkgdGhyb3cgVHlwZUVycm9yKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOyh0ID0gRShlKSkgPyBnKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgcjogciwgZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIGEoRCwgbiwgMSksIGEoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIudiA9IGUsIHIucyA9IDEsIE0ociwgITEpKTsKICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgUi5jYWxsKHsgcjogciwgZDogITEgfSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9O2sgfHwgKF9PID0gZnVuY3Rpb24gTyhlKSB7CiAgICAgICAgZChlKTt2YXIgdCA9IHRoaXMuX2QgPSB7IHA6IHAodGhpcywgX08sIG0pLCBjOiBbXSwgYTogdm9pZCAwLCBzOiAwLCBkOiAhMSwgdjogdm9pZCAwLCBoOiAhMSwgbjogITEgfTt0cnkgewogICAgICAgICAgZShhKEQsIHQsIDEpLCBhKFIsIHQsIDEpKTsKICAgICAgICB9IGNhdGNoIChyKSB7CiAgICAgICAgICBSLmNhbGwodCwgcik7CiAgICAgICAgfQogICAgICB9LCBlKCIuLyQucmVkZWZpbmUtYWxsIikoX08ucHJvdG90eXBlLCB7IHRoZW46IGZ1bmN0aW9uIHRoZW4oZSwgdCkgewogICAgICAgICAgdmFyIHIgPSBuZXcgUyhfKHRoaXMsIF9PKSksCiAgICAgICAgICAgICAgbiA9IHIucHJvbWlzZSwKICAgICAgICAgICAgICBvID0gdGhpcy5fZDtyZXR1cm4gci5vayA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogITAsIHIuZmFpbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdCwgby5jLnB1c2gociksIG8uYSAmJiBvLmEucHVzaChyKSwgby5zICYmIE0obywgITEpLCBuOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSksIHUodS5HICsgdS5XICsgdS5GICogIWssIHsgUHJvbWlzZTogX08gfSksIGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpKF9PLCBtKSwgZSgiLi8kLnNldC1zcGVjaWVzIikobSksIG4gPSBlKCIuLyQuY29yZSIpW21dLCB1KHUuUyArIHUuRiAqICFrLCBtLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gbmV3IFModGhpcyksCiAgICAgICAgICAgICAgciA9IHQucmVqZWN0O3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgdSh1LlMgKyB1LkYgKiAoIWsgfHwgdyghMCkpLCBtLCB7IHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoZSkgewogICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfTyAmJiB4KGUuY29uc3RydWN0b3IsIHRoaXMpKSByZXR1cm4gZTt2YXIgdCA9IG5ldyBTKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCB1KHUuUyArIHUuRiAqICEoayAmJiBlKCIuLyQuaXRlci1kZXRlY3QiKShmdW5jdGlvbiAoZSkgewogICAgICAgIF9PLmFsbChlKVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0pKSwgbSwgeyBhbGw6IGZ1bmN0aW9uIGFsbChlKSB7CiAgICAgICAgICB2YXIgdCA9IEModGhpcyksCiAgICAgICAgICAgICAgciA9IG5ldyBTKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgaSA9IHIucmVqZWN0LAogICAgICAgICAgICAgIHMgPSBbXSwKICAgICAgICAgICAgICBhID0gVChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGIoZSwgITEsIHMucHVzaCwgcyk7dmFyIHIgPSBzLmxlbmd0aCwKICAgICAgICAgICAgICAgIGEgPSBBcnJheShyKTtyID8gby5lYWNoLmNhbGwocywgZnVuY3Rpb24gKGUsIG8pIHsKICAgICAgICAgICAgICB2YXIgcyA9ICExO3QucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBzIHx8IChzID0gITAsIGFbb10gPSBlLCAtLXIgfHwgbihhKSk7CiAgICAgICAgICAgICAgfSwgaSk7CiAgICAgICAgICAgIH0pIDogbihhKTsKICAgICAgICAgIH0pO3JldHVybiBhICYmIGkoYS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gQyh0aGlzKSwKICAgICAgICAgICAgICByID0gbmV3IFModCksCiAgICAgICAgICAgICAgbiA9IHIucmVqZWN0LAogICAgICAgICAgICAgIG8gPSBUKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYihlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB0LnJlc29sdmUoZSkudGhlbihyLnJlc29sdmUsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pO3JldHVybiBvICYmIG4oby5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9IH0pOwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuYS1mdW5jdGlvbiI6IDI2LCAiLi8kLmFuLW9iamVjdCI6IDI4LCAiLi8kLmNsYXNzb2YiOiAyOSwgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZGVzY3JpcHRvcnMiOiAzNCwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mb3Itb2YiOiAzOSwgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSwgIi4vJC5pdGVyLWRldGVjdCI6IDUzLCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5taWNyb3Rhc2siOiA1OSwgIi4vJC5yZWRlZmluZS1hbGwiOiA2MiwgIi4vJC5zYW1lLXZhbHVlIjogNjQsICIuLyQuc2V0LXByb3RvIjogNjUsICIuLyQuc2V0LXNwZWNpZXMiOiA2NiwgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiOiA2OSwgIi4vJC5zdHJpY3QtbmV3IjogNzAsICIuLyQud2tzIjogNzggfV0sIDg3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5zdHJpbmctYXQiKSghMCk7ZSgiLi8kLml0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5pdGVyLWRlZmluZSI6IDUyLCAiLi8kLnN0cmluZy1hdCI6IDcxIH1dLCA4ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBpID0gZSgiLi8kLmhhcyIpLAogICAgICAgICAgcyA9IGUoIi4vJC5kZXNjcmlwdG9ycyIpLAogICAgICAgICAgYSA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIGMgPSBlKCIuLyQucmVkZWZpbmUiKSwKICAgICAgICAgIHUgPSBlKCIuLyQuZmFpbHMiKSwKICAgICAgICAgIGwgPSBlKCIuLyQuc2hhcmVkIiksCiAgICAgICAgICBmID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBkID0gZSgiLi8kLnVpZCIpLAogICAgICAgICAgcCA9IGUoIi4vJC53a3MiKSwKICAgICAgICAgIGIgPSBlKCIuLyQua2V5b2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuZ2V0LW5hbWVzIiksCiAgICAgICAgICB2ID0gZSgiLi8kLmVudW0ta2V5cyIpLAogICAgICAgICAgeSA9IGUoIi4vJC5pcy1hcnJheSIpLAogICAgICAgICAgXyA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIGcgPSBlKCIuLyQudG8taW9iamVjdCIpLAogICAgICAgICAgbSA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBqID0gbi5nZXREZXNjLAogICAgICAgICAgJCA9IG4uc2V0RGVzYywKICAgICAgICAgIE8gPSBuLmNyZWF0ZSwKICAgICAgICAgIHcgPSBoLmdldCwKICAgICAgICAgIGsgPSBvLlN5bWJvbCwKICAgICAgICAgIHggPSBvLkpTT04sCiAgICAgICAgICBDID0geCAmJiB4LnN0cmluZ2lmeSwKICAgICAgICAgIEUgPSAhMSwKICAgICAgICAgIFMgPSBwKCJfaGlkZGVuIiksCiAgICAgICAgICBUID0gbi5pc0VudW0sCiAgICAgICAgICBNID0gbCgic3ltYm9sLXJlZ2lzdHJ5IiksCiAgICAgICAgICBOID0gbCgic3ltYm9scyIpLAogICAgICAgICAgUiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGssCiAgICAgICAgICBEID0gT2JqZWN0LnByb3RvdHlwZSwKICAgICAgICAgIFAgPSBzICYmIHUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE8oJCh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gJCh0aGlzLCAiYSIsIHsgdmFsdWU6IDcgfSkuYTsKICAgICAgICAgIH0gfSkpLmE7CiAgICAgIH0pID8gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IGooRCwgdCk7biAmJiBkZWxldGUgRFt0XSwgJChlLCB0LCByKSwgbiAmJiBlICE9PSBEICYmICQoRCwgdCwgbik7CiAgICAgIH0gOiAkLAogICAgICAgICAgQSA9IGZ1bmN0aW9uIEEoZSkgewogICAgICAgIHZhciB0ID0gTltlXSA9IE8oay5wcm90b3R5cGUpO3JldHVybiB0Ll9rID0gZSwgcyAmJiBFICYmIFAoRCwgZSwgeyBjb25maWd1cmFibGU6ICEwLCBzZXQ6IGZ1bmN0aW9uIHNldCh0KSB7CiAgICAgICAgICAgIGkodGhpcywgUykgJiYgaSh0aGlzW1NdLCBlKSAmJiAodGhpc1tTXVtlXSA9ICExKSwgUCh0aGlzLCBlLCBtKDEsIHQpKTsKICAgICAgICAgIH0gfSksIHQ7CiAgICAgIH0sCiAgICAgICAgICBMID0gZnVuY3Rpb24gTChlKSB7CiAgICAgICAgcmV0dXJuICJzeW1ib2wiID09ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpOwogICAgICB9LAogICAgICAgICAgSSA9IGZ1bmN0aW9uIEkoZSwgdCwgcikgewogICAgICAgIHJldHVybiByICYmIGkoTiwgdCkgPyAoci5lbnVtZXJhYmxlID8gKGkoZSwgUykgJiYgZVtTXVt0XSAmJiAoZVtTXVt0XSA9ICExKSwgciA9IE8ociwgeyBlbnVtZXJhYmxlOiBtKDAsICExKSB9KSkgOiAoaShlLCBTKSB8fCAkKGUsIFMsIG0oMSwge30pKSwgZVtTXVt0XSA9ICEwKSwgUChlLCB0LCByKSkgOiAkKGUsIHQsIHIpOwogICAgICB9LAogICAgICAgICAgRiA9IGZ1bmN0aW9uIEYoZSwgdCkgewogICAgICAgIF8oZSk7Zm9yICh2YXIgciwgbiA9IHYodCA9IGcodCkpLCBvID0gMCwgaSA9IG4ubGVuZ3RoOyBpID4gbzspIHsKICAgICAgICAgIEkoZSwgciA9IG5bbysrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9LAogICAgICAgICAgViA9IGZ1bmN0aW9uIFYoZSwgdCkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IHQgPyBPKGUpIDogRihPKGUpLCB0KTsKICAgICAgfSwKICAgICAgICAgIHogPSBmdW5jdGlvbiB6KGUpIHsKICAgICAgICB2YXIgdCA9IFQuY2FsbCh0aGlzLCBlKTtyZXR1cm4gdCB8fCAhaSh0aGlzLCBlKSB8fCAhaShOLCBlKSB8fCBpKHRoaXMsIFMpICYmIHRoaXNbU11bZV0gPyB0IDogITA7CiAgICAgIH0sCiAgICAgICAgICBVID0gZnVuY3Rpb24gVShlLCB0KSB7CiAgICAgICAgdmFyIHIgPSBqKGUgPSBnKGUpLCB0KTtyZXR1cm4gIXIgfHwgIWkoTiwgdCkgfHwgaShlLCBTKSAmJiBlW1NdW3RdIHx8IChyLmVudW1lcmFibGUgPSAhMCksIHI7CiAgICAgIH0sCiAgICAgICAgICBIID0gZnVuY3Rpb24gSChlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgfHwgdCA9PSBTIHx8IG4ucHVzaCh0KTsKICAgICAgICB9cmV0dXJuIG47CiAgICAgIH0sCiAgICAgICAgICBCID0gZnVuY3Rpb24gQihlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgJiYgbi5wdXNoKE5bdF0pOwogICAgICAgIH1yZXR1cm4gbjsKICAgICAgfSwKICAgICAgICAgIEogPSBmdW5jdGlvbiBKKGUpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBlICYmICFMKGUpKSB7CiAgICAgICAgICBmb3IgKHZhciB0LCByLCBuID0gW2VdLCBvID0gMSwgaSA9IGFyZ3VtZW50czsgaS5sZW5ndGggPiBvOykgewogICAgICAgICAgICBuLnB1c2goaVtvKytdKTsKICAgICAgICAgIH1yZXR1cm4gdCA9IG5bMV0sICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgKHIgPSB0KSwgIXIgJiYgeSh0KSB8fCAodCA9IGZ1bmN0aW9uIHQoZSwgX3QyKSB7CiAgICAgICAgICAgIHJldHVybiByICYmIChfdDIgPSByLmNhbGwodGhpcywgZSwgX3QyKSksIEwoX3QyKSA/IHZvaWQgMCA6IF90MjsKICAgICAgICAgIH0pLCBuWzFdID0gdCwgQy5hcHBseSh4LCBuKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBXID0gdShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBrKCk7cmV0dXJuICJbbnVsbF0iICE9IEMoW2VdKSB8fCAie30iICE9IEMoeyBhOiBlIH0pIHx8ICJ7fSIgIT0gQyhPYmplY3QoZSkpOwogICAgICB9KTtSIHx8IChrID0gZnVuY3Rpb24gaygpIHsKICAgICAgICBpZiAoTCh0aGlzKSkgdGhyb3cgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKTtyZXR1cm4gQShkKGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdm9pZCAwKSk7CiAgICAgIH0sIGMoay5wcm90b3R5cGUsICJ0b1N0cmluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fazsKICAgICAgfSksIEwgPSBmdW5jdGlvbiBMKGUpIHsKICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIGs7CiAgICAgIH0sIG4uY3JlYXRlID0gViwgbi5pc0VudW0gPSB6LCBuLmdldERlc2MgPSBVLCBuLnNldERlc2MgPSBJLCBuLnNldERlc2NzID0gRiwgbi5nZXROYW1lcyA9IGguZ2V0ID0gSCwgbi5nZXRTeW1ib2xzID0gQiwgcyAmJiAhZSgiLi8kLmxpYnJhcnkiKSAmJiBjKEQsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsIHosICEwKSk7dmFyIFkgPSB7ICJmb3IiOiBmdW5jdGlvbiBfZm9yKGUpIHsKICAgICAgICAgIHJldHVybiBpKE0sIGUgKz0gIiIpID8gTVtlXSA6IE1bZV0gPSBrKGUpOwogICAgICAgIH0sIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKGUpIHsKICAgICAgICAgIHJldHVybiBiKE0sIGUpOwogICAgICAgIH0sIHVzZVNldHRlcjogZnVuY3Rpb24gdXNlU2V0dGVyKCkgewogICAgICAgICAgRSA9ICEwOwogICAgICAgIH0sIHVzZVNpbXBsZTogZnVuY3Rpb24gdXNlU2ltcGxlKCkgewogICAgICAgICAgRSA9ICExOwogICAgICAgIH0gfTtuLmVhY2guY2FsbCgiaGFzSW5zdGFuY2UsaXNDb25jYXRTcHJlYWRhYmxlLGl0ZXJhdG9yLG1hdGNoLHJlcGxhY2Usc2VhcmNoLHNwZWNpZXMsc3BsaXQsdG9QcmltaXRpdmUsdG9TdHJpbmdUYWcsdW5zY29wYWJsZXMiLnNwbGl0KCIsIiksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBwKGUpO1lbZV0gPSBSID8gdCA6IEEodCk7CiAgICAgIH0pLCBFID0gITAsIGEoYS5HICsgYS5XLCB7IFN5bWJvbDogayB9KSwgYShhLlMsICJTeW1ib2wiLCBZKSwgYShhLlMgKyBhLkYgKiAhUiwgIk9iamVjdCIsIHsgY3JlYXRlOiBWLCBkZWZpbmVQcm9wZXJ0eTogSSwgZGVmaW5lUHJvcGVydGllczogRiwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBVLCBnZXRPd25Qcm9wZXJ0eU5hbWVzOiBILCBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6IEIgfSksIHggJiYgYShhLlMgKyBhLkYgKiAoIVIgfHwgVyksICJKU09OIiwgeyBzdHJpbmdpZnk6IEogfSksIGYoaywgIlN5bWJvbCIpLCBmKE1hdGgsICJNYXRoIiwgITApLCBmKG8uSlNPTiwgIkpTT04iLCAhMCk7CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLmVudW0ta2V5cyI6IDM2LCAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLmZhaWxzIjogMzgsICIuLyQuZ2V0LW5hbWVzIjogNDAsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaGFzIjogNDIsICIuLyQuaXMtYXJyYXkiOiA0OCwgIi4vJC5rZXlvZiI6IDU3LCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQucmVkZWZpbmUiOiA2MywgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnRvLWlvYmplY3QiOiA3NCwgIi4vJC51aWQiOiA3NywgIi4vJC53a3MiOiA3OCB9XSwgODk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO3ZhciBuID0gZSgiLi8kLml0ZXJhdG9ycyIpO24uTm9kZUxpc3QgPSBuLkhUTUxDb2xsZWN0aW9uID0gbi5BcnJheTsKICAgIH0sIHsgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vZXM2LmFycmF5Lml0ZXJhdG9yIjogODAgfV0sIDkwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZ1bmN0aW9uIHQoZSkgewogICAgICAgICAgdGhpcy5nID0gW10sIHRoaXMuayA9IGU7CiAgICAgICAgfWZ1bmN0aW9uIHIoZSkgewogICAgICAgICAgIWZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIHZhciBuID0gZS50YWtlUmVjb3JkcygpO24ubGVuZ3RoICYmIGUuayhuLCBlKSwgZS5mID0gc2V0VGltZW91dChyLCB0Ll9wZXJpb2QpOwogICAgICAgICAgfSgpOwogICAgICAgIH1mdW5jdGlvbiBuKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4gPSB7IHR5cGU6IG51bGwsIHRhcmdldDogbnVsbCwgYWRkZWROb2RlczogW10sIHJlbW92ZWROb2RlczogW10sIHByZXZpb3VzU2libGluZzogbnVsbCwgbmV4dFNpYmxpbmc6IG51bGwsIGF0dHJpYnV0ZU5hbWU6IG51bGwsIGF0dHJpYnV0ZU5hbWVzcGFjZTogbnVsbCwgb2xkVmFsdWU6IG51bGwgfTtmb3IgKHIgaW4gdCkgewogICAgICAgICAgICBuW3JdICE9PSBlICYmIHRbcl0gIT09IGUgJiYgKG5bcl0gPSB0W3JdKTsKICAgICAgICAgIH1yZXR1cm4gbjsKICAgICAgICB9ZnVuY3Rpb24gbyhlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IGEoZSwgdCk7cmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgICAgYyA9IG4ubGVuZ3RoO3QuYSAmJiByLmEgJiYgaShuLCBlLCByLmEsIHQuZCksICh0LmIgfHwgdC5lKSAmJiAobyA9IHMobiwgZSwgciwgdCkpLCAobyB8fCBuLmxlbmd0aCAhPT0gYykgJiYgKHIgPSBhKGUsIHQpKTsKICAgICAgICAgIH07CiAgICAgICAgfWZ1bmN0aW9uIGkodCwgciwgbywgaSkgewogICAgICAgICAgZm9yICh2YXIgcywgYSwgYyA9IHt9LCB1ID0gci5hdHRyaWJ1dGVzLCBsID0gdS5sZW5ndGg7IGwtLTspIHsKICAgICAgICAgICAgcyA9IHVbbF0sIGEgPSBzLm5hbWUsIGkgJiYgaVthXSA9PT0gZSB8fCAocy52YWx1ZSAhPT0gb1thXSAmJiB0LnB1c2gobih7IHR5cGU6ICJhdHRyaWJ1dGVzIiwgdGFyZ2V0OiByLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSwgYXR0cmlidXRlTmFtZXNwYWNlOiBzLm5hbWVzcGFjZVVSSSB9KSksIGNbYV0gPSAhMCk7CiAgICAgICAgICB9Zm9yIChhIGluIG8pIHsKICAgICAgICAgICAgY1thXSB8fCB0LnB1c2gobih7IHRhcmdldDogciwgdHlwZTogImF0dHJpYnV0ZXMiLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfWZ1bmN0aW9uIHModCwgciwgbywgcykgewogICAgICAgICAgZnVuY3Rpb24gYShlLCByLCBvLCBhLCBjKSB7CiAgICAgICAgICAgIHZhciBsID0gZS5sZW5ndGggLSAxO2MgPSAtIH4oKGwgLSBjKSAvIDIpO2ZvciAodmFyIGYsIGQsIHA7IHAgPSBlLnBvcCgpOykgewogICAgICAgICAgICAgIGYgPSBvW3AuaF0sIGQgPSBhW3AuaV0sIHMuYiAmJiBjICYmIE1hdGguYWJzKHAuaCAtIHAuaSkgPj0gbCAmJiAodC5wdXNoKG4oeyB0eXBlOiAiY2hpbGRMaXN0IiwgdGFyZ2V0OiByLCBhZGRlZE5vZGVzOiBbZl0sIHJlbW92ZWROb2RlczogW2ZdLCBuZXh0U2libGluZzogZi5uZXh0U2libGluZywgcHJldmlvdXNTaWJsaW5nOiBmLnByZXZpb3VzU2libGluZyB9KSksIGMtLSksIHMuYSAmJiBkLmEgJiYgaSh0LCBmLCBkLmEsIHMuZCksIHMuYyAmJiAzID09PSBmLm5vZGVUeXBlICYmIGYubm9kZVZhbHVlICE9PSBkLmMgJiYgdC5wdXNoKG4oeyB0eXBlOiAiY2hhcmFjdGVyRGF0YSIsIHRhcmdldDogZiB9KSksIHMuZSAmJiB1KGYsIGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9ZnVuY3Rpb24gdShyLCBvKSB7CiAgICAgICAgICAgIGZvciAodmFyIGQsIHAsIGIsIGgsIHYsIHkgPSByLmNoaWxkTm9kZXMsIF8gPSBvLmIsIGcgPSB5Lmxlbmd0aCwgbSA9IF8gPyBfLmxlbmd0aCA6IDAsIGogPSAwLCAkID0gMCwgTyA9IDA7IGcgPiAkIHx8IG0gPiBPOykgewogICAgICAgICAgICAgIGggPSB5WyRdLCB2ID0gKGIgPSBfW09dKSAmJiBiLmosIGggPT09IHYgPyAocy5hICYmIGIuYSAmJiBpKHQsIGgsIGIuYSwgcy5kKSwgcy5jICYmIGIuYyAhPT0gZSAmJiBoLm5vZGVWYWx1ZSAhPT0gYi5jICYmIHQucHVzaChuKHsgdHlwZTogImNoYXJhY3RlckRhdGEiLCB0YXJnZXQ6IGggfSkpLCBwICYmIGEocCwgciwgeSwgXywgaiksIHMuZSAmJiAoaC5jaGlsZE5vZGVzLmxlbmd0aCB8fCBiLmIgJiYgYi5iLmxlbmd0aCkgJiYgdShoLCBiKSwgJCsrLCBPKyspIDogKGwgPSAhMCwgZCB8fCAoZCA9IHt9LCBwID0gW10pLCBoICYmIChkW2IgPSBjKGgpXSB8fCAoZFtiXSA9ICEwLCAtMSA9PT0gKGIgPSBmKF8sIGgsIE8sICJqIikpID8gcy5iICYmICh0LnB1c2gobih7IHR5cGU6ICJjaGlsZExpc3QiLCB0YXJnZXQ6IHIsIGFkZGVkTm9kZXM6IFtoXSwgbmV4dFNpYmxpbmc6IGgubmV4dFNpYmxpbmcsIHByZXZpb3VzU2libGluZzogaC5wcmV2aW91c1NpYmxpbmcgfSkpLCBqKyspIDogcC5wdXNoKHsgaDogJCwgaTogYiB9KSksICQrKyksIHYgJiYgdiAhPT0geVskXSAmJiAoZFtiID0gYyh2KV0gfHwgKGRbYl0gPSAhMCwgLTEgPT09IChiID0gZih5LCB2LCAkKSkgPyBzLmIgJiYgKHQucHVzaChuKHsgdHlwZTogImNoaWxkTGlzdCIsIHRhcmdldDogby5qLCByZW1vdmVkTm9kZXM6IFt2XSwgbmV4dFNpYmxpbmc6IF9bTyArIDFdLCBwcmV2aW91c1NpYmxpbmc6IF9bTyAtIDFdIH0pKSwgai0tKSA6IHAucHVzaCh7IGg6IGIsIGk6IE8gfSkpLCBPKyspKTsKICAgICAgICAgICAgfXAgJiYgYShwLCByLCB5LCBfLCBqKTsKICAgICAgICAgIH12YXIgbDtyZXR1cm4gdShyLCBvKSwgbDsKICAgICAgICB9ZnVuY3Rpb24gYShlLCB0KSB7CiAgICAgICAgICB2YXIgciA9ICEwO3JldHVybiBmdW5jdGlvbiBuKGUpIHsKICAgICAgICAgICAgdmFyIG8gPSB7IGo6IGUgfTtyZXR1cm4gIXQuYyB8fCAzICE9PSBlLm5vZGVUeXBlICYmIDggIT09IGUubm9kZVR5cGUgPyAodC5hICYmIHIgJiYgMSA9PT0gZS5ub2RlVHlwZSAmJiAoby5hID0gbChlLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQuZCAmJiAhdC5kW3IubmFtZV0gfHwgKGVbci5uYW1lXSA9IHIudmFsdWUpLCBlOwogICAgICAgICAgICB9KSksIHIgJiYgKHQuYiB8fCB0LmMgfHwgdC5hICYmIHQuZSkgJiYgKG8uYiA9IHUoZS5jaGlsZE5vZGVzLCBuKSksIHIgPSB0LmUpIDogby5jID0gZS5ub2RlVmFsdWUsIG87CiAgICAgICAgICB9KGUpOwogICAgICAgIH1mdW5jdGlvbiBjKGUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBlLmlkIHx8IChlLm1vX2lkID0gZS5tb19pZCB8fCBkKyspOwogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBjYXRjaCAocikgewogICAgICAgICAgICAgIHJldHVybiBkKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9ZnVuY3Rpb24gdShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByW25dID0gdChlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gbChlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0ge30sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByID0gdChyLCBlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gZihlLCB0LCByLCBuKSB7CiAgICAgICAgICBmb3IgKDsgciA8IGUubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgaWYgKChuID8gZVtyXVtuXSA6IGVbcl0pID09PSB0KSByZXR1cm4gcjsKICAgICAgICAgIH1yZXR1cm4gLTE7CiAgICAgICAgfXQuX3BlcmlvZCA9IDMwLCB0LnByb3RvdHlwZSA9IHsgb2JzZXJ2ZTogZnVuY3Rpb24gb2JzZXJ2ZShlLCB0KSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSB7IGE6ICEhKHQuYXR0cmlidXRlcyB8fCB0LmF0dHJpYnV0ZUZpbHRlciB8fCB0LmF0dHJpYnV0ZU9sZFZhbHVlKSwgYjogISF0LmNoaWxkTGlzdCwgZTogISF0LnN1YnRyZWUsIGM6ICEoIXQuY2hhcmFjdGVyRGF0YSAmJiAhdC5jaGFyYWN0ZXJEYXRhT2xkVmFsdWUpIH0sIGkgPSB0aGlzLmcsIHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgIGlbc10ubSA9PT0gZSAmJiBpLnNwbGljZShzLCAxKTsKICAgICAgICAgICAgfXQuYXR0cmlidXRlRmlsdGVyICYmIChuLmQgPSBsKHQuYXR0cmlidXRlRmlsdGVyLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHJldHVybiBlW3RdID0gITAsIGU7CiAgICAgICAgICAgIH0pKSwgaS5wdXNoKHsgbTogZSwgbDogbyhlLCBuKSB9KSwgdGhpcy5mIHx8IHIodGhpcyk7CiAgICAgICAgICB9LCB0YWtlUmVjb3JkczogZnVuY3Rpb24gdGFrZVJlY29yZHMoKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUgPSBbXSwgdCA9IHRoaXMuZywgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgICAgdFtyXS5sKGUpOwogICAgICAgICAgICB9cmV0dXJuIGU7CiAgICAgICAgICB9LCBkaXNjb25uZWN0OiBmdW5jdGlvbiBkaXNjb25uZWN0KCkgewogICAgICAgICAgICB0aGlzLmcgPSBbXSwgY2xlYXJUaW1lb3V0KHRoaXMuZiksIHRoaXMuZiA9IG51bGw7CiAgICAgICAgICB9IH07dmFyIGQgPSAxO3JldHVybiB0OwogICAgICB9KHZvaWQgMCk7CiAgICB9LCB7fV0sIDkxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgfHwgZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHMgPSBbImFkZCIsICJ1cGRhdGUiLCAiZGVsZXRlIiwgInJlY29uZmlndXJlIiwgInNldFByb3RvdHlwZSIsICJwcmV2ZW50RXh0ZW5zaW9ucyJdLAogICAgICAgICAgICBhID0gdC5pc0FycmF5IHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IGUuY2FsbCh0KTsKICAgICAgICAgIH07CiAgICAgICAgfShlLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIGMgPSB0LnByb3RvdHlwZS5pbmRleE9mID8gdC5pbmRleE9mIHx8IGZ1bmN0aW9uIChlLCByLCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsIHIsIG4pOwogICAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgICAgZm9yICh2YXIgbiA9IHIgfHwgMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgaWYgKGVbbl0gPT09IHQpIHJldHVybiBuOwogICAgICAgICAgfXJldHVybiAtMTsKICAgICAgICB9LAogICAgICAgICAgICB1ID0gci5NYXAgIT09IG4gJiYgTWFwLnByb3RvdHlwZS5mb3JFYWNoID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBNYXAoKTsKICAgICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGUgPSBbXSwKICAgICAgICAgICAgICB0ID0gW107cmV0dXJuIHsgc2l6ZTogMCwgaGFzOiBmdW5jdGlvbiBoYXModCkgewogICAgICAgICAgICAgIHJldHVybiBjKGUsIHQpID4gLTE7CiAgICAgICAgICAgIH0sIGdldDogZnVuY3Rpb24gZ2V0KHIpIHsKICAgICAgICAgICAgICByZXR1cm4gdFtjKGUsIHIpXTsKICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQociwgbikgewogICAgICAgICAgICAgIHZhciBvID0gYyhlLCByKTstMSA9PT0gbyA/IChlLnB1c2gociksIHQucHVzaChuKSwgdGhpcy5zaXplKyspIDogdFtvXSA9IG47CiAgICAgICAgICAgIH0sICJkZWxldGUiOiBmdW5jdGlvbiBfZGVsZXRlKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGMoZSwgcik7biA+IC0xICYmIChlLnNwbGljZShuLCAxKSwgdC5zcGxpY2UobiwgMSksIHRoaXMuc2l6ZS0tKTsKICAgICAgICAgICAgfSwgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChyKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICAgICAgICByLmNhbGwoYXJndW1lbnRzWzFdLCB0W25dLCBlW25dLCB0aGlzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gfTsKICAgICAgICB9LAogICAgICAgICAgICBsID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBlLmdldE93blByb3BlcnR5TmFtZXM7dHJ5IHsKICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZTsKICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgdmFyIG4gPSAodChjKS5qb2luKCIgIikgKyAiICIpLnJlcGxhY2UoL3Byb3RvdHlwZSB8bGVuZ3RoIHxuYW1lIC9nLCAiIikuc2xpY2UoMCwgLTEpLnNwbGl0KCIgIik7bi5sZW5ndGggJiYgKHQgPSBmdW5jdGlvbiB0KF90MykgewogICAgICAgICAgICAgIHZhciByID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzKF90Myk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIF90MykgZm9yICh2YXIgbywgaSA9IDA7IGkgPCBuLmxlbmd0aDspIHsKICAgICAgICAgICAgICAgIChvID0gYyhyLCBuW2krK10pKSA+IC0xICYmIHIuc3BsaWNlKG8sIDEpOwogICAgICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgfSgpIDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgbyA9IFtdO2lmICgiaGFzT3duUHJvcGVydHkiIGluIHQpIGZvciAociBpbiB0KSB7CiAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkocikgJiYgby5wdXNoKHIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbiA9IGUuaGFzT3duUHJvcGVydHk7Zm9yIChyIGluIHQpIHsKICAgICAgICAgICAgICBuLmNhbGwodCwgcikgJiYgby5wdXNoKHIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9cmV0dXJuIGEodCkgJiYgby5wdXNoKCJsZW5ndGgiKSwgbzsKICAgICAgICB9LAogICAgICAgICAgICBmID0gZS5nZXRQcm90b3R5cGVPZiwKICAgICAgICAgICAgZCA9IGUuZGVmaW5lUHJvcGVydGllcyAmJiBlLmdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICAgICAgICAgICAgcCA9IHIucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHIud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlID0gK25ldyBEYXRlKCksCiAgICAgICAgICAgICAgdCA9IGU7cmV0dXJuIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByKCh0ID0gK25ldyBEYXRlKCkpIC0gZSk7CiAgICAgICAgICAgIH0sIDE3KTsKICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICBiID0gZnVuY3Rpb24gYihlLCB0LCByKSB7CiAgICAgICAgICB2YXIgbiA9IG8uZ2V0KGUpO24gPyAodihuLCBlKSwgbShlLCBuLCB0LCByKSkgOiAobiA9IGgoZSksIG0oZSwgbiwgdCwgciksIDEgPT09IG8uc2l6ZSAmJiBwKHkpKTsKICAgICAgICB9LAogICAgICAgICAgICBoID0gZnVuY3Rpb24gaCh0LCByKSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICBpID0gbCh0KSwKICAgICAgICAgICAgICBzID0gW10sCiAgICAgICAgICAgICAgYSA9IDAsCiAgICAgICAgICAgICAgciA9IHsgaGFuZGxlcnM6IHUoKSwgZnJvemVuOiBlLmlzRnJvemVuID8gZS5pc0Zyb3plbih0KSA6ICExLCBleHRlbnNpYmxlOiBlLmlzRXh0ZW5zaWJsZSA/IGUuaXNFeHRlbnNpYmxlKHQpIDogITAsIHByb3RvOiBmICYmIGYodCksIHByb3BlcnRpZXM6IGksIHZhbHVlczogcywgbm90aWZpZXI6IGcodCwgcikgfTtpZiAoZCkgZm9yIChuID0gci5kZXNjcmlwdG9ycyA9IFtdOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIG5bYV0gPSBkKHQsIGlbYV0pLCBzW2FdID0gdFtpW2ErK11dOwogICAgICAgICAgfSBlbHNlIGZvciAoOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIHNbYV0gPSB0W2lbYSsrXV07CiAgICAgICAgICB9cmV0dXJuIG8uc2V0KHQsIHIpLCByOwogICAgICAgIH0sCiAgICAgICAgICAgIHYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IGQgPyBmdW5jdGlvbiAoZSwgdCwgciwgbiwgbykgewogICAgICAgICAgICB2YXIgaSA9IHQucHJvcGVydGllc1tyXSwKICAgICAgICAgICAgICAgIHMgPSBlW2ldLAogICAgICAgICAgICAgICAgYSA9IHQudmFsdWVzW3JdLAogICAgICAgICAgICAgICAgYyA9IHQuZGVzY3JpcHRvcnNbcl07InZhbHVlIiBpbiBvICYmIChhID09PSBzID8gMCA9PT0gYSAmJiAxIC8gYSAhPT0gMSAvIHMgOiBhID09PSBhIHx8IHMgPT09IHMpICYmIChqKGUsIHQsIHsgbmFtZTogaSwgdHlwZTogInVwZGF0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IGEgfSwgbiksIHQudmFsdWVzW3JdID0gcyksICFjLmNvbmZpZ3VyYWJsZSB8fCBvLmNvbmZpZ3VyYWJsZSAmJiBvLndyaXRhYmxlID09PSBjLndyaXRhYmxlICYmIG8uZW51bWVyYWJsZSA9PT0gYy5lbnVtZXJhYmxlICYmIG8uZ2V0ID09PSBjLmdldCAmJiBvLnNldCA9PT0gYy5zZXQgfHwgKGooZSwgdCwgeyBuYW1lOiBpLCB0eXBlOiAicmVjb25maWd1cmUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBhIH0sIG4pLCB0LmRlc2NyaXB0b3JzW3JdID0gbyk7CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgdmFyIG8gPSB0LnByb3BlcnRpZXNbcl0sCiAgICAgICAgICAgICAgICBpID0gZVtvXSwKICAgICAgICAgICAgICAgIHMgPSB0LnZhbHVlc1tyXTsocyA9PT0gaSA/IDAgPT09IHMgJiYgMSAvIHMgIT09IDEgLyBpIDogcyA9PT0gcyB8fCBpID09PSBpKSAmJiAoaihlLCB0LCB7IG5hbWU6IG8sIHR5cGU6ICJ1cGRhdGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBzIH0sIG4pLCB0LnZhbHVlc1tyXSA9IGkpOwogICAgICAgICAgfSwKICAgICAgICAgICAgICByID0gZCA/IGZ1bmN0aW9uIChlLCByLCBuLCBvLCBpKSB7CiAgICAgICAgICAgIGZvciAodmFyIHMsIGEgPSByLmxlbmd0aDsgbiAmJiBhLS07KSB7CiAgICAgICAgICAgICAgbnVsbCAhPT0gclthXSAmJiAocyA9IGQoZSwgclthXSksIG4tLSwgcyA/IHQoZSwgbywgYSwgaSwgcykgOiAoaihlLCBvLCB7IG5hbWU6IHJbYV0sIHR5cGU6ICJkZWxldGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBvLnZhbHVlc1thXSB9LCBpKSwgby5wcm9wZXJ0aWVzLnNwbGljZShhLCAxKSwgby52YWx1ZXMuc3BsaWNlKGEsIDEpLCBvLmRlc2NyaXB0b3JzLnNwbGljZShhLCAxKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4sIG8pIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHQubGVuZ3RoOyByICYmIGktLTspIHsKICAgICAgICAgICAgICBudWxsICE9PSB0W2ldICYmIChqKGUsIG4sIHsgbmFtZTogdFtpXSwgdHlwZTogImRlbGV0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IG4udmFsdWVzW2ldIH0sIG8pLCBuLnByb3BlcnRpZXMuc3BsaWNlKGksIDEpLCBuLnZhbHVlcy5zcGxpY2UoaSwgMSksIHItLSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07cmV0dXJuIGZ1bmN0aW9uIChuLCBvLCBpKSB7CiAgICAgICAgICAgIGlmIChuLmhhbmRsZXJzLnNpemUgJiYgIW4uZnJvemVuKSB7CiAgICAgICAgICAgICAgdmFyIHMsCiAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgICAgIHAsCiAgICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgICAgIHksCiAgICAgICAgICAgICAgICAgIF8gPSBuLnZhbHVlcywKICAgICAgICAgICAgICAgICAgZyA9IG4uZGVzY3JpcHRvcnMsCiAgICAgICAgICAgICAgICAgIG0gPSAwO2lmIChuLmV4dGVuc2libGUpIHsKICAgICAgICAgICAgICAgIGlmIChzID0gbi5wcm9wZXJ0aWVzLnNsaWNlKCksIGEgPSBzLmxlbmd0aCwgdSA9IGwobyksIGcpIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgeSA9IGQobywgYiksIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKG9bYl0pLCBnLnB1c2goeSkpIDogKHNbcF0gPSBudWxsLCBhLS0sIHQobywgbiwgcCwgaSwgeSkpOwogICAgICAgICAgICAgICAgICB9cihvLCBzLCBhLCBuLCBpKSwgZS5pc0V4dGVuc2libGUobykgfHwgKG4uZXh0ZW5zaWJsZSA9ICExLCBqKG8sIG4sIHsgdHlwZTogInByZXZlbnRFeHRlbnNpb25zIiwgb2JqZWN0OiBvIH0sIGkpLCBuLmZyb3plbiA9IGUuaXNGcm96ZW4obykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgaCA9IG9bYl0sIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKGgpKSA6IChzW3BdID0gbnVsbCwgYS0tLCB0KG8sIG4sIHAsIGkpKTsKICAgICAgICAgICAgICAgICAgfXIobywgcywgYSwgbiwgaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghbi5mcm96ZW4pIHsKICAgICAgICAgICAgICAgIGZvciAoOyBtIDwgcy5sZW5ndGg7IG0rKykgewogICAgICAgICAgICAgICAgICBiID0gc1ttXSwgdChvLCBuLCBtLCBpLCBkKG8sIGIpKTsKICAgICAgICAgICAgICAgIH1lLmlzRnJvemVuKG8pICYmIChuLmZyb3plbiA9ICEwKTsKICAgICAgICAgICAgICB9ZiAmJiAodiA9IGYobyksIHYgIT09IG4ucHJvdG8gJiYgKGoobywgbiwgeyB0eXBlOiAic2V0UHJvdG90eXBlIiwgbmFtZTogIl9fcHJvdG9fXyIsIG9iamVjdDogbywgb2xkVmFsdWU6IG4ucHJvdG8gfSksIG4ucHJvdG8gPSB2KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICB5ID0gZnVuY3Rpb24geSgpIHsKICAgICAgICAgIG8uc2l6ZSAmJiAoby5mb3JFYWNoKHYpLCBpLmZvckVhY2goXyksIHAoeSkpOwogICAgICAgIH0sCiAgICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKGUsIHQpIHsKICAgICAgICAgIHZhciByID0gZS5jaGFuZ2VSZWNvcmRzO3IubGVuZ3RoICYmIChlLmNoYW5nZVJlY29yZHMgPSBbXSwgdChyKSk7CiAgICAgICAgfSwKICAgICAgICAgICAgZyA9IGZ1bmN0aW9uIGcoZSwgdCkgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyICYmICh0ID0gby5nZXQoZSkpLCB0ICYmIHQubm90aWZpZXIgfHwgeyBub3RpZnk6IGZ1bmN0aW9uIG5vdGlmeSh0KSB7CiAgICAgICAgICAgICAgdC50eXBlO3ZhciByID0gby5nZXQoZSk7aWYgKHIpIHsKICAgICAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgICAgIGkgPSB7IG9iamVjdDogZSB9O2ZvciAobiBpbiB0KSB7CiAgICAgICAgICAgICAgICAgICJvYmplY3QiICE9PSBuICYmIChpW25dID0gdFtuXSk7CiAgICAgICAgICAgICAgICB9aihlLCByLCBpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHBlcmZvcm1DaGFuZ2U6IGZ1bmN0aW9uIHBlcmZvcm1DaGFuZ2UodCwgcikgewogICAgICAgICAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBub24tc3RyaW5nIGNoYW5nZVR5cGUiKTtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IHBlcmZvcm0gbm9uLWZ1bmN0aW9uIik7dmFyIGksCiAgICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICAgIGEgPSBvLmdldChlKSwKICAgICAgICAgICAgICAgICAgYyA9IGFyZ3VtZW50c1syXSwKICAgICAgICAgICAgICAgICAgdSA9IGMgPT09IG4gPyByKCkgOiByLmNhbGwoYyk7aWYgKGEgJiYgdihhLCBlLCB0KSwgYSAmJiB1ICYmICJvYmplY3QiID09ICh0eXBlb2YgdSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodSkpKSB7CiAgICAgICAgICAgICAgICBzID0geyBvYmplY3Q6IGUsIHR5cGU6IHQgfTtmb3IgKGkgaW4gdSkgewogICAgICAgICAgICAgICAgICAib2JqZWN0IiAhPT0gaSAmJiAidHlwZSIgIT09IGkgJiYgKHNbaV0gPSB1W2ldKTsKICAgICAgICAgICAgICAgIH1qKGUsIGEsIHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSB9OwogICAgICAgIH0sCiAgICAgICAgICAgIG0gPSBmdW5jdGlvbiBtKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHZhciBvID0gaS5nZXQocik7byB8fCBpLnNldChyLCBvID0geyBvYnNlcnZlZDogdSgpLCBjaGFuZ2VSZWNvcmRzOiBbXSB9KSwgby5vYnNlcnZlZC5zZXQoZSwgeyBhY2NlcHRMaXN0OiBuLnNsaWNlKCksIGRhdGE6IHQgfSksIHQuaGFuZGxlcnMuc2V0KHIsIG8pOwogICAgICAgIH0sCiAgICAgICAgICAgIGogPSBmdW5jdGlvbiBqKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHQuaGFuZGxlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbyA9IHQub2JzZXJ2ZWQuZ2V0KGUpLmFjY2VwdExpc3Q7KCJzdHJpbmciICE9IHR5cGVvZiBuIHx8IC0xID09PSBjKG8sIG4pKSAmJiBjKG8sIHIudHlwZSkgPiAtMSAmJiB0LmNoYW5nZVJlY29yZHMucHVzaChyKTsKICAgICAgICAgIH0pOwogICAgICAgIH07byA9IHUoKSwgaSA9IHUoKSwgZS5vYnNlcnZlID0gZnVuY3Rpb24gKHQsIHIsIG8pIHsKICAgICAgICAgIGlmICghdCB8fCAib2JqZWN0IiAhPSAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qub2JzZXJ2ZSBjYW5ub3Qgb2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIG5vbi1mdW5jdGlvbiIpO2lmIChlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4ocikpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIGEgZnJvemVuIGZ1bmN0aW9uIG9iamVjdCIpO2lmIChvID09PSBuKSBvID0gcztlbHNlIGlmICghbyB8fCAib2JqZWN0IiAhPSAodHlwZW9mIG8gPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG8pKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhpcmQgYXJndW1lbnQgdG8gT2JqZWN0Lm9ic2VydmUgbXVzdCBiZSBhbiBhcnJheSBvZiBzdHJpbmdzLiIpO3JldHVybiBiKHQsIHIsIG8pLCB0OwogICAgICAgIH0sIGUudW5vYnNlcnZlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSBlIHx8ICJvYmplY3QiICE9ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IHVub2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHIsCiAgICAgICAgICAgICAgbiA9IGkuZ2V0KHQpO3JldHVybiBuICYmIChyID0gbi5vYnNlcnZlZC5nZXQoZSkpICYmIChuLm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIHAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfKG4sIHQpOwogICAgICAgICAgfSksIDEgPT09IG4ub2JzZXJ2ZWQuc2l6ZSAmJiBuLm9ic2VydmVkLmhhcyhlKSA/IGlbImRlbGV0ZSJdKHQpIDogbi5vYnNlcnZlZFsiZGVsZXRlIl0oZSksIDEgPT09IHIuZGF0YS5oYW5kbGVycy5zaXplID8gb1siZGVsZXRlIl0oZSkgOiByLmRhdGEuaGFuZGxlcnNbImRlbGV0ZSJdKHQpKSwgZTsKICAgICAgICB9LCBlLmdldE5vdGlmaWVyID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSB0IHx8ICJvYmplY3QiICE9ICh0eXBlb2YgdCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodCkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5nZXROb3RpZmllciBjYW5ub3QgZ2V0Tm90aWZpZXIgbm9uLW9iamVjdCIpO3JldHVybiBlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4odCkgPyBudWxsIDogZyh0KTsKICAgICAgICB9LCBlLmRlbGl2ZXJDaGFuZ2VSZWNvcmRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QuZGVsaXZlckNoYW5nZVJlY29yZHMgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHQgPSBpLmdldChlKTt0ICYmICh0Lm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIF8odCwgZSkpOwogICAgICAgIH07CiAgICAgIH0oT2JqZWN0LCBBcnJheSwgdGhpcyk7CiAgICB9LCB7fV0sIDkyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pLCByLkRhdGFPYmplY3RPYnNlcnZlciA9IHIuRGF0YU9iamVjdFJlcG9ydGVyID0gci5TeW5jaGVyID0gdm9pZCAwLCBlKCJtdXRhdGlvbm9ic2VydmVyLXNoaW0iKSwgZSgib2JqZWN0Lm9ic2VydmUiKSwgZSgiYXJyYXkub2JzZXJ2ZSIpO3ZhciBvID0gZSgiLi9zeW5jaGVyL1N5bmNoZXIiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0UmVwb3J0ZXIiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiKSwKICAgICAgICAgIHUgPSBuKGMpO3IuU3luY2hlciA9IGlbImRlZmF1bHQiXSwgci5EYXRhT2JqZWN0UmVwb3J0ZXIgPSBhWyJkZWZhdWx0Il0sIHIuRGF0YU9iamVjdE9ic2VydmVyID0gdVsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9zeW5jaGVyL0RhdGFPYmplY3RPYnNlcnZlciI6IDk1LCAiLi9zeW5jaGVyL0RhdGFPYmplY3RSZXBvcnRlciI6IDk2LCAiLi9zeW5jaGVyL1N5bmNoZXIiOiA5OSwgImFycmF5Lm9ic2VydmUiOiAxLCAibXV0YXRpb25vYnNlcnZlci1zaGltIjogOTAsICJvYmplY3Qub2JzZXJ2ZSI6IDkxIH1dLCA5MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL1N5bmNPYmplY3QiKSwKICAgICAgICAgIHAgPSBuKGQpLAogICAgICAgICAgYiA9IGUoIi4vRGF0YU9iamVjdENoaWxkIiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCIuLi91dGlscy91dGlscy5qcyIpLAogICAgICAgICAgeSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBhID0gdGhpczthLl9zeW5jaGVyID0gdCwgYS5fdXJsID0gciwgYS5fc2NoZW1hID0gbiwgYS5fc3RhdHVzID0gbywgYS5fc3luY09iaiA9IG5ldyBwWyJkZWZhdWx0Il0oaSksIGEuX2NoaWxkcmVucyA9IHMsIGEuX3ZlcnNpb24gPSAwLCBhLl9jaGlsZElkID0gMCwgYS5fY2hpbGRyZW5PYmplY3RzID0ge30sIGEuX2NoaWxkcmVuTGlzdGVuZXJzID0gW10sIGEuX293bmVyID0gdC5fb3duZXIsIGEuX2J1cyA9IHQuX2J1czsKICAgICAgICB9cmV0dXJuICgwLCBmWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICAgICAgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gdC5fdXJsICsgIi9jaGlsZHJlbi8iO3QuX2NoaWxkcmVucyAmJiB0Ll9jaGlsZHJlbnMuZm9yRWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHZhciBvID0gciArIG4sCiAgICAgICAgICAgICAgICAgIGkgPSB0Ll9idXMuYWRkTGlzdGVuZXIobywgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgIGlmIChyLmZyb20gIT09IGUuX293bmVyKSBzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0LUNoaWxkcmVuLVJDVjogIiwgciksIHIudHlwZSkge2Nhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICAgICAgdC5fb25DaGlsZENyZWF0ZShyKTticmVhaztjYXNlICJkZWxldGUiOgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHIpO2JyZWFrO2RlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdC5fY2hhbmdlQ2hpbGRyZW4ocik7fQogICAgICAgICAgICAgIH0pO3QuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2goaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXM7ZS5fY2hpbGRyZW5MaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGUucmVtb3ZlKCk7CiAgICAgICAgICAgIH0pLCAoMCwgYVsiZGVmYXVsdCJdKShlLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGlsZHJlbk9iamVjdHNbdF0uX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAicGF1c2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHRocm93ICJOb3QgaW1wbGVtZW50ZWQiOwogICAgICAgICAgfSB9LCB7IGtleTogInJlc3VtZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3RvcCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAiYWRkQ2hpbGQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7ci5fY2hpbGRJZCsrO3ZhciBuID0gci5fb3duZXIgKyAiIyIgKyByLl9jaGlsZElkLAogICAgICAgICAgICAgICAgbyA9IHIuX3VybCArICIvY2hpbGRyZW4vIiArIGUsCiAgICAgICAgICAgICAgICBzID0geyB0eXBlOiAiY3JlYXRlIiwgZnJvbTogci5fb3duZXIsIHRvOiBvLCBib2R5OiB7IHJlc291cmNlOiBuLCB2YWx1ZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHIuX2J1cy5wb3N0TWVzc2FnZShzKTtjb25zb2xlLmxvZygiY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAiICsgci5fb3duZXIgKyAiICk6ICIsIHMpO3ZhciBhID0gbmV3IGhbImRlZmF1bHQiXShyLCBuLCB0LCByLl9vd25lciwgaSk7YS5vbkNoYW5nZShmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgci5fb25DaGFuZ2UoZSwgeyBwYXRoOiBvLCBjaGlsZElkOiBuIH0pOwogICAgICAgICAgICAgIH0pLCByLl9jaGlsZHJlbk9iamVjdHNbbl0gPSBhLCBlKGEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkFkZENoaWxkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoaWxkQ3JlYXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5yZXNvdXJjZTtjb25zb2xlLmxvZygiY3JlYXRlLW9ic2VydmVyLWNoaWxkKCAiICsgdC5fb3duZXIgKyAiICk6ICIsIGUpO3ZhciBuID0gbmV3IGhbImRlZmF1bHQiXSh0LCByLCBlLmJvZHkudmFsdWUpO3QuX2NoaWxkcmVuT2JqZWN0c1tyXSA9IG4sIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDIwMCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgICB9KTt2YXIgbyA9IHsgdHlwZTogZS50eXBlLCBmcm9tOiBlLmZyb20sIHVybDogZS50bywgdmFsdWU6IGUuYm9keS52YWx1ZSwgY2hpbGRJZDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSB9O3QuX29uQWRkQ2hpbGRyZW5IYW5kbGVyICYmIChjb25zb2xlLmxvZygiQURELUNISUxEUkVOLUVWRU5UOiAiLCBvKSwgdC5fb25BZGRDaGlsZHJlbkhhbmRsZXIobykpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbisrLCAib24iID09PSByLl9zdGF0dXMpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgdHlwZTogInVwZGF0ZSIsIGZyb206IHIuX3VybCwgdG86IHIuX3VybCArICIvY2hhbmdlcyIsIGJvZHk6IHsgdmVyc2lvbjogci5fdmVyc2lvbiwgc291cmNlOiByLl9vd25lciwgYXR0cmlidXRlOiBlLmZpZWxkIH0gfTtlLm9UeXBlID09PSBkLk9iamVjdFR5cGUuT0JKRUNUID8gZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSAmJiAobi5ib2R5LnZhbHVlID0gZS5kYXRhKSA6IChuLmJvZHkuYXR0cmlidXRlVHlwZSA9IGUub1R5cGUsIG4uYm9keS52YWx1ZSA9IGUuZGF0YSwgZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlVQREFURSAmJiAobi5ib2R5Lm9wZXJhdGlvbiA9IGUuY1R5cGUpKSwgdCAmJiAobi50byA9IHQucGF0aCwgbi5ib2R5LnJlc291cmNlID0gdC5jaGlsZElkKSwgci5fYnVzLnBvc3RNZXNzYWdlKG4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX2NoYW5nZU9iamVjdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbiArIDEgPT09IHQuYm9keS52ZXJzaW9uKSB7CiAgICAgICAgICAgICAgci5fdmVyc2lvbisrO3ZhciBuID0gdC5ib2R5LmF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgbyA9ICgwLCB2LmRlZXBDbG9uZSkodC5ib2R5LnZhbHVlKSwKICAgICAgICAgICAgICAgICAgaSA9IGUuZmluZEJlZm9yZShuKTtpZiAodC5ib2R5LmF0dHJpYnV0ZVR5cGUgPT09IGQuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgICAgICAgaWYgKHQuYm9keS5vcGVyYXRpb24gPT09IGQuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBpLm9iaiwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBpLmxhc3Q7QXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShzLCBbYSwgMF0uY29uY2F0KG8pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5ib2R5Lm9wZXJhdGlvbiA9PT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICAgICAgICB2YXIgYyA9IGkub2JqLAogICAgICAgICAgICAgICAgICAgICAgdSA9IGkubGFzdDtjLnNwbGljZSh1LCBvKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpLm9ialtpLmxhc3RdID0gbzsKICAgICAgICAgICAgICB9IGVsc2UgdC5ib2R5LnZhbHVlID8gaS5vYmpbaS5sYXN0XSA9IG8gOiBkZWxldGUgaS5vYmpbaS5sYXN0XTsKICAgICAgICAgICAgfSBlbHNlIGNvbnNvbGUubG9nKCJVTlNZTkNIUk9OSVpFRCBWRVJTSU9OOiAoZGF0YSA9PiAiICsgci5fdmVyc2lvbiArICIsIG1zZyA9PiAiICsgdC5ib2R5LnZlcnNpb24gKyAiKSIpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9jaGFuZ2VDaGlsZHJlbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztjb25zb2xlLmxvZygiQ2hhbmdlIGNoaWxkcmVuOiAiLCB0Ll9vd25lciwgZSk7dmFyIHIgPSBlLmJvZHkucmVzb3VyY2UsCiAgICAgICAgICAgICAgICBuID0gdC5fY2hpbGRyZW5PYmplY3RzW3JdO24gPyB0Ll9jaGFuZ2VPYmplY3Qobi5fc3luY09iaiwgZSkgOiBjb25zb2xlLmxvZygiTm8gY2hpbGRyZW4gZm91bmQgZm9yOiAiLCByKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cmwiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VybDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzY2hlbWEiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdGF0dXMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXR1czsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRyZW5zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbk9iamVjdHM7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IHksIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4uL3V0aWxzL3V0aWxzLmpzIjogMTAwLCAiLi9EYXRhT2JqZWN0Q2hpbGQiOiA5NCwgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogOSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vU3luY09iamVjdCIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgciwgbiwgbywgcykgewogICAgICAgICAgKDAsIGlbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIGEgPSB0aGlzO2EuX3BhcmVudCA9IHQsIGEuX2NoaWxkSWQgPSByLCBhLl9vd25lciA9IG8sIGEuX21zZ0lkID0gcywgYS5fc3luY09iaiA9IG5ldyB1WyJkZWZhdWx0Il0obiksIGEuX2J1cyA9IHQuX2J1cywgYS5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX293bmVyICYmIChlLl9saXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl9vd25lciwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAicmVzcG9uc2UiID09PSB0LnR5cGUgJiYgdC5pZCA9PT0gZS5fbXNnSWQgJiYgKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0Q2hpbGQub25SZXNwb25zZToiLCB0KSwgZS5fb25SZXNwb25zZSh0KSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyICYmIGUuX2xpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2RlbGV0ZSBlLl9wYXJlbnQuX2NoaWxkcmVuW2UuX2NoaWxkSWRdLCBlLl9yZWxlYXNlTGlzdGVuZXJzKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25DaGFuZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogZS50eXBlLCB1cmw6IGUuYm9keS5zb3VyY2UsIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgdC5fb25SZXNwb25zZUhhbmRsZXIocik7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRJZCIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IGwsIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICB1ID0gbihjKSwKICAgICAgICAgIGwgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGYgPSBuKGwpLAogICAgICAgICAgZCA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiksCiAgICAgICAgICBwID0gbihkKSwKICAgICAgICAgIGIgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKSwKICAgICAgICAgIHkgPSBuKHYpLAogICAgICAgICAgXyA9IGUoIi4vRGF0YU9iamVjdCIpLAogICAgICAgICAgZyA9IG4oXyksCiAgICAgICAgICBtID0gZSgiLi9EYXRhT2JqZWN0Q2hpbGQiKSwKICAgICAgICAgIGogPSBuKG0pLAogICAgICAgICAgJCA9IHsgQU5ZOiAiYW55IiwgU1RBUlQ6ICJzdGFydCIsIEVYQUNUOiAiZXhhY3QiIH0sCiAgICAgICAgICBPID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIHMsIGMsIGwpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBmID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBzLmRhdGEsIGMpKSwKICAgICAgICAgICAgICBkID0gZjtyZXR1cm4gZC5fdmVyc2lvbiA9IGwsIGQuX2ZpbHRlcnMgPSB7fSwgZC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGQuX29uRmlsdGVyKGUpOwogICAgICAgICAgfSksICgwLCBpWyJkZWZhdWx0Il0pKHMuY2hpbGRyZW5zKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0ID0gcy5jaGlsZHJlbnNbZV07ZC5fY2hpbGRyZW5PYmplY3RzW2VdID0gbmV3IGpbImRlZmF1bHQiXShkLCBlLCB0KTsKICAgICAgICAgIH0pLCBkLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBmOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fY2hhbmdlTGlzdGVuZXIgPSBlLl9idXMuYWRkTGlzdGVuZXIoZS5fdXJsICsgIi9jaGFuZ2VzIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAidXBkYXRlIiA9PT0gdC50eXBlICYmIChjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZU9iamVjdChlLl9zeW5jT2JqLCB0KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX2NoYW5nZUxpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX29ic2VydmVyc1tlLl91cmxdOwogICAgICAgICAgfSB9LCB7IGtleTogInVuc3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICB0ID0geyB0eXBlOiAidW5zdWJzY3JpYmUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLVVOU1VCU0NSSUJFOiAiLCB0KSwgMjAwID09PSB0LmJvZHkuY29kZSAmJiAoZS5fcmVsZWFzZUxpc3RlbmVycygpLCBkZWxldGUgZS5fc3luY2hlci5fb2JzZXJ2ZXJzW2UuX3VybF0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gZSwKICAgICAgICAgICAgICAgIG4gPSB7IHR5cGU6ICQuRVhBQ1QsIGNhbGxiYWNrOiB0IH0sCiAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKCIqIik7byA9PT0gZS5sZW5ndGggLSAxICYmICgwID09PSBvID8gbi50eXBlID0gJC5BTlkgOiAobi50eXBlID0gJC5TVEFSVCwgciA9IGUuc3Vic3RyKDAsIGUubGVuZ3RoIC0gMSkpKSwgdGhpcy5fZmlsdGVyc1tyXSA9IG47CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRmlsdGVyIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOygwLCBpWyJkZWZhdWx0Il0pKHQuX2ZpbHRlcnMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX2ZpbHRlcnNbcl07bi50eXBlID09PSAkLkFOWSA/IG4uY2FsbGJhY2soZSkgOiBuLnR5cGUgPT09ICQuU1RBUlQgPyAwID09PSBlLmZpZWxkLmluZGV4T2YocikgJiYgbi5jYWxsYmFjayhlKSA6IG4udHlwZSA9PT0gJC5FWEFDVCAmJiBlLmZpZWxkID09PSByICYmIG4uY2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBPLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL0RhdGFPYmplY3QiOiA5MywgIi4vRGF0YU9iamVjdENoaWxkIjogOTQsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOiA2LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjogMTMsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOiAxNCwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjogMTUgfV0sIDk2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpLAogICAgICAgICAgaCA9IG4oYiksCiAgICAgICAgICB2ID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIiksCiAgICAgICAgICB5ID0gbih2KSwKICAgICAgICAgIF8gPSBlKCIuL0RhdGFPYmplY3QiKSwKICAgICAgICAgIGcgPSBuKF8pLAogICAgICAgICAgbSA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBqID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBjID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBpLCBzKSksCiAgICAgICAgICAgICAgbCA9IGM7cmV0dXJuIGwuX3N1YnNjcmlwdGlvbnMgPSB7fSwgbC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItIiArIHIgKyAiLVNFTkQ6ICIsIGUpLCBsLl9vbkNoYW5nZShlKTsKICAgICAgICAgIH0pLCBsLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBjOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fcmVzcG9uc2VMaXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl91cmwsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgInJlc3BvbnNlIiA9PT0gdC50eXBlICYmIGUuX29uUmVzcG9uc2UodCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX3Jlc3BvbnNlTGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiaW52aXRlT2JzZXJ2ZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IHQuX3N5bmNoZXIuX293bmVyLCB0bzogdC5fc3luY2hlci5fc3ViVVJMLCBib2R5OiB7IHJlc291cmNlOiB0Ll91cmwsIHNjaGVtYTogdC5fc2NoZW1hLCB2YWx1ZTogdC5fc3luY09iai5kYXRhLCBhdXRob3Jpc2U6IGUgfSB9O3QuX2J1cy5wb3N0TWVzc2FnZShyKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgICAgICAgIHQgPSB7IHR5cGU6ICJkZWxldGUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLURFTEVURTogIiwgdCksIDIwMCA9PT0gdC5ib2R5LmNvZGUgJiYgKGUuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX3JlcG9ydGVyc1tlLl91cmxdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25TdWJzY3JpcHRpb24iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uUmVzcG9uc2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGU7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRm9yd2FyZCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItUkNWOiAiLCBlKSwgZS5ib2R5LnR5cGUpIHtjYXNlICJzdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25TdWJzY3JpYmUoZSk7YnJlYWs7Y2FzZSAidW5zdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25VblN1YnNjcmliZShlKTt9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uU3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5mcm9tLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgYWNjZXB0OiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHsgdXJsOiByLCBzdGF0dXM6ICJvbiIgfTt0Ll9zdWJzY3JpcHRpb25zW3JdID0gbjt2YXIgbyA9IHt9O3JldHVybiAoMCwgaVsiZGVmYXVsdCJdKSh0Ll9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0Ll9jaGlsZHJlbk9iamVjdHNbZV0uZGF0YTtvW2VdID0gKDAsIG0uZGVlcENsb25lKShyKTsKICAgICAgICAgICAgICAgIH0pLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogdC5fc2NoZW1hLCB2ZXJzaW9uOiB0Ll92ZXJzaW9uLCB2YWx1ZTogeyBkYXRhOiAoMCwgbS5kZWVwQ2xvbmUpKHQuZGF0YSksIGNoaWxkcmVuczogbyB9IH0gfSksIG47CiAgICAgICAgICAgICAgfSwgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICAgICAgICAgICAgdC5fYnVzLnBvc3RNZXNzYWdlKHsgaWQ6IGUuaWQsIHR5cGU6ICJyZXNwb25zZSIsIGZyb206IGUudG8sIHRvOiBlLmZyb20sIGJvZHk6IHsgY29kZTogNDAzLCBkZXNjOiByIH0gfSk7CiAgICAgICAgICAgICAgfSB9O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIlNVQlNDUklQVElPTi1FVkVOVDogIiwgbiksIHQuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihuKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uVW5TdWJzY3JpYmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LmZyb20sCiAgICAgICAgICAgICAgICBuID0gdC5fc3Vic2NyaXB0aW9uc1tyXTtkZWxldGUgdC5fc3Vic2NyaXB0aW9uc1tyXTt2YXIgbyA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgb2JqZWN0OiBuIH07dC5fb25TdWJzY3JpcHRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiVU4tU1VCU0NSSVBUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25TdWJzY3JpcHRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZXNwb25zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IHR5cGU6IGUudHlwZSwgdXJsOiBlLmZyb20sIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgKGNvbnNvbGUubG9nKCJSRVNQT05TRS1FVkVOVDogIiwgciksIHQuX29uUmVzcG9uc2VIYW5kbGVyKHIpKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpcHRpb25zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25zOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBqLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuLi91dGlscy91dGlscy5qcyI6IDEwMCwgIi4vRGF0YU9iamVjdCI6IDkzLCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogNiwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6IDcsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiAxMSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI6IDEyLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6IDEzLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjogMTQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI6IDE1IH1dLCA5NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByLCBuLCBvKSB7CiAgICAgICAgICAoMCwgaVsiZGVmYXVsdCJdKSh0aGlzLCBlKTt2YXIgcyA9IHRoaXM7cy5fb3duZXIgPSB0LCBzLl91cmwgPSByLCBzLl9idXMgPSBuLCBzLl9jaGlsZHJlbiA9IG8sIHMuX2NoYW5nZXMgPSBbXSwgcy5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyID0gZS5fYnVzLmFkZExpc3RlbmVyKGUuX3VybCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YVByb3Zpc2lvbmFsLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZXMucHVzaCh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9saXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJhcHBseSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpczt0Ll9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGFuZ2VPYmplY3QoZS5fc3luY09iaiwgdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImNoaWxkcmVuIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbjsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gYywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSksIHIuT2JqZWN0VHlwZSA9IHIuQ2hhbmdlVHlwZSA9IHZvaWQgMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBmID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgICAgKDAsIGFbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIHIgPSB0aGlzO3IuX29ic2VydmVycyA9IFtdLCByLl9maWx0ZXJzID0ge30sIHQgPyByLl9kYXRhID0gKDAsIGwuZGVlcENsb25lKSh0KSA6IHIuX2RhdGEgPSB7fSwgci5faW50ZXJuYWxPYnNlcnZlKG5ldyBkKCksIHIuX2RhdGEpOwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAib2JzZXJ2ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29ic2VydmVycy5wdXNoKGUpOwogICAgICAgICAgfSB9LCB7IGtleTogImZpbmQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGUuc3BsaXQoIi4iKTtyZXR1cm4gdGhpcy5fZmluZFdpdGhTcGxpdCh0KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJmaW5kQmVmb3JlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB7fSwKICAgICAgICAgICAgICAgIHIgPSBlLnNwbGl0KCIuIik7cmV0dXJuIHQubGFzdCA9IHIucG9wKCksIHQub2JqID0gdGhpcy5fZmluZFdpdGhTcGxpdChyKSwgdDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfZmluZFdpdGhTcGxpdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fZGF0YTtyZXR1cm4gZS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdCA9IHRbZV07CiAgICAgICAgICAgIH0pLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogIl9maXJlRXZlbnQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vYnNlcnZlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHQoZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9pc09ic2VydmFibGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICByZXR1cm4gZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IGUuY29uc3RydWN0b3IgPT09IEFycmF5OwogICAgICAgICAgfSB9LCB7IGtleTogIl9pbnRlcm5hbE9ic2VydmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7aWYgKHIuX2lzT2JzZXJ2YWJsZSh0KSkgewogICAgICAgICAgICAgIHZhciBuID0gZnVuY3Rpb24gbih0KSB7CiAgICAgICAgICAgICAgICByLl9vbkNoYW5nZXMoZSwgdCk7CiAgICAgICAgICAgICAgfTtpZiAodC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICAgICAgICBPYmplY3Qub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBvIGluIHQpIHsKICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHRbb10pICYmIHIuX2ludGVybmFsT2JzZXJ2ZShlWyJuZXciXShvKSwgdFtvXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgICAgICAgQXJyYXkub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBpIGluIHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHIuX2lzT2JzZXJ2YWJsZSh0W2ldKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0obmV3IHAodFtpXSwgaSkpO3IuX2ludGVybmFsT2JzZXJ2ZShzLCB0W2ldKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZXMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7Zm9yICh2YXIgbiBpbiB0KSB7CiAgICAgICAgICAgICAgdmFyIG8gPSB0W25dLm9iamVjdCwKICAgICAgICAgICAgICAgICAgaSA9IHZvaWQgMDtpZiAoby5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmIChpID0gaC5PQkpFQ1QpLCBvLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiAoaSA9IGguQVJSQVkpLCAic3BsaWNlIiA9PT0gdFtuXS50eXBlKSAhZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0W25dLmluZGV4LAogICAgICAgICAgICAgICAgICAgIGEgPSBlWyJuZXciXSgiIiArIHMpLAogICAgICAgICAgICAgICAgICAgIGMgPSBhLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgdSA9IHRbbl0ucmVtb3ZlZC5sZW5ndGg7aWYgKDAgIT09IHUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0W25dLnJlbW92ZWQ7Zi5mb3JFYWNoKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHQpICYmIGUucmVtb3ZlSW5kZXgocyArIG4pOwogICAgICAgICAgICAgICAgICB9KSwgci5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGMsIGRhdGE6IHUgfSk7CiAgICAgICAgICAgICAgICB9dmFyIGQgPSB0W25dLmFkZGVkQ291bnQ7aWYgKDAgIT09IGQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBvLnNsaWNlKHMsIHMgKyBkKTtoLmZvckVhY2goZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoci5faXNPYnNlcnZhYmxlKHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGVbIm5ldyJdKG5ldyBwKHQsIHMgKyBuKSk7ci5faW50ZXJuYWxPYnNlcnZlKG8sIHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksIHIuX2ZpcmVFdmVudCh7IGNUeXBlOiBiLkFERCwgb1R5cGU6IGksIGZpZWxkOiBjLCBkYXRhOiAoMCwgbC5kZWVwQ2xvbmUpKGgpIH0pOwogICAgICAgICAgICAgICAgfXMgIT09IG8ubGVuZ3RoIC0gMSAmJiBlLnJlSW5kZXhGcm9tKG8pOwogICAgICAgICAgICAgIH0oKTtlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0odFtuXS5uYW1lKSwKICAgICAgICAgICAgICAgICAgICBhID0gcy50b1N0cmluZygpO2lmICgtMSAhPT0gYS5pbmRleE9mKCJTeW1ib2wiKSkgY29udGludWU7dmFyIGMgPSBvW3Rbbl0ubmFtZV07InVwZGF0ZSIgPT09IHRbbl0udHlwZSAmJiB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5VUERBVEUsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSwgImFkZCIgPT09IHRbbl0udHlwZSAmJiAodGhpcy5faW50ZXJuYWxPYnNlcnZlKHMsIGMpLCB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5BREQsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSksICJkZWxldGUiID09PSB0W25dLnR5cGUgJiYgdGhpcy5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGEgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGF0YSIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCksCiAgICAgICAgICBkID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5fcGF0aCA9IFtdLCB0aGlzLl9vYnNlcnZhYmxlcyA9IHt9OwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAicmVtb3ZlSW5kZXgiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICBkZWxldGUgdGhpcy5fb2JzZXJ2YWJsZXNbZV07CiAgICAgICAgICB9IH0sIHsga2V5OiAicmVJbmRleEZyb20iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7KDAsIGlbImRlZmF1bHQiXSkodGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX29ic2VydmFibGVzW3JdLAogICAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKG4ub2JqKTtuLmlkeCAhPSBvICYmIChuLmlkeCA9IG8sIGRlbGV0ZSB0Ll9vYnNlcnZhYmxlc1tyXSwgdC5fb2JzZXJ2YWJsZXNbb10gPSBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAibmV3IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgZS5jb25zdHJ1Y3RvciA9PSBwICYmICh0aGlzLl9vYnNlcnZhYmxlc1tlLmlkeF0gPSBlKTt2YXIgdCA9IHRoaXMuY2xvbmUoKTtyZXR1cm4gdC5fcGF0aC5wdXNoKGUpLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogImNsb25lIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBlKCk7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQuX3BhdGgucHVzaChlKTsKICAgICAgICAgICAgfSksIHQ7CiAgICAgICAgICB9IH0sIHsga2V5OiAidG9TdHJpbmciLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gIiI7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgICAgIDAgPT09IHIgPyBlID0gdC50b1N0cmluZygpIDogZSArPSAiLiIgKyB0LnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0pLCBlOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKSwKICAgICAgICAgIHAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5vYmogPSB0LCB0aGlzLmlkeCA9IHI7CiAgICAgICAgfXJldHVybiAoMCwgdVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJ0b1N0cmluZyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWR4LnRvU3RyaW5nKCk7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpLAogICAgICAgICAgYiA9IHIuQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAidXBkYXRlIiwgQUREOiAiYWRkIiwgUkVNT1ZFOiAicmVtb3ZlIiB9LAogICAgICAgICAgaCA9IHIuT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAib2JqZWN0IiwgQVJSQVk6ICJhcnJheSIgfTtyWyJkZWZhdWx0Il0gPSBmOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMuanMiOiAxMDAsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOiA3LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4vRGF0YU9iamVjdFJlcG9ydGVyIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL0RhdGFPYmplY3RPYnNlcnZlciIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiLi9EYXRhUHJvdmlzaW9uYWwiKSwKICAgICAgICAgIGggPSBuKGIpLAogICAgICAgICAgdiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgICAgICAgICgwLCBhWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBvID0gdGhpcztvLl9vd25lciA9IHQsIG8uX2J1cyA9IHIsIG8uX3N1YlVSTCA9IG4ucnVudGltZVVSTCArICIvc20iLCBvLl9yZXBvcnRlcnMgPSB7fSwgby5fb2JzZXJ2ZXJzID0ge30sIG8uX3Byb3Zpc2lvbmFscyA9IHt9LCByLmFkZExpc3RlbmVyKHQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLmZyb20gIT09IHQpIHN3aXRjaCAoY29uc29sZS5sb2coIlN5bmNoZXItUkNWOiAiLCBlKSwgZS50eXBlKSB7Y2FzZSAiZm9yd2FyZCI6CiAgICAgICAgICAgICAgICBvLl9vbkZvcndhcmQoZSk7YnJlYWs7Y2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgIG8uX29uUmVtb3RlQ3JlYXRlKGUpO2JyZWFrO2Nhc2UgImRlbGV0ZSI6CiAgICAgICAgICAgICAgICBvLl9vblJlbW90ZURlbGV0ZShlKTt9CiAgICAgICAgICB9KTsKICAgICAgICB9cmV0dXJuICgwLCB1WyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImNyZWF0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0LCByKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcztyLnJlcG9ydGVyID0gbi5fb3duZXIsIHIuc2NoZW1hID0gZTt2YXIgbyA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IG4uX293bmVyLCB0bzogbi5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgdmFsdWU6IHIsIGF1dGhvcmlzZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKHQsIGkpIHsKICAgICAgICAgICAgICBuLl9idXMucG9zdE1lc3NhZ2UobywgZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgICAgIGlmIChjb25zb2xlLmxvZygiY3JlYXRlLXJlc3BvbnNlOiAiLCBvKSwgMjAwID09PSBvLmJvZHkuY29kZSkgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IG8uYm9keS5yZXNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBuZXcgZlsiZGVmYXVsdCJdKG4sIHMsIGUsICJvbiIsIHIsIG8uYm9keS5jaGlsZHJlblJlc291cmNlcyk7bi5fcmVwb3J0ZXJzW3NdID0gYSwgdChhKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpKG8uYm9keS5kZXNjKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogInN1YnNjcmliZSIsIGZyb206IHIuX293bmVyLCB0bzogci5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgcmVzb3VyY2U6IHQgfSB9O3JldHVybiBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uIChvLCBpKSB7CiAgICAgICAgICAgICAgci5fYnVzLnBvc3RNZXNzYWdlKG4sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic3Vic2NyaWJlLXJlc3BvbnNlOiAiLCBuKTt2YXIgcyA9IHIuX3Byb3Zpc2lvbmFsc1t0XTtpZiAoZGVsZXRlIHIuX3Byb3Zpc2lvbmFsc1t0XSwgcyAmJiBzLl9yZWxlYXNlTGlzdGVuZXJzKCksIG4uYm9keS5jb2RlIDwgMjAwKSBzID0gbmV3IGhbImRlZmF1bHQiXShyLl9vd25lciwgdCwgci5fYnVzLCBuLmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpLCByLl9wcm92aXNpb25hbHNbdF0gPSBzO2Vsc2UgaWYgKDIwMCA9PT0gbi5ib2R5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgcFsiZGVmYXVsdCJdKHIsIHQsIGUsICJvbiIsIG4uYm9keS52YWx1ZSwgcy5jaGlsZHJlbiwgbi5ib2R5LnZlcnNpb24pO3IuX29ic2VydmVyc1t0XSA9IGEsIG8oYSksIHMuYXBwbHkoYSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaShuLmJvZHkuZGVzYyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uTm90aWZpY2F0aW9uIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25Gb3J3YXJkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHQuX3JlcG9ydGVyc1tlLmJvZHkudG9dO3IuX29uRm9yd2FyZChlKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVDcmVhdGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5mcm9tLnNsaWNlKDAsIC0xMyksCiAgICAgICAgICAgICAgICBuID0geyB0eXBlOiBlLnR5cGUsIGZyb206IGUuYm9keS5zb3VyY2UsIHVybDogciwgc2NoZW1hOiBlLmJvZHkuc2NoZW1hLCB2YWx1ZTogZS5ib2R5LnZhbHVlLCBpZGVudGl0eTogZS5ib2R5LmlkZW50aXR5LCBhY2s6IGZ1bmN0aW9uIGFjayhyKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IDIwMDtyICYmIChuID0gciksIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IG4gfSB9KTsKICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBuKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG4pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVEZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LnJlc291cmNlLAogICAgICAgICAgICAgICAgbiA9IHQuX29ic2VydmVyc1tyXTtpZiAobikgewogICAgICAgICAgICAgIHZhciBvID0geyB0eXBlOiBlLnR5cGUsIHVybDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSwgYWNrOiBmdW5jdGlvbiBhY2socikgewogICAgICAgICAgICAgICAgICB2YXIgbyA9IDIwMDtyICYmIChvID0gciksIDIwMCA9PT0gbyAmJiBuWyJkZWxldGUiXSgpLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiBvLCBzb3VyY2U6IHQuX293bmVyIH0gfSk7CiAgICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgICAgfSBlbHNlIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDQwNCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm93bmVyIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vd25lcjsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZXBvcnRlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvYnNlcnZlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ic2VydmVyczsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gdiwgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiOiA5NSwgIi4vRGF0YU9iamVjdFJlcG9ydGVyIjogOTYsICIuL0RhdGFQcm92aXNpb25hbCI6IDk3LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOiA5LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgMTAwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfWZ1bmN0aW9uIG8oZSkgewogICAgICAgIHZhciB0ID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2ksCiAgICAgICAgICAgIHIgPSAiJDEsJDIsJDMiLAogICAgICAgICAgICBuID0gZS5yZXBsYWNlKHQsIHIpLnNwbGl0KCIsIik7blswXSA9PT0gZSAmJiAoblswXSA9ICJodHRwcyIsIG5bMV0gPSBlKTt2YXIgbyA9IHsgdHlwZTogblswXSwgZG9tYWluOiBuWzFdLCBpZGVudGl0eTogblsyXSB9O3JldHVybiBvOwogICAgICB9ZnVuY3Rpb24gaShlKSB7CiAgICAgICAgcmV0dXJuIGUgPyBKU09OLnBhcnNlKCgwLCBhWyJkZWZhdWx0Il0pKGUpKSA6IHZvaWQgMDsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBzID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL2pzb24vc3RyaW5naWZ5IiksCiAgICAgICAgICBhID0gbihzKTtyLmRpdmlkZVVSTCA9IG8sIHIuZGVlcENsb25lID0gaTsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSI6IDIgfV0gfSwge30sIFs5Ml0pKDkyKTsKfSk7Cgp9KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKfSx7fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gYWN0aXZhdGU7Cgp2YXIgX0h5cGVydHlEaXNjb3ZlcnkgPSByZXF1aXJlKCdzZXJ2aWNlLWZyYW1ld29yay9kaXN0L0h5cGVydHlEaXNjb3ZlcnknKTsKCnZhciBfSHlwZXJ0eURpc2NvdmVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9IeXBlcnR5RGlzY292ZXJ5KTsKCnZhciBfU3luY2hlciA9IHJlcXVpcmUoJ3NlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvU3luY2hlcicpOwoKdmFyIF9FdmVudEVtaXR0ZXIyID0gcmVxdWlyZSgnLi91dGlscy9FdmVudEVtaXR0ZXInKTsKCnZhciBfRXZlbnRFbWl0dGVyMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0V2ZW50RW1pdHRlcjIpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMnKTsKCnZhciBfY29tbXVuaWNhdGlvbiA9IHJlcXVpcmUoJy4vaHlwZXJ0eS1jaGF0L2NvbW11bmljYXRpb24nKTsKCnZhciBfcGFydGljaXBhbnQgPSByZXF1aXJlKCcuL2h5cGVydHktY2hhdC9wYXJ0aWNpcGFudCcpOwoKdmFyIF9wYXJ0aWNpcGFudDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wYXJ0aWNpcGFudCk7Cgp2YXIgX0NoYXQgPSByZXF1aXJlKCcuL2h5cGVydHktY2hhdC9DaGF0Jyk7Cgp2YXIgX0NoYXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQ2hhdCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpID8gY2FsbCA6IHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9IC8qKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoqLwoKLy8gU2VydmljZSBGcmFtZXdvcmsKCgovLyBVdGlscwoKCi8vIEludGVybmFscwoKCi8qKgoqIEh5cGVydHkgQ2hhdDsKKiBAYXV0aG9yIFZpdG9yIFNpbHZhIFt2aXRvci10LXNpbHZhQHRlbGVjb20ucHRdCiogQHZlcnNpb24gMC4xLjAKKi8KCnZhciBIeXBlcnR5Q2hhdCA9IGZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7CiAgX2luaGVyaXRzKEh5cGVydHlDaGF0LCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gSHlwZXJ0eUNoYXQoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eUNoYXQpOwoKICAgIGlmICghaHlwZXJ0eVVSTCkgdGhyb3cgbmV3IEVycm9yKCdUaGUgaHlwZXJ0eVVSTCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKICAgIGlmICghYnVzKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBNaW5pQnVzIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwogICAgaWYgKCFjb25maWd1cmF0aW9uKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjb25maWd1cmF0aW9uIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwoKICAgIHZhciBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoSHlwZXJ0eUNoYXQpLmNhbGwodGhpcywgaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKSk7CgogICAgdmFyIF90aGlzID0gX3RoaXMyOwogICAgdmFyIHN5bmNoZXIgPSBuZXcgX1N5bmNoZXIuU3luY2hlcihoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pOwoKICAgIHZhciBkb21haW4gPSAoMCwgX3V0aWxzLmRpdmlkZVVSTCkoaHlwZXJ0eVVSTCkuZG9tYWluOwogICAgdmFyIGh5cGVydHlEaXNjb3ZlcnkgPSBuZXcgX0h5cGVydHlEaXNjb3ZlcnkyLmRlZmF1bHQoaHlwZXJ0eVVSTCwgYnVzKTsKCiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL0NvbW11bmljYXRpb24nOwoKICAgIF90aGlzLl9oeXBlcnR5VVJMID0gaHlwZXJ0eVVSTDsKICAgIF90aGlzLl9zeW5jaGVyID0gc3luY2hlcjsKICAgIF90aGlzLl9kb21haW4gPSBkb21haW47CiAgICBfdGhpcy5faHlwZXJ0eURpc2NvdmVyeSA9IGh5cGVydHlEaXNjb3Zlcnk7CgogICAgc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgY29uc29sZS5sb2coJ05vdGlmaWNhdGlvbjogJywgZXZlbnQpOwogICAgICBfdGhpcy5fYXV0b1N1YnNjcmliZShldmVudC51cmwpOwogICAgfSk7CgogICAgcmV0dXJuIF90aGlzMjsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBjcmVhdGUgYSBuZXcgR3JvdXAgQ2hhdCBwcm92aWRpbmcgdGhlIGlkZW50aWZpZXIgb2YgdGhlIEdyb3VwIHRvIGJlIG5vdGlmaWVkLgogICAqIEBwYXJhbSAge1N0cmluZ30gbmFtZSAgICAgICAgICAgICBjaGF0IG5hbWUKICAgKiBAcGFyYW0gIHtVUkwuVXNlclVSTH0gVXNlclVSTExpc3QgTGlzdCBvZiBVc2VyIGFsbG93ZWQKICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEh5cGVydHlDaGF0LCBbewogICAga2V5OiAnY3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUobmFtZSwgcGFydGljaXBhbnRzKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgc3luY2hlciA9IF90aGlzLl9zeW5jaGVyOwogICAgICB2YXIgaHlwZXJ0eURpc2NvdmVyeSA9IF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5OwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy8gQ3JlYXRlIG93bmVyIHBhcnRpY2lwYW50CiAgICAgICAgLy8gVE9ETzogY3JlYXRlIGFsbCBpbmZvcm1hdGlvbiB0byBjb21tdW5pY2F0aW9uOwogICAgICAgIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3Qub3duZXIgPSBfdGhpcy5faHlwZXJ0eVVSTDsKICAgICAgICBfY29tbXVuaWNhdGlvbi5jb21tdW5pY2F0aW9uT2JqZWN0Lm5hbWUgPSBuYW1lOwogICAgICAgIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3QuaWQgPSBuYW1lOwogICAgICAgIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3Quc3RhdHVzID0gX2NvbW11bmljYXRpb24uQ29tbXVuaWNhdGlvblN0YXR1cy5PUEVOOwogICAgICAgIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3Quc3RhcnRpbmdUaW1lID0gbmV3IERhdGUoKS50b0pTT04oKTsKICAgICAgICBfY29tbXVuaWNhdGlvbi5jb21tdW5pY2F0aW9uT2JqZWN0Lmxhc3RNb2RpZmllZCA9IF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3Quc3RhcnRpbmdUaW1lOwoKICAgICAgICAvLyBTZXQgdGhlIG90aGVyIHN1YnNjcmlwdGlvbiBsaWtlIGEgcGFydGljaXBhbnQKICAgICAgICBfcGFydGljaXBhbnQyLmRlZmF1bHQuaHlwZXJ0eVJlc291cmNlID0gX3RoaXMuX2h5cGVydHlVUkw7CiAgICAgICAgX2NvbW11bmljYXRpb24uY29tbXVuaWNhdGlvbk9iamVjdC5wYXJ0aWNpcGFudHMucHVzaChfcGFydGljaXBhbnQyLmRlZmF1bHQpOwoKICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE1hcHBpbmcgUGFydGljcGFudHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4nKTsKICAgICAgICBfdGhpcy5fbWFwcGluZ1VzZXIocGFydGljaXBhbnRzKS50aGVuKGZ1bmN0aW9uIChoeXBlcnRpZXMpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5fY3JlYXRlU3luY2hlcihoeXBlcnRpZXMsIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3QpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChoeXBlcnRpZXMpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5fY3JlYXRlU3luY2hlcihoeXBlcnRpZXMsIF9jb21tdW5pY2F0aW9uLmNvbW11bmljYXRpb25PYmplY3QpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RSZXBvcnRlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCczLiBSZXR1cm4gQ3JlYXRlIERhdGEgT2JqZWN0IFJlcG9ydGVyJywgZGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICAgICAgICB2YXIgY2hhdCA9IG5ldyBfQ2hhdDIuZGVmYXVsdChzeW5jaGVyLCBoeXBlcnR5RGlzY292ZXJ5LCBfdGhpcy5fZG9tYWluKTsKICAgICAgICAgIGNoYXQuZGF0YU9iamVjdFJlcG9ydGVyID0gZGF0YU9iamVjdFJlcG9ydGVyOwogICAgICAgICAgcmVzb2x2ZShjaGF0KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnam9pbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gam9pbihyZXNvdXJjZSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgc3luY2hlciA9IF90aGlzLl9zeW5jaGVyOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBzdWJzY3JpYmUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbicpOwogICAgICAgIGNvbnNvbGUuaW5mbyhyZXNvdXJjZSk7CgogICAgICAgIHN5bmNoZXIuc3Vic2NyaWJlKF90aGlzLl9vYmplY3REZXNjVVJMLCByZXNvdXJjZSkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdE9ic2VydmVyKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJ0RhdGEgT2JqZWN0IE9ic2VydmVyOiAnLCBkYXRhT2JqZWN0T2JzZXJ2ZXIpOwogICAgICAgICAgdmFyIGNoYXQgPSBuZXcgX0NoYXQyLmRlZmF1bHQoc3luY2hlciwgX3RoaXMuX2h5cGVydHlEaXNjb3ZlcnksIF90aGlzLl9kb21haW4pOwogICAgICAgICAgY2hhdC5kYXRhT2JqZWN0T2JzZXJ2ZXIgPSBkYXRhT2JqZWN0T2JzZXJ2ZXI7CgogICAgICAgICAgcmVzb2x2ZShjaGF0KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2F1dG9TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvU3Vic2NyaWJlKHJlc291cmNlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5qb2luKHJlc291cmNlKS50aGVuKGZ1bmN0aW9uIChjaGF0R3JvdXApIHsKICAgICAgICBfdGhpcy50cmlnZ2VyKCdjaGF0OnN1YnNjcmliZScsIGNoYXRHcm91cCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19jcmVhdGVTeW5jaGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlU3luY2hlcihoeXBlcnRpZXMsIGNvbW11bmljYXRpb24pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjsKCiAgICAgIGNvbnNvbGUuaW5mbygnSGF2ZSAnICsgaHlwZXJ0aWVzLmxlbmd0aCArICcgcGFydGljaXBhbnRzOycpOwogICAgICBjb25zb2xlLmluZm8oJ1dJdGggY29tbXVuaWNhdGlvbk9iamVjdDogJywgY29tbXVuaWNhdGlvbik7CgogICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTeW5jaGVyIENyZWF0ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxuJyk7CiAgICAgIHJldHVybiBzeW5jaGVyLmNyZWF0ZShfdGhpcy5fb2JqZWN0RGVzY1VSTCwgaHlwZXJ0aWVzLCBjb21tdW5pY2F0aW9uKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfbWFwcGluZ1VzZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9tYXBwaW5nVXNlcih1c2VyTGlzdCkgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHZhciBoeXBlcnRpZXMgPSBbXTsKICAgICAgICB2YXIgY291bnQgPSAwOwoKICAgICAgICBpZiAodXNlckxpc3QubGVuZ3RoID09PSAwKSByZWplY3QoaHlwZXJ0aWVzKTsKCiAgICAgICAgdmFyIHJlc3VsdFVzZXJzID0gZnVuY3Rpb24gcmVzdWx0VXNlcnMoKSB7CiAgICAgICAgICBpZiAoY291bnQgPT09IHVzZXJMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICBjb25zb2xlLmluZm8oJ0hhdmUgJyArIGh5cGVydGllcy5sZW5ndGggKyAndXNlcnMgZm91bmQ7Jyk7CiAgICAgICAgICAgIHJlc29sdmUoaHlwZXJ0aWVzKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgYWN0aXZlVXNlcnMgPSBmdW5jdGlvbiBhY3RpdmVVc2Vycyh1c2VyKSB7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgaHlwZXJ0aWVzLnB1c2godXNlci5oeXBlcnR5VVJMKTsKICAgICAgICAgIHJlc3VsdFVzZXJzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGluYWN0aXZlVXNlcnMgPSBmdW5jdGlvbiBpbmFjdGl2ZVVzZXJzKCkgewogICAgICAgICAgY291bnQrKzsKICAgICAgICAgIHJlc3VsdFVzZXJzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdXNlckxpc3QuZm9yRWFjaChmdW5jdGlvbiAodXNlcikgewogICAgICAgICAgY29uc29sZS5sb2codXNlcik7CiAgICAgICAgICBpZiAodXNlci5lbWFpbC5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eVBlclVzZXIodXNlci5lbWFpbCwgdXNlci5kb21haW4pLnRoZW4oYWN0aXZlVXNlcnMpLmNhdGNoKGluYWN0aXZlVXNlcnMpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBIeXBlcnR5Q2hhdDsKfShfRXZlbnRFbWl0dGVyMy5kZWZhdWx0KTsKCmZ1bmN0aW9uIGFjdGl2YXRlKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikgewoKICByZXR1cm4gewogICAgbmFtZTogJ0h5cGVydHlDaGF0JywKICAgIGluc3RhbmNlOiBuZXcgSHlwZXJ0eUNoYXQoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKQogIH07Cn0KCn0seyIuL2h5cGVydHktY2hhdC9DaGF0Ijo1LCIuL2h5cGVydHktY2hhdC9jb21tdW5pY2F0aW9uIjo2LCIuL2h5cGVydHktY2hhdC9wYXJ0aWNpcGFudCI6NywiLi91dGlscy9FdmVudEVtaXR0ZXIiOjgsIi4vdXRpbHMvdXRpbHMiOjksInNlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvSHlwZXJ0eURpc2NvdmVyeSI6Miwic2VydmljZS1mcmFtZXdvcmsvZGlzdC9TeW5jaGVyIjozfV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKdmFyIF9FdmVudEVtaXR0ZXIyID0gcmVxdWlyZSgnLi4vdXRpbHMvRXZlbnRFbWl0dGVyJyk7Cgp2YXIgX0V2ZW50RW1pdHRlcjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9FdmVudEVtaXR0ZXIyKTsKCnZhciBfcGFydGljaXBhbnQgPSByZXF1aXJlKCcuL3BhcnRpY2lwYW50Jyk7Cgp2YXIgX3BhcnRpY2lwYW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3BhcnRpY2lwYW50KTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0gLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgQ2hhdEdyb3VwID0gZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoQ2hhdEdyb3VwLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gQ2hhdEdyb3VwKHN5bmNoZXIsIGh5cGVydHlEaXNjb3ZlcnksIGRvbWFpbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENoYXRHcm91cCk7CgogICAgaWYgKCFzeW5jaGVyKSB0aHJvdyBFcnJvcignU3luY2hlciBpcyBhIG5lY2Vzc2FyeSBkZXBlbmRlY3knKTsKICAgIGlmICghaHlwZXJ0eURpc2NvdmVyeSkgdGhyb3cgRXJyb3IoJ0h5cGVydHkgZGlzY292ZXIgaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7CgogICAgdmFyIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIE9iamVjdC5nZXRQcm90b3R5cGVPZihDaGF0R3JvdXApLmNhbGwodGhpcywgc3luY2hlciwgaHlwZXJ0eURpc2NvdmVyeSkpOwoKICAgIHZhciBfdGhpcyA9IF90aGlzMjsKICAgIF90aGlzLl9zeW5jaGVyID0gc3luY2hlcjsKICAgIF90aGlzLl9oeXBlcnR5RGlzY292ZXJ5ID0gaHlwZXJ0eURpc2NvdmVyeTsKCiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL0NvbW11bmljYXRpb24nOwogICAgcmV0dXJuIF90aGlzMjsKICB9CgogIF9jcmVhdGVDbGFzcyhDaGF0R3JvdXAsIFt7CiAgICBrZXk6ICdwcm9jZXNzUGFydGlwYW50cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1BhcnRpcGFudHMocGFydGljaXBhbnRzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBwYXJ0aWNpcGFudHMuZm9yRWFjaChmdW5jdGlvbiAocGFydGljaXBhbnQpIHsKICAgICAgICBpZiAoX3RoaXMuX2RhdGFPYmplY3RPYnNlcnZlci5fb3duZXIgIT09IHBhcnRpY2lwYW50Lmh5cGVydHlSZXNvdXJjZSkgewogICAgICAgICAgX3RoaXMucHJvY2Vzc1BhcnRpY2lwYW50KHBhcnRpY2lwYW50KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3Byb2Nlc3NQYXJ0aWNpcGFudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1BhcnRpY2lwYW50KHBhcnRpY2lwYW50KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGNvbnNvbGUubG9nKCdFYWNoIFBhcnRpY2lwYW50IHdpbGwgYmUgdHJpZ2dlcjogJywgcGFydGljaXBhbnQpOwogICAgICBfdGhpcy50cmlnZ2VyKCdwYXJ0aWNpcGFudDphZGRlZCcsIHBhcnRpY2lwYW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MgY2hpbGQgbWVzc2FnZXMKICAgICAqIEBwYXJhbSAge1t0eXBlXX0gY2hpbGQgW2Rlc2NyaXB0aW9uXQogICAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICBbZGVzY3JpcHRpb25dCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnX3Byb2Nlc3NDaGlsZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Byb2Nlc3NDaGlsZChjaGlsZCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgY29uc29sZS5pbmZvKCdQcm9jZXNzIE1lc3NhZ2U6JywgY2hpbGQpOwoKICAgICAgX3RoaXMudHJpZ2dlcignbmV3Om1lc3NhZ2U6cmVjaXZlZCcsIGNoaWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBzZW5kIGEgY2hhdCBtZXNzYWdlLgogICAgICogQHBhcmFtICB7TWVzc2FnZX0gbWVzc2FnZSB0ZXh0IHRvIGJlIHNlbmQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzZW5kJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKG1lc3NhZ2UpIHsKCiAgICAgIGNvbnNvbGUuaW5mbygnU2VuZCBNZXNzYWdlOicsIG1lc3NhZ2UsIHRoaXMpOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgPyBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgOiBfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBkYXRhT2JqZWN0LmFkZENoaWxkKCdjaGF0bWVzc2FnZXMnLCB7IGNoYXRNZXNzYWdlOiBtZXNzYWdlIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RDaGlsZCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCdEYXRhIE9iamVjdCBDaGlsZDogJywgZGF0YU9iamVjdENoaWxkKTsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIGNoaWxkSWQ6IGRhdGFPYmplY3RDaGlsZC5fY2hpbGRJZCwKICAgICAgICAgICAgZnJvbTogZGF0YU9iamVjdENoaWxkLl9vd25lciwKICAgICAgICAgICAgdmFsdWU6IGRhdGFPYmplY3RDaGlsZC5kYXRhCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLl9wcm9jZXNzQ2hpbGQobXNnKTsKICAgICAgICAgIHJlc29sdmUoZGF0YU9iamVjdENoaWxkKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBjbG9zZSBhbiBleGlzdGluZyBHcm91cCBDaGF0IGluc3RhbmNlLgogICAgICoKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdjbG9zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2UoKSB7fQogIH0sIHsKICAgIGtleTogJ2pvaW4nLAogICAgdmFsdWU6IGZ1bmN0aW9uIGpvaW4ocmVzb3VyY2UpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBfdGhpcy5hZGRQYXJ0aWNpcGFudChyZXNvdXJjZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICByZXNvbHZlKCdqb2luZWQ6ICcsIHJlc3VsdCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIFRPRE86IGltcHJvdmUgdGhpcyB3aXRoIGFuIGludml0ZTsKICAgIC8qKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGFkZCAvIGludml0ZSBuZXcgcGFydGljaXBhbnQgb24gYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS4KICAgICAqIEByZXR1cm4ge1Byb21pc2V9IFByb21pc2Ugd2l0aCB0aGUgc3RhdHVzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnYWRkUGFydGljaXBhbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFBhcnRpY2lwYW50KGVtYWlsKSB7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgc3luY2hlciA9IF90aGlzLl9zeW5jaGVyOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZW1vdmUgYSBwYXJ0aWNpcGFudCBmcm9tIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfSBQcm9taXNlIHdpdGggdGhlIHN0YXR1cwogICAgICovCgogIH0sIHsKICAgIGtleTogJ3JlbW92ZVBhcnRpY2lwYW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVQYXJ0aWNpcGFudCgpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc29sdmUoJ3BhcnRpY2lwYW50IHJlbW92ZWQnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoJ3JlbW92ZSBwYXJ0aWNpcGFudCBmYWlsJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBvcGVuIGEgR3JvdXAgQ2hhdCBpbnN0YW5jZSB0aGF0IHdhcyBwcmV2aW91c2x5IGNsb3NlZC4KICAgICAqIEByZXR1cm4ge1t0eXBlXX0gW2Rlc2NyaXB0aW9uXQogICAgICovCgogIH0sIHsKICAgIGtleTogJ29wZW4nLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9wZW4oKSB7fQogIH0sIHsKICAgIGtleTogJ2RhdGFPYmplY3RSZXBvcnRlcicsCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRhT2JqZWN0UmVwb3J0ZXIpIHsKCiAgICAgIGlmICghZGF0YU9iamVjdFJlcG9ydGVyKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBkYXRhIG9iamVjdCByZXBvcnRlciBpcyBuZWNlc3NhcnkgcGFyYW1ldGVyJyk7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgY29uc29sZS5pbmZvKCdTZXQgZGF0YSBvYmplY3QgcmVwb3J0ZXI6ICcsIGRhdGFPYmplY3RSZXBvcnRlcik7CgogICAgICBkYXRhT2JqZWN0UmVwb3J0ZXIub25TdWJzY3JpcHRpb24oZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICAgIGV2ZW50LmFjY2VwdCgpOwoKICAgICAgICAvLyBTZXQgdGhlIG90aGVyIHN1YnNjcmlwdGlvbiBsaWtlIGEgcGFydGljaXBhbnQKICAgICAgICBfcGFydGljaXBhbnQyLmRlZmF1bHQuaHlwZXJ0eVJlc291cmNlID0gZXZlbnQudXJsOwoKICAgICAgICBjb25zb2xlLmluZm8oJ09uIFN1YnNjcmlwdGlvbiBhZGQgUGFydGljaXBhbnQ6ICcsIF9wYXJ0aWNpcGFudDIuZGVmYXVsdCwgZXZlbnQpOwoKICAgICAgICBkYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YS5wYXJ0aWNpcGFudHMucHVzaChfcGFydGljaXBhbnQyLmRlZmF1bHQpOwoKICAgICAgICBfdGhpcy5wcm9jZXNzUGFydGljaXBhbnQoX3BhcnRpY2lwYW50Mi5kZWZhdWx0KTsKICAgICAgfSk7CgogICAgICBkYXRhT2JqZWN0UmVwb3J0ZXIub25BZGRDaGlsZChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICBjb25zb2xlLmluZm8oJ1JlcG9ydGVyIC0gQWRkIENoaWxkOiAnLCBjaGlsZCk7CiAgICAgICAgZGF0YU9iamVjdFJlcG9ydGVyLmRhdGEubGFzdE1vZGlmaWVkID0gbmV3IERhdGUoKS50b0pTT04oKTsKICAgICAgICBfdGhpcy5fcHJvY2Vzc0NoaWxkKGNoaWxkKTsKICAgICAgfSk7CgogICAgICBfdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyID0gZGF0YU9iamVjdFJlcG9ydGVyOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2RhdGFPYmplY3RSZXBvcnRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdkYXRhT2JqZWN0T2JzZXJ2ZXInLAogICAgc2V0OiBmdW5jdGlvbiBzZXQoZGF0YU9iamVjdE9ic2VydmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyOwoKICAgICAgZGF0YU9iamVjdE9ic2VydmVyLm9uQ2hhbmdlKCdwYXJ0aWNpcGFudHMuKicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGNvbnNvbGUuaW5mbygnQ2hhbmdlIEV2ZW50OiAnLCBldmVudCk7CiAgICAgICAgX3RoaXMucHJvY2Vzc1BhcnRpcGFudHMoZXZlbnQuZGF0YSk7CiAgICAgIH0pOwoKICAgICAgZGF0YU9iamVjdE9ic2VydmVyLm9uQWRkQ2hpbGQoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgY29uc29sZS5pbmZvKCdPYnNlcnZlciAtIEFkZCBDaGlsZDogJywgY2hpbGQpOwogICAgICAgIF90aGlzLl9wcm9jZXNzQ2hpbGQoY2hpbGQpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgcmV0dXJuIF90aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAnZGF0YU9iamVjdCcsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgcmV0dXJuIF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIgPyBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgOiBfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQ2hhdEdyb3VwOwp9KF9FdmVudEVtaXR0ZXIzLmRlZmF1bHQpOwoKZXhwb3J0cy5kZWZhdWx0ID0gQ2hhdEdyb3VwOwoKfSx7Ii4uL3V0aWxzL0V2ZW50RW1pdHRlciI6OCwiLi9wYXJ0aWNpcGFudCI6N31dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Ci8qKgoqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQoqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KKgoqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioqLwoKdmFyIENvbW11bmljYXRpb25TdGF0dXMgPSBleHBvcnRzLkNvbW11bmljYXRpb25TdGF0dXMgPSB7CiAgT1BFTjogJ29wZW4nLAogIFBFTkRJTkc6ICdwZW5kaW5nJywKICBDTE9TRUQ6ICdjbG9zZWQnLAogIFBBVVNFRDogJ3BhdXNlZCcsCiAgRkFJTEVEOiAnZmFpbGVkJwp9OwoKdmFyIGNvbW11bmljYXRpb25PYmplY3QgPSBleHBvcnRzLmNvbW11bmljYXRpb25PYmplY3QgPSB7CiAgaWQ6ICcnLAogIG5hbWU6ICcnLAogIG93bmVyOiAnJywKICBzdGFydGluZ1RpbWU6ICcnLAogIGxhc3RNb2RpZmllZDogJycsCiAgZHVyYXRpb246ICcnLAogIHN0YXR1czogJycsCiAgcW9zOiAnJywKICBwYXJ0aWNpcGFudHM6IFtdCn07Cgp9LHt9XSw3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCnZhciBwYXJ0aWNpcGFudCA9IHsKICBzdGF0dXM6ICcnLAogIGh5cGVydHlSZXNvdXJjZTogJycsCiAgaWRlbnRpdHk6ICcnCn07CgpleHBvcnRzLmRlZmF1bHQgPSBwYXJ0aWNpcGFudDsKCn0se31dLDg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgoqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQoqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgoqCiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoqCiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKKgoqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKiovCgovKioKICogRXZlbnRFbWl0dGVyCiAqIEFsbCBjbGFzc2VzIHdoaWNoIGV4dGVuZHMgdGhpcywgY2FuIGhhdmUgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdHJpZ2dlciBldmVudHM7CiAqLwoKdmFyIEV2ZW50RW1pdHRlciA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXZlbnRFbWl0dGVyKTsKICB9CgogIF9jcmVhdGVDbGFzcyhFdmVudEVtaXR0ZXIsIFt7CiAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKCgogICAgLyoqCiAgICAgKiBhZGRFdmVudExpc3RlbmVyIGxpc3RlbiBmb3IgYW4gZXZlbnRUeXBlCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICAgICAgZXZlbnRUeXBlIC0gbGlzdGVuaW5nIGZvciB0aGlzIHR5cGUgb2YgZXZlbnQKICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgICAgICBjYiAgICAgICAgLSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IGl0IGlzIGludm9rZWQKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpc1tldmVudFR5cGVdID0gY2I7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGV2ZW50VHlwZQogICAgICogQHBhcmFtICB7c3RyaW5nfSBldmVudFR5cGUgLSBldmVudCB3aWxsIGJlIGludm9rZWQKICAgICAqIEBwYXJhbSAge29iamVjdH0gcGFyYW1zIC0gcGFyYW1ldGVycyB3aWxsIGJlIHBhc3NlZCB0byB0aGUgYWRkRXZlbnRMaXN0ZW5lcgogICAgICovCgogIH0sIHsKICAgIGtleTogInRyaWdnZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnRUeXBlLCBwYXJhbXMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpc1tldmVudFR5cGVdKSB7CiAgICAgICAgX3RoaXNbZXZlbnRUeXBlXShwYXJhbXMpOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRXZlbnRFbWl0dGVyOwp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBFdmVudEVtaXR0ZXI7Cgp9LHt9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChwcm9jZXNzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRpdmlkZVVSTCA9IGRpdmlkZVVSTDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CmV4cG9ydHMuZ2V0Q29uZmlnID0gZ2V0Q29uZmlnOwpleHBvcnRzLmdldFVzZXJNZWRpYSA9IGdldFVzZXJNZWRpYTsKZXhwb3J0cy5zZXJpYWxpemUgPSBzZXJpYWxpemU7CmV4cG9ydHMuZ2V0VGVtcGxhdGUgPSBnZXRUZW1wbGF0ZTsKLyoqCiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKiovCgovLyBqc2hpbnQgYnJvd3Nlcjp0cnVlLCBqcXVlcnk6IHRydWUKLy8ganNoaW50IHZhcnN0bXQ6IHRydWUKLyogZ2xvYmFsIEhhbmRsZWJhcnMgKi8KCi8qKgogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsCiAqIEBtb2R1bGUgdXRpbHMKICovCgovKioKICogQHR5cGVkZWYgZGl2aWRlVVJMCiAqIEB0eXBlIE9iamVjdAogKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkwKICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTAogKi8KCi8qKgogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkKICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3MKICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTAogKi8KZnVuY3Rpb24gZGl2aWRlVVJMKHVybCkgewoKICAvLyBsZXQgcmUgPSAvKFthLXpBLVotXSopPzpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKSooXC9bXC9cZFx3XC4tXSopKig/OltcP10pKiguKykqL2dpOwogIHZhciByZSA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpOwogIHZhciBzdWJzdCA9ICckMSwkMiwkMyc7CiAgdmFyIHBhcnRzID0gdXJsLnJlcGxhY2UocmUsIHN1YnN0KS5zcGxpdCgnLCcpOwoKICAvLyBJZiB0aGUgdXJsIGhhcyBubyBwcm90b2NvbCwgdGhlIGRlZmF1bHQgcHJvdG9jb2wgc2V0IGlzIGh0dHBzCiAgaWYgKHBhcnRzWzBdID09PSB1cmwpIHsKICAgIHBhcnRzWzBdID0gJ2h0dHBzJzsKICAgIHBhcnRzWzFdID0gdXJsOwogIH0KCiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YQogKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkCiAqIEByZXR1cm4ge09iamVjdH0KICovCmZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHsKICAvL1RPRE86IHNpbXBsZSBidXQgaW5lZmZpY2llbnQgSlNPTiBkZWVwIGNsb25lLi4uCiAgaWYgKG9iaikgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCi8qKgogKiBHZXQgdGhlIGNvbmZpZ3VyYXRpb24gZnJvbSBhbiBqc29uIGZpbGU7CiAqIEBwYXJhbSAge0pTT05PYmplY3R9IGpzb25GaWxlCiAqIEByZXR1cm4ge29iamVjdH0KICovCmZ1bmN0aW9uIGdldENvbmZpZyhKU09OT2JqZWN0KSB7CiAgY29uc29sZS5sb2cocHJvY2Vzcy5lbnYuZW52aXJvbm1lbnQpOwogIHJldHVybiBKU09OT2JqZWN0W3Byb2Nlc3MuZW52LmVudmlyb25tZW50XTsKfQoKLyoqCiAqIEdldCBXZWJSVEMgQVBJIHJlc291cmNlcwogKiBAcGFyYW0gIHtPYmplY3R9ICAgICBvcHRpb25zIE9iamVjdCBjb250YWluaW5nIHRoZSBpbmZvcm1hdGlvbiB0aGF0IHJlc291cmNlcyB3aWxsIGJlIHVzZWQgKGNhbWVyYSwgbWljLCByZXNvbHV0aW9uLCBldGMpOwogKiBAcmV0dXJuIHtQcm9taXNlfQogKi8KZnVuY3Rpb24gZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKSB7CgogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpLnRoZW4oZnVuY3Rpb24gKG1lZGlhU3RyZWFtKSB7CiAgICAgIHJlc29sdmUobWVkaWFTdHJlYW0pOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICByZWplY3QocmVhc29uKTsKICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiBzZXJpYWxpemUoKSB7CgogICQuZm4uc2VyaWFsaXplT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG8gPSB7fTsKICAgIHZhciBhID0gdGhpcy5zZXJpYWxpemVBcnJheSgpOwogICAgJC5lYWNoKGEsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKG9bdGhpcy5uYW1lXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCFvW3RoaXMubmFtZV0ucHVzaCkgewogICAgICAgICAgb1t0aGlzLm5hbWVdID0gW29bdGhpcy5uYW1lXV07CiAgICAgICAgfQoKICAgICAgICBvW3RoaXMubmFtZV0ucHVzaCh0aGlzLnZhbHVlIHx8ICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvW3RoaXMubmFtZV0gPSB0aGlzLnZhbHVlIHx8ICcnOwogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gbzsKICB9OwoKICAkLmZuLnNlcmlhbGl6ZU9iamVjdEFycmF5ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG8gPSB7fTsKICAgIHZhciBhID0gdGhpcy5zZXJpYWxpemVBcnJheSgpOwogICAgJC5lYWNoKGEsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKG9bdGhpcy5uYW1lXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCFvW3RoaXMubmFtZV0ucHVzaCkgewogICAgICAgICAgb1t0aGlzLm5hbWVdID0gW29bdGhpcy5uYW1lXV07CiAgICAgICAgfQoKICAgICAgICBvW3RoaXMubmFtZV0ucHVzaCh0aGlzLnZhbHVlIHx8ICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIW9bdGhpcy5uYW1lXSkgb1t0aGlzLm5hbWVdID0gW107CiAgICAgICAgb1t0aGlzLm5hbWVdLnB1c2godGhpcy52YWx1ZSB8fCAnJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBvOwogIH07Cn0KCmZ1bmN0aW9uIGdldFRlbXBsYXRlKHBhdGgsIHNjcmlwdCkgewoKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgIGlmIChIYW5kbGViYXJzLnRlbXBsYXRlcyA9PT0gdW5kZWZpbmVkIHx8IEhhbmRsZWJhcnMudGVtcGxhdGVzW25hbWVdID09PSB1bmRlZmluZWQpIHsKICAgICAgSGFuZGxlYmFycy50ZW1wbGF0ZXMgPSB7fTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc29sdmUoSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0pOwogICAgfQoKICAgIHZhciB0ZW1wbGF0ZUZpbGUgPSAkLmFqYXgoewogICAgICB1cmw6IHBhdGggKyAnLmhicycsCiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkgewogICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzW25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKGRhdGEpOwogICAgICB9LAoKICAgICAgZmFpbDogZnVuY3Rpb24gZmFpbChyZWFzb24pIHsKICAgICAgICByZXR1cm4gcmVhc29uOwogICAgICB9CiAgICB9KTsKCiAgICB2YXIgc2NyaXB0RmlsZSA9ICQuZ2V0U2NyaXB0KHNjcmlwdCk7CgogICAgdmFyIHJlcXVlc3RzID0gW107CiAgICBpZiAocGF0aCkgcmVxdWVzdHMucHVzaCh0ZW1wbGF0ZUZpbGUpOwogICAgaWYgKHNjcmlwdCkgcmVxdWVzdHMucHVzaChzY3JpcHRGaWxlKTsKCiAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgIHJlc29sdmUoSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0pOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICByZWplY3QocmVhc29uKTsKICAgIH0pOwogIH0pOwp9Cgp9KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSkKfSx7Il9wcm9jZXNzIjoxfV19LHt9LFs0XSkoNCkKfSk7",
      "sourceCodeClassname": "HypertyChat",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of HypertyChat",
    "objectName": "HypertyChat",
    "configuration": {},
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "GroupChatHyperty": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CiJ1c2Ugc3RyaWN0IjsKCnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsKCi8qKgoqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQoqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KKgoqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioqLwoKLy8gRGlzdHJpYnV0aW9uIGZpbGUgZm9yIEh5cGVydHlEaXNjb3ZlcnkuanMKLy8gdmVyc2lvbjogMC4yLjAKCiFmdW5jdGlvbiAoZSkgewogIGlmICgib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbW9kdWxlKSBtb2R1bGUuZXhwb3J0cyA9IGUoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCBlKTtlbHNlIHsKICAgIHZhciB0O3QgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHRoaXMsIHQuSHlwZXJ0eURpc2NvdmVyeSA9IGUoKTsKICB9Cn0oZnVuY3Rpb24gKCkgewogIHJldHVybiBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgIGZ1bmN0aW9uIG8oYywgcykgewogICAgICBpZiAoIXJbY10pIHsKICAgICAgICBpZiAoIXRbY10pIHsKICAgICAgICAgIHZhciB1ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlO2lmICghcyAmJiB1KSByZXR1cm4gdShjLCAhMCk7aWYgKGkpIHJldHVybiBpKGMsICEwKTt2YXIgYSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgYyArICInIik7dGhyb3cgYS5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCBhOwogICAgICAgIH12YXIgZiA9IHJbY10gPSB7IGV4cG9ydHM6IHt9IH07dFtjXVswXS5jYWxsKGYuZXhwb3J0cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gdFtjXVsxXVtlXTtyZXR1cm4gbyhyID8gciA6IGUpOwogICAgICAgIH0sIGYsIGYuZXhwb3J0cywgZSwgdCwgciwgbik7CiAgICAgIH1yZXR1cm4gcltjXS5leHBvcnRzOwogICAgfWZvciAodmFyIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmUsIGMgPSAwOyBjIDwgbi5sZW5ndGg7IGMrKykgewogICAgICBvKG5bY10pOwogICAgfXJldHVybiBvOwogIH0oeyAxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9qc29uL3N0cmluZ2lmeSIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL2pzb24vc3RyaW5naWZ5IjogNiB9XSwgMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9kZWZpbmUtcHJvcGVydHkiOiA3IH1dLCAzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSI6IDggfV0sIDQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHIuX19lc01vZHVsZSA9ICEwLCByWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICAgIH07CiAgICB9LCB7fV0sIDU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9ci5fX2VzTW9kdWxlID0gITA7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtyXTtuLmVudW1lcmFibGUgPSBuLmVudW1lcmFibGUgfHwgITEsIG4uY29uZmlndXJhYmxlID0gITAsICJ2YWx1ZSIgaW4gbiAmJiAobi53cml0YWJsZSA9ICEwKSwgKDAsIGlbImRlZmF1bHQiXSkoZSwgbi5rZXksIG4pOwogICAgICAgICAgfQogICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKHQsIHIsIG4pIHsKICAgICAgICAgIHJldHVybiByICYmIGUodC5wcm90b3R5cGUsIHIpLCBuICYmIGUodCwgbiksIHQ7CiAgICAgICAgfTsKICAgICAgfSgpOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkiOiAyIH1dLCA2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLi8uLi9tb2R1bGVzL19jb3JlIiksCiAgICAgICAgICBvID0gbi5KU09OIHx8IChuLkpTT04gPSB7IHN0cmluZ2lmeTogSlNPTi5zdHJpbmdpZnkgfSk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gby5zdHJpbmdpZnkuYXBwbHkobywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvX2NvcmUiOiAxNiB9XSwgNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5kZWZpbmUtcHJvcGVydHkiKTt2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvX2NvcmUiKS5PYmplY3Q7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICByZXR1cm4gbi5kZWZpbmVQcm9wZXJ0eShlLCB0LCByKTsKICAgICAgfTsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvX2NvcmUiOiAxNiwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOiA3MSB9XSwgODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciKSwgZSgiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksIGUoIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSIpLCBlKCIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIiksIHQuZXhwb3J0cyA9IGUoIi4uL21vZHVsZXMvX2NvcmUiKS5Qcm9taXNlOwogICAgfSwgeyAiLi4vbW9kdWxlcy9fY29yZSI6IDE2LCAiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyI6IDcyLCAiLi4vbW9kdWxlcy9lczYucHJvbWlzZSI6IDczLCAiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIjogNzQsICIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOiA3NSB9XSwgOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYSBmdW5jdGlvbiEiKTtyZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHt9XSwgMTA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7fTsKICAgIH0sIHt9XSwgMTE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgbikgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSB8fCB2b2lkIDAgIT09IG4gJiYgbiBpbiBlKSB0aHJvdyBUeXBlRXJyb3IociArICI6IGluY29ycmVjdCBpbnZvY2F0aW9uISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAxMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoIW4oZSkpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYW4gb2JqZWN0ISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9faXMtb2JqZWN0IjogMzMgfV0sIDEzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL190by1pb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9fdG8tbGVuZ3RoIiksCiAgICAgICAgICBpID0gZSgiLi9fdG8taW5kZXgiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgciwgYykgewogICAgICAgICAgdmFyIHMsCiAgICAgICAgICAgICAgdSA9IG4odCksCiAgICAgICAgICAgICAgYSA9IG8odS5sZW5ndGgpLAogICAgICAgICAgICAgIGYgPSBpKGMsIGEpO2lmIChlICYmIHIgIT0gcikgewogICAgICAgICAgICBmb3IgKDsgYSA+IGY7KSB7CiAgICAgICAgICAgICAgaWYgKHMgPSB1W2YrK10sIHMgIT0gcykgcmV0dXJuICEwOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgZm9yICg7IGEgPiBmOyBmKyspIHsKICAgICAgICAgICAgaWYgKChlIHx8IGYgaW4gdSkgJiYgdVtmXSA9PT0gcikgcmV0dXJuIGUgfHwgZiB8fCAwOwogICAgICAgICAgfXJldHVybiAhZSAmJiAtMTsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fdG8taW5kZXgiOiA2MSwgIi4vX3RvLWlvYmplY3QiOiA2MywgIi4vX3RvLWxlbmd0aCI6IDY0IH1dLCAxNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY29mIiksCiAgICAgICAgICBvID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIiksCiAgICAgICAgICBpID0gIkFyZ3VtZW50cyIgPT0gbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50czsKICAgICAgfSgpKSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiBjKGUsIHQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIGVbdF07CiAgICAgICAgfSBjYXRjaCAocikge30KICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LCByLCBzO3JldHVybiB2b2lkIDAgPT09IGUgPyAiVW5kZWZpbmVkIiA6IG51bGwgPT09IGUgPyAiTnVsbCIgOiAic3RyaW5nIiA9PSB0eXBlb2YgKHIgPSBjKHQgPSBPYmplY3QoZSksIG8pKSA/IHIgOiBpID8gbih0KSA6ICJPYmplY3QiID09IChzID0gbih0KSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5jYWxsZWUgPyAiQXJndW1lbnRzIiA6IHM7CiAgICAgIH07CiAgICB9LCB7ICIuL19jb2YiOiAxNSwgIi4vX3drcyI6IDY4IH1dLCAxNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0ge30udG9TdHJpbmc7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbi5jYWxsKGUpLnNsaWNlKDgsIC0xKTsKICAgICAgfTsKICAgIH0sIHt9XSwgMTY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9IHsgdmVyc2lvbjogIjIuNC4wIiB9OyJudW1iZXIiID09IHR5cGVvZiBfX2UgJiYgKF9fZSA9IG4pOwogICAgfSwge31dLCAxNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYS1mdW5jdGlvbiIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHZvaWQgMCA9PT0gdCkgcmV0dXJuIGU7c3dpdGNoIChyKSB7Y2FzZSAxOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIpOwogICAgICAgICAgICB9O2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuKTsKICAgICAgICAgICAgfTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbiwgbykgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgciwgbiwgbyk7CiAgICAgICAgICAgIH07fXJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuL19hLWZ1bmN0aW9uIjogOSB9XSwgMTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICh2b2lkIDAgPT0gZSkgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAgIiArIGUpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAxOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9ICFlKCIuL19mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pLmE7CiAgICAgIH0pOwogICAgfSwgeyAiLi9fZmFpbHMiOiAyMyB9XSwgMjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lzLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2dsb2JhbCIpLmRvY3VtZW50LAogICAgICAgICAgaSA9IG4obykgJiYgbihvLmNyZWF0ZUVsZW1lbnQpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGkgPyBvLmNyZWF0ZUVsZW1lbnQoZSkgOiB7fTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2dsb2JhbCI6IDI1LCAiLi9faXMtb2JqZWN0IjogMzMgfV0sIDIxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gImNvbnN0cnVjdG9yLGhhc093blByb3BlcnR5LGlzUHJvdG90eXBlT2YscHJvcGVydHlJc0VudW1lcmFibGUsdG9Mb2NhbGVTdHJpbmcsdG9TdHJpbmcsdmFsdWVPZiIuc3BsaXQoIiwiKTsKICAgIH0sIHt9XSwgMjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vX2NvcmUiKSwKICAgICAgICAgIGkgPSBlKCIuL19jdHgiKSwKICAgICAgICAgIGMgPSBlKCIuL19oaWRlIiksCiAgICAgICAgICBzID0gInByb3RvdHlwZSIsCiAgICAgICAgICB1ID0gZnVuY3Rpb24gdShlLCB0LCByKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIF8sCiAgICAgICAgICAgIGwgPSBlICYgdS5GLAogICAgICAgICAgICBkID0gZSAmIHUuRywKICAgICAgICAgICAgcCA9IGUgJiB1LlMsCiAgICAgICAgICAgIHYgPSBlICYgdS5QLAogICAgICAgICAgICB5ID0gZSAmIHUuQiwKICAgICAgICAgICAgaCA9IGUgJiB1LlcsCiAgICAgICAgICAgIGIgPSBkID8gbyA6IG9bdF0gfHwgKG9bdF0gPSB7fSksCiAgICAgICAgICAgIG0gPSBiW3NdLAogICAgICAgICAgICBnID0gZCA/IG4gOiBwID8gblt0XSA6IChuW3RdIHx8IHt9KVtzXTtkICYmIChyID0gdCk7Zm9yIChhIGluIHIpIHsKICAgICAgICAgIGYgPSAhbCAmJiBnICYmIHZvaWQgMCAhPT0gZ1thXSwgZiAmJiBhIGluIGIgfHwgKF8gPSBmID8gZ1thXSA6IHJbYV0sIGJbYV0gPSBkICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIGdbYV0gPyByW2FdIDogeSAmJiBmID8gaShfLCBuKSA6IGggJiYgZ1thXSA9PSBfID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBmdW5jdGlvbiB0KF90LCByLCBuKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBlKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKCk7Y2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZShfdCk7Y2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZShfdCwgcik7fXJldHVybiBuZXcgZShfdCwgciwgbik7CiAgICAgICAgICAgICAgfXJldHVybiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07cmV0dXJuIHRbc10gPSBlW3NdLCB0OwogICAgICAgICAgfShfKSA6IHYgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgXyA/IGkoRnVuY3Rpb24uY2FsbCwgXykgOiBfLCB2ICYmICgoYi52aXJ0dWFsIHx8IChiLnZpcnR1YWwgPSB7fSkpW2FdID0gXywgZSAmIHUuUiAmJiBtICYmICFtW2FdICYmIGMobSwgYSwgXykpKTsKICAgICAgICB9CiAgICAgIH07dS5GID0gMSwgdS5HID0gMiwgdS5TID0gNCwgdS5QID0gOCwgdS5CID0gMTYsIHUuVyA9IDMyLCB1LlUgPSA2NCwgdS5SID0gMTI4LCB0LmV4cG9ydHMgPSB1OwogICAgfSwgeyAiLi9fY29yZSI6IDE2LCAiLi9fY3R4IjogMTcsICIuL19nbG9iYWwiOiAyNSwgIi4vX2hpZGUiOiAyNyB9XSwgMjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gISFlKCk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgcmV0dXJuICEwOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHt9XSwgMjQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgbyA9IGUoIi4vX2l0ZXItY2FsbCIpLAogICAgICAgICAgaSA9IGUoIi4vX2lzLWFycmF5LWl0ZXIiKSwKICAgICAgICAgIGMgPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIHMgPSBlKCIuL190by1sZW5ndGgiKSwKICAgICAgICAgIHUgPSBlKCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCIpLAogICAgICAgICAgYSA9IHt9LAogICAgICAgICAgZiA9IHt9LAogICAgICAgICAgciA9IHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBfLCBsKSB7CiAgICAgICAgdmFyIGQsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHksCiAgICAgICAgICAgIGggPSBsID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfSA6IHUoZSksCiAgICAgICAgICAgIGIgPSBuKHIsIF8sIHQgPyAyIDogMSksCiAgICAgICAgICAgIG0gPSAwO2lmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBoKSB0aHJvdyBUeXBlRXJyb3IoZSArICIgaXMgbm90IGl0ZXJhYmxlISIpO2lmIChpKGgpKSB7CiAgICAgICAgICBmb3IgKGQgPSBzKGUubGVuZ3RoKTsgZCA+IG07IG0rKykgewogICAgICAgICAgICBpZiAoeSA9IHQgPyBiKGMocCA9IGVbbV0pWzBdLCBwWzFdKSA6IGIoZVttXSksIHkgPT09IGEgfHwgeSA9PT0gZikgcmV0dXJuIHk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGZvciAodiA9IGguY2FsbChlKTsgIShwID0gdi5uZXh0KCkpLmRvbmU7KSB7CiAgICAgICAgICBpZiAoeSA9IG8odiwgYiwgcC52YWx1ZSwgdCksIHkgPT09IGEgfHwgeSA9PT0gZikgcmV0dXJuIHk7CiAgICAgICAgfQogICAgICB9O3IuQlJFQUsgPSBhLCByLlJFVFVSTiA9IGY7CiAgICB9LCB7ICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2N0eCI6IDE3LCAiLi9faXMtYXJyYXktaXRlciI6IDMyLCAiLi9faXRlci1jYWxsIjogMzQsICIuL190by1sZW5ndGgiOiA2NCwgIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIjogNjkgfV0sIDI1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB0LmV4cG9ydHMgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ICYmIHdpbmRvdy5NYXRoID09IE1hdGggPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGYgOiBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpOyJudW1iZXIiID09IHR5cGVvZiBfX2cgJiYgKF9fZyA9IG4pOwogICAgfSwge31dLCAyNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0ge30uaGFzT3duUHJvcGVydHk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbi5jYWxsKGUsIHQpOwogICAgICB9OwogICAgfSwge31dLCAyNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LWRwIiksCiAgICAgICAgICBvID0gZSgiLi9fcHJvcGVydHktZGVzYyIpO3QuZXhwb3J0cyA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLmYoZSwgdCwgbygxLCByKSk7CiAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBlW3RdID0gciwgZTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2Rlc2NyaXB0b3JzIjogMTksICIuL19vYmplY3QtZHAiOiA0MywgIi4vX3Byb3BlcnR5LWRlc2MiOiA1MCB9XSwgMjg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBlKCIuL19nbG9iYWwiKS5kb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSB9XSwgMjk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhZSgiLi9fZGVzY3JpcHRvcnMiKSAmJiAhZSgiLi9fZmFpbHMiKShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDcgIT0gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUoIi4vX2RvbS1jcmVhdGUiKSgiZGl2IiksICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pLmE7CiAgICAgIH0pOwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2RvbS1jcmVhdGUiOiAyMCwgIi4vX2ZhaWxzIjogMjMgfV0sIDMwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IHZvaWQgMCA9PT0gcjtzd2l0Y2ggKHQubGVuZ3RoKSB7Y2FzZSAwOgogICAgICAgICAgICByZXR1cm4gbiA/IGUoKSA6IGUuY2FsbChyKTtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdKSA6IGUuY2FsbChyLCB0WzBdKTtjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdKTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdKTtjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKTt9cmV0dXJuIGUuYXBwbHkociwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDMxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19jb2YiKTt0LmV4cG9ydHMgPSBPYmplY3QoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKSA/IE9iamVjdCA6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICJTdHJpbmciID09IG4oZSkgPyBlLnNwbGl0KCIiKSA6IE9iamVjdChlKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1IH1dLCAzMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXRlcmF0b3JzIiksCiAgICAgICAgICBvID0gZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBpID0gQXJyYXkucHJvdG90eXBlO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZSAmJiAobi5BcnJheSA9PT0gZSB8fCBpW29dID09PSBlKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjggfV0sIDMzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gKHR5cGVvZiBlID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihlKSkgPyBudWxsICE9PSBlIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBvKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBvID8gdChuKHIpWzBdLCByWzFdKSA6IHQocik7CiAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgdmFyIGMgPSBlWyJyZXR1cm4iXTt0aHJvdyB2b2lkIDAgIT09IGMgJiYgbihjLmNhbGwoZSkpLCBpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyIH1dLCAzNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtY3JlYXRlIiksCiAgICAgICAgICBvID0gZSgiLi9fcHJvcGVydHktZGVzYyIpLAogICAgICAgICAgaSA9IGUoIi4vX3NldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBjID0ge307ZSgiLi9faGlkZSIpKGMsIGUoIi4vX3drcyIpKCJpdGVyYXRvciIpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGUucHJvdG90eXBlID0gbihjLCB7IG5leHQ6IG8oMSwgcikgfSksIGkoZSwgdCArICIgSXRlcmF0b3IiKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2hpZGUiOiAyNywgIi4vX29iamVjdC1jcmVhdGUiOiA0MiwgIi4vX3Byb3BlcnR5LWRlc2MiOiA1MCwgIi4vX3NldC10by1zdHJpbmctdGFnIjogNTUsICIuL193a3MiOiA2OCB9XSwgMzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fbGlicmFyeSIpLAogICAgICAgICAgbyA9IGUoIi4vX2V4cG9ydCIpLAogICAgICAgICAgaSA9IGUoIi4vX3JlZGVmaW5lIiksCiAgICAgICAgICBjID0gZSgiLi9faGlkZSIpLAogICAgICAgICAgcyA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgdSA9IGUoIi4vX2l0ZXJhdG9ycyIpLAogICAgICAgICAgYSA9IGUoIi4vX2l0ZXItY3JlYXRlIiksCiAgICAgICAgICBmID0gZSgiLi9fc2V0LXRvLXN0cmluZy10YWciKSwKICAgICAgICAgIF8gPSBlKCIuL19vYmplY3QtZ3BvIiksCiAgICAgICAgICBsID0gZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBkID0gIShbXS5rZXlzICYmICJuZXh0IiBpbiBbXS5rZXlzKCkpLAogICAgICAgICAgcCA9ICJAQGl0ZXJhdG9yIiwKICAgICAgICAgIHYgPSAia2V5cyIsCiAgICAgICAgICB5ID0gInZhbHVlcyIsCiAgICAgICAgICBoID0gZnVuY3Rpb24gaCgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgYiwgbSwgZywgaikgewogICAgICAgIGEociwgdCwgYik7dmFyIHgsCiAgICAgICAgICAgIHcsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIE8gPSBmdW5jdGlvbiBPKGUpIHsKICAgICAgICAgIGlmICghZCAmJiBlIGluIEUpIHJldHVybiBFW2VdO3N3aXRjaCAoZSkge2Nhc2UgdjoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyByKHRoaXMsIGUpOwogICAgICAgICAgICAgIH07Y2FzZSB5OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTt9cmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyByKHRoaXMsIGUpOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgICAgICBNID0gdCArICIgSXRlcmF0b3IiLAogICAgICAgICAgICBQID0gbSA9PSB5LAogICAgICAgICAgICBTID0gITEsCiAgICAgICAgICAgIEUgPSBlLnByb3RvdHlwZSwKICAgICAgICAgICAgVCA9IEVbbF0gfHwgRVtwXSB8fCBtICYmIEVbbV0sCiAgICAgICAgICAgIEEgPSBUIHx8IE8obSksCiAgICAgICAgICAgIFUgPSBtID8gUCA/IE8oImVudHJpZXMiKSA6IEEgOiB2b2lkIDAsCiAgICAgICAgICAgIEMgPSAiQXJyYXkiID09IHQgPyBFLmVudHJpZXMgfHwgVCA6IFQ7aWYgKEMgJiYgKGsgPSBfKEMuY2FsbChuZXcgZSgpKSksIGsgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgKGYoaywgTSwgITApLCBuIHx8IHMoaywgbCkgfHwgYyhrLCBsLCBoKSkpLCBQICYmIFQgJiYgVC5uYW1lICE9PSB5ICYmIChTID0gITAsIEEgPSBmdW5jdGlvbiBBKCkgewogICAgICAgICAgcmV0dXJuIFQuY2FsbCh0aGlzKTsKICAgICAgICB9KSwgbiAmJiAhaiB8fCAhZCAmJiAhUyAmJiBFW2xdIHx8IGMoRSwgbCwgQSksIHVbdF0gPSBBLCB1W01dID0gaCwgbSkgaWYgKHggPSB7IHZhbHVlczogUCA/IEEgOiBPKHkpLCBrZXlzOiBnID8gQSA6IE8odiksIGVudHJpZXM6IFUgfSwgaikgZm9yICh3IGluIHgpIHsKICAgICAgICAgIHcgaW4gRSB8fCBpKEUsIHcsIHhbd10pOwogICAgICAgIH0gZWxzZSBvKG8uUCArIG8uRiAqIChkIHx8IFMpLCB0LCB4KTtyZXR1cm4geDsKICAgICAgfTsKICAgIH0sIHsgIi4vX2V4cG9ydCI6IDIyLCAiLi9faGFzIjogMjYsICIuL19oaWRlIjogMjcsICIuL19pdGVyLWNyZWF0ZSI6IDM1LCAiLi9faXRlcmF0b3JzIjogMzksICIuL19saWJyYXJ5IjogNDAsICIuL19vYmplY3QtZ3BvIjogNDYsICIuL19yZWRlZmluZSI6IDUyLCAiLi9fc2V0LXRvLXN0cmluZy10YWciOiA1NSwgIi4vX3drcyI6IDY4IH1dLCAzNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBvID0gITE7dHJ5IHsKICAgICAgICB2YXIgaSA9IFs3XVtuXSgpO2lbInJldHVybiJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbyA9ICEwOwogICAgICAgIH0sIEFycmF5LmZyb20oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhyb3cgMjsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoYykge310LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICghdCAmJiAhbykgcmV0dXJuICExO3ZhciByID0gITE7dHJ5IHsKICAgICAgICAgIHZhciBpID0gWzddLAogICAgICAgICAgICAgIGMgPSBpW25dKCk7Yy5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4geyBkb25lOiByID0gITAgfTsKICAgICAgICAgIH0sIGlbbl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBjOwogICAgICAgICAgfSwgZShpKTsKICAgICAgICB9IGNhdGNoIChzKSB7fXJldHVybiByOwogICAgICB9OwogICAgfSwgeyAiLi9fd2tzIjogNjggfV0sIDM4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4geyB2YWx1ZTogdCwgZG9uZTogISFlIH07CiAgICAgIH07CiAgICB9LCB7fV0sIDM5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0ge307CiAgICB9LCB7fV0sIDQwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gITA7CiAgICB9LCB7fV0sIDQxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIG8gPSBlKCIuL190YXNrIikuc2V0LAogICAgICAgICAgaSA9IG4uTXV0YXRpb25PYnNlcnZlciB8fCBuLldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsCiAgICAgICAgICBjID0gbi5wcm9jZXNzLAogICAgICAgICAgcyA9IG4uUHJvbWlzZSwKICAgICAgICAgIHUgPSAicHJvY2VzcyIgPT0gZSgiLi9fY29mIikoYyk7dC5leHBvcnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0LAogICAgICAgICAgICByLAogICAgICAgICAgICBhID0gZnVuY3Rpb24gYSgpIHsKICAgICAgICAgIHZhciBuLCBvO2ZvciAodSAmJiAobiA9IGMuZG9tYWluKSAmJiBuLmV4aXQoKTsgZTspIHsKICAgICAgICAgICAgbyA9IGUuZm4sIGUgPSBlLm5leHQ7dHJ5IHsKICAgICAgICAgICAgICBvKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgICB0aHJvdyBlID8gcigpIDogdCA9IHZvaWQgMCwgaTsKICAgICAgICAgICAgfQogICAgICAgICAgfXQgPSB2b2lkIDAsIG4gJiYgbi5lbnRlcigpOwogICAgICAgIH07aWYgKHUpIHIgPSBmdW5jdGlvbiByKCkgewogICAgICAgICAgYy5uZXh0VGljayhhKTsKICAgICAgICB9O2Vsc2UgaWYgKGkpIHsKICAgICAgICAgIHZhciBmID0gITAsCiAgICAgICAgICAgICAgXyA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKTtuZXcgaShhKS5vYnNlcnZlKF8sIHsgY2hhcmFjdGVyRGF0YTogITAgfSksIHIgPSBmdW5jdGlvbiByKCkgewogICAgICAgICAgICBfLmRhdGEgPSBmID0gIWY7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAocyAmJiBzLnJlc29sdmUpIHsKICAgICAgICAgIHZhciBsID0gcy5yZXNvbHZlKCk7ciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIGwudGhlbihhKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHIgPSBmdW5jdGlvbiByKCkgewogICAgICAgICAgby5jYWxsKG4sIGEpOwogICAgICAgIH07cmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB2YXIgbyA9IHsgZm46IG4sIG5leHQ6IHZvaWQgMCB9O3QgJiYgKHQubmV4dCA9IG8pLCBlIHx8IChlID0gbywgcigpKSwgdCA9IG87CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fZ2xvYmFsIjogMjUsICIuL190YXNrIjogNjAgfV0sIDQyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL19vYmplY3QtZHBzIiksCiAgICAgICAgICBpID0gZSgiLi9fZW51bS1idWcta2V5cyIpLAogICAgICAgICAgYyA9IGUoIi4vX3NoYXJlZC1rZXkiKSgiSUVfUFJPVE8iKSwKICAgICAgICAgIHMgPSBmdW5jdGlvbiBzKCkge30sCiAgICAgICAgICB1ID0gInByb3RvdHlwZSIsCiAgICAgICAgICBfYSA9IGZ1bmN0aW9uIGEoKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIHIgPSBlKCIuL19kb20tY3JlYXRlIikoImlmcmFtZSIpLAogICAgICAgICAgICBuID0gaS5sZW5ndGgsCiAgICAgICAgICAgIG8gPSAiPiI7Zm9yIChyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIsIGUoIi4vX2h0bWwiKS5hcHBlbmRDaGlsZChyKSwgci5zcmMgPSAiamF2YXNjcmlwdDoiLCB0ID0gci5jb250ZW50V2luZG93LmRvY3VtZW50LCB0Lm9wZW4oKSwgdC53cml0ZSgiPHNjcmlwdD5kb2N1bWVudC5GPU9iamVjdDwvc2NyaXB0IiArIG8pLCB0LmNsb3NlKCksIF9hID0gdC5GOyBuLS07KSB7CiAgICAgICAgICBkZWxldGUgX2FbdV1baVtuXV07CiAgICAgICAgfXJldHVybiBfYSgpOwogICAgICB9O3QuZXhwb3J0cyA9IE9iamVjdC5jcmVhdGUgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgcjtyZXR1cm4gbnVsbCAhPT0gZSA/IChzW3VdID0gbihlKSwgciA9IG5ldyBzKCksIHNbdV0gPSBudWxsLCByW2NdID0gZSkgOiByID0gX2EoKSwgdm9pZCAwID09PSB0ID8gciA6IG8ociwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2RvbS1jcmVhdGUiOiAyMCwgIi4vX2VudW0tYnVnLWtleXMiOiAyMSwgIi4vX2h0bWwiOiAyOCwgIi4vX29iamVjdC1kcHMiOiA0NCwgIi4vX3NoYXJlZC1rZXkiOiA1NiB9XSwgNDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2llOC1kb20tZGVmaW5lIiksCiAgICAgICAgICBpID0gZSgiLi9fdG8tcHJpbWl0aXZlIiksCiAgICAgICAgICBjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O3IuZiA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGlmIChuKGUpLCB0ID0gaSh0LCAhMCksIG4ociksIG8pIHRyeSB7CiAgICAgICAgICByZXR1cm4gYyhlLCB0LCByKTsKICAgICAgICB9IGNhdGNoIChzKSB7fWlmICgiZ2V0IiBpbiByIHx8ICJzZXQiIGluIHIpIHRocm93IFR5cGVFcnJvcigiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQhIik7cmV0dXJuICJ2YWx1ZSIgaW4gciAmJiAoZVt0XSA9IHIudmFsdWUpLCBlOwogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9faWU4LWRvbS1kZWZpbmUiOiAyOSwgIi4vX3RvLXByaW1pdGl2ZSI6IDY2IH1dLCA0NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LWRwIiksCiAgICAgICAgICBvID0gZSgiLi9fYW4tb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi9fb2JqZWN0LWtleXMiKTt0LmV4cG9ydHMgPSBlKCIuL19kZXNjcmlwdG9ycyIpID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIG8oZSk7Zm9yICh2YXIgciwgYyA9IGkodCksIHMgPSBjLmxlbmd0aCwgdSA9IDA7IHMgPiB1OykgewogICAgICAgICAgbi5mKGUsIHIgPSBjW3UrK10sIHRbcl0pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fb2JqZWN0LWtleXMiOiA0OCB9XSwgNDU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1waWUiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi9fdG8taW9iamVjdCIpLAogICAgICAgICAgYyA9IGUoIi4vX3RvLXByaW1pdGl2ZSIpLAogICAgICAgICAgcyA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgdSA9IGUoIi4vX2llOC1kb20tZGVmaW5lIiksCiAgICAgICAgICBhID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjtyLmYgPSBlKCIuL19kZXNjcmlwdG9ycyIpID8gYSA6IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKGUgPSBpKGUpLCB0ID0gYyh0LCAhMCksIHUpIHRyeSB7CiAgICAgICAgICByZXR1cm4gYShlLCB0KTsKICAgICAgICB9IGNhdGNoIChyKSB7fXJldHVybiBzKGUsIHQpID8gbyghbi5mLmNhbGwoZSwgdCksIGVbdF0pIDogdm9pZCAwOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2hhcyI6IDI2LCAiLi9faWU4LWRvbS1kZWZpbmUiOiAyOSwgIi4vX29iamVjdC1waWUiOiA0OSwgIi4vX3Byb3BlcnR5LWRlc2MiOiA1MCwgIi4vX3RvLWlvYmplY3QiOiA2MywgIi4vX3RvLXByaW1pdGl2ZSI6IDY2IH1dLCA0NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faGFzIiksCiAgICAgICAgICBvID0gZSgiLi9fdG8tb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi9fc2hhcmVkLWtleSIpKCJJRV9QUk9UTyIpLAogICAgICAgICAgYyA9IE9iamVjdC5wcm90b3R5cGU7dC5leHBvcnRzID0gT2JqZWN0LmdldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgPSBvKGUpLCBuKGUsIGkpID8gZVtpXSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUuY29uc3RydWN0b3IgJiYgZSBpbnN0YW5jZW9mIGUuY29uc3RydWN0b3IgPyBlLmNvbnN0cnVjdG9yLnByb3RvdHlwZSA6IGUgaW5zdGFuY2VvZiBPYmplY3QgPyBjIDogbnVsbDsKICAgICAgfTsKICAgIH0sIHsgIi4vX2hhcyI6IDI2LCAiLi9fc2hhcmVkLWtleSI6IDU2LCAiLi9fdG8tb2JqZWN0IjogNjUgfV0sIDQ3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19oYXMiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1pb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi9fYXJyYXktaW5jbHVkZXMiKSghMSksCiAgICAgICAgICBjID0gZSgiLi9fc2hhcmVkLWtleSIpKCJJRV9QUk9UTyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIHMgPSBvKGUpLAogICAgICAgICAgICB1ID0gMCwKICAgICAgICAgICAgYSA9IFtdO2ZvciAociBpbiBzKSB7CiAgICAgICAgICByICE9IGMgJiYgbihzLCByKSAmJiBhLnB1c2gocik7CiAgICAgICAgfWZvciAoOyB0Lmxlbmd0aCA+IHU7KSB7CiAgICAgICAgICBuKHMsIHIgPSB0W3UrK10pICYmICh+aShhLCByKSB8fCBhLnB1c2gocikpOwogICAgICAgIH1yZXR1cm4gYTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2FycmF5LWluY2x1ZGVzIjogMTMsICIuL19oYXMiOiAyNiwgIi4vX3NoYXJlZC1rZXkiOiA1NiwgIi4vX3RvLWlvYmplY3QiOiA2MyB9XSwgNDg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1rZXlzLWludGVybmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fZW51bS1idWcta2V5cyIpO3QuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG4oZSwgbyk7CiAgICAgIH07CiAgICB9LCB7ICIuL19lbnVtLWJ1Zy1rZXlzIjogMjEsICIuL19vYmplY3Qta2V5cy1pbnRlcm5hbCI6IDQ3IH1dLCA0OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHIuZiA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgfSwge31dLCA1MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZSksIGNvbmZpZ3VyYWJsZTogISgyICYgZSksIHdyaXRhYmxlOiAhKDQgJiBlKSwgdmFsdWU6IHQgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2hpZGUiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGZvciAodmFyIG8gaW4gdCkgewogICAgICAgICAgciAmJiBlW29dID8gZVtvXSA9IHRbb10gOiBuKGUsIG8sIHRbb10pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2hpZGUiOiAyNyB9XSwgNTI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBlKCIuL19oaWRlIik7CiAgICB9LCB7ICIuL19oaWRlIjogMjcgfV0sIDUzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pcy1vYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIGkgPSBmdW5jdGlvbiBpKGUsIHQpIHsKICAgICAgICBpZiAobyhlKSwgIW4odCkgJiYgbnVsbCAhPT0gdCkgdGhyb3cgVHlwZUVycm9yKHQgKyAiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlISIpOwogICAgICB9O3QuZXhwb3J0cyA9IHsgc2V0OiBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgKCJfX3Byb3RvX18iIGluIHt9ID8gZnVuY3Rpb24gKHQsIHIsIG4pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG4gPSBlKCIuL19jdHgiKShGdW5jdGlvbi5jYWxsLCBlKCIuL19vYmplY3QtZ29wZCIpLmYoT2JqZWN0LnByb3RvdHlwZSwgIl9fcHJvdG9fXyIpLnNldCwgMiksIG4odCwgW10pLCByID0gISh0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgICAgICAgfSBjYXRjaCAobykgewogICAgICAgICAgICByID0gITA7CiAgICAgICAgICB9cmV0dXJuIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiBpKGUsIHQpLCByID8gZS5fX3Byb3RvX18gPSB0IDogbihlLCB0KSwgZTsKICAgICAgICAgIH07CiAgICAgICAgfSh7fSwgITEpIDogdm9pZCAwKSwgY2hlY2s6IGkgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fY3R4IjogMTcsICIuL19pcy1vYmplY3QiOiAzMywgIi4vX29iamVjdC1nb3BkIjogNDUgfV0sIDU0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vX2NvcmUiKSwKICAgICAgICAgIGkgPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIGMgPSBlKCIuL19kZXNjcmlwdG9ycyIpLAogICAgICAgICAgcyA9IGUoIi4vX3drcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG9bZV0gPyBvW2VdIDogbltlXTtjICYmIHQgJiYgIXRbc10gJiYgaS5mKHQsIHMsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSB9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvcmUiOiAxNiwgIi4vX2Rlc2NyaXB0b3JzIjogMTksICIuL19nbG9iYWwiOiAyNSwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fd2tzIjogNjggfV0sIDU1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKS5mLAogICAgICAgICAgbyA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgaSA9IGUoIi4vX3drcyIpKCJ0b1N0cmluZ1RhZyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZSAmJiAhbyhlID0gciA/IGUgOiBlLnByb3RvdHlwZSwgaSkgJiYgbihlLCBpLCB7IGNvbmZpZ3VyYWJsZTogITAsIHZhbHVlOiB0IH0pOwogICAgICB9OwogICAgfSwgeyAiLi9faGFzIjogMjYsICIuL19vYmplY3QtZHAiOiA0MywgIi4vX3drcyI6IDY4IH1dLCA1NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fc2hhcmVkIikoImtleXMiKSwKICAgICAgICAgIG8gPSBlKCIuL191aWQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuW2VdIHx8IChuW2VdID0gbyhlKSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19zaGFyZWQiOiA1NywgIi4vX3VpZCI6IDY3IH1dLCA1NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gIl9fY29yZS1qc19zaGFyZWRfXyIsCiAgICAgICAgICBpID0gbltvXSB8fCAobltvXSA9IHt9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpW2VdIHx8IChpW2VdID0ge30pOwogICAgICB9OwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUgfV0sIDU4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL19hLWZ1bmN0aW9uIiksCiAgICAgICAgICBpID0gZSgiLi9fd2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciByLAogICAgICAgICAgICBjID0gbihlKS5jb25zdHJ1Y3RvcjtyZXR1cm4gdm9pZCAwID09PSBjIHx8IHZvaWQgMCA9PSAociA9IG4oYylbaV0pID8gdCA6IG8ocik7CiAgICAgIH07CiAgICB9LCB7ICIuL19hLWZ1bmN0aW9uIjogOSwgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fd2tzIjogNjggfV0sIDU5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL190by1pbnRlZ2VyIiksCiAgICAgICAgICBvID0gZSgiLi9fZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIHMgPSBTdHJpbmcobyh0KSksCiAgICAgICAgICAgICAgdSA9IG4ociksCiAgICAgICAgICAgICAgYSA9IHMubGVuZ3RoO3JldHVybiAwID4gdSB8fCB1ID49IGEgPyBlID8gIiIgOiB2b2lkIDAgOiAoaSA9IHMuY2hhckNvZGVBdCh1KSwgNTUyOTYgPiBpIHx8IGkgPiA1NjMxOSB8fCB1ICsgMSA9PT0gYSB8fCAoYyA9IHMuY2hhckNvZGVBdCh1ICsgMSkpIDwgNTYzMjAgfHwgYyA+IDU3MzQzID8gZSA/IHMuY2hhckF0KHUpIDogaSA6IGUgPyBzLnNsaWNlKHUsIHUgKyAyKSA6IChpIC0gNTUyOTYgPDwgMTApICsgKGMgLSA1NjMyMCkgKyA2NTUzNik7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2RlZmluZWQiOiAxOCwgIi4vX3RvLWludGVnZXIiOiA2MiB9XSwgNjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYyA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgcyA9IGUoIi4vX2ludm9rZSIpLAogICAgICAgICAgdSA9IGUoIi4vX2h0bWwiKSwKICAgICAgICAgIGEgPSBlKCIuL19kb20tY3JlYXRlIiksCiAgICAgICAgICBmID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBfID0gZi5wcm9jZXNzLAogICAgICAgICAgbCA9IGYuc2V0SW1tZWRpYXRlLAogICAgICAgICAgZCA9IGYuY2xlYXJJbW1lZGlhdGUsCiAgICAgICAgICBwID0gZi5NZXNzYWdlQ2hhbm5lbCwKICAgICAgICAgIHYgPSAwLAogICAgICAgICAgeSA9IHt9LAogICAgICAgICAgaCA9ICJvbnJlYWR5c3RhdGVjaGFuZ2UiLAogICAgICAgICAgYiA9IGZ1bmN0aW9uIGIoKSB7CiAgICAgICAgdmFyIGUgPSArdGhpcztpZiAoeS5oYXNPd25Qcm9wZXJ0eShlKSkgewogICAgICAgICAgdmFyIHQgPSB5W2VdO2RlbGV0ZSB5W2VdLCB0KCk7CiAgICAgICAgfQogICAgICB9LAogICAgICAgICAgbSA9IGZ1bmN0aW9uIG0oZSkgewogICAgICAgIGIuY2FsbChlLmRhdGEpOwogICAgICB9O2wgJiYgZCB8fCAobCA9IGZ1bmN0aW9uIGwoZSkgewogICAgICAgIGZvciAodmFyIHQgPSBbXSwgciA9IDE7IGFyZ3VtZW50cy5sZW5ndGggPiByOykgewogICAgICAgICAgdC5wdXNoKGFyZ3VtZW50c1tyKytdKTsKICAgICAgICB9cmV0dXJuIHlbKyt2XSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IGUgOiBGdW5jdGlvbihlKSwgdCk7CiAgICAgICAgfSwgbih2KSwgdjsKICAgICAgfSwgZCA9IGZ1bmN0aW9uIGQoZSkgewogICAgICAgIGRlbGV0ZSB5W2VdOwogICAgICB9LCAicHJvY2VzcyIgPT0gZSgiLi9fY29mIikoXykgPyBuID0gZnVuY3Rpb24gbihlKSB7CiAgICAgICAgXy5uZXh0VGljayhjKGIsIGUsIDEpKTsKICAgICAgfSA6IHAgPyAobyA9IG5ldyBwKCksIGkgPSBvLnBvcnQyLCBvLnBvcnQxLm9ubWVzc2FnZSA9IG0sIG4gPSBjKGkucG9zdE1lc3NhZ2UsIGksIDEpKSA6IGYuYWRkRXZlbnRMaXN0ZW5lciAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBwb3N0TWVzc2FnZSAmJiAhZi5pbXBvcnRTY3JpcHRzID8gKG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBmLnBvc3RNZXNzYWdlKGUgKyAiIiwgIioiKTsKICAgICAgfSwgZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgbSwgITEpKSA6IG4gPSBoIGluIGEoInNjcmlwdCIpID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICB1LmFwcGVuZENoaWxkKGEoInNjcmlwdCIpKVtoXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHUucmVtb3ZlQ2hpbGQodGhpcyksIGIuY2FsbChlKTsKICAgICAgICB9OwogICAgICB9IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICBzZXRUaW1lb3V0KGMoYiwgZSwgMSksIDApOwogICAgICB9KSwgdC5leHBvcnRzID0geyBzZXQ6IGwsIGNsZWFyOiBkIH07CiAgICB9LCB7ICIuL19jb2YiOiAxNSwgIi4vX2N0eCI6IDE3LCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZ2xvYmFsIjogMjUsICIuL19odG1sIjogMjgsICIuL19pbnZva2UiOiAzMCB9XSwgNjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBNYXRoLm1heCwKICAgICAgICAgIGkgPSBNYXRoLm1pbjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBlID0gbihlKSwgMCA+IGUgPyBvKGUgKyB0LCAwKSA6IGkoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbnRlZ2VyIjogNjIgfV0sIDYyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBNYXRoLmNlaWwsCiAgICAgICAgICBvID0gTWF0aC5mbG9vcjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpc05hTihlID0gK2UpID8gMCA6IChlID4gMCA/IG8gOiBuKShlKTsKICAgICAgfTsKICAgIH0sIHt9XSwgNjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2RlZmluZWQiOiAxOCwgIi4vX2lvYmplY3QiOiAzMSB9XSwgNjQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBNYXRoLm1pbjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlID4gMCA/IG8obihlKSwgOTAwNzE5OTI1NDc0MDk5MSkgOiAwOwogICAgICB9OwogICAgfSwgeyAiLi9fdG8taW50ZWdlciI6IDYyIH1dLCA2NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdChuKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2RlZmluZWQiOiAxOCB9XSwgNjY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lzLW9iamVjdCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCFuKGUpKSByZXR1cm4gZTt2YXIgciwgbztpZiAodCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudG9TdHJpbmcpICYmICFuKG8gPSByLmNhbGwoZSkpKSByZXR1cm4gbztpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHIgPSBlLnZhbHVlT2YpICYmICFuKG8gPSByLmNhbGwoZSkpKSByZXR1cm4gbztpZiAoIXQgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHIgPSBlLnRvU3RyaW5nKSAmJiAhbihvID0gci5jYWxsKGUpKSkgcmV0dXJuIG87dGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2lzLW9iamVjdCI6IDMzIH1dLCA2NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gMCwKICAgICAgICAgIG8gPSBNYXRoLnJhbmRvbSgpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICJTeW1ib2woIi5jb25jYXQodm9pZCAwID09PSBlID8gIiIgOiBlLCAiKV8iLCAoKytuICsgbykudG9TdHJpbmcoMzYpKTsKICAgICAgfTsKICAgIH0sIHt9XSwgNjg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3NoYXJlZCIpKCJ3a3MiKSwKICAgICAgICAgIG8gPSBlKCIuL191aWQiKSwKICAgICAgICAgIGkgPSBlKCIuL19nbG9iYWwiKS5TeW1ib2wsCiAgICAgICAgICBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgaSwKICAgICAgICAgIHMgPSB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuW2VdIHx8IChuW2VdID0gYyAmJiBpW2VdIHx8IChjID8gaSA6IG8pKCJTeW1ib2wuIiArIGUpKTsKICAgICAgfTtzLnN0b3JlID0gbjsKICAgIH0sIHsgIi4vX2dsb2JhbCI6IDI1LCAiLi9fc2hhcmVkIjogNTcsICIuL191aWQiOiA2NyB9XSwgNjk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2NsYXNzb2YiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGkgPSBlKCIuL19pdGVyYXRvcnMiKTt0LmV4cG9ydHMgPSBlKCIuL19jb3JlIikuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT0gZSA/IGVbb10gfHwgZVsiQEBpdGVyYXRvciJdIHx8IGlbbihlKV0gOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuL19jbGFzc29mIjogMTQsICIuL19jb3JlIjogMTYsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX3drcyI6IDY4IH1dLCA3MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuL19hZGQtdG8tdW5zY29wYWJsZXMiKSwKICAgICAgICAgIG8gPSBlKCIuL19pdGVyLXN0ZXAiKSwKICAgICAgICAgIGkgPSBlKCIuL19pdGVyYXRvcnMiKSwKICAgICAgICAgIGMgPSBlKCIuL190by1pb2JqZWN0Iik7dC5leHBvcnRzID0gZSgiLi9faXRlci1kZWZpbmUiKShBcnJheSwgIkFycmF5IiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0aGlzLl90ID0gYyhlKSwgdGhpcy5faSA9IDAsIHRoaXMuX2sgPSB0OwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl90LAogICAgICAgICAgICB0ID0gdGhpcy5faywKICAgICAgICAgICAgciA9IHRoaXMuX2krKztyZXR1cm4gIWUgfHwgciA+PSBlLmxlbmd0aCA/ICh0aGlzLl90ID0gdm9pZCAwLCBvKDEpKSA6ICJrZXlzIiA9PSB0ID8gbygwLCByKSA6ICJ2YWx1ZXMiID09IHQgPyBvKDAsIGVbcl0pIDogbygwLCBbciwgZVtyXV0pOwogICAgICB9LCAidmFsdWVzIiksIGkuQXJndW1lbnRzID0gaS5BcnJheSwgbigia2V5cyIpLCBuKCJ2YWx1ZXMiKSwgbigiZW50cmllcyIpOwogICAgfSwgeyAiLi9fYWRkLXRvLXVuc2NvcGFibGVzIjogMTAsICIuL19pdGVyLWRlZmluZSI6IDM2LCAiLi9faXRlci1zdGVwIjogMzgsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX3RvLWlvYmplY3QiOiA2MyB9XSwgNzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2V4cG9ydCIpO24obi5TICsgbi5GICogIWUoIi4vX2Rlc2NyaXB0b3JzIiksICJPYmplY3QiLCB7IGRlZmluZVByb3BlcnR5OiBlKCIuL19vYmplY3QtZHAiKS5mIH0pOwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2V4cG9ydCI6IDIyLCAiLi9fb2JqZWN0LWRwIjogNDMgfV0sIDcyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHt9LCB7fV0sIDczOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYyA9IGUoIi4vX2xpYnJhcnkiKSwKICAgICAgICAgIHMgPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIHUgPSBlKCIuL19jdHgiKSwKICAgICAgICAgIGEgPSBlKCIuL19jbGFzc29mIiksCiAgICAgICAgICBmID0gZSgiLi9fZXhwb3J0IiksCiAgICAgICAgICBfID0gZSgiLi9faXMtb2JqZWN0IiksCiAgICAgICAgICBsID0gKGUoIi4vX2FuLW9iamVjdCIpLCBlKCIuL19hLWZ1bmN0aW9uIikpLAogICAgICAgICAgZCA9IGUoIi4vX2FuLWluc3RhbmNlIiksCiAgICAgICAgICBwID0gZSgiLi9fZm9yLW9mIiksCiAgICAgICAgICB2ID0gKGUoIi4vX3NldC1wcm90byIpLnNldCwgZSgiLi9fc3BlY2llcy1jb25zdHJ1Y3RvciIpKSwKICAgICAgICAgIHkgPSBlKCIuL190YXNrIikuc2V0LAogICAgICAgICAgaCA9IGUoIi4vX21pY3JvdGFzayIpKCksCiAgICAgICAgICBiID0gIlByb21pc2UiLAogICAgICAgICAgbSA9IHMuVHlwZUVycm9yLAogICAgICAgICAgZyA9IHMucHJvY2VzcywKICAgICAgICAgIF9qID0gc1tiXSwKICAgICAgICAgIGcgPSBzLnByb2Nlc3MsCiAgICAgICAgICB4ID0gInByb2Nlc3MiID09IGEoZyksCiAgICAgICAgICB3ID0gZnVuY3Rpb24gdygpIHt9LAogICAgICAgICAgayA9ICEhZnVuY3Rpb24gKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgdCA9IF9qLnJlc29sdmUoMSksCiAgICAgICAgICAgICAgciA9ICh0LmNvbnN0cnVjdG9yID0ge30pW2UoIi4vX3drcyIpKCJzcGVjaWVzIildID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgZSh3LCB3KTsKICAgICAgICAgIH07cmV0dXJuICh4IHx8ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFByb21pc2VSZWplY3Rpb25FdmVudCkgJiYgdC50aGVuKHcpIGluc3RhbmNlb2YgcjsKICAgICAgICB9IGNhdGNoIChuKSB7fQogICAgICB9KCksCiAgICAgICAgICBPID0gZnVuY3Rpb24gTyhlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgPT09IHQgfHwgZSA9PT0gX2ogJiYgdCA9PT0gaTsKICAgICAgfSwKICAgICAgICAgIE0gPSBmdW5jdGlvbiBNKGUpIHsKICAgICAgICB2YXIgdDtyZXR1cm4gXyhlKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAodCA9IGUudGhlbikgPyB0IDogITE7CiAgICAgIH0sCiAgICAgICAgICBQID0gZnVuY3Rpb24gUChlKSB7CiAgICAgICAgcmV0dXJuIE8oX2osIGUpID8gbmV3IFMoZSkgOiBuZXcgbyhlKTsKICAgICAgfSwKICAgICAgICAgIFMgPSBvID0gZnVuY3Rpb24gbyhlKSB7CiAgICAgICAgdmFyIHQsIHI7dGhpcy5wcm9taXNlID0gbmV3IGUoZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICAgIGlmICh2b2lkIDAgIT09IHQgfHwgdm9pZCAwICE9PSByKSB0aHJvdyBtKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO3QgPSBlLCByID0gbjsKICAgICAgICB9KSwgdGhpcy5yZXNvbHZlID0gbCh0KSwgdGhpcy5yZWplY3QgPSBsKHIpOwogICAgICB9LAogICAgICAgICAgRSA9IGZ1bmN0aW9uIEUoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBlKCk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHQgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBUID0gZnVuY3Rpb24gVChlLCB0KSB7CiAgICAgICAgaWYgKCFlLl9uKSB7CiAgICAgICAgICBlLl9uID0gITA7dmFyIHIgPSBlLl9jO2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0gZS5fdiwgbyA9IDEgPT0gZS5fcywgaSA9IDAsIGMgPSBmdW5jdGlvbiBjKHQpIHsKICAgICAgICAgICAgICB2YXIgciwKICAgICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgICAgYyA9IG8gPyB0Lm9rIDogdC5mYWlsLAogICAgICAgICAgICAgICAgICBzID0gdC5yZXNvbHZlLAogICAgICAgICAgICAgICAgICB1ID0gdC5yZWplY3QsCiAgICAgICAgICAgICAgICAgIGEgPSB0LmRvbWFpbjt0cnkgewogICAgICAgICAgICAgICAgYyA/IChvIHx8ICgyID09IGUuX2ggJiYgQyhlKSwgZS5faCA9IDEpLCBjID09PSAhMCA/IHIgPSBuIDogKGEgJiYgYS5lbnRlcigpLCByID0gYyhuKSwgYSAmJiBhLmV4aXQoKSksIHIgPT09IHQucHJvbWlzZSA/IHUobSgiUHJvbWlzZS1jaGFpbiBjeWNsZSIpKSA6IChpID0gTShyKSkgPyBpLmNhbGwociwgcywgdSkgOiBzKHIpKSA6IHUobik7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZikgewogICAgICAgICAgICAgICAgdShmKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07IHIubGVuZ3RoID4gaTspIHsKICAgICAgICAgICAgICBjKHJbaSsrXSk7CiAgICAgICAgICAgIH1lLl9jID0gW10sIGUuX24gPSAhMSwgdCAmJiAhZS5faCAmJiBBKGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICAgICAgQSA9IGZ1bmN0aW9uIEEoZSkgewogICAgICAgIHkuY2FsbChzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCwKICAgICAgICAgICAgICByLAogICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgbyA9IGUuX3Y7aWYgKFUoZSkgJiYgKHQgPSBFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgeCA/IGcuZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIiwgbywgZSkgOiAociA9IHMub251bmhhbmRsZWRyZWplY3Rpb24pID8gcih7IHByb21pc2U6IGUsIHJlYXNvbjogbyB9KSA6IChuID0gcy5jb25zb2xlKSAmJiBuLmVycm9yICYmIG4uZXJyb3IoIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsIG8pOwogICAgICAgICAgfSksIGUuX2ggPSB4IHx8IFUoZSkgPyAyIDogMSksIGUuX2EgPSB2b2lkIDAsIHQpIHRocm93IHQuZXJyb3I7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICAgICBVID0gZnVuY3Rpb24gVShlKSB7CiAgICAgICAgaWYgKDEgPT0gZS5faCkgcmV0dXJuICExO2ZvciAodmFyIHQsIHIgPSBlLl9hIHx8IGUuX2MsIG4gPSAwOyByLmxlbmd0aCA+IG47KSB7CiAgICAgICAgICBpZiAodCA9IHJbbisrXSwgdC5mYWlsIHx8ICFVKHQucHJvbWlzZSkpIHJldHVybiAhMTsKICAgICAgICB9cmV0dXJuICEwOwogICAgICB9LAogICAgICAgICAgQyA9IGZ1bmN0aW9uIEMoZSkgewogICAgICAgIHkuY2FsbChzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdDt4ID8gZy5lbWl0KCJyZWplY3Rpb25IYW5kbGVkIiwgZSkgOiAodCA9IHMub25yZWplY3Rpb25oYW5kbGVkKSAmJiB0KHsgcHJvbWlzZTogZSwgcmVhc29uOiBlLl92IH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICAgICAgUiA9IGZ1bmN0aW9uIFIoZSkgewogICAgICAgIHZhciB0ID0gdGhpczt0Ll9kIHx8ICh0Ll9kID0gITAsIHQgPSB0Ll93IHx8IHQsIHQuX3YgPSBlLCB0Ll9zID0gMiwgdC5fYSB8fCAodC5fYSA9IHQuX2Muc2xpY2UoKSksIFQodCwgITApKTsKICAgICAgfSwKICAgICAgICAgIEwgPSBmdW5jdGlvbiBMKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IHRoaXM7aWYgKCFyLl9kKSB7CiAgICAgICAgICByLl9kID0gITAsIHIgPSByLl93IHx8IHI7dHJ5IHsKICAgICAgICAgICAgaWYgKHIgPT09IGUpIHRocm93IG0oIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7KHQgPSBNKGUpKSA/IGgoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBuID0geyBfdzogciwgX2Q6ICExIH07dHJ5IHsKICAgICAgICAgICAgICAgIHQuY2FsbChlLCB1KEwsIG4sIDEpLCB1KFIsIG4sIDEpKTsKICAgICAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgICAgICBSLmNhbGwobiwgbyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSA6IChyLl92ID0gZSwgci5fcyA9IDEsIFQociwgITEpKTsKICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgUi5jYWxsKHsgX3c6IHIsIF9kOiAhMSB9LCBuKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07ayB8fCAoX2ogPSBmdW5jdGlvbiBqKGUpIHsKICAgICAgICBkKHRoaXMsIF9qLCBiLCAiX2giKSwgbChlKSwgbi5jYWxsKHRoaXMpO3RyeSB7CiAgICAgICAgICBlKHUoTCwgdGhpcywgMSksIHUoUiwgdGhpcywgMSkpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIFIuY2FsbCh0aGlzLCB0KTsKICAgICAgICB9CiAgICAgIH0sIG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICB0aGlzLl9jID0gW10sIHRoaXMuX2EgPSB2b2lkIDAsIHRoaXMuX3MgPSAwLCB0aGlzLl9kID0gITEsIHRoaXMuX3YgPSB2b2lkIDAsIHRoaXMuX2ggPSAwLCB0aGlzLl9uID0gITE7CiAgICAgIH0sIG4ucHJvdG90eXBlID0gZSgiLi9fcmVkZWZpbmUtYWxsIikoX2oucHJvdG90eXBlLCB7IHRoZW46IGZ1bmN0aW9uIHRoZW4oZSwgdCkgewogICAgICAgICAgdmFyIHIgPSBQKHYodGhpcywgX2opKTtyZXR1cm4gci5vayA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogITAsIHIuZmFpbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdCwgci5kb21haW4gPSB4ID8gZy5kb21haW4gOiB2b2lkIDAsIHRoaXMuX2MucHVzaChyKSwgdGhpcy5fYSAmJiB0aGlzLl9hLnB1c2gociksIHRoaXMuX3MgJiYgVCh0aGlzLCAhMSksIHIucHJvbWlzZTsKICAgICAgICB9LCAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2goZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMudGhlbih2b2lkIDAsIGUpOwogICAgICAgIH0gfSksIFMgPSBmdW5jdGlvbiBTKCkgewogICAgICAgIHZhciBlID0gbmV3IG4oKTt0aGlzLnByb21pc2UgPSBlLCB0aGlzLnJlc29sdmUgPSB1KEwsIGUsIDEpLCB0aGlzLnJlamVjdCA9IHUoUiwgZSwgMSk7CiAgICAgIH0pLCBmKGYuRyArIGYuVyArIGYuRiAqICFrLCB7IFByb21pc2U6IF9qIH0pLCBlKCIuL19zZXQtdG8tc3RyaW5nLXRhZyIpKF9qLCBiKSwgZSgiLi9fc2V0LXNwZWNpZXMiKShiKSwgaSA9IGUoIi4vX2NvcmUiKVtiXSwgZihmLlMgKyBmLkYgKiAhaywgYiwgeyByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChlKSB7CiAgICAgICAgICB2YXIgdCA9IFAodGhpcyksCiAgICAgICAgICAgICAgciA9IHQucmVqZWN0O3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgZihmLlMgKyBmLkYgKiAoYyB8fCAhayksIGIsIHsgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZShlKSB7CiAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIF9qICYmIE8oZS5jb25zdHJ1Y3RvciwgdGhpcykpIHJldHVybiBlO3ZhciB0ID0gUCh0aGlzKSwKICAgICAgICAgICAgICByID0gdC5yZXNvbHZlO3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgZihmLlMgKyBmLkYgKiAhKGsgJiYgZSgiLi9faXRlci1kZXRlY3QiKShmdW5jdGlvbiAoZSkgewogICAgICAgIF9qLmFsbChlKVsiY2F0Y2giXSh3KTsKICAgICAgfSkpLCBiLCB7IGFsbDogZnVuY3Rpb24gYWxsKGUpIHsKICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICByID0gUCh0KSwKICAgICAgICAgICAgICBuID0gci5yZXNvbHZlLAogICAgICAgICAgICAgIG8gPSByLnJlamVjdCwKICAgICAgICAgICAgICBpID0gRShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciByID0gW10sCiAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgIGMgPSAxO3AoZSwgITEsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdmFyIHMgPSBpKyssCiAgICAgICAgICAgICAgICAgIHUgPSAhMTtyLnB1c2godm9pZCAwKSwgYysrLCB0LnJlc29sdmUoZSkudGhlbihmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgdSB8fCAodSA9ICEwLCByW3NdID0gZSwgLS1jIHx8IG4ocikpOwogICAgICAgICAgICAgIH0sIG8pOwogICAgICAgICAgICB9KSwgLS1jIHx8IG4ocik7CiAgICAgICAgICB9KTtyZXR1cm4gaSAmJiBvKGkuZXJyb3IpLCByLnByb21pc2U7CiAgICAgICAgfSwgcmFjZTogZnVuY3Rpb24gcmFjZShlKSB7CiAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgciA9IFAodCksCiAgICAgICAgICAgICAgbiA9IHIucmVqZWN0LAogICAgICAgICAgICAgIG8gPSBFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcChlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB0LnJlc29sdmUoZSkudGhlbihyLnJlc29sdmUsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pO3JldHVybiBvICYmIG4oby5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9IH0pOwogICAgfSwgeyAiLi9fYS1mdW5jdGlvbiI6IDksICIuL19hbi1pbnN0YW5jZSI6IDExLCAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19jbGFzc29mIjogMTQsICIuL19jb3JlIjogMTYsICIuL19jdHgiOiAxNywgIi4vX2V4cG9ydCI6IDIyLCAiLi9fZm9yLW9mIjogMjQsICIuL19nbG9iYWwiOiAyNSwgIi4vX2lzLW9iamVjdCI6IDMzLCAiLi9faXRlci1kZXRlY3QiOiAzNywgIi4vX2xpYnJhcnkiOiA0MCwgIi4vX21pY3JvdGFzayI6IDQxLCAiLi9fcmVkZWZpbmUtYWxsIjogNTEsICIuL19zZXQtcHJvdG8iOiA1MywgIi4vX3NldC1zcGVjaWVzIjogNTQsICIuL19zZXQtdG8tc3RyaW5nLXRhZyI6IDU1LCAiLi9fc3BlY2llcy1jb25zdHJ1Y3RvciI6IDU4LCAiLi9fdGFzayI6IDYwLCAiLi9fd2tzIjogNjggfV0sIDc0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX3N0cmluZy1hdCIpKCEwKTtlKCIuL19pdGVyLWRlZmluZSIpKFN0cmluZywgIlN0cmluZyIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5fdCA9IFN0cmluZyhlKSwgdGhpcy5faSA9IDA7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgdCA9IHRoaXMuX3QsCiAgICAgICAgICAgIHIgPSB0aGlzLl9pO3JldHVybiByID49IHQubGVuZ3RoID8geyB2YWx1ZTogdm9pZCAwLCBkb25lOiAhMCB9IDogKGUgPSBuKHQsIHIpLCB0aGlzLl9pICs9IGUubGVuZ3RoLCB7IHZhbHVlOiBlLCBkb25lOiAhMSB9KTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19pdGVyLWRlZmluZSI6IDM2LCAiLi9fc3RyaW5nLWF0IjogNTkgfV0sIDc1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi9lczYuYXJyYXkuaXRlcmF0b3IiKTtmb3IgKHZhciBuID0gZSgiLi9fZ2xvYmFsIiksIG8gPSBlKCIuL19oaWRlIiksIGkgPSBlKCIuL19pdGVyYXRvcnMiKSwgYyA9IGUoIi4vX3drcyIpKCJ0b1N0cmluZ1RhZyIpLCBzID0gWyJOb2RlTGlzdCIsICJET01Ub2tlbkxpc3QiLCAiTWVkaWFMaXN0IiwgIlN0eWxlU2hlZXRMaXN0IiwgIkNTU1J1bGVMaXN0Il0sIHUgPSAwOyA1ID4gdTsgdSsrKSB7CiAgICAgICAgdmFyIGEgPSBzW3VdLAogICAgICAgICAgICBmID0gblthXSwKICAgICAgICAgICAgXyA9IGYgJiYgZi5wcm90b3R5cGU7XyAmJiAhX1tjXSAmJiBvKF8sIGMsIGEpLCBpW2FdID0gaS5BcnJheTsKICAgICAgfQogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19oaWRlIjogMjcsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX3drcyI6IDY4LCAiLi9lczYuYXJyYXkuaXRlcmF0b3IiOiA3MCB9XSwgNzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCIuL2h5cGVydHktZGlzY292ZXJ5L0h5cGVydHlEaXNjb3ZlcnkiKSwKICAgICAgICAgIGkgPSBuKG8pO3JbImRlZmF1bHQiXSA9IGlbImRlZmF1bHQiXSwgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9oeXBlcnR5LWRpc2NvdmVyeS9IeXBlcnR5RGlzY292ZXJ5IjogNzcgfV0sIDc3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgcyA9IG4oYyksCiAgICAgICAgICB1ID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBhID0gbih1KSwKICAgICAgICAgIGYgPSBlKCIuLi91dGlscy91dGlscyIpLAogICAgICAgICAgXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIpIHsKICAgICAgICAgICgwLCBzWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBuID0gdGhpcztuLm1lc3NhZ2VCdXMgPSByLCBuLmRvbWFpbiA9ICgwLCBmLmRpdmlkZVVSTCkodCkuZG9tYWluLCBuLmRpc2NvdmVyeVVSTCA9IHQ7CiAgICAgICAgfXJldHVybiAoMCwgYVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJkaXNjb3ZlckRhdGFPYmplY3RQZXJOYW1lIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHZvaWQgMDtuID0gdCA/IHQgOiByLmRvbWFpbjt2YXIgbyA9IHsgdHlwZTogInJlYWQiLCBmcm9tOiByLmRpc2NvdmVyeVVSTCwgdG86ICJkb21haW46Ly9yZWdpc3RyeS4iICsgbiArICIvIiwgYm9keTogeyByZXNvdXJjZTogImRhdGFPYmplY3Q6Ly8iICsgZSB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgICByLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobywgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gci5ib2R5LnZhbHVlLnVybDtuID8gZShuKSA6IHQoIkRhdGFPYmplY3QgbmFtZSBkb2VzIG5vdCBleGlzdCIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkaXNjb3Zlckh5cGVydHlQZXJVc2VyIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHZvaWQgMDtuID0gdCA/IHQgOiByLmRvbWFpbjt2YXIgbyA9ICJ1c2VyOi8vIiArIGUuc3Vic3RyaW5nKGUuaW5kZXhPZigiQCIpICsgMSwgZS5sZW5ndGgpICsgIi8iICsgZS5zdWJzdHJpbmcoMCwgZS5pbmRleE9mKCJAIikpLAogICAgICAgICAgICAgICAgYyA9IHsgdHlwZTogInJlYWQiLCBmcm9tOiByLmRpc2NvdmVyeVVSTCwgdG86ICJkb21haW46Ly9yZWdpc3RyeS4iICsgbiArICIvIiwgYm9keTogeyByZXNvdXJjZTogbyB9IH07cmV0dXJuIGNvbnNvbGUubG9nKCJNZXNzYWdlOiAiLCBjLCBuLCBvKSwgbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShjLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIm1lc3NhZ2UgcmVwbHkiLCByKTt2YXIgbyA9IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBpID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAgIGMgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgcyA9IHIuYm9keS52YWx1ZTtmb3IgKG8gaW4gcykgewogICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBzW29dLmxhc3RNb2RpZmllZCkgaWYgKHZvaWQgMCA9PT0gaSkgaSA9IG5ldyBEYXRlKHNbb10ubGFzdE1vZGlmaWVkKSwgYyA9IG87ZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSBuZXcgRGF0ZShzW29dLmxhc3RNb2RpZmllZCk7aS5nZXRUaW1lKCkgPCB1LmdldFRpbWUoKSAmJiAoaSA9IHUsIGMgPSBvKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWNvbnNvbGUubG9nKCJMYXN0IEh5cGVydHk6ICIsIGMsIGkpO3ZhciBhID0gYztpZiAodm9pZCAwID09PSBhKSByZXR1cm4gbigiVXNlciBIeXBlcnR5IG5vdCBmb3VuZCIpO3ZhciBmID0geyBpZDogZSwgZGVzY3JpcHRvcjogc1thXS5kZXNjcmlwdG9yLCBoeXBlcnR5VVJMOiBhIH07Y29uc29sZS5sb2coIj09PT4gaHlwZXJ0eURpc2NvdmVyeSBtZXNzYWdlQnVuZGxlOiAiLCBmKSwgdChmKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHZvaWQgMDtuID0gdCA/IHQgOiByLmRvbWFpbjt2YXIgbyA9ICJ1c2VyOi8vIiArIGUuc3Vic3RyaW5nKGUuaW5kZXhPZigiQCIpICsgMSwgZS5sZW5ndGgpICsgIi8iICsgZS5zdWJzdHJpbmcoMCwgZS5pbmRleE9mKCJAIikpLAogICAgICAgICAgICAgICAgYyA9IHsgdHlwZTogInJlYWQiLCBmcm9tOiByLmRpc2NvdmVyeVVSTCwgdG86ICJkb21haW46Ly9yZWdpc3RyeS4iICsgbiArICIvIiwgYm9keTogeyByZXNvdXJjZTogbyB9IH07cmV0dXJuIGNvbnNvbGUubG9nKCJNZXNzYWdlIGRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlcjogIiwgYywgbiwgbyksIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgICByLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UoYywgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkaXNjb3Zlckh5cGVydGllc1BlclVzZXIgcmVwbHkiLCByKTt2YXIgbiA9IHIuYm9keS52YWx1ZTtyZXR1cm4gbiA/IHZvaWQgZShuKSA6IHQoIlVzZXIgSHlwZXJ0eSBub3QgZm91bmQiKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IF8sIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4uL3V0aWxzL3V0aWxzIjogNzgsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6IDMsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiA0LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogNSB9XSwgNzg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9ZnVuY3Rpb24gbyhlKSB7CiAgICAgICAgdmFyIHQgPSAvKFthLXpBLVotXSopOlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9KShbLWEtekEtWjAtOUA6JS5fXCt+Iz1cL10qKS9naSwKICAgICAgICAgICAgciA9ICIkMSwkMiwkMyIsCiAgICAgICAgICAgIG4gPSBlLnJlcGxhY2UodCwgcikuc3BsaXQoIiwiKTtuWzBdID09PSBlICYmIChuWzBdID0gImh0dHBzIiwgblsxXSA9IGUpO3ZhciBvID0geyB0eXBlOiBuWzBdLCBkb21haW46IG5bMV0sIGlkZW50aXR5OiBuWzJdIH07cmV0dXJuIG87CiAgICAgIH1mdW5jdGlvbiBpKGUpIHsKICAgICAgICByZXR1cm4gZSA/IEpTT04ucGFyc2UoKDAsIHNbImRlZmF1bHQiXSkoZSkpIDogdm9pZCAwOwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIGMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvanNvbi9zdHJpbmdpZnkiKSwKICAgICAgICAgIHMgPSBuKGMpO3IuZGl2aWRlVVJMID0gbywgci5kZWVwQ2xvbmUgPSBpOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9jb3JlLWpzL2pzb24vc3RyaW5naWZ5IjogMSB9XSB9LCB7fSwgWzc2XSkoNzYpOwp9KTsKCn0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9KQp9LHt9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpewoidXNlIHN0cmljdCI7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07CgovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8vIERpc3RyaWJ1dGlvbiBmaWxlIGZvciBTeW5jaGVyLmpzCi8vIHZlcnNpb246IDAuMi4wCgohZnVuY3Rpb24gKGUpIHsKICBpZiAoIm9iamVjdCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIG1vZHVsZSkgbW9kdWxlLmV4cG9ydHMgPSBlKCk7ZWxzZSBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZGVmaW5lICYmIGRlZmluZS5hbWQpIGRlZmluZShbXSwgZSk7ZWxzZSB7CiAgICB2YXIgdDt0ID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiB0aGlzLCB0LlN5bmNoZXIgPSBlKCk7CiAgfQp9KGZ1bmN0aW9uICgpIHsKICByZXR1cm4gZnVuY3Rpb24gZSh0LCByLCBuKSB7CiAgICBmdW5jdGlvbiBvKHMsIGEpIHsKICAgICAgaWYgKCFyW3NdKSB7CiAgICAgICAgaWYgKCF0W3NdKSB7CiAgICAgICAgICB2YXIgYyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZTtpZiAoIWEgJiYgYykgcmV0dXJuIGMocywgITApO2lmIChpKSByZXR1cm4gaShzLCAhMCk7dmFyIHUgPSBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIiArIHMgKyAiJyIpO3Rocm93IHUuY29kZSA9ICJNT0RVTEVfTk9UX0ZPVU5EIiwgdTsKICAgICAgICB9dmFyIGwgPSByW3NdID0geyBleHBvcnRzOiB7fSB9O3Rbc11bMF0uY2FsbChsLmV4cG9ydHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgciA9IHRbc11bMV1bZV07cmV0dXJuIG8ociA/IHIgOiBlKTsKICAgICAgICB9LCBsLCBsLmV4cG9ydHMsIGUsIHQsIHIsIG4pOwogICAgICB9cmV0dXJuIHJbc10uZXhwb3J0czsKICAgIH1mb3IgKHZhciBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlLCBzID0gMDsgcyA8IG4ubGVuZ3RoOyBzKyspIHsKICAgICAgbyhuW3NdKTsKICAgIH1yZXR1cm4gbzsKICB9KHsgMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIE9iamVjdC5vYnNlcnZlICYmICFBcnJheS5vYnNlcnZlICYmIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciByID0gZS5nZXROb3RpZmllciwKICAgICAgICAgICAgbiA9ICJwZXJmb3JtQ2hhbmdlIiwKICAgICAgICAgICAgbyA9ICJfb3JpZ2luYWwiLAogICAgICAgICAgICBpID0gInNwbGljZSIsCiAgICAgICAgICAgIHMgPSB7IHB1c2g6IGZ1bmN0aW9uIGMoZSkgewogICAgICAgICAgICB2YXIgdCA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIHMgPSBjW29dLmFwcGx5KHRoaXMsIHQpO3JldHVybiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogcyAtIHQubGVuZ3RoLCBhZGRlZENvdW50OiB0Lmxlbmd0aCwgcmVtb3ZlZDogW10gfTsKICAgICAgICAgICAgfSksIHM7CiAgICAgICAgICB9LCB1bnNoaWZ0OiBmdW5jdGlvbiB1KGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBzID0gdVtvXS5hcHBseSh0aGlzLCB0KTtyZXR1cm4gcih0aGlzKVtuXShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IDAsIGFkZGVkQ291bnQ6IHQubGVuZ3RoLCByZW1vdmVkOiBbXSB9OwogICAgICAgICAgICB9KSwgczsKICAgICAgICAgIH0sIHBvcDogZnVuY3Rpb24gbCgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHQgPSBsW29dLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMubGVuZ3RoICE9PSBlICYmIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiB0aGlzLmxlbmd0aCwgYWRkZWRDb3VudDogMCwgcmVtb3ZlZDogW3RdIH07CiAgICAgICAgICAgIH0sIHRoaXMpLCB0OwogICAgICAgICAgfSwgc2hpZnQ6IGZ1bmN0aW9uIGYoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5sZW5ndGgsCiAgICAgICAgICAgICAgICB0ID0gZltvXS5jYWxsKHRoaXMpO3JldHVybiB0aGlzLmxlbmd0aCAhPT0gZSAmJiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogMCwgYWRkZWRDb3VudDogMCwgcmVtb3ZlZDogW3RdIH07CiAgICAgICAgICAgIH0sIHRoaXMpLCB0OwogICAgICAgICAgfSwgc3BsaWNlOiBmdW5jdGlvbiBkKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHMgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBhID0gZFtvXS5hcHBseSh0aGlzLCBzKTtyZXR1cm4gKGEubGVuZ3RoIHx8IHMubGVuZ3RoID4gMikgJiYgcih0aGlzKVtuXShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGUsIGFkZGVkQ291bnQ6IHMubGVuZ3RoIC0gMiwgcmVtb3ZlZDogYSB9OwogICAgICAgICAgICB9LCB0aGlzKSwgYTsKICAgICAgICAgIH0gfTtmb3IgKHZhciBhIGluIHMpIHsKICAgICAgICAgIHNbYV1bb10gPSB0LnByb3RvdHlwZVthXSwgdC5wcm90b3R5cGVbYV0gPSBzW2FdOwogICAgICAgIH10Lm9ic2VydmUgPSBmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgcmV0dXJuIGUub2JzZXJ2ZSh0LCByLCBbImFkZCIsICJ1cGRhdGUiLCAiZGVsZXRlIiwgaV0pOwogICAgICAgIH0sIHQudW5vYnNlcnZlID0gZS51bm9ic2VydmU7CiAgICAgIH0oT2JqZWN0LCBBcnJheSk7CiAgICB9LCB7fV0sIDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL2pzb24vc3RyaW5naWZ5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiOiAxNyB9XSwgMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2NyZWF0ZSIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUiOiAxOCB9XSwgNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9kZWZpbmUtcHJvcGVydHkiOiAxOSB9XSwgNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOiAyMCB9XSwgNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6IDIxIH1dLCA3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIjogMjIgfV0sIDg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiOiAyMyB9XSwgOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiOiAyNCB9XSwgMTA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCI6IDI1IH1dLCAxMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgci5fX2VzTW9kdWxlID0gITAsIHJbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfTsKICAgIH0sIHt9XSwgMTI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9ci5fX2VzTW9kdWxlID0gITA7dmFyIG8gPSBlKCIuLi9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkiKSwKICAgICAgICAgIGkgPSBuKG8pO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKGUsIHQpIHsKICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgewogICAgICAgICAgICB2YXIgbiA9IHRbcl07bi5lbnVtZXJhYmxlID0gbi5lbnVtZXJhYmxlIHx8ICExLCBuLmNvbmZpZ3VyYWJsZSA9ICEwLCAidmFsdWUiIGluIG4gJiYgKG4ud3JpdGFibGUgPSAhMCksICgwLCBpWyJkZWZhdWx0Il0pKGUsIG4ua2V5LCBuKTsKICAgICAgICAgIH0KICAgICAgICB9cmV0dXJuIGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgICAgICByZXR1cm4gciAmJiBlKHQucHJvdG90eXBlLCByKSwgbiAmJiBlKHQsIG4pLCB0OwogICAgICAgIH07CiAgICAgIH0oKTsKICAgIH0sIHsgIi4uL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDQgfV0sIDEzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIilbImRlZmF1bHQiXTtyWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGZvciAodmFyIG8gPSAhMDsgbzspIHsKICAgICAgICAgIHZhciBpID0gZSwKICAgICAgICAgICAgICBzID0gdCwKICAgICAgICAgICAgICBhID0gcjtvID0gITEsIG51bGwgPT09IGkgJiYgKGkgPSBGdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBjID0gbihpLCBzKTtpZiAodm9pZCAwICE9PSBjKSB7CiAgICAgICAgICAgIGlmICgidmFsdWUiIGluIGMpIHJldHVybiBjLnZhbHVlO3ZhciB1ID0gYy5nZXQ7aWYgKHZvaWQgMCA9PT0gdSkgcmV0dXJuO3JldHVybiB1LmNhbGwoYSk7CiAgICAgICAgICB9dmFyIGwgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoaSk7aWYgKG51bGwgPT09IGwpIHJldHVybjtlID0gbCwgdCA9IHMsIHIgPSBhLCBvID0gITAsIGMgPSBsID0gdm9pZCAwOwogICAgICAgIH0KICAgICAgfSwgci5fX2VzTW9kdWxlID0gITA7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6IDUgfV0sIDE0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvY3JlYXRlIilbImRlZmF1bHQiXSwKICAgICAgICAgIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiKVsiZGVmYXVsdCJdO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQgJiYgbnVsbCAhPT0gdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgKHR5cGVvZiB0ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih0KSkpO2UucHJvdG90eXBlID0gbih0ICYmIHQucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBlLCBlbnVtZXJhYmxlOiAhMSwgd3JpdGFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0gfSksIHQgJiYgKG8gPyBvKGUsIHQpIDogZS5fX3Byb3RvX18gPSB0KTsKICAgICAgfSwgci5fX2VzTW9kdWxlID0gITA7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2NyZWF0ZSI6IDMsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiOiA4IH1dLCAxNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoIi4uL2hlbHBlcnMvdHlwZW9mIiksCiAgICAgICAgICBpID0gbihvKTtyWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICghZSkgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4gIXQgfHwgIm9iamVjdCIgIT09ICgidW5kZWZpbmVkIiA9PSB0eXBlb2YgdCA/ICJ1bmRlZmluZWQiIDogKDAsIGlbImRlZmF1bHQiXSkodCkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQgPyBlIDogdDsKICAgICAgfTsKICAgIH0sIHsgIi4uL2hlbHBlcnMvdHlwZW9mIjogMTYgfV0sIDE2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9zeW1ib2wiKVsiZGVmYXVsdCJdO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5jb25zdHJ1Y3RvciA9PT0gbiA/ICJzeW1ib2wiIDogdHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpOwogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9zeW1ib2wiOiAxMCB9XSwgMTc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gKG4uSlNPTiAmJiBuLkpTT04uc3RyaW5naWZ5IHx8IEpTT04uc3RyaW5naWZ5KS5hcHBseShKU09OLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOiAzMSB9XSwgMTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIG4uY3JlYXRlKGUsIHQpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kIjogNTYgfV0sIDE5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLi8uLi9tb2R1bGVzLyQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLnNldERlc2MoZSwgdCwgcik7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiB9XSwgMjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJCIpO2UoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKSwgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbi5nZXREZXNjKGUsIHQpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kIjogNTYsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjogODEgfV0sIDIxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiKSwgdC5leHBvcnRzID0gZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKS5PYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiOiA4MiB9XSwgMjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cyIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5rZXlzOwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOiAzMSwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIjogODMgfV0sIDIzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YiKSwgdC5leHBvcnRzID0gZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKS5PYmplY3Quc2V0UHJvdG90eXBlT2Y7CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YiOiA4NCB9XSwgMjQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIiksIGUoIi4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciIpLCBlKCIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiKSwgZSgiLi4vbW9kdWxlcy9lczYucHJvbWlzZSIpLCB0LmV4cG9ydHMgPSBlKCIuLi9tb2R1bGVzLyQuY29yZSIpLlByb21pc2U7CiAgICB9LCB7ICIuLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyI6IDg1LCAiLi4vbW9kdWxlcy9lczYucHJvbWlzZSI6IDg2LCAiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIjogODcsICIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOiA4OSB9XSwgMjU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5zeW1ib2wiKSwgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLlN5bWJvbDsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogODUsICIuLi8uLi9tb2R1bGVzL2VzNi5zeW1ib2wiOiA4OCB9XSwgMjY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSB0aHJvdyBUeXBlRXJyb3IoZSArICIgaXMgbm90IGEgZnVuY3Rpb24hIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDI3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKCkge307CiAgICB9LCB7fV0sIDI4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXMtb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoIW4oZSkpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYW4gb2JqZWN0ISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi8kLmlzLW9iamVjdCI6IDQ5IH1dLCAyOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvZiIpLAogICAgICAgICAgbyA9IGUoIi4vJC53a3MiKSgidG9TdHJpbmdUYWciKSwKICAgICAgICAgIGkgPSAiQXJndW1lbnRzIiA9PSBuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsIHIsIHM7cmV0dXJuIHZvaWQgMCA9PT0gZSA/ICJVbmRlZmluZWQiIDogbnVsbCA9PT0gZSA/ICJOdWxsIiA6ICJzdHJpbmciID09IHR5cGVvZiAociA9ICh0ID0gT2JqZWN0KGUpKVtvXSkgPyByIDogaSA/IG4odCkgOiAiT2JqZWN0IiA9PSAocyA9IG4odCkpICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQuY2FsbGVlID8gIkFyZ3VtZW50cyIgOiBzOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwLCAiLi8kLndrcyI6IDc4IH1dLCAzMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0ge30udG9TdHJpbmc7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbi5jYWxsKGUpLnNsaWNlKDgsIC0xKTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9IHsgdmVyc2lvbjogIjEuMi42IiB9OyJudW1iZXIiID09IHR5cGVvZiBfX2UgJiYgKF9fZSA9IG4pOwogICAgfSwge31dLCAzMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmEtZnVuY3Rpb24iKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGlmIChuKGUpLCB2b2lkIDAgPT09IHQpIHJldHVybiBlO3N3aXRjaCAocikge2Nhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByKTsKICAgICAgICAgICAgfTtjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbikgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgciwgbik7CiAgICAgICAgICAgIH07Y2FzZSAzOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIsIG4sIG8pIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIsIG4sIG8pOwogICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGUuYXBwbHkodCwgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi8kLmEtZnVuY3Rpb24iOiAyNiB9XSwgMzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICh2b2lkIDAgPT0gZSkgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAgIiArIGUpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAzNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9ICFlKCIuLyQuZmFpbHMiKShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDcgIT0gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAiYSIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfSB9KS5hOwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5mYWlscyI6IDM4IH1dLCAzNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmlzLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5nbG9iYWwiKS5kb2N1bWVudCwKICAgICAgICAgIGkgPSBuKG8pICYmIG4oby5jcmVhdGVFbGVtZW50KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpID8gby5jcmVhdGVFbGVtZW50KGUpIDoge307CiAgICAgIH07CiAgICB9LCB7ICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaXMtb2JqZWN0IjogNDkgfV0sIDM2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gbi5nZXRLZXlzKGUpLAogICAgICAgICAgICByID0gbi5nZXRTeW1ib2xzO2lmIChyKSBmb3IgKHZhciBvLCBpID0gcihlKSwgcyA9IG4uaXNFbnVtLCBhID0gMDsgaS5sZW5ndGggPiBhOykgewogICAgICAgICAgcy5jYWxsKGUsIG8gPSBpW2ErK10pICYmIHQucHVzaChvKTsKICAgICAgICB9cmV0dXJuIHQ7CiAgICAgIH07CiAgICB9LCB7ICIuLyQiOiA1NiB9XSwgMzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5nbG9iYWwiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vJC5jdHgiKSwKICAgICAgICAgIHMgPSAicHJvdG90eXBlIiwKICAgICAgICAgIGEgPSBmdW5jdGlvbiBhKGUsIHQsIHIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgICAgdSwKICAgICAgICAgICAgbCwKICAgICAgICAgICAgZiA9IGUgJiBhLkYsCiAgICAgICAgICAgIGQgPSBlICYgYS5HLAogICAgICAgICAgICBwID0gZSAmIGEuUywKICAgICAgICAgICAgYiA9IGUgJiBhLlAsCiAgICAgICAgICAgIGggPSBlICYgYS5CLAogICAgICAgICAgICB2ID0gZSAmIGEuVywKICAgICAgICAgICAgeSA9IGQgPyBvIDogb1t0XSB8fCAob1t0XSA9IHt9KSwKICAgICAgICAgICAgXyA9IGQgPyBuIDogcCA/IG5bdF0gOiAoblt0XSB8fCB7fSlbc107ZCAmJiAociA9IHQpO2ZvciAoYyBpbiByKSB7CiAgICAgICAgICB1ID0gIWYgJiYgXyAmJiBjIGluIF8sIHUgJiYgYyBpbiB5IHx8IChsID0gdSA/IF9bY10gOiByW2NdLCB5W2NdID0gZCAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiBfW2NdID8gcltjXSA6IGggJiYgdSA/IGkobCwgbikgOiB2ICYmIF9bY10gPT0gbCA/IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0ID0gZnVuY3Rpb24gdChfdCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgZSA/IG5ldyBlKF90KSA6IGUoX3QpOwogICAgICAgICAgICB9O3JldHVybiB0W3NdID0gZVtzXSwgdDsKICAgICAgICAgIH0obCkgOiBiICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGwgPyBpKEZ1bmN0aW9uLmNhbGwsIGwpIDogbCwgYiAmJiAoKHlbc10gfHwgKHlbc10gPSB7fSkpW2NdID0gbCkpOwogICAgICAgIH0KICAgICAgfTthLkYgPSAxLCBhLkcgPSAyLCBhLlMgPSA0LCBhLlAgPSA4LCBhLkIgPSAxNiwgYS5XID0gMzIsIHQuZXhwb3J0cyA9IGE7CiAgICB9LCB7ICIuLyQuY29yZSI6IDMxLCAiLi8kLmN0eCI6IDMyLCAiLi8kLmdsb2JhbCI6IDQxIH1dLCAzODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiAhIWUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gITA7CiAgICAgICAgfQogICAgICB9OwogICAgfSwge31dLCAzOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5pdGVyLWNhbGwiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuaXMtYXJyYXktaXRlciIpLAogICAgICAgICAgcyA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIGEgPSBlKCIuLyQudG8tbGVuZ3RoIiksCiAgICAgICAgICBjID0gZSgiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgdSkgewogICAgICAgIHZhciBsLAogICAgICAgICAgICBmLAogICAgICAgICAgICBkLAogICAgICAgICAgICBwID0gYyhlKSwKICAgICAgICAgICAgYiA9IG4ociwgdSwgdCA/IDIgOiAxKSwKICAgICAgICAgICAgaCA9IDA7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHApIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgaXRlcmFibGUhIik7aWYgKGkocCkpIGZvciAobCA9IGEoZS5sZW5ndGgpOyBsID4gaDsgaCsrKSB7CiAgICAgICAgICB0ID8gYihzKGYgPSBlW2hdKVswXSwgZlsxXSkgOiBiKGVbaF0pOwogICAgICAgIH0gZWxzZSBmb3IgKGQgPSBwLmNhbGwoZSk7ICEoZiA9IGQubmV4dCgpKS5kb25lOykgewogICAgICAgICAgbyhkLCBiLCBmLnZhbHVlLCB0KTsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYW4tb2JqZWN0IjogMjgsICIuLyQuY3R4IjogMzIsICIuLyQuaXMtYXJyYXktaXRlciI6IDQ3LCAiLi8kLml0ZXItY2FsbCI6IDUwLCAiLi8kLnRvLWxlbmd0aCI6IDc1LCAiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiOiA3OSB9XSwgNDA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1pb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi8kIikuZ2V0TmFtZXMsCiAgICAgICAgICBpID0ge30udG9TdHJpbmcsCiAgICAgICAgICBzID0gIm9iamVjdCIgPT0gKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHdpbmRvdykpICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KSA6IFtdLAogICAgICAgICAgYSA9IGZ1bmN0aW9uIGEoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbyhlKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gcy5zbGljZSgpOwogICAgICAgIH0KICAgICAgfTt0LmV4cG9ydHMuZ2V0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gcyAmJiAiW29iamVjdCBXaW5kb3ddIiA9PSBpLmNhbGwoZSkgPyBhKGUpIDogbyhuKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgNDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgd2luZG93Lk1hdGggPT0gTWF0aCA/IHdpbmRvdyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZiA6IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7Im51bWJlciIgPT0gdHlwZW9mIF9fZyAmJiAoX19nID0gbik7CiAgICB9LCB7fV0sIDQyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDQzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQucHJvcGVydHktZGVzYyIpO3QuZXhwb3J0cyA9IGUoIi4vJC5kZXNjcmlwdG9ycyIpID8gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICByZXR1cm4gbi5zZXREZXNjKGUsIHQsIG8oMSwgcikpOwogICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICByZXR1cm4gZVt0XSA9IHIsIGU7CiAgICAgIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLnByb3BlcnR5LWRlc2MiOiA2MSB9XSwgNDQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBlKCIuLyQuZ2xvYmFsIikuZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxIH1dLCA0NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgdmFyIG4gPSB2b2lkIDAgPT09IHI7c3dpdGNoICh0Lmxlbmd0aCkge2Nhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKCkgOiBlLmNhbGwocik7Y2FzZSAxOgogICAgICAgICAgICByZXR1cm4gbiA/IGUodFswXSkgOiBlLmNhbGwociwgdFswXSk7Y2FzZSAyOgogICAgICAgICAgICByZXR1cm4gbiA/IGUodFswXSwgdFsxXSkgOiBlLmNhbGwociwgdFswXSwgdFsxXSk7Y2FzZSAzOgogICAgICAgICAgICByZXR1cm4gbiA/IGUodFswXSwgdFsxXSwgdFsyXSkgOiBlLmNhbGwociwgdFswXSwgdFsxXSwgdFsyXSk7Y2FzZSA0OgogICAgICAgICAgICByZXR1cm4gbiA/IGUodFswXSwgdFsxXSwgdFsyXSwgdFszXSkgOiBlLmNhbGwociwgdFswXSwgdFsxXSwgdFsyXSwgdFszXSk7fXJldHVybiBlLmFwcGx5KHIsIHQpOwogICAgICB9OwogICAgfSwge31dLCA0NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvZiIpO3QuZXhwb3J0cyA9IE9iamVjdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN0cmluZyIgPT0gbihlKSA/IGUuc3BsaXQoIiIpIDogT2JqZWN0KGUpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwIH1dLCA0NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLml0ZXJhdG9ycyIpLAogICAgICAgICAgbyA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGkgPSBBcnJheS5wcm90b3R5cGU7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlICYmIChuLkFycmF5ID09PSBlIHx8IGlbb10gPT09IGUpOwogICAgICB9OwogICAgfSwgeyAiLi8kLml0ZXJhdG9ycyI6IDU1LCAiLi8kLndrcyI6IDc4IH1dLCA0ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvZiIpO3QuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIkFycmF5IiA9PSBuKGUpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwIH1dLCA0OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICJvYmplY3QiID09ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpID8gbnVsbCAhPT0gZSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDUwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuYW4tb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIG8gPyB0KG4ocilbMF0sIHJbMV0pIDogdChyKTsKICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICB2YXIgcyA9IGVbInJldHVybiJdO3Rocm93IHZvaWQgMCAhPT0gcyAmJiBuKHMuY2FsbChlKSksIGk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwgeyAiLi8kLmFuLW9iamVjdCI6IDI4IH1dLCA1MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQucHJvcGVydHktZGVzYyIpLAogICAgICAgICAgaSA9IGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgcyA9IHt9O2UoIi4vJC5oaWRlIikocywgZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGUucHJvdG90eXBlID0gbi5jcmVhdGUocywgeyBuZXh0OiBvKDEsIHIpIH0pLCBpKGUsIHQgKyAiIEl0ZXJhdG9yIik7CiAgICAgIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5oaWRlIjogNDMsICIuLyQucHJvcGVydHktZGVzYyI6IDYxLCAiLi8kLnNldC10by1zdHJpbmctdGFnIjogNjcsICIuLyQud2tzIjogNzggfV0sIDUyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5saWJyYXJ5IiksCiAgICAgICAgICBvID0gZSgiLi8kLmV4cG9ydCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5yZWRlZmluZSIpLAogICAgICAgICAgcyA9IGUoIi4vJC5oaWRlIiksCiAgICAgICAgICBhID0gZSgiLi8kLmhhcyIpLAogICAgICAgICAgYyA9IGUoIi4vJC5pdGVyYXRvcnMiKSwKICAgICAgICAgIHUgPSBlKCIuLyQuaXRlci1jcmVhdGUiKSwKICAgICAgICAgIGwgPSBlKCIuLyQuc2V0LXRvLXN0cmluZy10YWciKSwKICAgICAgICAgIGYgPSBlKCIuLyQiKS5nZXRQcm90bywKICAgICAgICAgIGQgPSBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBwID0gIShbXS5rZXlzICYmICJuZXh0IiBpbiBbXS5rZXlzKCkpLAogICAgICAgICAgYiA9ICJAQGl0ZXJhdG9yIiwKICAgICAgICAgIGggPSAia2V5cyIsCiAgICAgICAgICB2ID0gInZhbHVlcyIsCiAgICAgICAgICB5ID0gZnVuY3Rpb24geSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgXywgZywgbSwgaikgewogICAgICAgIHUociwgdCwgXyk7dmFyICQsCiAgICAgICAgICAgIE8sCiAgICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KGUpIHsKICAgICAgICAgIGlmICghcCAmJiBlIGluIEUpIHJldHVybiBFW2VdO3N3aXRjaCAoZSkge2Nhc2UgaDoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyByKHRoaXMsIGUpOwogICAgICAgICAgICAgIH07Y2FzZSB2OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTt9cmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyByKHRoaXMsIGUpOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgICAgICBrID0gdCArICIgSXRlcmF0b3IiLAogICAgICAgICAgICB4ID0gZyA9PSB2LAogICAgICAgICAgICBDID0gITEsCiAgICAgICAgICAgIEUgPSBlLnByb3RvdHlwZSwKICAgICAgICAgICAgUyA9IEVbZF0gfHwgRVtiXSB8fCBnICYmIEVbZ10sCiAgICAgICAgICAgIFQgPSBTIHx8IHcoZyk7aWYgKFMpIHsKICAgICAgICAgIHZhciBNID0gZihULmNhbGwobmV3IGUoKSkpO2woTSwgaywgITApLCAhbiAmJiBhKEUsIGIpICYmIHMoTSwgZCwgeSksIHggJiYgUy5uYW1lICE9PSB2ICYmIChDID0gITAsIFQgPSBmdW5jdGlvbiBUKCkgewogICAgICAgICAgICByZXR1cm4gUy5jYWxsKHRoaXMpOwogICAgICAgICAgfSk7CiAgICAgICAgfWlmIChuICYmICFqIHx8ICFwICYmICFDICYmIEVbZF0gfHwgcyhFLCBkLCBUKSwgY1t0XSA9IFQsIGNba10gPSB5LCBnKSBpZiAoJCA9IHsgdmFsdWVzOiB4ID8gVCA6IHcodiksIGtleXM6IG0gPyBUIDogdyhoKSwgZW50cmllczogeCA/IHcoImVudHJpZXMiKSA6IFQgfSwgaikgZm9yIChPIGluICQpIHsKICAgICAgICAgIE8gaW4gRSB8fCBpKEUsIE8sICRbT10pOwogICAgICAgIH0gZWxzZSBvKG8uUCArIG8uRiAqIChwIHx8IEMpLCB0LCAkKTtyZXR1cm4gJDsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLmhhcyI6IDQyLCAiLi8kLmhpZGUiOiA0MywgIi4vJC5pdGVyLWNyZWF0ZSI6IDUxLCAiLi8kLml0ZXJhdG9ycyI6IDU1LCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5yZWRlZmluZSI6IDYzLCAiLi8kLnNldC10by1zdHJpbmctdGFnIjogNjcsICIuLyQud2tzIjogNzggfV0sIDUzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBvID0gITE7dHJ5IHsKICAgICAgICB2YXIgaSA9IFs3XVtuXSgpO2lbInJldHVybiJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbyA9ICEwOwogICAgICAgIH0sIEFycmF5LmZyb20oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhyb3cgMjsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAocykge310LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICghdCAmJiAhbykgcmV0dXJuICExO3ZhciByID0gITE7dHJ5IHsKICAgICAgICAgIHZhciBpID0gWzddLAogICAgICAgICAgICAgIHMgPSBpW25dKCk7cy5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByID0gITA7CiAgICAgICAgICB9LCBpW25dID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICAgIH0sIGUoaSk7CiAgICAgICAgfSBjYXRjaCAoYSkge31yZXR1cm4gcjsKICAgICAgfTsKICAgIH0sIHsgIi4vJC53a3MiOiA3OCB9XSwgNTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiB7IHZhbHVlOiB0LCBkb25lOiAhIWUgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7fTsKICAgIH0sIHt9XSwgNTY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IE9iamVjdDt0LmV4cG9ydHMgPSB7IGNyZWF0ZTogbi5jcmVhdGUsIGdldFByb3RvOiBuLmdldFByb3RvdHlwZU9mLCBpc0VudW06IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLCBnZXREZXNjOiBuLmdldE93blByb3BlcnR5RGVzY3JpcHRvciwgc2V0RGVzYzogbi5kZWZpbmVQcm9wZXJ0eSwgc2V0RGVzY3M6IG4uZGVmaW5lUHJvcGVydGllcywgZ2V0S2V5czogbi5rZXlzLCBnZXROYW1lczogbi5nZXRPd25Qcm9wZXJ0eU5hbWVzLCBnZXRTeW1ib2xzOiBuLmdldE93blByb3BlcnR5U3ltYm9scywgZWFjaDogW10uZm9yRWFjaCB9OwogICAgfSwge31dLCA1NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIiksCiAgICAgICAgICBvID0gZSgiLi8kLnRvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGZvciAodmFyIHIsIGkgPSBvKGUpLCBzID0gbi5nZXRLZXlzKGkpLCBhID0gcy5sZW5ndGgsIGMgPSAwOyBhID4gYzspIHsKICAgICAgICAgIGlmIChpW3IgPSBzW2MrK11dID09PSB0KSByZXR1cm4gcjsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC50by1pb2JqZWN0IjogNzQgfV0sIDU4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gITA7CiAgICB9LCB7fV0sIDU5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBvLAogICAgICAgICAgaSwKICAgICAgICAgIHMgPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBhID0gZSgiLi8kLnRhc2siKS5zZXQsCiAgICAgICAgICBjID0gcy5NdXRhdGlvbk9ic2VydmVyIHx8IHMuV2ViS2l0TXV0YXRpb25PYnNlcnZlciwKICAgICAgICAgIHUgPSBzLnByb2Nlc3MsCiAgICAgICAgICBsID0gcy5Qcm9taXNlLAogICAgICAgICAgZiA9ICJwcm9jZXNzIiA9PSBlKCIuLyQuY29mIikodSksCiAgICAgICAgICBkID0gZnVuY3Rpb24gZCgpIHsKICAgICAgICB2YXIgZSwgdCwgcjtmb3IgKGYgJiYgKGUgPSB1LmRvbWFpbikgJiYgKHUuZG9tYWluID0gbnVsbCwgZS5leGl0KCkpOyBuOykgewogICAgICAgICAgdCA9IG4uZG9tYWluLCByID0gbi5mbiwgdCAmJiB0LmVudGVyKCksIHIoKSwgdCAmJiB0LmV4aXQoKSwgbiA9IG4ubmV4dDsKICAgICAgICB9byA9IHZvaWQgMCwgZSAmJiBlLmVudGVyKCk7CiAgICAgIH07aWYgKGYpIGkgPSBmdW5jdGlvbiBpKCkgewogICAgICAgIHUubmV4dFRpY2soZCk7CiAgICAgIH07ZWxzZSBpZiAoYykgewogICAgICAgIHZhciBwID0gMSwKICAgICAgICAgICAgYiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKTtuZXcgYyhkKS5vYnNlcnZlKGIsIHsgY2hhcmFjdGVyRGF0YTogITAgfSksIGkgPSBmdW5jdGlvbiBpKCkgewogICAgICAgICAgYi5kYXRhID0gcCA9IC1wOwogICAgICAgIH07CiAgICAgIH0gZWxzZSBpID0gbCAmJiBsLnJlc29sdmUgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgbC5yZXNvbHZlKCkudGhlbihkKTsKICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICBhLmNhbGwocywgZCk7CiAgICAgIH07dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHsgZm46IGUsIG5leHQ6IHZvaWQgMCwgZG9tYWluOiBmICYmIHUuZG9tYWluIH07byAmJiAoby5uZXh0ID0gdCksIG4gfHwgKG4gPSB0LCBpKCkpLCBvID0gdDsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5jb2YiOiAzMCwgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC50YXNrIjogNzIgfV0sIDYwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZXhwb3J0IiksCiAgICAgICAgICBvID0gZSgiLi8kLmNvcmUiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZmFpbHMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciByID0gKG8uT2JqZWN0IHx8IHt9KVtlXSB8fCBPYmplY3RbZV0sCiAgICAgICAgICAgIHMgPSB7fTtzW2VdID0gdChyKSwgbihuLlMgKyBuLkYgKiBpKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHIoMSk7CiAgICAgICAgfSksICJPYmplY3QiLCBzKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5jb3JlIjogMzEsICIuLyQuZXhwb3J0IjogMzcsICIuLyQuZmFpbHMiOiAzOCB9XSwgNjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiB7IGVudW1lcmFibGU6ICEoMSAmIGUpLCBjb25maWd1cmFibGU6ICEoMiAmIGUpLCB3cml0YWJsZTogISg0ICYgZSksIHZhbHVlOiB0IH07CiAgICAgIH07CiAgICB9LCB7fV0sIDYyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQucmVkZWZpbmUiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGZvciAodmFyIHIgaW4gdCkgewogICAgICAgICAgbihlLCByLCB0W3JdKTsKICAgICAgICB9cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuLyQucmVkZWZpbmUiOiA2MyB9XSwgNjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBlKCIuLyQuaGlkZSIpOwogICAgfSwgeyAiLi8kLmhpZGUiOiA0MyB9XSwgNjQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBPYmplY3QuaXMgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSA9PT0gdCA/IDAgIT09IGUgfHwgMSAvIGUgPT09IDEgLyB0IDogZSAhPSBlICYmIHQgIT0gdDsKICAgICAgfTsKICAgIH0sIHt9XSwgNjU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpLmdldERlc2MsCiAgICAgICAgICBvID0gZSgiLi8kLmlzLW9iamVjdCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIHMgPSBmdW5jdGlvbiBzKGUsIHQpIHsKICAgICAgICBpZiAoaShlKSwgIW8odCkgJiYgbnVsbCAhPT0gdCkgdGhyb3cgVHlwZUVycm9yKHQgKyAiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlISIpOwogICAgICB9O3QuZXhwb3J0cyA9IHsgc2V0OiBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgKCJfX3Byb3RvX18iIGluIHt9ID8gZnVuY3Rpb24gKHQsIHIsIG8pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG8gPSBlKCIuLyQuY3R4IikoRnVuY3Rpb24uY2FsbCwgbihPYmplY3QucHJvdG90eXBlLCAiX19wcm90b19fIikuc2V0LCAyKSwgbyh0LCBbXSksIHIgPSAhKHQgaW5zdGFuY2VvZiBBcnJheSk7CiAgICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHMoZSwgdCksIHIgPyBlLl9fcHJvdG9fXyA9IHQgOiBvKGUsIHQpLCBlOwogICAgICAgICAgfTsKICAgICAgICB9KHt9LCAhMSkgOiB2b2lkIDApLCBjaGVjazogcyB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuYW4tb2JqZWN0IjogMjgsICIuLyQuY3R4IjogMzIsICIuLyQuaXMtb2JqZWN0IjogNDkgfV0sIDY2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5jb3JlIiksCiAgICAgICAgICBvID0gZSgiLi8kIiksCiAgICAgICAgICBpID0gZSgiLi8kLmRlc2NyaXB0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IG5bZV07aSAmJiB0ICYmICF0W3NdICYmIG8uc2V0RGVzYyh0LCBzLCB7IGNvbmZpZ3VyYWJsZTogITAsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0gfSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5jb3JlIjogMzEsICIuLyQuZGVzY3JpcHRvcnMiOiAzNCwgIi4vJC53a3MiOiA3OCB9XSwgNjc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpLnNldERlc2MsCiAgICAgICAgICBvID0gZSgiLi8kLmhhcyIpLAogICAgICAgICAgaSA9IGUoIi4vJC53a3MiKSgidG9TdHJpbmdUYWciKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGUgJiYgIW8oZSA9IHIgPyBlIDogZS5wcm90b3R5cGUsIGkpICYmIG4oZSwgaSwgeyBjb25maWd1cmFibGU6ICEwLCB2YWx1ZTogdCB9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmhhcyI6IDQyLCAiLi8kLndrcyI6IDc4IH1dLCA2ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgbyA9ICJfX2NvcmUtanNfc2hhcmVkX18iLAogICAgICAgICAgaSA9IG5bb10gfHwgKG5bb10gPSB7fSk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaVtlXSB8fCAoaVtlXSA9IHt9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5nbG9iYWwiOiA0MSB9XSwgNjk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuYS1mdW5jdGlvbiIpLAogICAgICAgICAgaSA9IGUoIi4vJC53a3MiKSgic3BlY2llcyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIHMgPSBuKGUpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDAgPT09IHMgfHwgdm9pZCAwID09IChyID0gbihzKVtpXSkgPyB0IDogbyhyKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5hLWZ1bmN0aW9uIjogMjYsICIuLyQuYW4tb2JqZWN0IjogMjgsICIuLyQud2tzIjogNzggfV0sIDcwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgdCkpIHRocm93IFR5cGVFcnJvcihyICsgIjogdXNlIHRoZSAnbmV3JyBvcGVyYXRvciEiKTtyZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHt9XSwgNzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1pbnRlZ2VyIiksCiAgICAgICAgICBvID0gZSgiLi8kLmRlZmluZWQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgdmFyIGksCiAgICAgICAgICAgICAgcywKICAgICAgICAgICAgICBhID0gU3RyaW5nKG8odCkpLAogICAgICAgICAgICAgIGMgPSBuKHIpLAogICAgICAgICAgICAgIHUgPSBhLmxlbmd0aDtyZXR1cm4gMCA+IGMgfHwgYyA+PSB1ID8gZSA/ICIiIDogdm9pZCAwIDogKGkgPSBhLmNoYXJDb2RlQXQoYyksIDU1Mjk2ID4gaSB8fCBpID4gNTYzMTkgfHwgYyArIDEgPT09IHUgfHwgKHMgPSBhLmNoYXJDb2RlQXQoYyArIDEpKSA8IDU2MzIwIHx8IHMgPiA1NzM0MyA/IGUgPyBhLmNoYXJBdChjKSA6IGkgOiBlID8gYS5zbGljZShjLCBjICsgMikgOiAoaSAtIDU1Mjk2IDw8IDEwKSArIChzIC0gNTYzMjApICsgNjU1MzYpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuLyQuZGVmaW5lZCI6IDMzLCAiLi8kLnRvLWludGVnZXIiOiA3MyB9XSwgNzI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgcyA9IGUoIi4vJC5jdHgiKSwKICAgICAgICAgIGEgPSBlKCIuLyQuaW52b2tlIiksCiAgICAgICAgICBjID0gZSgiLi8kLmh0bWwiKSwKICAgICAgICAgIHUgPSBlKCIuLyQuZG9tLWNyZWF0ZSIpLAogICAgICAgICAgbCA9IGUoIi4vJC5nbG9iYWwiKSwKICAgICAgICAgIGYgPSBsLnByb2Nlc3MsCiAgICAgICAgICBkID0gbC5zZXRJbW1lZGlhdGUsCiAgICAgICAgICBwID0gbC5jbGVhckltbWVkaWF0ZSwKICAgICAgICAgIGIgPSBsLk1lc3NhZ2VDaGFubmVsLAogICAgICAgICAgaCA9IDAsCiAgICAgICAgICB2ID0ge30sCiAgICAgICAgICB5ID0gIm9ucmVhZHlzdGF0ZWNoYW5nZSIsCiAgICAgICAgICBfID0gZnVuY3Rpb24gXygpIHsKICAgICAgICB2YXIgZSA9ICt0aGlzO2lmICh2Lmhhc093blByb3BlcnR5KGUpKSB7CiAgICAgICAgICB2YXIgdCA9IHZbZV07ZGVsZXRlIHZbZV0sIHQoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBnID0gZnVuY3Rpb24gZyhlKSB7CiAgICAgICAgXy5jYWxsKGUuZGF0YSk7CiAgICAgIH07ZCAmJiBwIHx8IChkID0gZnVuY3Rpb24gZChlKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLCByID0gMTsgYXJndW1lbnRzLmxlbmd0aCA+IHI7KSB7CiAgICAgICAgICB0LnB1c2goYXJndW1lbnRzW3IrK10pOwogICAgICAgIH1yZXR1cm4gdlsrK2hdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgYSgiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZSA6IEZ1bmN0aW9uKGUpLCB0KTsKICAgICAgICB9LCBuKGgpLCBoOwogICAgICB9LCBwID0gZnVuY3Rpb24gcChlKSB7CiAgICAgICAgZGVsZXRlIHZbZV07CiAgICAgIH0sICJwcm9jZXNzIiA9PSBlKCIuLyQuY29mIikoZikgPyBuID0gZnVuY3Rpb24gbihlKSB7CiAgICAgICAgZi5uZXh0VGljayhzKF8sIGUsIDEpKTsKICAgICAgfSA6IGIgPyAobyA9IG5ldyBiKCksIGkgPSBvLnBvcnQyLCBvLnBvcnQxLm9ubWVzc2FnZSA9IGcsIG4gPSBzKGkucG9zdE1lc3NhZ2UsIGksIDEpKSA6IGwuYWRkRXZlbnRMaXN0ZW5lciAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBwb3N0TWVzc2FnZSAmJiAhbC5pbXBvcnRTY3JpcHRzID8gKG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBsLnBvc3RNZXNzYWdlKGUgKyAiIiwgIioiKTsKICAgICAgfSwgbC5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgZywgITEpKSA6IG4gPSB5IGluIHUoInNjcmlwdCIpID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICBjLmFwcGVuZENoaWxkKHUoInNjcmlwdCIpKVt5XSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGMucmVtb3ZlQ2hpbGQodGhpcyksIF8uY2FsbChlKTsKICAgICAgICB9OwogICAgICB9IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICBzZXRUaW1lb3V0KHMoXywgZSwgMSksIDApOwogICAgICB9KSwgdC5leHBvcnRzID0geyBzZXQ6IGQsIGNsZWFyOiBwIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAsICIuLyQuY3R4IjogMzIsICIuLyQuZG9tLWNyZWF0ZSI6IDM1LCAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLmh0bWwiOiA0NCwgIi4vJC5pbnZva2UiOiA0NSB9XSwgNzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IE1hdGguY2VpbCwKICAgICAgICAgIG8gPSBNYXRoLmZsb29yO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGUgPSArZSkgPyAwIDogKGUgPiAwID8gbyA6IG4pKGUpOwogICAgICB9OwogICAgfSwge31dLCA3NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG4obyhlKSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuZGVmaW5lZCI6IDMzLCAiLi8kLmlvYmplY3QiOiA0NiB9XSwgNzU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1pbnRlZ2VyIiksCiAgICAgICAgICBvID0gTWF0aC5taW47dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSA+IDAgPyBvKG4oZSksIDkwMDcxOTkyNTQ3NDA5OTEpIDogMDsKICAgICAgfTsKICAgIH0sIHsgIi4vJC50by1pbnRlZ2VyIjogNzMgfV0sIDc2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdChuKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMgfV0sIDc3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSAwLAogICAgICAgICAgbyA9IE1hdGgucmFuZG9tKCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN5bWJvbCgiLmNvbmNhdCh2b2lkIDAgPT09IGUgPyAiIiA6IGUsICIpXyIsICgrK24gKyBvKS50b1N0cmluZygzNikpOwogICAgICB9OwogICAgfSwge31dLCA3ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnNoYXJlZCIpKCJ3a3MiKSwKICAgICAgICAgIG8gPSBlKCIuLyQudWlkIiksCiAgICAgICAgICBpID0gZSgiLi8kLmdsb2JhbCIpLlN5bWJvbDt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuW2VdIHx8IChuW2VdID0gaSAmJiBpW2VdIHx8IChpIHx8IG8pKCJTeW1ib2wuIiArIGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5zaGFyZWQiOiA2OCwgIi4vJC51aWQiOiA3NyB9XSwgNzk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5jbGFzc29mIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IGUoIi4vJC5pdGVyYXRvcnMiKTt0LmV4cG9ydHMgPSBlKCIuLyQuY29yZSIpLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9IGUgPyBlW29dIHx8IGVbIkBAaXRlcmF0b3IiXSB8fCBpW24oZSldIDogdm9pZCAwOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNsYXNzb2YiOiAyOSwgIi4vJC5jb3JlIjogMzEsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQud2tzIjogNzggfV0sIDgwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5hZGQtdG8tdW5zY29wYWJsZXMiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuaXRlci1zdGVwIiksCiAgICAgICAgICBpID0gZSgiLi8kLml0ZXJhdG9ycyIpLAogICAgICAgICAgcyA9IGUoIi4vJC50by1pb2JqZWN0Iik7dC5leHBvcnRzID0gZSgiLi8kLml0ZXItZGVmaW5lIikoQXJyYXksICJBcnJheSIsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdGhpcy5fdCA9IHMoZSksIHRoaXMuX2kgPSAwLCB0aGlzLl9rID0gdDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gdGhpcy5fdCwKICAgICAgICAgICAgdCA9IHRoaXMuX2ssCiAgICAgICAgICAgIHIgPSB0aGlzLl9pKys7cmV0dXJuICFlIHx8IHIgPj0gZS5sZW5ndGggPyAodGhpcy5fdCA9IHZvaWQgMCwgbygxKSkgOiAia2V5cyIgPT0gdCA/IG8oMCwgcikgOiAidmFsdWVzIiA9PSB0ID8gbygwLCBlW3JdKSA6IG8oMCwgW3IsIGVbcl1dKTsKICAgICAgfSwgInZhbHVlcyIpLCBpLkFyZ3VtZW50cyA9IGkuQXJyYXksIG4oImtleXMiKSwgbigidmFsdWVzIiksIG4oImVudHJpZXMiKTsKICAgIH0sIHsgIi4vJC5hZGQtdG8tdW5zY29wYWJsZXMiOiAyNywgIi4vJC5pdGVyLWRlZmluZSI6IDUyLCAiLi8kLml0ZXItc3RlcCI6IDU0LCAiLi8kLml0ZXJhdG9ycyI6IDU1LCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgODE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1pb2JqZWN0Iik7ZSgiLi8kLm9iamVjdC1zYXAiKSgiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHJldHVybiBlKG4odCksIHIpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgfSwgeyAiLi8kLm9iamVjdC1zYXAiOiA2MCwgIi4vJC50by1pb2JqZWN0IjogNzQgfV0sIDgyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQudG8tb2JqZWN0Iik7ZSgiLi8kLm9iamVjdC1zYXAiKSgiZ2V0UHJvdG90eXBlT2YiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUobih0KSk7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQub2JqZWN0LXNhcCI6IDYwLCAiLi8kLnRvLW9iamVjdCI6IDc2IH1dLCA4MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLW9iamVjdCIpO2UoIi4vJC5vYmplY3Qtc2FwIikoImtleXMiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUobih0KSk7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQub2JqZWN0LXNhcCI6IDYwLCAiLi8kLnRvLW9iamVjdCI6IDc2IH1dLCA4NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmV4cG9ydCIpO24obi5TLCAiT2JqZWN0IiwgeyBzZXRQcm90b3R5cGVPZjogZSgiLi8kLnNldC1wcm90byIpLnNldCB9KTsKICAgIH0sIHsgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5zZXQtcHJvdG8iOiA2NSB9XSwgODU6IFtmdW5jdGlvbiAoZSwgdCwgcikge30sIHt9XSwgODY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuLAogICAgICAgICAgbyA9IGUoIi4vJCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5saWJyYXJ5IiksCiAgICAgICAgICBzID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgYSA9IGUoIi4vJC5jdHgiKSwKICAgICAgICAgIGMgPSBlKCIuLyQuY2xhc3NvZiIpLAogICAgICAgICAgdSA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIGwgPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBmID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgZCA9IGUoIi4vJC5hLWZ1bmN0aW9uIiksCiAgICAgICAgICBwID0gZSgiLi8kLnN0cmljdC1uZXciKSwKICAgICAgICAgIGIgPSBlKCIuLyQuZm9yLW9mIiksCiAgICAgICAgICBoID0gZSgiLi8kLnNldC1wcm90byIpLnNldCwKICAgICAgICAgIHYgPSBlKCIuLyQuc2FtZS12YWx1ZSIpLAogICAgICAgICAgeSA9IGUoIi4vJC53a3MiKSgic3BlY2llcyIpLAogICAgICAgICAgXyA9IGUoIi4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yIiksCiAgICAgICAgICBnID0gZSgiLi8kLm1pY3JvdGFzayIpLAogICAgICAgICAgbSA9ICJQcm9taXNlIiwKICAgICAgICAgIGogPSBzLnByb2Nlc3MsCiAgICAgICAgICAkID0gInByb2Nlc3MiID09IGMoaiksCiAgICAgICAgICBfTyA9IHNbbV0sCiAgICAgICAgICB3ID0gZnVuY3Rpb24gdyhlKSB7CiAgICAgICAgdmFyIHQgPSBuZXcgX08oZnVuY3Rpb24gKCkge30pO3JldHVybiBlICYmICh0LmNvbnN0cnVjdG9yID0gT2JqZWN0KSwgX08ucmVzb2x2ZSh0KSA9PT0gdDsKICAgICAgfSwKICAgICAgICAgIGsgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gdChlKSB7CiAgICAgICAgICB2YXIgciA9IG5ldyBfTyhlKTtyZXR1cm4gaChyLCB0LnByb3RvdHlwZSksIHI7CiAgICAgICAgfXZhciByID0gITE7dHJ5IHsKICAgICAgICAgIGlmIChyID0gX08gJiYgX08ucmVzb2x2ZSAmJiB3KCksIGgodCwgX08pLCB0LnByb3RvdHlwZSA9IG8uY3JlYXRlKF9PLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogdCB9IH0pLCB0LnJlc29sdmUoNSkudGhlbihmdW5jdGlvbiAoKSB7fSkgaW5zdGFuY2VvZiB0IHx8IChyID0gITEpLCByICYmIGUoIi4vJC5kZXNjcmlwdG9ycyIpKSB7CiAgICAgICAgICAgIHZhciBuID0gITE7X08ucmVzb2x2ZShvLnNldERlc2Moe30sICJ0aGVuIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgICAgIG4gPSAhMDsKICAgICAgICAgICAgICB9IH0pKSwgciA9IG47CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgciA9ICExOwogICAgICAgIH1yZXR1cm4gcjsKICAgICAgfSgpLAogICAgICAgICAgeCA9IGZ1bmN0aW9uIHgoZSwgdCkgewogICAgICAgIHJldHVybiBpICYmIGUgPT09IF9PICYmIHQgPT09IG4gPyAhMCA6IHYoZSwgdCk7CiAgICAgIH0sCiAgICAgICAgICBDID0gZnVuY3Rpb24gQyhlKSB7CiAgICAgICAgdmFyIHQgPSBmKGUpW3ldO3JldHVybiB2b2lkIDAgIT0gdCA/IHQgOiBlOwogICAgICB9LAogICAgICAgICAgRSA9IGZ1bmN0aW9uIEUoZSkgewogICAgICAgIHZhciB0O3JldHVybiBsKGUpICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mICh0ID0gZS50aGVuKSA/IHQgOiAhMTsKICAgICAgfSwKICAgICAgICAgIFMgPSBmdW5jdGlvbiBTKGUpIHsKICAgICAgICB2YXIgdCwgcjt0aGlzLnByb21pc2UgPSBuZXcgZShmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCB8fCB2b2lkIDAgIT09IHIpIHRocm93IFR5cGVFcnJvcigiQmFkIFByb21pc2UgY29uc3RydWN0b3IiKTt0ID0gZSwgciA9IG47CiAgICAgICAgfSksIHRoaXMucmVzb2x2ZSA9IGQodCksIHRoaXMucmVqZWN0ID0gZChyKTsKICAgICAgfSwKICAgICAgICAgIFQgPSBmdW5jdGlvbiBUKGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgZSgpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiB7IGVycm9yOiB0IH07CiAgICAgICAgfQogICAgICB9LAogICAgICAgICAgTSA9IGZ1bmN0aW9uIE0oZSwgdCkgewogICAgICAgIGlmICghZS5uKSB7CiAgICAgICAgICBlLm4gPSAhMDt2YXIgciA9IGUuYztnKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IGUudiwgbyA9IDEgPT0gZS5zLCBpID0gMCwgYSA9IGZ1bmN0aW9uIGEodCkgewogICAgICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICBzID0gbyA/IHQub2sgOiB0LmZhaWwsCiAgICAgICAgICAgICAgICAgIGEgPSB0LnJlc29sdmUsCiAgICAgICAgICAgICAgICAgIGMgPSB0LnJlamVjdDt0cnkgewogICAgICAgICAgICAgICAgcyA/IChvIHx8IChlLmggPSAhMCksIHIgPSBzID09PSAhMCA/IG4gOiBzKG4pLCByID09PSB0LnByb21pc2UgPyBjKFR5cGVFcnJvcigiUHJvbWlzZS1jaGFpbiBjeWNsZSIpKSA6IChpID0gRShyKSkgPyBpLmNhbGwociwgYSwgYykgOiBhKHIpKSA6IGMobik7CiAgICAgICAgICAgICAgfSBjYXRjaCAodSkgewogICAgICAgICAgICAgICAgYyh1KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07IHIubGVuZ3RoID4gaTspIHsKICAgICAgICAgICAgICBhKHJbaSsrXSk7CiAgICAgICAgICAgIH1yLmxlbmd0aCA9IDAsIGUubiA9ICExLCB0ICYmIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciB0LAogICAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgICBvID0gZS5wO04obykgJiYgKCQgPyBqLmVtaXQoInVuaGFuZGxlZFJlamVjdGlvbiIsIG4sIG8pIDogKHQgPSBzLm9udW5oYW5kbGVkcmVqZWN0aW9uKSA/IHQoeyBwcm9taXNlOiBvLCByZWFzb246IG4gfSkgOiAociA9IHMuY29uc29sZSkgJiYgci5lcnJvciAmJiByLmVycm9yKCJVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24iLCBuKSksIGUuYSA9IHZvaWQgMDsKICAgICAgICAgICAgfSwgMSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBOID0gZnVuY3Rpb24gTihlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIHIgPSBlLl9kLAogICAgICAgICAgICBuID0gci5hIHx8IHIuYywKICAgICAgICAgICAgbyA9IDA7aWYgKHIuaCkgcmV0dXJuICExO2ZvciAoOyBuLmxlbmd0aCA+IG87KSB7CiAgICAgICAgICBpZiAodCA9IG5bbysrXSwgdC5mYWlsIHx8ICFOKHQucHJvbWlzZSkpIHJldHVybiAhMTsKICAgICAgICB9cmV0dXJuICEwOwogICAgICB9LAogICAgICAgICAgUiA9IGZ1bmN0aW9uIFIoZSkgewogICAgICAgIHZhciB0ID0gdGhpczt0LmQgfHwgKHQuZCA9ICEwLCB0ID0gdC5yIHx8IHQsIHQudiA9IGUsIHQucyA9IDIsIHQuYSA9IHQuYy5zbGljZSgpLCBNKHQsICEwKSk7CiAgICAgIH0sCiAgICAgICAgICBEID0gZnVuY3Rpb24gRChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIHIgPSB0aGlzO2lmICghci5kKSB7CiAgICAgICAgICByLmQgPSAhMCwgciA9IHIuciB8fCByO3RyeSB7CiAgICAgICAgICAgIGlmIChyLnAgPT09IGUpIHRocm93IFR5cGVFcnJvcigiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsodCA9IEUoZSkpID8gZyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7IHI6IHIsIGQ6ICExIH07dHJ5IHsKICAgICAgICAgICAgICAgIHQuY2FsbChlLCBhKEQsIG4sIDEpLCBhKFIsIG4sIDEpKTsKICAgICAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgICAgICBSLmNhbGwobiwgbyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSA6IChyLnYgPSBlLCByLnMgPSAxLCBNKHIsICExKSk7CiAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgIFIuY2FsbCh7IHI6IHIsIGQ6ICExIH0sIG4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTtrIHx8IChfTyA9IGZ1bmN0aW9uIE8oZSkgewogICAgICAgIGQoZSk7dmFyIHQgPSB0aGlzLl9kID0geyBwOiBwKHRoaXMsIF9PLCBtKSwgYzogW10sIGE6IHZvaWQgMCwgczogMCwgZDogITEsIHY6IHZvaWQgMCwgaDogITEsIG46ICExIH07dHJ5IHsKICAgICAgICAgIGUoYShELCB0LCAxKSwgYShSLCB0LCAxKSk7CiAgICAgICAgfSBjYXRjaCAocikgewogICAgICAgICAgUi5jYWxsKHQsIHIpOwogICAgICAgIH0KICAgICAgfSwgZSgiLi8kLnJlZGVmaW5lLWFsbCIpKF9PLnByb3RvdHlwZSwgeyB0aGVuOiBmdW5jdGlvbiB0aGVuKGUsIHQpIHsKICAgICAgICAgIHZhciByID0gbmV3IFMoXyh0aGlzLCBfTykpLAogICAgICAgICAgICAgIG4gPSByLnByb21pc2UsCiAgICAgICAgICAgICAgbyA9IHRoaXMuX2Q7cmV0dXJuIHIub2sgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZSA6ICEwLCByLmZhaWwgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQsIG8uYy5wdXNoKHIpLCBvLmEgJiYgby5hLnB1c2gociksIG8ucyAmJiBNKG8sICExKSwgbjsKICAgICAgICB9LCAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2goZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMudGhlbih2b2lkIDAsIGUpOwogICAgICAgIH0gfSkpLCB1KHUuRyArIHUuVyArIHUuRiAqICFrLCB7IFByb21pc2U6IF9PIH0pLCBlKCIuLyQuc2V0LXRvLXN0cmluZy10YWciKShfTywgbSksIGUoIi4vJC5zZXQtc3BlY2llcyIpKG0pLCBuID0gZSgiLi8kLmNvcmUiKVttXSwgdSh1LlMgKyB1LkYgKiAhaywgbSwgeyByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChlKSB7CiAgICAgICAgICB2YXIgdCA9IG5ldyBTKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlamVjdDtyZXR1cm4gcihlKSwgdC5wcm9taXNlOwogICAgICAgIH0gfSksIHUodS5TICsgdS5GICogKCFrIHx8IHcoITApKSwgbSwgeyByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKGUpIHsKICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX08gJiYgeChlLmNvbnN0cnVjdG9yLCB0aGlzKSkgcmV0dXJuIGU7dmFyIHQgPSBuZXcgUyh0aGlzKSwKICAgICAgICAgICAgICByID0gdC5yZXNvbHZlO3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgdSh1LlMgKyB1LkYgKiAhKGsgJiYgZSgiLi8kLml0ZXItZGV0ZWN0IikoZnVuY3Rpb24gKGUpIHsKICAgICAgICBfTy5hbGwoZSlbImNhdGNoIl0oZnVuY3Rpb24gKCkge30pOwogICAgICB9KSksIG0sIHsgYWxsOiBmdW5jdGlvbiBhbGwoZSkgewogICAgICAgICAgdmFyIHQgPSBDKHRoaXMpLAogICAgICAgICAgICAgIHIgPSBuZXcgUyh0KSwKICAgICAgICAgICAgICBuID0gci5yZXNvbHZlLAogICAgICAgICAgICAgIGkgPSByLnJlamVjdCwKICAgICAgICAgICAgICBzID0gW10sCiAgICAgICAgICAgICAgYSA9IFQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBiKGUsICExLCBzLnB1c2gsIHMpO3ZhciByID0gcy5sZW5ndGgsCiAgICAgICAgICAgICAgICBhID0gQXJyYXkocik7ciA/IG8uZWFjaC5jYWxsKHMsIGZ1bmN0aW9uIChlLCBvKSB7CiAgICAgICAgICAgICAgdmFyIHMgPSAhMTt0LnJlc29sdmUoZSkudGhlbihmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcyB8fCAocyA9ICEwLCBhW29dID0gZSwgLS1yIHx8IG4oYSkpOwogICAgICAgICAgICAgIH0sIGkpOwogICAgICAgICAgICB9KSA6IG4oYSk7CiAgICAgICAgICB9KTtyZXR1cm4gYSAmJiBpKGEuZXJyb3IpLCByLnByb21pc2U7CiAgICAgICAgfSwgcmFjZTogZnVuY3Rpb24gcmFjZShlKSB7CiAgICAgICAgICB2YXIgdCA9IEModGhpcyksCiAgICAgICAgICAgICAgciA9IG5ldyBTKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlamVjdCwKICAgICAgICAgICAgICBvID0gVChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGIoZSwgITEsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdC5yZXNvbHZlKGUpLnRoZW4oci5yZXNvbHZlLCBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTtyZXR1cm4gbyAmJiBuKG8uZXJyb3IpLCByLnByb21pc2U7CiAgICAgICAgfSB9KTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmEtZnVuY3Rpb24iOiAyNiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jbGFzc29mIjogMjksICIuLyQuY29yZSI6IDMxLCAiLi8kLmN0eCI6IDMyLCAiLi8kLmRlc2NyaXB0b3JzIjogMzQsICIuLyQuZXhwb3J0IjogMzcsICIuLyQuZm9yLW9mIjogMzksICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaXMtb2JqZWN0IjogNDksICIuLyQuaXRlci1kZXRlY3QiOiA1MywgIi4vJC5saWJyYXJ5IjogNTgsICIuLyQubWljcm90YXNrIjogNTksICIuLyQucmVkZWZpbmUtYWxsIjogNjIsICIuLyQuc2FtZS12YWx1ZSI6IDY0LCAiLi8kLnNldC1wcm90byI6IDY1LCAiLi8kLnNldC1zcGVjaWVzIjogNjYsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yIjogNjksICIuLyQuc3RyaWN0LW5ldyI6IDcwLCAiLi8kLndrcyI6IDc4IH1dLCA4NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuLyQuc3RyaW5nLWF0IikoITApO2UoIi4vJC5pdGVyLWRlZmluZSIpKFN0cmluZywgIlN0cmluZyIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5fdCA9IFN0cmluZyhlKSwgdGhpcy5faSA9IDA7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgdCA9IHRoaXMuX3QsCiAgICAgICAgICAgIHIgPSB0aGlzLl9pO3JldHVybiByID49IHQubGVuZ3RoID8geyB2YWx1ZTogdm9pZCAwLCBkb25lOiAhMCB9IDogKGUgPSBuKHQsIHIpLCB0aGlzLl9pICs9IGUubGVuZ3RoLCB7IHZhbHVlOiBlLCBkb25lOiAhMSB9KTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQuaXRlci1kZWZpbmUiOiA1MiwgIi4vJC5zdHJpbmctYXQiOiA3MSB9XSwgODg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kIiksCiAgICAgICAgICBvID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5oYXMiKSwKICAgICAgICAgIHMgPSBlKCIuLyQuZGVzY3JpcHRvcnMiKSwKICAgICAgICAgIGEgPSBlKCIuLyQuZXhwb3J0IiksCiAgICAgICAgICBjID0gZSgiLi8kLnJlZGVmaW5lIiksCiAgICAgICAgICB1ID0gZSgiLi8kLmZhaWxzIiksCiAgICAgICAgICBsID0gZSgiLi8kLnNoYXJlZCIpLAogICAgICAgICAgZiA9IGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgZCA9IGUoIi4vJC51aWQiKSwKICAgICAgICAgIHAgPSBlKCIuLyQud2tzIiksCiAgICAgICAgICBiID0gZSgiLi8kLmtleW9mIiksCiAgICAgICAgICBoID0gZSgiLi8kLmdldC1uYW1lcyIpLAogICAgICAgICAgdiA9IGUoIi4vJC5lbnVtLWtleXMiKSwKICAgICAgICAgIHkgPSBlKCIuLyQuaXMtYXJyYXkiKSwKICAgICAgICAgIF8gPSBlKCIuLyQuYW4tb2JqZWN0IiksCiAgICAgICAgICBnID0gZSgiLi8kLnRvLWlvYmplY3QiKSwKICAgICAgICAgIG0gPSBlKCIuLyQucHJvcGVydHktZGVzYyIpLAogICAgICAgICAgaiA9IG4uZ2V0RGVzYywKICAgICAgICAgICQgPSBuLnNldERlc2MsCiAgICAgICAgICBPID0gbi5jcmVhdGUsCiAgICAgICAgICB3ID0gaC5nZXQsCiAgICAgICAgICBrID0gby5TeW1ib2wsCiAgICAgICAgICB4ID0gby5KU09OLAogICAgICAgICAgQyA9IHggJiYgeC5zdHJpbmdpZnksCiAgICAgICAgICBFID0gITEsCiAgICAgICAgICBTID0gcCgiX2hpZGRlbiIpLAogICAgICAgICAgVCA9IG4uaXNFbnVtLAogICAgICAgICAgTSA9IGwoInN5bWJvbC1yZWdpc3RyeSIpLAogICAgICAgICAgTiA9IGwoInN5bWJvbHMiKSwKICAgICAgICAgIFIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBrLAogICAgICAgICAgRCA9IE9iamVjdC5wcm90b3R5cGUsCiAgICAgICAgICBQID0gcyAmJiB1KGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPKCQoe30sICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuICQodGhpcywgImEiLCB7IHZhbHVlOiA3IH0pLmE7CiAgICAgICAgICB9IH0pKS5hOwogICAgICB9KSA/IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgdmFyIG4gPSBqKEQsIHQpO24gJiYgZGVsZXRlIERbdF0sICQoZSwgdCwgciksIG4gJiYgZSAhPT0gRCAmJiAkKEQsIHQsIG4pOwogICAgICB9IDogJCwKICAgICAgICAgIEEgPSBmdW5jdGlvbiBBKGUpIHsKICAgICAgICB2YXIgdCA9IE5bZV0gPSBPKGsucHJvdG90eXBlKTtyZXR1cm4gdC5fayA9IGUsIHMgJiYgRSAmJiBQKEQsIGUsIHsgY29uZmlndXJhYmxlOiAhMCwgc2V0OiBmdW5jdGlvbiBzZXQodCkgewogICAgICAgICAgICBpKHRoaXMsIFMpICYmIGkodGhpc1tTXSwgZSkgJiYgKHRoaXNbU11bZV0gPSAhMSksIFAodGhpcywgZSwgbSgxLCB0KSk7CiAgICAgICAgICB9IH0pLCB0OwogICAgICB9LAogICAgICAgICAgTCA9IGZ1bmN0aW9uIEwoZSkgewogICAgICAgIHJldHVybiAic3ltYm9sIiA9PSAodHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpKTsKICAgICAgfSwKICAgICAgICAgIEkgPSBmdW5jdGlvbiBJKGUsIHQsIHIpIHsKICAgICAgICByZXR1cm4gciAmJiBpKE4sIHQpID8gKHIuZW51bWVyYWJsZSA/IChpKGUsIFMpICYmIGVbU11bdF0gJiYgKGVbU11bdF0gPSAhMSksIHIgPSBPKHIsIHsgZW51bWVyYWJsZTogbSgwLCAhMSkgfSkpIDogKGkoZSwgUykgfHwgJChlLCBTLCBtKDEsIHt9KSksIGVbU11bdF0gPSAhMCksIFAoZSwgdCwgcikpIDogJChlLCB0LCByKTsKICAgICAgfSwKICAgICAgICAgIEYgPSBmdW5jdGlvbiBGKGUsIHQpIHsKICAgICAgICBfKGUpO2ZvciAodmFyIHIsIG4gPSB2KHQgPSBnKHQpKSwgbyA9IDAsIGkgPSBuLmxlbmd0aDsgaSA+IG87KSB7CiAgICAgICAgICBJKGUsIHIgPSBuW28rK10sIHRbcl0pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfSwKICAgICAgICAgIFYgPSBmdW5jdGlvbiBWKGUsIHQpIHsKICAgICAgICByZXR1cm4gdm9pZCAwID09PSB0ID8gTyhlKSA6IEYoTyhlKSwgdCk7CiAgICAgIH0sCiAgICAgICAgICB6ID0gZnVuY3Rpb24geihlKSB7CiAgICAgICAgdmFyIHQgPSBULmNhbGwodGhpcywgZSk7cmV0dXJuIHQgfHwgIWkodGhpcywgZSkgfHwgIWkoTiwgZSkgfHwgaSh0aGlzLCBTKSAmJiB0aGlzW1NdW2VdID8gdCA6ICEwOwogICAgICB9LAogICAgICAgICAgVSA9IGZ1bmN0aW9uIFUoZSwgdCkgewogICAgICAgIHZhciByID0gaihlID0gZyhlKSwgdCk7cmV0dXJuICFyIHx8ICFpKE4sIHQpIHx8IGkoZSwgUykgJiYgZVtTXVt0XSB8fCAoci5lbnVtZXJhYmxlID0gITApLCByOwogICAgICB9LAogICAgICAgICAgSCA9IGZ1bmN0aW9uIEgoZSkgewogICAgICAgIGZvciAodmFyIHQsIHIgPSB3KGcoZSkpLCBuID0gW10sIG8gPSAwOyByLmxlbmd0aCA+IG87KSB7CiAgICAgICAgICBpKE4sIHQgPSByW28rK10pIHx8IHQgPT0gUyB8fCBuLnB1c2godCk7CiAgICAgICAgfXJldHVybiBuOwogICAgICB9LAogICAgICAgICAgQiA9IGZ1bmN0aW9uIEIoZSkgewogICAgICAgIGZvciAodmFyIHQsIHIgPSB3KGcoZSkpLCBuID0gW10sIG8gPSAwOyByLmxlbmd0aCA+IG87KSB7CiAgICAgICAgICBpKE4sIHQgPSByW28rK10pICYmIG4ucHVzaChOW3RdKTsKICAgICAgICB9cmV0dXJuIG47CiAgICAgIH0sCiAgICAgICAgICBKID0gZnVuY3Rpb24gSihlKSB7CiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSAmJiAhTChlKSkgewogICAgICAgICAgZm9yICh2YXIgdCwgciwgbiA9IFtlXSwgbyA9IDEsIGkgPSBhcmd1bWVudHM7IGkubGVuZ3RoID4gbzspIHsKICAgICAgICAgICAgbi5wdXNoKGlbbysrXSk7CiAgICAgICAgICB9cmV0dXJuIHQgPSBuWzFdLCAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIChyID0gdCksICFyICYmIHkodCkgfHwgKHQgPSBmdW5jdGlvbiB0KGUsIF90MikgewogICAgICAgICAgICByZXR1cm4gciAmJiAoX3QyID0gci5jYWxsKHRoaXMsIGUsIF90MikpLCBMKF90MikgPyB2b2lkIDAgOiBfdDI7CiAgICAgICAgICB9KSwgblsxXSA9IHQsIEMuYXBwbHkoeCwgbik7CiAgICAgICAgfQogICAgICB9LAogICAgICAgICAgVyA9IHUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gaygpO3JldHVybiAiW251bGxdIiAhPSBDKFtlXSkgfHwgInt9IiAhPSBDKHsgYTogZSB9KSB8fCAie30iICE9IEMoT2JqZWN0KGUpKTsKICAgICAgfSk7UiB8fCAoayA9IGZ1bmN0aW9uIGsoKSB7CiAgICAgICAgaWYgKEwodGhpcykpIHRocm93IFR5cGVFcnJvcigiU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yIik7cmV0dXJuIEEoZChhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHZvaWQgMCkpOwogICAgICB9LCBjKGsucHJvdG90eXBlLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2s7CiAgICAgIH0pLCBMID0gZnVuY3Rpb24gTChlKSB7CiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBrOwogICAgICB9LCBuLmNyZWF0ZSA9IFYsIG4uaXNFbnVtID0geiwgbi5nZXREZXNjID0gVSwgbi5zZXREZXNjID0gSSwgbi5zZXREZXNjcyA9IEYsIG4uZ2V0TmFtZXMgPSBoLmdldCA9IEgsIG4uZ2V0U3ltYm9scyA9IEIsIHMgJiYgIWUoIi4vJC5saWJyYXJ5IikgJiYgYyhELCAicHJvcGVydHlJc0VudW1lcmFibGUiLCB6LCAhMCkpO3ZhciBZID0geyAiZm9yIjogZnVuY3Rpb24gX2ZvcihlKSB7CiAgICAgICAgICByZXR1cm4gaShNLCBlICs9ICIiKSA/IE1bZV0gOiBNW2VdID0gayhlKTsKICAgICAgICB9LCBrZXlGb3I6IGZ1bmN0aW9uIGtleUZvcihlKSB7CiAgICAgICAgICByZXR1cm4gYihNLCBlKTsKICAgICAgICB9LCB1c2VTZXR0ZXI6IGZ1bmN0aW9uIHVzZVNldHRlcigpIHsKICAgICAgICAgIEUgPSAhMDsKICAgICAgICB9LCB1c2VTaW1wbGU6IGZ1bmN0aW9uIHVzZVNpbXBsZSgpIHsKICAgICAgICAgIEUgPSAhMTsKICAgICAgICB9IH07bi5lYWNoLmNhbGwoImhhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCxzcGVjaWVzLHNwbGl0LHRvUHJpbWl0aXZlLHRvU3RyaW5nVGFnLHVuc2NvcGFibGVzIi5zcGxpdCgiLCIpLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gcChlKTtZW2VdID0gUiA/IHQgOiBBKHQpOwogICAgICB9KSwgRSA9ICEwLCBhKGEuRyArIGEuVywgeyBTeW1ib2w6IGsgfSksIGEoYS5TLCAiU3ltYm9sIiwgWSksIGEoYS5TICsgYS5GICogIVIsICJPYmplY3QiLCB7IGNyZWF0ZTogViwgZGVmaW5lUHJvcGVydHk6IEksIGRlZmluZVByb3BlcnRpZXM6IEYsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogVSwgZ2V0T3duUHJvcGVydHlOYW1lczogSCwgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBCIH0pLCB4ICYmIGEoYS5TICsgYS5GICogKCFSIHx8IFcpLCAiSlNPTiIsIHsgc3RyaW5naWZ5OiBKIH0pLCBmKGssICJTeW1ib2wiKSwgZihNYXRoLCAiTWF0aCIsICEwKSwgZihvLkpTT04sICJKU09OIiwgITApOwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuYW4tb2JqZWN0IjogMjgsICIuLyQuZGVzY3JpcHRvcnMiOiAzNCwgIi4vJC5lbnVtLWtleXMiOiAzNiwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mYWlscyI6IDM4LCAiLi8kLmdldC1uYW1lcyI6IDQwLCAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLmhhcyI6IDQyLCAiLi8kLmlzLWFycmF5IjogNDgsICIuLyQua2V5b2YiOiA1NywgIi4vJC5saWJyYXJ5IjogNTgsICIuLyQucHJvcGVydHktZGVzYyI6IDYxLCAiLi8kLnJlZGVmaW5lIjogNjMsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC5zaGFyZWQiOiA2OCwgIi4vJC50by1pb2JqZWN0IjogNzQsICIuLyQudWlkIjogNzcsICIuLyQud2tzIjogNzggfV0sIDg5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi9lczYuYXJyYXkuaXRlcmF0b3IiKTt2YXIgbiA9IGUoIi4vJC5pdGVyYXRvcnMiKTtuLk5vZGVMaXN0ID0gbi5IVE1MQ29sbGVjdGlvbiA9IG4uQXJyYXk7CiAgICB9LCB7ICIuLyQuaXRlcmF0b3JzIjogNTUsICIuL2VzNi5hcnJheS5pdGVyYXRvciI6IDgwIH1dLCA5MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUpIHsKICAgICAgICAgIHRoaXMuZyA9IFtdLCB0aGlzLmsgPSBlOwogICAgICAgIH1mdW5jdGlvbiByKGUpIHsKICAgICAgICAgICFmdW5jdGlvbiByKCkgewogICAgICAgICAgICB2YXIgbiA9IGUudGFrZVJlY29yZHMoKTtuLmxlbmd0aCAmJiBlLmsobiwgZSksIGUuZiA9IHNldFRpbWVvdXQociwgdC5fcGVyaW9kKTsKICAgICAgICAgIH0oKTsKICAgICAgICB9ZnVuY3Rpb24gbih0KSB7CiAgICAgICAgICB2YXIgciwKICAgICAgICAgICAgICBuID0geyB0eXBlOiBudWxsLCB0YXJnZXQ6IG51bGwsIGFkZGVkTm9kZXM6IFtdLCByZW1vdmVkTm9kZXM6IFtdLCBwcmV2aW91c1NpYmxpbmc6IG51bGwsIG5leHRTaWJsaW5nOiBudWxsLCBhdHRyaWJ1dGVOYW1lOiBudWxsLCBhdHRyaWJ1dGVOYW1lc3BhY2U6IG51bGwsIG9sZFZhbHVlOiBudWxsIH07Zm9yIChyIGluIHQpIHsKICAgICAgICAgICAgbltyXSAhPT0gZSAmJiB0W3JdICE9PSBlICYmIChuW3JdID0gdFtyXSk7CiAgICAgICAgICB9cmV0dXJuIG47CiAgICAgICAgfWZ1bmN0aW9uIG8oZSwgdCkgewogICAgICAgICAgdmFyIHIgPSBhKGUsIHQpO3JldHVybiBmdW5jdGlvbiAobikgewogICAgICAgICAgICB2YXIgbywKICAgICAgICAgICAgICAgIGMgPSBuLmxlbmd0aDt0LmEgJiYgci5hICYmIGkobiwgZSwgci5hLCB0LmQpLCAodC5iIHx8IHQuZSkgJiYgKG8gPSBzKG4sIGUsIHIsIHQpKSwgKG8gfHwgbi5sZW5ndGggIT09IGMpICYmIChyID0gYShlLCB0KSk7CiAgICAgICAgICB9OwogICAgICAgIH1mdW5jdGlvbiBpKHQsIHIsIG8sIGkpIHsKICAgICAgICAgIGZvciAodmFyIHMsIGEsIGMgPSB7fSwgdSA9IHIuYXR0cmlidXRlcywgbCA9IHUubGVuZ3RoOyBsLS07KSB7CiAgICAgICAgICAgIHMgPSB1W2xdLCBhID0gcy5uYW1lLCBpICYmIGlbYV0gPT09IGUgfHwgKHMudmFsdWUgIT09IG9bYV0gJiYgdC5wdXNoKG4oeyB0eXBlOiAiYXR0cmlidXRlcyIsIHRhcmdldDogciwgYXR0cmlidXRlTmFtZTogYSwgb2xkVmFsdWU6IG9bYV0sIGF0dHJpYnV0ZU5hbWVzcGFjZTogcy5uYW1lc3BhY2VVUkkgfSkpLCBjW2FdID0gITApOwogICAgICAgICAgfWZvciAoYSBpbiBvKSB7CiAgICAgICAgICAgIGNbYV0gfHwgdC5wdXNoKG4oeyB0YXJnZXQ6IHIsIHR5cGU6ICJhdHRyaWJ1dGVzIiwgYXR0cmlidXRlTmFtZTogYSwgb2xkVmFsdWU6IG9bYV0gfSkpOwogICAgICAgICAgfQogICAgICAgIH1mdW5jdGlvbiBzKHQsIHIsIG8sIHMpIHsKICAgICAgICAgIGZ1bmN0aW9uIGEoZSwgciwgbywgYSwgYykgewogICAgICAgICAgICB2YXIgbCA9IGUubGVuZ3RoIC0gMTtjID0gLSB+KChsIC0gYykgLyAyKTtmb3IgKHZhciBmLCBkLCBwOyBwID0gZS5wb3AoKTspIHsKICAgICAgICAgICAgICBmID0gb1twLmhdLCBkID0gYVtwLmldLCBzLmIgJiYgYyAmJiBNYXRoLmFicyhwLmggLSBwLmkpID49IGwgJiYgKHQucHVzaChuKHsgdHlwZTogImNoaWxkTGlzdCIsIHRhcmdldDogciwgYWRkZWROb2RlczogW2ZdLCByZW1vdmVkTm9kZXM6IFtmXSwgbmV4dFNpYmxpbmc6IGYubmV4dFNpYmxpbmcsIHByZXZpb3VzU2libGluZzogZi5wcmV2aW91c1NpYmxpbmcgfSkpLCBjLS0pLCBzLmEgJiYgZC5hICYmIGkodCwgZiwgZC5hLCBzLmQpLCBzLmMgJiYgMyA9PT0gZi5ub2RlVHlwZSAmJiBmLm5vZGVWYWx1ZSAhPT0gZC5jICYmIHQucHVzaChuKHsgdHlwZTogImNoYXJhY3RlckRhdGEiLCB0YXJnZXQ6IGYgfSkpLCBzLmUgJiYgdShmLCBkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfWZ1bmN0aW9uIHUociwgbykgewogICAgICAgICAgICBmb3IgKHZhciBkLCBwLCBiLCBoLCB2LCB5ID0gci5jaGlsZE5vZGVzLCBfID0gby5iLCBnID0geS5sZW5ndGgsIG0gPSBfID8gXy5sZW5ndGggOiAwLCBqID0gMCwgJCA9IDAsIE8gPSAwOyBnID4gJCB8fCBtID4gTzspIHsKICAgICAgICAgICAgICBoID0geVskXSwgdiA9IChiID0gX1tPXSkgJiYgYi5qLCBoID09PSB2ID8gKHMuYSAmJiBiLmEgJiYgaSh0LCBoLCBiLmEsIHMuZCksIHMuYyAmJiBiLmMgIT09IGUgJiYgaC5ub2RlVmFsdWUgIT09IGIuYyAmJiB0LnB1c2gobih7IHR5cGU6ICJjaGFyYWN0ZXJEYXRhIiwgdGFyZ2V0OiBoIH0pKSwgcCAmJiBhKHAsIHIsIHksIF8sIGopLCBzLmUgJiYgKGguY2hpbGROb2Rlcy5sZW5ndGggfHwgYi5iICYmIGIuYi5sZW5ndGgpICYmIHUoaCwgYiksICQrKywgTysrKSA6IChsID0gITAsIGQgfHwgKGQgPSB7fSwgcCA9IFtdKSwgaCAmJiAoZFtiID0gYyhoKV0gfHwgKGRbYl0gPSAhMCwgLTEgPT09IChiID0gZihfLCBoLCBPLCAiaiIpKSA/IHMuYiAmJiAodC5wdXNoKG4oeyB0eXBlOiAiY2hpbGRMaXN0IiwgdGFyZ2V0OiByLCBhZGRlZE5vZGVzOiBbaF0sIG5leHRTaWJsaW5nOiBoLm5leHRTaWJsaW5nLCBwcmV2aW91c1NpYmxpbmc6IGgucHJldmlvdXNTaWJsaW5nIH0pKSwgaisrKSA6IHAucHVzaCh7IGg6ICQsIGk6IGIgfSkpLCAkKyspLCB2ICYmIHYgIT09IHlbJF0gJiYgKGRbYiA9IGModildIHx8IChkW2JdID0gITAsIC0xID09PSAoYiA9IGYoeSwgdiwgJCkpID8gcy5iICYmICh0LnB1c2gobih7IHR5cGU6ICJjaGlsZExpc3QiLCB0YXJnZXQ6IG8uaiwgcmVtb3ZlZE5vZGVzOiBbdl0sIG5leHRTaWJsaW5nOiBfW08gKyAxXSwgcHJldmlvdXNTaWJsaW5nOiBfW08gLSAxXSB9KSksIGotLSkgOiBwLnB1c2goeyBoOiBiLCBpOiBPIH0pKSwgTysrKSk7CiAgICAgICAgICAgIH1wICYmIGEocCwgciwgeSwgXywgaik7CiAgICAgICAgICB9dmFyIGw7cmV0dXJuIHUociwgbyksIGw7CiAgICAgICAgfWZ1bmN0aW9uIGEoZSwgdCkgewogICAgICAgICAgdmFyIHIgPSAhMDtyZXR1cm4gZnVuY3Rpb24gbihlKSB7CiAgICAgICAgICAgIHZhciBvID0geyBqOiBlIH07cmV0dXJuICF0LmMgfHwgMyAhPT0gZS5ub2RlVHlwZSAmJiA4ICE9PSBlLm5vZGVUeXBlID8gKHQuYSAmJiByICYmIDEgPT09IGUubm9kZVR5cGUgJiYgKG8uYSA9IGwoZS5hdHRyaWJ1dGVzLCBmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgICAgIHJldHVybiB0LmQgJiYgIXQuZFtyLm5hbWVdIHx8IChlW3IubmFtZV0gPSByLnZhbHVlKSwgZTsKICAgICAgICAgICAgfSkpLCByICYmICh0LmIgfHwgdC5jIHx8IHQuYSAmJiB0LmUpICYmIChvLmIgPSB1KGUuY2hpbGROb2RlcywgbikpLCByID0gdC5lKSA6IG8uYyA9IGUubm9kZVZhbHVlLCBvOwogICAgICAgICAgfShlKTsKICAgICAgICB9ZnVuY3Rpb24gYyhlKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZS5pZCB8fCAoZS5tb19pZCA9IGUubW9faWQgfHwgZCsrKTsKICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gZS5ub2RlVmFsdWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfWZ1bmN0aW9uIHUoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IFtdLCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgcltuXSA9IHQoZVtuXSwgbiwgZSk7CiAgICAgICAgICB9cmV0dXJuIHI7CiAgICAgICAgfWZ1bmN0aW9uIGwoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IHt9LCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgciA9IHQociwgZVtuXSwgbiwgZSk7CiAgICAgICAgICB9cmV0dXJuIHI7CiAgICAgICAgfWZ1bmN0aW9uIGYoZSwgdCwgciwgbikgewogICAgICAgICAgZm9yICg7IHIgPCBlLmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIGlmICgobiA/IGVbcl1bbl0gOiBlW3JdKSA9PT0gdCkgcmV0dXJuIHI7CiAgICAgICAgICB9cmV0dXJuIC0xOwogICAgICAgIH10Ll9wZXJpb2QgPSAzMCwgdC5wcm90b3R5cGUgPSB7IG9ic2VydmU6IGZ1bmN0aW9uIG9ic2VydmUoZSwgdCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0geyBhOiAhISh0LmF0dHJpYnV0ZXMgfHwgdC5hdHRyaWJ1dGVGaWx0ZXIgfHwgdC5hdHRyaWJ1dGVPbGRWYWx1ZSksIGI6ICEhdC5jaGlsZExpc3QsIGU6ICEhdC5zdWJ0cmVlLCBjOiAhKCF0LmNoYXJhY3RlckRhdGEgJiYgIXQuY2hhcmFjdGVyRGF0YU9sZFZhbHVlKSB9LCBpID0gdGhpcy5nLCBzID0gMDsgcyA8IGkubGVuZ3RoOyBzKyspIHsKICAgICAgICAgICAgICBpW3NdLm0gPT09IGUgJiYgaS5zcGxpY2UocywgMSk7CiAgICAgICAgICAgIH10LmF0dHJpYnV0ZUZpbHRlciAmJiAobi5kID0gbCh0LmF0dHJpYnV0ZUZpbHRlciwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZVt0XSA9ICEwLCBlOwogICAgICAgICAgICB9KSksIGkucHVzaCh7IG06IGUsIGw6IG8oZSwgbikgfSksIHRoaXMuZiB8fCByKHRoaXMpOwogICAgICAgICAgfSwgdGFrZVJlY29yZHM6IGZ1bmN0aW9uIHRha2VSZWNvcmRzKCkgewogICAgICAgICAgICBmb3IgKHZhciBlID0gW10sIHQgPSB0aGlzLmcsIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgewogICAgICAgICAgICAgIHRbcl0ubChlKTsKICAgICAgICAgICAgfXJldHVybiBlOwogICAgICAgICAgfSwgZGlzY29ubmVjdDogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHsKICAgICAgICAgICAgdGhpcy5nID0gW10sIGNsZWFyVGltZW91dCh0aGlzLmYpLCB0aGlzLmYgPSBudWxsOwogICAgICAgICAgfSB9O3ZhciBkID0gMTtyZXR1cm4gdDsKICAgICAgfSh2b2lkIDApOwogICAgfSwge31dLCA5MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIE9iamVjdC5vYnNlcnZlIHx8IGZ1bmN0aW9uIChlLCB0LCByLCBuKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBvLAogICAgICAgICAgICBpLAogICAgICAgICAgICBzID0gWyJhZGQiLCAidXBkYXRlIiwgImRlbGV0ZSIsICJyZWNvbmZpZ3VyZSIsICJzZXRQcm90b3R5cGUiLCAicHJldmVudEV4dGVuc2lvbnMiXSwKICAgICAgICAgICAgYSA9IHQuaXNBcnJheSB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiAiW29iamVjdCBBcnJheV0iID09PSBlLmNhbGwodCk7CiAgICAgICAgICB9OwogICAgICAgIH0oZS5wcm90b3R5cGUudG9TdHJpbmcpLAogICAgICAgICAgICBjID0gdC5wcm90b3R5cGUuaW5kZXhPZiA/IHQuaW5kZXhPZiB8fCBmdW5jdGlvbiAoZSwgciwgbikgewogICAgICAgICAgcmV0dXJuIHQucHJvdG90eXBlLmluZGV4T2YuY2FsbChlLCByLCBuKTsKICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICAgIGZvciAodmFyIG4gPSByIHx8IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICAgIGlmIChlW25dID09PSB0KSByZXR1cm4gbjsKICAgICAgICAgIH1yZXR1cm4gLTE7CiAgICAgICAgfSwKICAgICAgICAgICAgdSA9IHIuTWFwICE9PSBuICYmIE1hcC5wcm90b3R5cGUuZm9yRWFjaCA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBuZXcgTWFwKCk7CiAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlID0gW10sCiAgICAgICAgICAgICAgdCA9IFtdO3JldHVybiB7IHNpemU6IDAsIGhhczogZnVuY3Rpb24gaGFzKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gYyhlLCB0KSA+IC0xOwogICAgICAgICAgICB9LCBnZXQ6IGZ1bmN0aW9uIGdldChyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRbYyhlLCByKV07CiAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHIsIG4pIHsKICAgICAgICAgICAgICB2YXIgbyA9IGMoZSwgcik7LTEgPT09IG8gPyAoZS5wdXNoKHIpLCB0LnB1c2gobiksIHRoaXMuc2l6ZSsrKSA6IHRbb10gPSBuOwogICAgICAgICAgICB9LCAiZGVsZXRlIjogZnVuY3Rpb24gX2RlbGV0ZShyKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBjKGUsIHIpO24gPiAtMSAmJiAoZS5zcGxpY2UobiwgMSksIHQuc3BsaWNlKG4sIDEpLCB0aGlzLnNpemUtLSk7CiAgICAgICAgICAgIH0sIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2gocikgewogICAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICAgICAgci5jYWxsKGFyZ3VtZW50c1sxXSwgdFtuXSwgZVtuXSwgdGhpcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IH07CiAgICAgICAgfSwKICAgICAgICAgICAgbCA9IGUuZ2V0T3duUHJvcGVydHlOYW1lcyA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzO3RyeSB7CiAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWU7CiAgICAgICAgICB9IGNhdGNoIChyKSB7CiAgICAgICAgICAgIHZhciBuID0gKHQoYykuam9pbigiICIpICsgIiAiKS5yZXBsYWNlKC9wcm90b3R5cGUgfGxlbmd0aCB8bmFtZSAvZywgIiIpLnNsaWNlKDAsIC0xKS5zcGxpdCgiICIpO24ubGVuZ3RoICYmICh0ID0gZnVuY3Rpb24gdChfdDMpIHsKICAgICAgICAgICAgICB2YXIgciA9IGUuZ2V0T3duUHJvcGVydHlOYW1lcyhfdDMpO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiBfdDMpIGZvciAodmFyIG8sIGkgPSAwOyBpIDwgbi5sZW5ndGg7KSB7CiAgICAgICAgICAgICAgICAobyA9IGMociwgbltpKytdKSkgPiAtMSAmJiByLnNwbGljZShvLCAxKTsKICAgICAgICAgICAgICB9cmV0dXJuIHI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfXJldHVybiB0OwogICAgICAgIH0oKSA6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgciwKICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgIG8gPSBbXTtpZiAoImhhc093blByb3BlcnR5IiBpbiB0KSBmb3IgKHIgaW4gdCkgewogICAgICAgICAgICB0Lmhhc093blByb3BlcnR5KHIpICYmIG8ucHVzaChyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG4gPSBlLmhhc093blByb3BlcnR5O2ZvciAociBpbiB0KSB7CiAgICAgICAgICAgICAgbi5jYWxsKHQsIHIpICYmIG8ucHVzaChyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfXJldHVybiBhKHQpICYmIG8ucHVzaCgibGVuZ3RoIiksIG87CiAgICAgICAgfSwKICAgICAgICAgICAgZiA9IGUuZ2V0UHJvdG90eXBlT2YsCiAgICAgICAgICAgIGQgPSBlLmRlZmluZVByb3BlcnRpZXMgJiYgZS5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgICAgICAgICAgIHAgPSByLnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCByLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZSA9ICtuZXcgRGF0ZSgpLAogICAgICAgICAgICAgIHQgPSBlO3JldHVybiBmdW5jdGlvbiAocikgewogICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcigodCA9ICtuZXcgRGF0ZSgpKSAtIGUpOwogICAgICAgICAgICB9LCAxNyk7CiAgICAgICAgICB9OwogICAgICAgIH0oKSwKICAgICAgICAgICAgYiA9IGZ1bmN0aW9uIGIoZSwgdCwgcikgewogICAgICAgICAgdmFyIG4gPSBvLmdldChlKTtuID8gKHYobiwgZSksIG0oZSwgbiwgdCwgcikpIDogKG4gPSBoKGUpLCBtKGUsIG4sIHQsIHIpLCAxID09PSBvLnNpemUgJiYgcCh5KSk7CiAgICAgICAgfSwKICAgICAgICAgICAgaCA9IGZ1bmN0aW9uIGgodCwgcikgewogICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgaSA9IGwodCksCiAgICAgICAgICAgICAgcyA9IFtdLAogICAgICAgICAgICAgIGEgPSAwLAogICAgICAgICAgICAgIHIgPSB7IGhhbmRsZXJzOiB1KCksIGZyb3plbjogZS5pc0Zyb3plbiA/IGUuaXNGcm96ZW4odCkgOiAhMSwgZXh0ZW5zaWJsZTogZS5pc0V4dGVuc2libGUgPyBlLmlzRXh0ZW5zaWJsZSh0KSA6ICEwLCBwcm90bzogZiAmJiBmKHQpLCBwcm9wZXJ0aWVzOiBpLCB2YWx1ZXM6IHMsIG5vdGlmaWVyOiBnKHQsIHIpIH07aWYgKGQpIGZvciAobiA9IHIuZGVzY3JpcHRvcnMgPSBbXTsgYSA8IGkubGVuZ3RoOykgewogICAgICAgICAgICBuW2FdID0gZCh0LCBpW2FdKSwgc1thXSA9IHRbaVthKytdXTsKICAgICAgICAgIH0gZWxzZSBmb3IgKDsgYSA8IGkubGVuZ3RoOykgewogICAgICAgICAgICBzW2FdID0gdFtpW2ErK11dOwogICAgICAgICAgfXJldHVybiBvLnNldCh0LCByKSwgcjsKICAgICAgICB9LAogICAgICAgICAgICB2ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBkID8gZnVuY3Rpb24gKGUsIHQsIHIsIG4sIG8pIHsKICAgICAgICAgICAgdmFyIGkgPSB0LnByb3BlcnRpZXNbcl0sCiAgICAgICAgICAgICAgICBzID0gZVtpXSwKICAgICAgICAgICAgICAgIGEgPSB0LnZhbHVlc1tyXSwKICAgICAgICAgICAgICAgIGMgPSB0LmRlc2NyaXB0b3JzW3JdOyJ2YWx1ZSIgaW4gbyAmJiAoYSA9PT0gcyA/IDAgPT09IGEgJiYgMSAvIGEgIT09IDEgLyBzIDogYSA9PT0gYSB8fCBzID09PSBzKSAmJiAoaihlLCB0LCB7IG5hbWU6IGksIHR5cGU6ICJ1cGRhdGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBhIH0sIG4pLCB0LnZhbHVlc1tyXSA9IHMpLCAhYy5jb25maWd1cmFibGUgfHwgby5jb25maWd1cmFibGUgJiYgby53cml0YWJsZSA9PT0gYy53cml0YWJsZSAmJiBvLmVudW1lcmFibGUgPT09IGMuZW51bWVyYWJsZSAmJiBvLmdldCA9PT0gYy5nZXQgJiYgby5zZXQgPT09IGMuc2V0IHx8IChqKGUsIHQsIHsgbmFtZTogaSwgdHlwZTogInJlY29uZmlndXJlIiwgb2JqZWN0OiBlLCBvbGRWYWx1ZTogYSB9LCBuKSwgdC5kZXNjcmlwdG9yc1tyXSA9IG8pOwogICAgICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgIHZhciBvID0gdC5wcm9wZXJ0aWVzW3JdLAogICAgICAgICAgICAgICAgaSA9IGVbb10sCiAgICAgICAgICAgICAgICBzID0gdC52YWx1ZXNbcl07KHMgPT09IGkgPyAwID09PSBzICYmIDEgLyBzICE9PSAxIC8gaSA6IHMgPT09IHMgfHwgaSA9PT0gaSkgJiYgKGooZSwgdCwgeyBuYW1lOiBvLCB0eXBlOiAidXBkYXRlIiwgb2JqZWN0OiBlLCBvbGRWYWx1ZTogcyB9LCBuKSwgdC52YWx1ZXNbcl0gPSBpKTsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgciA9IGQgPyBmdW5jdGlvbiAoZSwgciwgbiwgbywgaSkgewogICAgICAgICAgICBmb3IgKHZhciBzLCBhID0gci5sZW5ndGg7IG4gJiYgYS0tOykgewogICAgICAgICAgICAgIG51bGwgIT09IHJbYV0gJiYgKHMgPSBkKGUsIHJbYV0pLCBuLS0sIHMgPyB0KGUsIG8sIGEsIGksIHMpIDogKGooZSwgbywgeyBuYW1lOiByW2FdLCB0eXBlOiAiZGVsZXRlIiwgb2JqZWN0OiBlLCBvbGRWYWx1ZTogby52YWx1ZXNbYV0gfSwgaSksIG8ucHJvcGVydGllcy5zcGxpY2UoYSwgMSksIG8udmFsdWVzLnNwbGljZShhLCAxKSwgby5kZXNjcmlwdG9ycy5zcGxpY2UoYSwgMSkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0LCByLCBuLCBvKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0Lmxlbmd0aDsgciAmJiBpLS07KSB7CiAgICAgICAgICAgICAgbnVsbCAhPT0gdFtpXSAmJiAoaihlLCBuLCB7IG5hbWU6IHRbaV0sIHR5cGU6ICJkZWxldGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBuLnZhbHVlc1tpXSB9LCBvKSwgbi5wcm9wZXJ0aWVzLnNwbGljZShpLCAxKSwgbi52YWx1ZXMuc3BsaWNlKGksIDEpLCByLS0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9O3JldHVybiBmdW5jdGlvbiAobiwgbywgaSkgewogICAgICAgICAgICBpZiAobi5oYW5kbGVycy5zaXplICYmICFuLmZyb3plbikgewogICAgICAgICAgICAgIHZhciBzLAogICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgICAgICBoLAogICAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgICB5LAogICAgICAgICAgICAgICAgICBfID0gbi52YWx1ZXMsCiAgICAgICAgICAgICAgICAgIGcgPSBuLmRlc2NyaXB0b3JzLAogICAgICAgICAgICAgICAgICBtID0gMDtpZiAobi5leHRlbnNpYmxlKSB7CiAgICAgICAgICAgICAgICBpZiAocyA9IG4ucHJvcGVydGllcy5zbGljZSgpLCBhID0gcy5sZW5ndGgsIHUgPSBsKG8pLCBnKSB7CiAgICAgICAgICAgICAgICAgIGZvciAoOyBtIDwgdS5sZW5ndGg7KSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IHVbbSsrXSwgcCA9IGMocywgYiksIHkgPSBkKG8sIGIpLCAtMSA9PT0gcCA/IChqKG8sIG4sIHsgbmFtZTogYiwgdHlwZTogImFkZCIsIG9iamVjdDogbyB9LCBpKSwgbi5wcm9wZXJ0aWVzLnB1c2goYiksIF8ucHVzaChvW2JdKSwgZy5wdXNoKHkpKSA6IChzW3BdID0gbnVsbCwgYS0tLCB0KG8sIG4sIHAsIGksIHkpKTsKICAgICAgICAgICAgICAgICAgfXIobywgcywgYSwgbiwgaSksIGUuaXNFeHRlbnNpYmxlKG8pIHx8IChuLmV4dGVuc2libGUgPSAhMSwgaihvLCBuLCB7IHR5cGU6ICJwcmV2ZW50RXh0ZW5zaW9ucyIsIG9iamVjdDogbyB9LCBpKSwgbi5mcm96ZW4gPSBlLmlzRnJvemVuKG8pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGZvciAoOyBtIDwgdS5sZW5ndGg7KSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IHVbbSsrXSwgcCA9IGMocywgYiksIGggPSBvW2JdLCAtMSA9PT0gcCA/IChqKG8sIG4sIHsgbmFtZTogYiwgdHlwZTogImFkZCIsIG9iamVjdDogbyB9LCBpKSwgbi5wcm9wZXJ0aWVzLnB1c2goYiksIF8ucHVzaChoKSkgOiAoc1twXSA9IG51bGwsIGEtLSwgdChvLCBuLCBwLCBpKSk7CiAgICAgICAgICAgICAgICAgIH1yKG8sIHMsIGEsIG4sIGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW4uZnJvemVuKSB7CiAgICAgICAgICAgICAgICBmb3IgKDsgbSA8IHMubGVuZ3RoOyBtKyspIHsKICAgICAgICAgICAgICAgICAgYiA9IHNbbV0sIHQobywgbiwgbSwgaSwgZChvLCBiKSk7CiAgICAgICAgICAgICAgICB9ZS5pc0Zyb3plbihvKSAmJiAobi5mcm96ZW4gPSAhMCk7CiAgICAgICAgICAgICAgfWYgJiYgKHYgPSBmKG8pLCB2ICE9PSBuLnByb3RvICYmIChqKG8sIG4sIHsgdHlwZTogInNldFByb3RvdHlwZSIsIG5hbWU6ICJfX3Byb3RvX18iLCBvYmplY3Q6IG8sIG9sZFZhbHVlOiBuLnByb3RvIH0pLCBuLnByb3RvID0gdikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0oKSwKICAgICAgICAgICAgeSA9IGZ1bmN0aW9uIHkoKSB7CiAgICAgICAgICBvLnNpemUgJiYgKG8uZm9yRWFjaCh2KSwgaS5mb3JFYWNoKF8pLCBwKHkpKTsKICAgICAgICB9LAogICAgICAgICAgICBfID0gZnVuY3Rpb24gXyhlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IGUuY2hhbmdlUmVjb3JkcztyLmxlbmd0aCAmJiAoZS5jaGFuZ2VSZWNvcmRzID0gW10sIHQocikpOwogICAgICAgIH0sCiAgICAgICAgICAgIGcgPSBmdW5jdGlvbiBnKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiAodCA9IG8uZ2V0KGUpKSwgdCAmJiB0Lm5vdGlmaWVyIHx8IHsgbm90aWZ5OiBmdW5jdGlvbiBub3RpZnkodCkgewogICAgICAgICAgICAgIHQudHlwZTt2YXIgciA9IG8uZ2V0KGUpO2lmIChyKSB7CiAgICAgICAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICAgICAgICBpID0geyBvYmplY3Q6IGUgfTtmb3IgKG4gaW4gdCkgewogICAgICAgICAgICAgICAgICAib2JqZWN0IiAhPT0gbiAmJiAoaVtuXSA9IHRbbl0pOwogICAgICAgICAgICAgICAgfWooZSwgciwgaSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBwZXJmb3JtQ2hhbmdlOiBmdW5jdGlvbiBwZXJmb3JtQ2hhbmdlKHQsIHIpIHsKICAgICAgICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgbm9uLXN0cmluZyBjaGFuZ2VUeXBlIik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHIpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBwZXJmb3JtIG5vbi1mdW5jdGlvbiIpO3ZhciBpLAogICAgICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgICAgICBhID0gby5nZXQoZSksCiAgICAgICAgICAgICAgICAgIGMgPSBhcmd1bWVudHNbMl0sCiAgICAgICAgICAgICAgICAgIHUgPSBjID09PSBuID8gcigpIDogci5jYWxsKGMpO2lmIChhICYmIHYoYSwgZSwgdCksIGEgJiYgdSAmJiAib2JqZWN0IiA9PSAodHlwZW9mIHUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHUpKSkgewogICAgICAgICAgICAgICAgcyA9IHsgb2JqZWN0OiBlLCB0eXBlOiB0IH07Zm9yIChpIGluIHUpIHsKICAgICAgICAgICAgICAgICAgIm9iamVjdCIgIT09IGkgJiYgInR5cGUiICE9PSBpICYmIChzW2ldID0gdVtpXSk7CiAgICAgICAgICAgICAgICB9aihlLCBhLCBzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gfTsKICAgICAgICB9LAogICAgICAgICAgICBtID0gZnVuY3Rpb24gbShlLCB0LCByLCBuKSB7CiAgICAgICAgICB2YXIgbyA9IGkuZ2V0KHIpO28gfHwgaS5zZXQociwgbyA9IHsgb2JzZXJ2ZWQ6IHUoKSwgY2hhbmdlUmVjb3JkczogW10gfSksIG8ub2JzZXJ2ZWQuc2V0KGUsIHsgYWNjZXB0TGlzdDogbi5zbGljZSgpLCBkYXRhOiB0IH0pLCB0LmhhbmRsZXJzLnNldChyLCBvKTsKICAgICAgICB9LAogICAgICAgICAgICBqID0gZnVuY3Rpb24gaihlLCB0LCByLCBuKSB7CiAgICAgICAgICB0LmhhbmRsZXJzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG8gPSB0Lm9ic2VydmVkLmdldChlKS5hY2NlcHRMaXN0Oygic3RyaW5nIiAhPSB0eXBlb2YgbiB8fCAtMSA9PT0gYyhvLCBuKSkgJiYgYyhvLCByLnR5cGUpID4gLTEgJiYgdC5jaGFuZ2VSZWNvcmRzLnB1c2gocik7CiAgICAgICAgICB9KTsKICAgICAgICB9O28gPSB1KCksIGkgPSB1KCksIGUub2JzZXJ2ZSA9IGZ1bmN0aW9uICh0LCByLCBvKSB7CiAgICAgICAgICBpZiAoIXQgfHwgIm9iamVjdCIgIT0gKHR5cGVvZiB0ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih0KSkgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiT2JqZWN0Lm9ic2VydmUgY2Fubm90IG9ic2VydmUgbm9uLW9iamVjdCIpO2lmICgiZnVuY3Rpb24iICE9IHR5cGVvZiByKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qub2JzZXJ2ZSBjYW5ub3QgZGVsaXZlciB0byBub24tZnVuY3Rpb24iKTtpZiAoZS5pc0Zyb3plbiAmJiBlLmlzRnJvemVuKHIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qub2JzZXJ2ZSBjYW5ub3QgZGVsaXZlciB0byBhIGZyb3plbiBmdW5jdGlvbiBvYmplY3QiKTtpZiAobyA9PT0gbikgbyA9IHM7ZWxzZSBpZiAoIW8gfHwgIm9iamVjdCIgIT0gKHR5cGVvZiBvID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihvKSkpIHRocm93IG5ldyBUeXBlRXJyb3IoIlRoaXJkIGFyZ3VtZW50IHRvIE9iamVjdC5vYnNlcnZlIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy4iKTtyZXR1cm4gYih0LCByLCBvKSwgdDsKICAgICAgICB9LCBlLnVub2JzZXJ2ZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAobnVsbCA9PT0gZSB8fCAib2JqZWN0IiAhPSAodHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QudW5vYnNlcnZlIGNhbm5vdCB1bm9ic2VydmUgbm9uLW9iamVjdCIpO2lmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QudW5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIG5vbi1mdW5jdGlvbiIpO3ZhciByLAogICAgICAgICAgICAgIG4gPSBpLmdldCh0KTtyZXR1cm4gbiAmJiAociA9IG4ub2JzZXJ2ZWQuZ2V0KGUpKSAmJiAobi5vYnNlcnZlZC5mb3JFYWNoKGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgIHYoZS5kYXRhLCB0KTsKICAgICAgICAgIH0pLCBwKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgXyhuLCB0KTsKICAgICAgICAgIH0pLCAxID09PSBuLm9ic2VydmVkLnNpemUgJiYgbi5vYnNlcnZlZC5oYXMoZSkgPyBpWyJkZWxldGUiXSh0KSA6IG4ub2JzZXJ2ZWRbImRlbGV0ZSJdKGUpLCAxID09PSByLmRhdGEuaGFuZGxlcnMuc2l6ZSA/IG9bImRlbGV0ZSJdKGUpIDogci5kYXRhLmhhbmRsZXJzWyJkZWxldGUiXSh0KSksIGU7CiAgICAgICAgfSwgZS5nZXROb3RpZmllciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpZiAobnVsbCA9PT0gdCB8fCAib2JqZWN0IiAhPSAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QuZ2V0Tm90aWZpZXIgY2Fubm90IGdldE5vdGlmaWVyIG5vbi1vYmplY3QiKTtyZXR1cm4gZS5pc0Zyb3plbiAmJiBlLmlzRnJvemVuKHQpID8gbnVsbCA6IGcodCk7CiAgICAgICAgfSwgZS5kZWxpdmVyQ2hhbmdlUmVjb3JkcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiT2JqZWN0LmRlbGl2ZXJDaGFuZ2VSZWNvcmRzIGNhbm5vdCBkZWxpdmVyIHRvIG5vbi1mdW5jdGlvbiIpO3ZhciB0ID0gaS5nZXQoZSk7dCAmJiAodC5vYnNlcnZlZC5mb3JFYWNoKGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgIHYoZS5kYXRhLCB0KTsKICAgICAgICAgIH0pLCBfKHQsIGUpKTsKICAgICAgICB9OwogICAgICB9KE9iamVjdCwgQXJyYXksIHRoaXMpOwogICAgfSwge31dLCA5MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KSwgci5EYXRhT2JqZWN0T2JzZXJ2ZXIgPSByLkRhdGFPYmplY3RSZXBvcnRlciA9IHIuU3luY2hlciA9IHZvaWQgMCwgZSgibXV0YXRpb25vYnNlcnZlci1zaGltIiksIGUoIm9iamVjdC5vYnNlcnZlIiksIGUoImFycmF5Lm9ic2VydmUiKTt2YXIgbyA9IGUoIi4vc3luY2hlci9TeW5jaGVyIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCIuL3N5bmNoZXIvRGF0YU9iamVjdFJlcG9ydGVyIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCIuL3N5bmNoZXIvRGF0YU9iamVjdE9ic2VydmVyIiksCiAgICAgICAgICB1ID0gbihjKTtyLlN5bmNoZXIgPSBpWyJkZWZhdWx0Il0sIHIuRGF0YU9iamVjdFJlcG9ydGVyID0gYVsiZGVmYXVsdCJdLCByLkRhdGFPYmplY3RPYnNlcnZlciA9IHVbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiOiA5NSwgIi4vc3luY2hlci9EYXRhT2JqZWN0UmVwb3J0ZXIiOiA5NiwgIi4vc3luY2hlci9TeW5jaGVyIjogOTksICJhcnJheS5vYnNlcnZlIjogMSwgIm11dGF0aW9ub2JzZXJ2ZXItc2hpbSI6IDkwLCAib2JqZWN0Lm9ic2VydmUiOiA5MSB9XSwgOTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpLAogICAgICAgICAgZiA9IG4obCksCiAgICAgICAgICBkID0gZSgiLi9TeW5jT2JqZWN0IiksCiAgICAgICAgICBwID0gbihkKSwKICAgICAgICAgIGIgPSBlKCIuL0RhdGFPYmplY3RDaGlsZCIpLAogICAgICAgICAgaCA9IG4oYiksCiAgICAgICAgICB2ID0gZSgiLi4vdXRpbHMvdXRpbHMuanMiKSwKICAgICAgICAgIHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByLCBuLCBvLCBpLCBzKSB7CiAgICAgICAgICAoMCwgdVsiZGVmYXVsdCJdKSh0aGlzLCBlKTt2YXIgYSA9IHRoaXM7YS5fc3luY2hlciA9IHQsIGEuX3VybCA9IHIsIGEuX3NjaGVtYSA9IG4sIGEuX3N0YXR1cyA9IG8sIGEuX3N5bmNPYmogPSBuZXcgcFsiZGVmYXVsdCJdKGkpLCBhLl9jaGlsZHJlbnMgPSBzLCBhLl92ZXJzaW9uID0gMCwgYS5fY2hpbGRJZCA9IDAsIGEuX2NoaWxkcmVuT2JqZWN0cyA9IHt9LCBhLl9jaGlsZHJlbkxpc3RlbmVycyA9IFtdLCBhLl9vd25lciA9IHQuX293bmVyLCBhLl9idXMgPSB0Ll9idXM7CiAgICAgICAgfXJldHVybiAoMCwgZlsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJfYWxsb2NhdGVMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgICAgICAgIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHQuX3VybCArICIvY2hpbGRyZW4vIjt0Ll9jaGlsZHJlbnMgJiYgdC5fY2hpbGRyZW5zLmZvckVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICB2YXIgbyA9IHIgKyBuLAogICAgICAgICAgICAgICAgICBpID0gdC5fYnVzLmFkZExpc3RlbmVyKG8sIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICBpZiAoci5mcm9tICE9PSBlLl9vd25lcikgc3dpdGNoIChjb25zb2xlLmxvZygiRGF0YU9iamVjdC1DaGlsZHJlbi1SQ1Y6ICIsIHIpLCByLnR5cGUpIHtjYXNlICJjcmVhdGUiOgogICAgICAgICAgICAgICAgICAgIHQuX29uQ2hpbGRDcmVhdGUocik7YnJlYWs7Y2FzZSAiZGVsZXRlIjoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyKTticmVhaztkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHQuX2NoYW5nZUNoaWxkcmVuKHIpO30KICAgICAgICAgICAgICB9KTt0Ll9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2NoaWxkcmVuTGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBlLnJlbW92ZSgpOwogICAgICAgICAgICB9KSwgKDAsIGFbImRlZmF1bHQiXSkoZS5fY2hpbGRyZW5PYmplY3RzKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgZS5fY2hpbGRyZW5PYmplY3RzW3RdLl9yZWxlYXNlTGlzdGVuZXJzKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogInBhdXNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB0aHJvdyAiTm90IGltcGxlbWVudGVkIjsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZXN1bWUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHRocm93ICJOb3QgaW1wbGVtZW50ZWQiOwogICAgICAgICAgfSB9LCB7IGtleTogInN0b3AiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHRocm93ICJOb3QgaW1wbGVtZW50ZWQiOwogICAgICAgICAgfSB9LCB7IGtleTogImFkZENoaWxkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzO3IuX2NoaWxkSWQrKzt2YXIgbiA9IHIuX293bmVyICsgIiMiICsgci5fY2hpbGRJZCwKICAgICAgICAgICAgICAgIG8gPSByLl91cmwgKyAiL2NoaWxkcmVuLyIgKyBlLAogICAgICAgICAgICAgICAgcyA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IHIuX293bmVyLCB0bzogbywgYm9keTogeyByZXNvdXJjZTogbiwgdmFsdWU6IHQgfSB9O3JldHVybiBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdmFyIGkgPSByLl9idXMucG9zdE1lc3NhZ2Uocyk7Y29uc29sZS5sb2coImNyZWF0ZS1yZXBvcnRlci1jaGlsZCggIiArIHIuX293bmVyICsgIiApOiAiLCBzKTt2YXIgYSA9IG5ldyBoWyJkZWZhdWx0Il0ociwgbiwgdCwgci5fb3duZXIsIGkpO2Eub25DaGFuZ2UoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHIuX29uQ2hhbmdlKGUsIHsgcGF0aDogbywgY2hpbGRJZDogbiB9KTsKICAgICAgICAgICAgICB9KSwgci5fY2hpbGRyZW5PYmplY3RzW25dID0gYSwgZShhKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25BZGRDaGlsZCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25DaGlsZENyZWF0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSBlLmJvZHkucmVzb3VyY2U7Y29uc29sZS5sb2coImNyZWF0ZS1vYnNlcnZlci1jaGlsZCggIiArIHQuX293bmVyICsgIiApOiAiLCBlKTt2YXIgbiA9IG5ldyBoWyJkZWZhdWx0Il0odCwgciwgZS5ib2R5LnZhbHVlKTt0Ll9jaGlsZHJlbk9iamVjdHNbcl0gPSBuLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiAyMDAsIHNvdXJjZTogdC5fb3duZXIgfSB9KTsKICAgICAgICAgICAgfSk7dmFyIG8gPSB7IHR5cGU6IGUudHlwZSwgZnJvbTogZS5mcm9tLCB1cmw6IGUudG8sIHZhbHVlOiBlLmJvZHkudmFsdWUsIGNoaWxkSWQ6IHIsIGlkZW50aXR5OiBlLmJvZHkuaWRlbnRpdHkgfTt0Ll9vbkFkZENoaWxkcmVuSGFuZGxlciAmJiAoY29uc29sZS5sb2coIkFERC1DSElMRFJFTi1FVkVOVDogIiwgbyksIHQuX29uQWRkQ2hpbGRyZW5IYW5kbGVyKG8pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25DaGFuZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7aWYgKHIuX3ZlcnNpb24rKywgIm9uIiA9PT0gci5fc3RhdHVzKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7IHR5cGU6ICJ1cGRhdGUiLCBmcm9tOiByLl91cmwsIHRvOiByLl91cmwgKyAiL2NoYW5nZXMiLCBib2R5OiB7IHZlcnNpb246IHIuX3ZlcnNpb24sIHNvdXJjZTogci5fb3duZXIsIGF0dHJpYnV0ZTogZS5maWVsZCB9IH07ZS5vVHlwZSA9PT0gZC5PYmplY3RUeXBlLk9CSkVDVCA/IGUuY1R5cGUgIT09IGQuQ2hhbmdlVHlwZS5SRU1PVkUgJiYgKG4uYm9keS52YWx1ZSA9IGUuZGF0YSkgOiAobi5ib2R5LmF0dHJpYnV0ZVR5cGUgPSBlLm9UeXBlLCBuLmJvZHkudmFsdWUgPSBlLmRhdGEsIGUuY1R5cGUgIT09IGQuQ2hhbmdlVHlwZS5VUERBVEUgJiYgKG4uYm9keS5vcGVyYXRpb24gPSBlLmNUeXBlKSksIHQgJiYgKG4udG8gPSB0LnBhdGgsIG4uYm9keS5yZXNvdXJjZSA9IHQuY2hpbGRJZCksIHIuX2J1cy5wb3N0TWVzc2FnZShuKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSB9LCB7IGtleTogIl9jaGFuZ2VPYmplY3QiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7aWYgKHIuX3ZlcnNpb24gKyAxID09PSB0LmJvZHkudmVyc2lvbikgewogICAgICAgICAgICAgIHIuX3ZlcnNpb24rKzt2YXIgbiA9IHQuYm9keS5hdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgIG8gPSAoMCwgdi5kZWVwQ2xvbmUpKHQuYm9keS52YWx1ZSksCiAgICAgICAgICAgICAgICAgIGkgPSBlLmZpbmRCZWZvcmUobik7aWYgKHQuYm9keS5hdHRyaWJ1dGVUeXBlID09PSBkLk9iamVjdFR5cGUuQVJSQVkpIHsKICAgICAgICAgICAgICAgIGlmICh0LmJvZHkub3BlcmF0aW9uID09PSBkLkNoYW5nZVR5cGUuQUREKSB7CiAgICAgICAgICAgICAgICAgIHZhciBzID0gaS5vYmosCiAgICAgICAgICAgICAgICAgICAgICBhID0gaS5sYXN0O0FycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkocywgW2EsIDBdLmNvbmNhdChvKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQuYm9keS5vcGVyYXRpb24gPT09IGQuQ2hhbmdlVHlwZS5SRU1PVkUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGMgPSBpLm9iaiwKICAgICAgICAgICAgICAgICAgICAgIHUgPSBpLmxhc3Q7Yy5zcGxpY2UodSwgbyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaS5vYmpbaS5sYXN0XSA9IG87CiAgICAgICAgICAgICAgfSBlbHNlIHQuYm9keS52YWx1ZSA/IGkub2JqW2kubGFzdF0gPSBvIDogZGVsZXRlIGkub2JqW2kubGFzdF07CiAgICAgICAgICAgIH0gZWxzZSBjb25zb2xlLmxvZygiVU5TWU5DSFJPTklaRUQgVkVSU0lPTjogKGRhdGEgPT4gIiArIHIuX3ZlcnNpb24gKyAiLCBtc2cgPT4gIiArIHQuYm9keS52ZXJzaW9uICsgIikiKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfY2hhbmdlQ2hpbGRyZW4iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7Y29uc29sZS5sb2coIkNoYW5nZSBjaGlsZHJlbjogIiwgdC5fb3duZXIsIGUpO3ZhciByID0gZS5ib2R5LnJlc291cmNlLAogICAgICAgICAgICAgICAgbiA9IHQuX2NoaWxkcmVuT2JqZWN0c1tyXTtuID8gdC5fY2hhbmdlT2JqZWN0KG4uX3N5bmNPYmosIGUpIDogY29uc29sZS5sb2coIk5vIGNoaWxkcmVuIGZvdW5kIGZvcjogIiwgcik7CiAgICAgICAgICB9IH0sIHsga2V5OiAidXJsIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91cmw7CiAgICAgICAgICB9IH0sIHsga2V5OiAic2NoZW1hIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY2hlbWE7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3RhdHVzIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGF0YSIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgICAgICAgfSB9LCB7IGtleTogImNoaWxkcmVucyIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5PYmplY3RzOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKTtyWyJkZWZhdWx0Il0gPSB5LCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuLi91dGlscy91dGlscy5qcyI6IDEwMCwgIi4vRGF0YU9iamVjdENoaWxkIjogOTQsICIuL1N5bmNPYmplY3QiOiA5OCwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6IDcsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6IDksICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiAxMSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI6IDEyIH1dLCA5NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCIuL1N5bmNPYmplY3QiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4sIG8sIHMpIHsKICAgICAgICAgICgwLCBpWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBhID0gdGhpczthLl9wYXJlbnQgPSB0LCBhLl9jaGlsZElkID0gciwgYS5fb3duZXIgPSBvLCBhLl9tc2dJZCA9IHMsIGEuX3N5bmNPYmogPSBuZXcgdVsiZGVmYXVsdCJdKG4pLCBhLl9idXMgPSB0Ll9idXMsIGEuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICAgICAgfXJldHVybiAoMCwgYVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJfYWxsb2NhdGVMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9vd25lciAmJiAoZS5fbGlzdGVuZXIgPSBlLl9idXMuYWRkTGlzdGVuZXIoZS5fb3duZXIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgInJlc3BvbnNlIiA9PT0gdC50eXBlICYmIHQuaWQgPT09IGUuX21zZ0lkICYmIChjb25zb2xlLmxvZygiRGF0YU9iamVjdENoaWxkLm9uUmVzcG9uc2U6IiwgdCksIGUuX29uUmVzcG9uc2UodCkpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9saXN0ZW5lciAmJiBlLl9saXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztkZWxldGUgZS5fcGFyZW50Ll9jaGlsZHJlbltlLl9jaGlsZElkXSwgZS5fcmVsZWFzZUxpc3RlbmVycygpOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uQ2hhbmdlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgZSh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25SZXNwb25zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29uUmVzcG9uc2VIYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZXNwb25zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IHR5cGU6IGUudHlwZSwgdXJsOiBlLmJvZHkuc291cmNlLCBjb2RlOiBlLmJvZHkuY29kZSB9O3QuX29uUmVzcG9uc2VIYW5kbGVyICYmIHQuX29uUmVzcG9uc2VIYW5kbGVyKHIpOwogICAgICAgICAgfSB9LCB7IGtleTogImNoaWxkSWQiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkSWQ7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGF0YSIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKTtyWyJkZWZhdWx0Il0gPSBsLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL1N5bmNPYmplY3QiOiA5OCwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpLAogICAgICAgICAgaCA9IG4oYiksCiAgICAgICAgICB2ID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIiksCiAgICAgICAgICB5ID0gbih2KSwKICAgICAgICAgIF8gPSBlKCIuL0RhdGFPYmplY3QiKSwKICAgICAgICAgIGcgPSBuKF8pLAogICAgICAgICAgbSA9IGUoIi4vRGF0YU9iamVjdENoaWxkIiksCiAgICAgICAgICBqID0gbihtKSwKICAgICAgICAgICQgPSB7IEFOWTogImFueSIsIFNUQVJUOiAic3RhcnQiLCBFWEFDVDogImV4YWN0IiB9LAogICAgICAgICAgTyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZnVuY3Rpb24gdChlLCByLCBuLCBvLCBzLCBjLCBsKSB7CiAgICAgICAgICAoMCwgdVsiZGVmYXVsdCJdKSh0aGlzLCB0KTt2YXIgZiA9ICgwLCBwWyJkZWZhdWx0Il0pKHRoaXMsICgwLCBhWyJkZWZhdWx0Il0pKHQpLmNhbGwodGhpcywgZSwgciwgbiwgbywgcy5kYXRhLCBjKSksCiAgICAgICAgICAgICAgZCA9IGY7cmV0dXJuIGQuX3ZlcnNpb24gPSBsLCBkLl9maWx0ZXJzID0ge30sIGQuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBkLl9vbkZpbHRlcihlKTsKICAgICAgICAgIH0pLCAoMCwgaVsiZGVmYXVsdCJdKShzLmNoaWxkcmVucykuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdCA9IHMuY2hpbGRyZW5zW2VdO2QuX2NoaWxkcmVuT2JqZWN0c1tlXSA9IG5ldyBqWyJkZWZhdWx0Il0oZCwgZSwgdCk7CiAgICAgICAgICB9KSwgZC5fYWxsb2NhdGVMaXN0ZW5lcnMoKSwgZjsKICAgICAgICB9cmV0dXJuICgwLCB5WyJkZWZhdWx0Il0pKHQsIGUpLCAoMCwgZlsiZGVmYXVsdCJdKSh0LCBbeyBrZXk6ICJfYWxsb2NhdGVMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgICgwLCBoWyJkZWZhdWx0Il0pKCgwLCBhWyJkZWZhdWx0Il0pKHQucHJvdG90eXBlKSwgIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX2NoYW5nZUxpc3RlbmVyID0gZS5fYnVzLmFkZExpc3RlbmVyKGUuX3VybCArICIvY2hhbmdlcyIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgInVwZGF0ZSIgPT09IHQudHlwZSAmJiAoY29uc29sZS5sb2coIkRhdGFPYmplY3RPYnNlcnZlci0iICsgZS5fdXJsICsgIi1SQ1Y6ICIsIHQpLCBlLl9jaGFuZ2VPYmplY3QoZS5fc3luY09iaiwgdCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB0aGlzKS5jYWxsKHRoaXMpO3ZhciBlID0gdGhpcztlLl9jaGFuZ2VMaXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9yZWxlYXNlTGlzdGVuZXJzKCksIGRlbGV0ZSBlLl9zeW5jaGVyLl9vYnNlcnZlcnNbZS5fdXJsXTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1bnN1YnNjcmliZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICAgICAgdCA9IHsgdHlwZTogInVuc3Vic2NyaWJlIiwgZnJvbTogZS5fb3duZXIsIHRvOiBlLl9zeW5jaGVyLl9zdWJVUkwsIGJvZHk6IHsgcmVzb3VyY2U6IGUuX3VybCB9IH07ZS5fYnVzLnBvc3RNZXNzYWdlKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coIkRhdGFPYmplY3RPYnNlcnZlci1VTlNVQlNDUklCRTogIiwgdCksIDIwMCA9PT0gdC5ib2R5LmNvZGUgJiYgKGUuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX29ic2VydmVyc1tlLl91cmxdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25DaGFuZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IGUsCiAgICAgICAgICAgICAgICBuID0geyB0eXBlOiAkLkVYQUNULCBjYWxsYmFjazogdCB9LAogICAgICAgICAgICAgICAgbyA9IGUuaW5kZXhPZigiKiIpO28gPT09IGUubGVuZ3RoIC0gMSAmJiAoMCA9PT0gbyA/IG4udHlwZSA9ICQuQU5ZIDogKG4udHlwZSA9ICQuU1RBUlQsIHIgPSBlLnN1YnN0cigwLCBlLmxlbmd0aCAtIDEpKSksIHRoaXMuX2ZpbHRlcnNbcl0gPSBuOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkZpbHRlciIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpczsoMCwgaVsiZGVmYXVsdCJdKSh0Ll9maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB0Ll9maWx0ZXJzW3JdO24udHlwZSA9PT0gJC5BTlkgPyBuLmNhbGxiYWNrKGUpIDogbi50eXBlID09PSAkLlNUQVJUID8gMCA9PT0gZS5maWVsZC5pbmRleE9mKHIpICYmIG4uY2FsbGJhY2soZSkgOiBuLnR5cGUgPT09ICQuRVhBQ1QgJiYgZS5maWVsZCA9PT0gciAmJiBuLmNhbGxiYWNrKGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfV0pLCB0OwogICAgICB9KGdbImRlZmF1bHQiXSk7clsiZGVmYXVsdCJdID0gTywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9EYXRhT2JqZWN0IjogOTMsICIuL0RhdGFPYmplY3RDaGlsZCI6IDk0LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogNiwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6IDcsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiAxMSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI6IDEyLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6IDEzLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjogMTQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI6IDE1IH1dLCA5NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpLAogICAgICAgICAgZiA9IG4obCksCiAgICAgICAgICBkID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iKSwKICAgICAgICAgIHAgPSBuKGQpLAogICAgICAgICAgYiA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiKSwKICAgICAgICAgIGggPSBuKGIpLAogICAgICAgICAgdiA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyIpLAogICAgICAgICAgeSA9IG4odiksCiAgICAgICAgICBfID0gZSgiLi9EYXRhT2JqZWN0IiksCiAgICAgICAgICBnID0gbihfKSwKICAgICAgICAgIG0gPSBlKCIuLi91dGlscy91dGlscy5qcyIpLAogICAgICAgICAgaiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZnVuY3Rpb24gdChlLCByLCBuLCBvLCBpLCBzKSB7CiAgICAgICAgICAoMCwgdVsiZGVmYXVsdCJdKSh0aGlzLCB0KTt2YXIgYyA9ICgwLCBwWyJkZWZhdWx0Il0pKHRoaXMsICgwLCBhWyJkZWZhdWx0Il0pKHQpLmNhbGwodGhpcywgZSwgciwgbiwgbywgaSwgcykpLAogICAgICAgICAgICAgIGwgPSBjO3JldHVybiBsLl9zdWJzY3JpcHRpb25zID0ge30sIGwuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLSIgKyByICsgIi1TRU5EOiAiLCBlKSwgbC5fb25DaGFuZ2UoZSk7CiAgICAgICAgICB9KSwgbC5fYWxsb2NhdGVMaXN0ZW5lcnMoKSwgYzsKICAgICAgICB9cmV0dXJuICgwLCB5WyJkZWZhdWx0Il0pKHQsIGUpLCAoMCwgZlsiZGVmYXVsdCJdKSh0LCBbeyBrZXk6ICJfYWxsb2NhdGVMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgICgwLCBoWyJkZWZhdWx0Il0pKCgwLCBhWyJkZWZhdWx0Il0pKHQucHJvdG90eXBlKSwgIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX3Jlc3BvbnNlTGlzdGVuZXIgPSBlLl9idXMuYWRkTGlzdGVuZXIoZS5fdXJsLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICJyZXNwb25zZSIgPT09IHQudHlwZSAmJiBlLl9vblJlc3BvbnNlKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB0aGlzKS5jYWxsKHRoaXMpO3ZhciBlID0gdGhpcztlLl9yZXNwb25zZUxpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImludml0ZU9ic2VydmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IHR5cGU6ICJjcmVhdGUiLCBmcm9tOiB0Ll9zeW5jaGVyLl9vd25lciwgdG86IHQuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogdC5fdXJsLCBzY2hlbWE6IHQuX3NjaGVtYSwgdmFsdWU6IHQuX3N5bmNPYmouZGF0YSwgYXV0aG9yaXNlOiBlIH0gfTt0Ll9idXMucG9zdE1lc3NhZ2Uocik7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGVsZXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICB0ID0geyB0eXBlOiAiZGVsZXRlIiwgZnJvbTogZS5fb3duZXIsIHRvOiBlLl9zeW5jaGVyLl9zdWJVUkwsIGJvZHk6IHsgcmVzb3VyY2U6IGUuX3VybCB9IH07ZS5fYnVzLnBvc3RNZXNzYWdlKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coIkRhdGFPYmplY3RSZXBvcnRlci1ERUxFVEU6ICIsIHQpLCAyMDAgPT09IHQuYm9keS5jb2RlICYmIChlLl9yZWxlYXNlTGlzdGVuZXJzKCksIGRlbGV0ZSBlLl9zeW5jaGVyLl9yZXBvcnRlcnNbZS5fdXJsXSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uU3Vic2NyaXB0aW9uIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkZvcndhcmQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7c3dpdGNoIChjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLVJDVjogIiwgZSksIGUuYm9keS50eXBlKSB7Y2FzZSAic3Vic2NyaWJlIjoKICAgICAgICAgICAgICAgIHQuX29uU3Vic2NyaWJlKGUpO2JyZWFrO2Nhc2UgInVuc3Vic2NyaWJlIjoKICAgICAgICAgICAgICAgIHQuX29uVW5TdWJzY3JpYmUoZSk7fQogICAgICAgICAgfSB9LCB7IGtleTogIl9vblN1YnNjcmliZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSBlLmJvZHkuZnJvbSwKICAgICAgICAgICAgICAgIG4gPSB7IHR5cGU6IGUuYm9keS50eXBlLCB1cmw6IHIsIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSB7IHVybDogciwgc3RhdHVzOiAib24iIH07dC5fc3Vic2NyaXB0aW9uc1tyXSA9IG47dmFyIG8gPSB7fTtyZXR1cm4gKDAsIGlbImRlZmF1bHQiXSkodC5fY2hpbGRyZW5PYmplY3RzKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIHZhciByID0gdC5fY2hpbGRyZW5PYmplY3RzW2VdLmRhdGE7b1tlXSA9ICgwLCBtLmRlZXBDbG9uZSkocik7CiAgICAgICAgICAgICAgICB9KSwgdC5fYnVzLnBvc3RNZXNzYWdlKHsgaWQ6IGUuaWQsIHR5cGU6ICJyZXNwb25zZSIsIGZyb206IGUudG8sIHRvOiBlLmZyb20sIGJvZHk6IHsgY29kZTogMjAwLCBzY2hlbWE6IHQuX3NjaGVtYSwgdmVyc2lvbjogdC5fdmVyc2lvbiwgdmFsdWU6IHsgZGF0YTogKDAsIG0uZGVlcENsb25lKSh0LmRhdGEpLCBjaGlsZHJlbnM6IG8gfSB9IH0pLCBuOwogICAgICAgICAgICAgIH0sIHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KHIpIHsKICAgICAgICAgICAgICAgIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDQwMywgZGVzYzogciB9IH0pOwogICAgICAgICAgICAgIH0gfTt0Ll9vblN1YnNjcmlwdGlvbkhhbmRsZXIgJiYgKGNvbnNvbGUubG9nKCJTVUJTQ1JJUFRJT04tRVZFTlQ6ICIsIG4pLCB0Ll9vblN1YnNjcmlwdGlvbkhhbmRsZXIobikpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vblVuU3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5mcm9tLAogICAgICAgICAgICAgICAgbiA9IHQuX3N1YnNjcmlwdGlvbnNbcl07ZGVsZXRlIHQuX3N1YnNjcmlwdGlvbnNbcl07dmFyIG8gPSB7IHR5cGU6IGUuYm9keS50eXBlLCB1cmw6IHIsIG9iamVjdDogbiB9O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIlVOLVNVQlNDUklQVElPTi1FVkVOVDogIiwgbyksIHQuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihvKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uUmVzcG9uc2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0geyB0eXBlOiBlLnR5cGUsIHVybDogZS5mcm9tLCBjb2RlOiBlLmJvZHkuY29kZSB9O3QuX29uUmVzcG9uc2VIYW5kbGVyICYmIChjb25zb2xlLmxvZygiUkVTUE9OU0UtRVZFTlQ6ICIsIHIpLCB0Ll9vblJlc3BvbnNlSGFuZGxlcihyKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3Vic2NyaXB0aW9ucyIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uczsKICAgICAgICAgIH0gfV0pLCB0OwogICAgICB9KGdbImRlZmF1bHQiXSk7clsiZGVmYXVsdCJdID0gaiwgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMuanMiOiAxMDAsICIuL0RhdGFPYmplY3QiOiA5MywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiI6IDYsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOiA3LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOiAxMywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6IDE0LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOiAxNSB9XSwgOTc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgciwgbiwgbykgewogICAgICAgICAgKDAsIGlbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIHMgPSB0aGlzO3MuX293bmVyID0gdCwgcy5fdXJsID0gciwgcy5fYnVzID0gbiwgcy5fY2hpbGRyZW4gPSBvLCBzLl9jaGFuZ2VzID0gW10sIHMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICAgICAgfXJldHVybiAoMCwgYVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJfYWxsb2NhdGVMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9saXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl91cmwsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coIkRhdGFQcm92aXNpb25hbC0iICsgZS5fdXJsICsgIi1SQ1Y6ICIsIHQpLCBlLl9jaGFuZ2VzLnB1c2godCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXM7ZS5fbGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiYXBwbHkiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7dC5fY2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgZS5fY2hhbmdlT2JqZWN0KGUuX3N5bmNPYmosIHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJjaGlsZHJlbiIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW47CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IGMsIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pLCByLk9iamVjdFR5cGUgPSByLkNoYW5nZVR5cGUgPSB2b2lkIDA7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICB1ID0gbihjKSwKICAgICAgICAgIGwgPSBlKCIuLi91dGlscy91dGlscy5qcyIpLAogICAgICAgICAgZiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQpIHsKICAgICAgICAgICgwLCBhWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciByID0gdGhpcztyLl9vYnNlcnZlcnMgPSBbXSwgci5fZmlsdGVycyA9IHt9LCB0ID8gci5fZGF0YSA9ICgwLCBsLmRlZXBDbG9uZSkodCkgOiByLl9kYXRhID0ge30sIHIuX2ludGVybmFsT2JzZXJ2ZShuZXcgZCgpLCByLl9kYXRhKTsKICAgICAgICB9cmV0dXJuICgwLCB1WyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIm9ic2VydmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vYnNlcnZlcnMucHVzaChlKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJmaW5kIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBlLnNwbGl0KCIuIik7cmV0dXJuIHRoaXMuX2ZpbmRXaXRoU3BsaXQodCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZmluZEJlZm9yZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0ge30sCiAgICAgICAgICAgICAgICByID0gZS5zcGxpdCgiLiIpO3JldHVybiB0Lmxhc3QgPSByLnBvcCgpLCB0Lm9iaiA9IHRoaXMuX2ZpbmRXaXRoU3BsaXQociksIHQ7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX2ZpbmRXaXRoU3BsaXQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMuX2RhdGE7cmV0dXJuIGUuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQgPSB0W2VdOwogICAgICAgICAgICB9KSwgdDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfZmlyZUV2ZW50IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB0KGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfaXNPYnNlcnZhYmxlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGUuY29uc3RydWN0b3IgPT09IE9iamVjdCB8fCBlLmNvbnN0cnVjdG9yID09PSBBcnJheTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfaW50ZXJuYWxPYnNlcnZlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzO2lmIChyLl9pc09ic2VydmFibGUodCkpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGZ1bmN0aW9uIG4odCkgewogICAgICAgICAgICAgICAgci5fb25DaGFuZ2VzKGUsIHQpOwogICAgICAgICAgICAgIH07aWYgKHQuY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgICAgICAgT2JqZWN0Lm9ic2VydmUodCwgbik7Zm9yICh2YXIgbyBpbiB0KSB7CiAgICAgICAgICAgICAgICAgIHIuX2lzT2JzZXJ2YWJsZSh0W29dKSAmJiByLl9pbnRlcm5hbE9ic2VydmUoZVsibmV3Il0obyksIHRbb10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgICAgICAgIEFycmF5Lm9ic2VydmUodCwgbik7Zm9yICh2YXIgaSBpbiB0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChyLl9pc09ic2VydmFibGUodFtpXSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGVbIm5ldyJdKG5ldyBwKHRbaV0sIGkpKTtyLl9pbnRlcm5hbE9ic2VydmUocywgdFtpXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25DaGFuZ2VzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzO2ZvciAodmFyIG4gaW4gdCkgewogICAgICAgICAgICAgIHZhciBvID0gdFtuXS5vYmplY3QsCiAgICAgICAgICAgICAgICAgIGkgPSB2b2lkIDA7aWYgKG8uY29uc3RydWN0b3IgPT09IE9iamVjdCAmJiAoaSA9IGguT0JKRUNUKSwgby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgKGkgPSBoLkFSUkFZKSwgInNwbGljZSIgPT09IHRbbl0udHlwZSkgIWZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzID0gdFtuXS5pbmRleCwKICAgICAgICAgICAgICAgICAgICBhID0gZVsibmV3Il0oIiIgKyBzKSwKICAgICAgICAgICAgICAgICAgICBjID0gYS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgIHUgPSB0W25dLnJlbW92ZWQubGVuZ3RoO2lmICgwICE9PSB1KSB7CiAgICAgICAgICAgICAgICAgIHZhciBmID0gdFtuXS5yZW1vdmVkO2YuZm9yRWFjaChmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgICAgICAgIHIuX2lzT2JzZXJ2YWJsZSh0KSAmJiBlLnJlbW92ZUluZGV4KHMgKyBuKTsKICAgICAgICAgICAgICAgICAgfSksIHIuX2ZpcmVFdmVudCh7IGNUeXBlOiBiLlJFTU9WRSwgb1R5cGU6IGksIGZpZWxkOiBjLCBkYXRhOiB1IH0pOwogICAgICAgICAgICAgICAgfXZhciBkID0gdFtuXS5hZGRlZENvdW50O2lmICgwICE9PSBkKSB7CiAgICAgICAgICAgICAgICAgIHZhciBoID0gby5zbGljZShzLCBzICsgZCk7aC5mb3JFYWNoKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHIuX2lzT2JzZXJ2YWJsZSh0KSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBlWyJuZXciXShuZXcgcCh0LCBzICsgbikpO3IuX2ludGVybmFsT2JzZXJ2ZShvLCB0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pLCByLl9maXJlRXZlbnQoeyBjVHlwZTogYi5BREQsIG9UeXBlOiBpLCBmaWVsZDogYywgZGF0YTogKDAsIGwuZGVlcENsb25lKShoKSB9KTsKICAgICAgICAgICAgICAgIH1zICE9PSBvLmxlbmd0aCAtIDEgJiYgZS5yZUluZGV4RnJvbShvKTsKICAgICAgICAgICAgICB9KCk7ZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcyA9IGVbIm5ldyJdKHRbbl0ubmFtZSksCiAgICAgICAgICAgICAgICAgICAgYSA9IHMudG9TdHJpbmcoKTtpZiAoLTEgIT09IGEuaW5kZXhPZigiU3ltYm9sIikpIGNvbnRpbnVlO3ZhciBjID0gb1t0W25dLm5hbWVdOyJ1cGRhdGUiID09PSB0W25dLnR5cGUgJiYgdGhpcy5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuVVBEQVRFLCBvVHlwZTogaSwgZmllbGQ6IGEsIGRhdGE6ICgwLCBsLmRlZXBDbG9uZSkoYykgfSksICJhZGQiID09PSB0W25dLnR5cGUgJiYgKHRoaXMuX2ludGVybmFsT2JzZXJ2ZShzLCBjKSwgdGhpcy5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuQURELCBvVHlwZTogaSwgZmllbGQ6IGEsIGRhdGE6ICgwLCBsLmRlZXBDbG9uZSkoYykgfSkpLCAiZGVsZXRlIiA9PT0gdFtuXS50eXBlICYmIHRoaXMuX2ZpcmVFdmVudCh7IGNUeXBlOiBiLlJFTU9WRSwgb1R5cGU6IGksIGZpZWxkOiBhIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSB9LCB7IGtleTogImRhdGEiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpLAogICAgICAgICAgZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgICAgKDAsIGFbImRlZmF1bHQiXSkodGhpcywgZSksIHRoaXMuX3BhdGggPSBbXSwgdGhpcy5fb2JzZXJ2YWJsZXMgPSB7fTsKICAgICAgICB9cmV0dXJuICgwLCB1WyJkZWZhdWx0Il0pKGUsIFt7IGtleTogInJlbW92ZUluZGV4IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuX29ic2VydmFibGVzW2VdOwogICAgICAgICAgfSB9LCB7IGtleTogInJlSW5kZXhGcm9tIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOygwLCBpWyJkZWZhdWx0Il0pKHRoaXMuX29ic2VydmFibGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB0Ll9vYnNlcnZhYmxlc1tyXSwKICAgICAgICAgICAgICAgICAgbyA9IGUuaW5kZXhPZihuLm9iaik7bi5pZHggIT0gbyAmJiAobi5pZHggPSBvLCBkZWxldGUgdC5fb2JzZXJ2YWJsZXNbcl0sIHQuX29ic2VydmFibGVzW29dID0gbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm5ldyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIGUuY29uc3RydWN0b3IgPT0gcCAmJiAodGhpcy5fb2JzZXJ2YWJsZXNbZS5pZHhdID0gZSk7dmFyIHQgPSB0aGlzLmNsb25lKCk7cmV0dXJuIHQuX3BhdGgucHVzaChlKSwgdDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJjbG9uZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHQgPSBuZXcgZSgpO3JldHVybiB0aGlzLl9wYXRoLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB0Ll9wYXRoLnB1c2goZSk7CiAgICAgICAgICAgIH0pLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogInRvU3RyaW5nIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9ICIiO3JldHVybiB0aGlzLl9wYXRoLmZvckVhY2goZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgICAgICAwID09PSByID8gZSA9IHQudG9TdHJpbmcoKSA6IGUgKz0gIi4iICsgdC50b1N0cmluZygpOwogICAgICAgICAgICB9KSwgZTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCksCiAgICAgICAgICBwID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgcikgewogICAgICAgICAgKDAsIGFbImRlZmF1bHQiXSkodGhpcywgZSksIHRoaXMub2JqID0gdCwgdGhpcy5pZHggPSByOwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAidG9TdHJpbmciLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlkeC50b1N0cmluZygpOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKSwKICAgICAgICAgIGIgPSByLkNoYW5nZVR5cGUgPSB7IFVQREFURTogInVwZGF0ZSIsIEFERDogImFkZCIsIFJFTU9WRTogInJlbW92ZSIgfSwKICAgICAgICAgIGggPSByLk9iamVjdFR5cGUgPSB7IE9CSkVDVDogIm9iamVjdCIsIEFSUkFZOiAiYXJyYXkiIH07clsiZGVmYXVsdCJdID0gZjsKICAgIH0sIHsgIi4uL3V0aWxzL3V0aWxzLmpzIjogMTAwLCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICB1ID0gbihjKSwKICAgICAgICAgIGwgPSBlKCIuL0RhdGFPYmplY3RSZXBvcnRlciIpLAogICAgICAgICAgZiA9IG4obCksCiAgICAgICAgICBkID0gZSgiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiKSwKICAgICAgICAgIHAgPSBuKGQpLAogICAgICAgICAgYiA9IGUoIi4vRGF0YVByb3Zpc2lvbmFsIiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByLCBuKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKTt2YXIgbyA9IHRoaXM7by5fb3duZXIgPSB0LCBvLl9idXMgPSByLCBvLl9zdWJVUkwgPSBuLnJ1bnRpbWVVUkwgKyAiL3NtIiwgby5fcmVwb3J0ZXJzID0ge30sIG8uX29ic2VydmVycyA9IHt9LCBvLl9wcm92aXNpb25hbHMgPSB7fSwgci5hZGRMaXN0ZW5lcih0LCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5mcm9tICE9PSB0KSBzd2l0Y2ggKGNvbnNvbGUubG9nKCJTeW5jaGVyLVJDVjogIiwgZSksIGUudHlwZSkge2Nhc2UgImZvcndhcmQiOgogICAgICAgICAgICAgICAgby5fb25Gb3J3YXJkKGUpO2JyZWFrO2Nhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICBvLl9vblJlbW90ZUNyZWF0ZShlKTticmVhaztjYXNlICJkZWxldGUiOgogICAgICAgICAgICAgICAgby5fb25SZW1vdGVEZWxldGUoZSk7fQogICAgICAgICAgfSk7CiAgICAgICAgfXJldHVybiAoMCwgdVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJjcmVhdGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCwgcikgewogICAgICAgICAgICB2YXIgbiA9IHRoaXM7ci5yZXBvcnRlciA9IG4uX293bmVyLCByLnNjaGVtYSA9IGU7dmFyIG8gPSB7IHR5cGU6ICJjcmVhdGUiLCBmcm9tOiBuLl9vd25lciwgdG86IG4uX3N1YlVSTCwgYm9keTogeyBzY2hlbWE6IGUsIHZhbHVlOiByLCBhdXRob3Jpc2U6IHQgfSB9O3JldHVybiBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uICh0LCBpKSB7CiAgICAgICAgICAgICAgbi5fYnVzLnBvc3RNZXNzYWdlKG8sIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICAgICAgICBpZiAoY29uc29sZS5sb2coImNyZWF0ZS1yZXNwb25zZTogIiwgbyksIDIwMCA9PT0gby5ib2R5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBvLmJvZHkucmVzb3VyY2UsCiAgICAgICAgICAgICAgICAgICAgICBhID0gbmV3IGZbImRlZmF1bHQiXShuLCBzLCBlLCAib24iLCByLCBvLmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpO24uX3JlcG9ydGVyc1tzXSA9IGEsIHQoYSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaShvLmJvZHkuZGVzYyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogInN1YnNjcmliZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcywKICAgICAgICAgICAgICAgIG4gPSB7IHR5cGU6ICJzdWJzY3JpYmUiLCBmcm9tOiByLl9vd25lciwgdG86IHIuX3N1YlVSTCwgYm9keTogeyBzY2hlbWE6IGUsIHJlc291cmNlOiB0IH0gfTtyZXR1cm4gbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAobywgaSkgewogICAgICAgICAgICAgIHIuX2J1cy5wb3N0TWVzc2FnZShuLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInN1YnNjcmliZS1yZXNwb25zZTogIiwgbik7dmFyIHMgPSByLl9wcm92aXNpb25hbHNbdF07aWYgKGRlbGV0ZSByLl9wcm92aXNpb25hbHNbdF0sIHMgJiYgcy5fcmVsZWFzZUxpc3RlbmVycygpLCBuLmJvZHkuY29kZSA8IDIwMCkgcyA9IG5ldyBoWyJkZWZhdWx0Il0oci5fb3duZXIsIHQsIHIuX2J1cywgbi5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzKSwgci5fcHJvdmlzaW9uYWxzW3RdID0gcztlbHNlIGlmICgyMDAgPT09IG4uYm9keS5jb2RlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhID0gbmV3IHBbImRlZmF1bHQiXShyLCB0LCBlLCAib24iLCBuLmJvZHkudmFsdWUsIHMuY2hpbGRyZW4sIG4uYm9keS52ZXJzaW9uKTtyLl9vYnNlcnZlcnNbdF0gPSBhLCBvKGEpLCBzLmFwcGx5KGEpOwogICAgICAgICAgICAgICAgfSBlbHNlIGkobi5ib2R5LmRlc2MpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbk5vdGlmaWNhdGlvbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlciA9IGU7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRm9yd2FyZCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB0Ll9yZXBvcnRlcnNbZS5ib2R5LnRvXTtyLl9vbkZvcndhcmQoZSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uUmVtb3RlQ3JlYXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuZnJvbS5zbGljZSgwLCAtMTMpLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogZS50eXBlLCBmcm9tOiBlLmJvZHkuc291cmNlLCB1cmw6IHIsIHNjaGVtYTogZS5ib2R5LnNjaGVtYSwgdmFsdWU6IGUuYm9keS52YWx1ZSwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSwgYWNrOiBmdW5jdGlvbiBhY2socikgewogICAgICAgICAgICAgICAgdmFyIG4gPSAyMDA7ciAmJiAobiA9IHIpLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiBuIH0gfSk7CiAgICAgICAgICAgICAgfSB9O3QuX29uTm90aWZpY2F0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIk5PVElGSUNBVElPTi1FVkVOVDogIiwgbiksIHQuX29uTm90aWZpY2F0aW9uSGFuZGxlcihuKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uUmVtb3RlRGVsZXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5yZXNvdXJjZSwKICAgICAgICAgICAgICAgIG4gPSB0Ll9vYnNlcnZlcnNbcl07aWYgKG4pIHsKICAgICAgICAgICAgICB2YXIgbyA9IHsgdHlwZTogZS50eXBlLCB1cmw6IHIsIGlkZW50aXR5OiBlLmJvZHkuaWRlbnRpdHksIGFjazogZnVuY3Rpb24gYWNrKHIpIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSAyMDA7ciAmJiAobyA9IHIpLCAyMDAgPT09IG8gJiYgblsiZGVsZXRlIl0oKSwgdC5fYnVzLnBvc3RNZXNzYWdlKHsgaWQ6IGUuaWQsIHR5cGU6ICJyZXNwb25zZSIsIGZyb206IGUudG8sIHRvOiBlLmZyb20sIGJvZHk6IHsgY29kZTogbywgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgICAgICAgfSB9O3QuX29uTm90aWZpY2F0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIk5PVElGSUNBVElPTi1FVkVOVDogIiwgbyksIHQuX29uTm90aWZpY2F0aW9uSGFuZGxlcihvKSk7CiAgICAgICAgICAgIH0gZWxzZSB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiA0MDQsIHNvdXJjZTogdC5fb3duZXIgfSB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvd25lciIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duZXI7CiAgICAgICAgICB9IH0sIHsga2V5OiAicmVwb3J0ZXJzIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXBvcnRlcnM7CiAgICAgICAgICB9IH0sIHsga2V5OiAib2JzZXJ2ZXJzIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnM7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IHYsIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4vRGF0YU9iamVjdE9ic2VydmVyIjogOTUsICIuL0RhdGFPYmplY3RSZXBvcnRlciI6IDk2LCAiLi9EYXRhUHJvdmlzaW9uYWwiOiA5NywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogOSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDEwMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1mdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpLAogICAgICAgICAgICByID0gIiQxLCQyLCQzIiwKICAgICAgICAgICAgbiA9IGUucmVwbGFjZSh0LCByKS5zcGxpdCgiLCIpO25bMF0gPT09IGUgJiYgKG5bMF0gPSAiaHR0cHMiLCBuWzFdID0gZSk7dmFyIG8gPSB7IHR5cGU6IG5bMF0sIGRvbWFpbjogblsxXSwgaWRlbnRpdHk6IG5bMl0gfTtyZXR1cm4gbzsKICAgICAgfWZ1bmN0aW9uIGkoZSkgewogICAgICAgIHJldHVybiBlID8gSlNPTi5wYXJzZSgoMCwgYVsiZGVmYXVsdCJdKShlKSkgOiB2b2lkIDA7CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgcyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSIpLAogICAgICAgICAgYSA9IG4ocyk7ci5kaXZpZGVVUkwgPSBvLCByLmRlZXBDbG9uZSA9IGk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvanNvbi9zdHJpbmdpZnkiOiAyIH1dIH0sIHt9LCBbOTJdKSg5Mik7Cn0pOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07CgovKiEKICogVVJJLmpzIC0gTXV0YXRpbmcgVVJMcwogKiBJUHY2IFN1cHBvcnQKICoKICogVmVyc2lvbjogMS4xOC4wCiAqCiAqIEF1dGhvcjogUm9kbmV5IFJlaG0KICogV2ViOiBodHRwOi8vbWVkaWFsaXplLmdpdGh1Yi5pby9VUkkuanMvCiAqCiAqIExpY2Vuc2VkIHVuZGVyCiAqICAgTUlUIExpY2Vuc2UgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZQogKgogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICd1c2Ugc3RyaWN0JzsKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvbWFzdGVyL3JldHVybkV4cG9ydHMuanMKCiAgaWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JykgewogICAgLy8gTm9kZQogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShmYWN0b3J5KTsKICB9IGVsc2UgewogICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgIHJvb3QuSVB2NiA9IGZhY3Rvcnkocm9vdCk7CiAgfQp9KSh1bmRlZmluZWQsIGZ1bmN0aW9uIChyb290KSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvKgogIHZhciBfaW4gPSAiZmU4MDowMDAwOjAwMDA6MDAwMDowMjA0OjYxZmY6ZmU5ZDpmMTU2IjsKICB2YXIgX291dCA9IElQdjYuYmVzdChfaW4pOwogIHZhciBfZXhwZWN0ZWQgPSAiZmU4MDo6MjA0OjYxZmY6ZmU5ZDpmMTU2IjsKICAgY29uc29sZS5sb2coX2luLCBfb3V0LCBfZXhwZWN0ZWQsIF9vdXQgPT09IF9leHBlY3RlZCk7CiAgKi8KCiAgLy8gc2F2ZSBjdXJyZW50IElQdjYgdmFyaWFibGUsIGlmIGFueQoKICB2YXIgX0lQdjYgPSByb290ICYmIHJvb3QuSVB2NjsKCiAgZnVuY3Rpb24gYmVzdFByZXNlbnRhdGlvbihhZGRyZXNzKSB7CiAgICAvLyBiYXNlZCBvbjoKICAgIC8vIEphdmFzY3JpcHQgdG8gdGVzdCBhbiBJUHY2IGFkZHJlc3MgZm9yIHByb3BlciBmb3JtYXQsIGFuZCB0bwogICAgLy8gcHJlc2VudCB0aGUgImJlc3QgdGV4dCByZXByZXNlbnRhdGlvbiIgYWNjb3JkaW5nIHRvIElFVEYgRHJhZnQgUkZDIGF0CiAgICAvLyBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9kcmFmdC1pZXRmLTZtYW4tdGV4dC1hZGRyLXJlcHJlc2VudGF0aW9uLTA0CiAgICAvLyA4IEZlYiAyMDEwIFJpY2ggQnJvd24sIERhcnR3YXJlLCBMTEMKICAgIC8vIFBsZWFzZSBmZWVsIGZyZWUgdG8gdXNlIHRoaXMgY29kZSBhcyBsb25nIGFzIHlvdSBwcm92aWRlIGEgbGluayB0bwogICAgLy8gaHR0cDovL3d3dy5pbnRlcm1hcHBlci5jb20KICAgIC8vIGh0dHA6Ly9pbnRlcm1hcHBlci5jb20vc3VwcG9ydC90b29scy9JUFY2LVZhbGlkYXRvci5hc3B4CiAgICAvLyBodHRwOi8vZG93bmxvYWQuZGFydHdhcmUuY29tL3RoaXJkcGFydHkvaXB2NnZhbGlkYXRvci5qcwoKICAgIHZhciBfYWRkcmVzcyA9IGFkZHJlc3MudG9Mb3dlckNhc2UoKTsKICAgIHZhciBzZWdtZW50cyA9IF9hZGRyZXNzLnNwbGl0KCc6Jyk7CiAgICB2YXIgbGVuZ3RoID0gc2VnbWVudHMubGVuZ3RoOwogICAgdmFyIHRvdGFsID0gODsKCiAgICAvLyB0cmltIGNvbG9ucyAoOjogb3IgOjphOmI6Y+KApiBvciDigKZhOmI6Yzo6KQogICAgaWYgKHNlZ21lbnRzWzBdID09PSAnJyAmJiBzZWdtZW50c1sxXSA9PT0gJycgJiYgc2VnbWVudHNbMl0gPT09ICcnKSB7CiAgICAgIC8vIG11c3QgaGF2ZSBiZWVuIDo6CiAgICAgIC8vIHJlbW92ZSBmaXJzdCB0d28gaXRlbXMKICAgICAgc2VnbWVudHMuc2hpZnQoKTsKICAgICAgc2VnbWVudHMuc2hpZnQoKTsKICAgIH0gZWxzZSBpZiAoc2VnbWVudHNbMF0gPT09ICcnICYmIHNlZ21lbnRzWzFdID09PSAnJykgewogICAgICAvLyBtdXN0IGhhdmUgYmVlbiA6Onh4eHgKICAgICAgLy8gcmVtb3ZlIHRoZSBmaXJzdCBpdGVtCiAgICAgIHNlZ21lbnRzLnNoaWZ0KCk7CiAgICB9IGVsc2UgaWYgKHNlZ21lbnRzW2xlbmd0aCAtIDFdID09PSAnJyAmJiBzZWdtZW50c1tsZW5ndGggLSAyXSA9PT0gJycpIHsKICAgICAgLy8gbXVzdCBoYXZlIGJlZW4geHh4eDo6CiAgICAgIHNlZ21lbnRzLnBvcCgpOwogICAgfQoKICAgIGxlbmd0aCA9IHNlZ21lbnRzLmxlbmd0aDsKCiAgICAvLyBhZGp1c3QgdG90YWwgc2VnbWVudHMgZm9yIElQdjQgdHJhaWxlcgogICAgaWYgKHNlZ21lbnRzW2xlbmd0aCAtIDFdLmluZGV4T2YoJy4nKSAhPT0gLTEpIHsKICAgICAgLy8gZm91bmQgYSAiLiIgd2hpY2ggbWVhbnMgSVB2NAogICAgICB0b3RhbCA9IDc7CiAgICB9CgogICAgLy8gZmlsbCBlbXB0eSBzZWdtZW50cyB0aGVtIHdpdGggIjAwMDAiCiAgICB2YXIgcG9zOwogICAgZm9yIChwb3MgPSAwOyBwb3MgPCBsZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmIChzZWdtZW50c1twb3NdID09PSAnJykgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgaWYgKHBvcyA8IHRvdGFsKSB7CiAgICAgIHNlZ21lbnRzLnNwbGljZShwb3MsIDEsICcwMDAwJyk7CiAgICAgIHdoaWxlIChzZWdtZW50cy5sZW5ndGggPCB0b3RhbCkgewogICAgICAgIHNlZ21lbnRzLnNwbGljZShwb3MsIDAsICcwMDAwJyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBzdHJpcCBsZWFkaW5nIHplcm9zCiAgICB2YXIgX3NlZ21lbnRzOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3RhbDsgaSsrKSB7CiAgICAgIF9zZWdtZW50cyA9IHNlZ21lbnRzW2ldLnNwbGl0KCcnKTsKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICBpZiAoX3NlZ21lbnRzWzBdID09PSAnMCcgJiYgX3NlZ21lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIF9zZWdtZW50cy5zcGxpY2UoMCwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2VnbWVudHNbaV0gPSBfc2VnbWVudHMuam9pbignJyk7CiAgICB9CgogICAgLy8gZmluZCBsb25nZXN0IHNlcXVlbmNlIG9mIHplcm9lcyBhbmQgY29hbGVzY2UgdGhlbSBpbnRvIG9uZSBzZWdtZW50CiAgICB2YXIgYmVzdCA9IC0xOwogICAgdmFyIF9iZXN0ID0gMDsKICAgIHZhciBfY3VycmVudCA9IDA7CiAgICB2YXIgY3VycmVudCA9IC0xOwogICAgdmFyIGluemVyb2VzID0gZmFsc2U7CiAgICAvLyBpOyBhbHJlYWR5IGRlY2xhcmVkCgogICAgZm9yIChpID0gMDsgaSA8IHRvdGFsOyBpKyspIHsKICAgICAgaWYgKGluemVyb2VzKSB7CiAgICAgICAgaWYgKHNlZ21lbnRzW2ldID09PSAnMCcpIHsKICAgICAgICAgIF9jdXJyZW50ICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluemVyb2VzID0gZmFsc2U7CiAgICAgICAgICBpZiAoX2N1cnJlbnQgPiBfYmVzdCkgewogICAgICAgICAgICBiZXN0ID0gY3VycmVudDsKICAgICAgICAgICAgX2Jlc3QgPSBfY3VycmVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNlZ21lbnRzW2ldID09PSAnMCcpIHsKICAgICAgICAgIGluemVyb2VzID0gdHJ1ZTsKICAgICAgICAgIGN1cnJlbnQgPSBpOwogICAgICAgICAgX2N1cnJlbnQgPSAxOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChfY3VycmVudCA+IF9iZXN0KSB7CiAgICAgIGJlc3QgPSBjdXJyZW50OwogICAgICBfYmVzdCA9IF9jdXJyZW50OwogICAgfQoKICAgIGlmIChfYmVzdCA+IDEpIHsKICAgICAgc2VnbWVudHMuc3BsaWNlKGJlc3QsIF9iZXN0LCAnJyk7CiAgICB9CgogICAgbGVuZ3RoID0gc2VnbWVudHMubGVuZ3RoOwoKICAgIC8vIGFzc2VtYmxlIHJlbWFpbmluZyBzZWdtZW50cwogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgaWYgKHNlZ21lbnRzWzBdID09PSAnJykgewogICAgICByZXN1bHQgPSAnOic7CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdCArPSBzZWdtZW50c1tpXTsKICAgICAgaWYgKGkgPT09IGxlbmd0aCAtIDEpIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmVzdWx0ICs9ICc6JzsKICAgIH0KCiAgICBpZiAoc2VnbWVudHNbbGVuZ3RoIC0gMV0gPT09ICcnKSB7CiAgICAgIHJlc3VsdCArPSAnOic7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KICAgIGlmIChyb290LklQdjYgPT09IHRoaXMpIHsKICAgICAgcm9vdC5JUHY2ID0gX0lQdjY7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICByZXR1cm4gewogICAgYmVzdDogYmVzdFByZXNlbnRhdGlvbiwKICAgIG5vQ29uZmxpY3Q6IG5vQ29uZmxpY3QKICB9Owp9KTsKCn0se31dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07CgovKiEKICogVVJJLmpzIC0gTXV0YXRpbmcgVVJMcwogKiBTZWNvbmQgTGV2ZWwgRG9tYWluIChTTEQpIFN1cHBvcnQKICoKICogVmVyc2lvbjogMS4xOC4wCiAqCiAqIEF1dGhvcjogUm9kbmV5IFJlaG0KICogV2ViOiBodHRwOi8vbWVkaWFsaXplLmdpdGh1Yi5pby9VUkkuanMvCiAqCiAqIExpY2Vuc2VkIHVuZGVyCiAqICAgTUlUIExpY2Vuc2UgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZQogKgogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICd1c2Ugc3RyaWN0JzsKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvbWFzdGVyL3JldHVybkV4cG9ydHMuanMKCiAgaWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JykgewogICAgLy8gTm9kZQogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShmYWN0b3J5KTsKICB9IGVsc2UgewogICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgIHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zID0gZmFjdG9yeShyb290KTsKICB9Cn0pKHVuZGVmaW5lZCwgZnVuY3Rpb24gKHJvb3QpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIHNhdmUgY3VycmVudCBTZWNvbmRMZXZlbERvbWFpbnMgdmFyaWFibGUsIGlmIGFueQoKICB2YXIgX1NlY29uZExldmVsRG9tYWlucyA9IHJvb3QgJiYgcm9vdC5TZWNvbmRMZXZlbERvbWFpbnM7CgogIHZhciBTTEQgPSB7CiAgICAvLyBsaXN0IG9mIGtub3duIFNlY29uZCBMZXZlbCBEb21haW5zCiAgICAvLyBjb252ZXJ0ZWQgbGlzdCBvZiBTTERzIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2dhdmluZ21pbGxlci9zZWNvbmQtbGV2ZWwtZG9tYWlucwogICAgLy8gLS0tLQogICAgLy8gcHVibGljc3VmZml4Lm9yZyBpcyBtb3JlIGN1cnJlbnQgYW5kIGFjdHVhbGx5IHVzZWQgYnkgYSBjb3VwbGUgb2YgYnJvd3NlcnMgaW50ZXJuYWxseS4KICAgIC8vIGRvd25zaWRlIGlzIGl0IGFsc28gY29udGFpbnMgZG9tYWlucyBsaWtlICJkeW5kbnMub3JnIiAtIHdoaWNoIGlzIGZpbmUgZm9yIHRoZSBzZWN1cml0eQogICAgLy8gaXNzdWVzIGJyb3dzZXIgaGF2ZSB0byBkZWFsIHdpdGggKFNPUCBmb3IgY29va2llcywgZXRjKSAtIGJ1dCBpcyB3YXkgb3ZlcmJvYXJkIGZvciBVUkkuanMKICAgIC8vIC0tLS0KICAgIGxpc3Q6IHsKICAgICAgJ2FjJzogJyBjb20gZ292IG1pbCBuZXQgb3JnICcsCiAgICAgICdhZSc6ICcgYWMgY28gZ292IG1pbCBuYW1lIG5ldCBvcmcgcHJvIHNjaCAnLAogICAgICAnYWYnOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2FsJzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG9yZyAnLAogICAgICAnYW8nOiAnIGNvIGVkIGd2IGl0IG9nIHBiICcsCiAgICAgICdhcic6ICcgY29tIGVkdSBnb2IgZ292IGludCBtaWwgbmV0IG9yZyB0dXIgJywKICAgICAgJ2F0JzogJyBhYyBjbyBndiBvciAnLAogICAgICAnYXUnOiAnIGFzbiBjb20gY3Npcm8gZWR1IGdvdiBpZCBuZXQgb3JnICcsCiAgICAgICdiYSc6ICcgY28gY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgcnMgdW5iaSB1bm1vIHVuc2EgdW50eiB1bnplICcsCiAgICAgICdiYic6ICcgYml6IGNvIGNvbSBlZHUgZ292IGluZm8gbmV0IG9yZyBzdG9yZSB0diAnLAogICAgICAnYmgnOiAnIGJpeiBjYyBjb20gZWR1IGdvdiBpbmZvIG5ldCBvcmcgJywKICAgICAgJ2JuJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdibyc6ICcgY29tIGVkdSBnb2IgZ292IGludCBtaWwgbmV0IG9yZyB0diAnLAogICAgICAnYnInOiAnIGFkbSBhZHYgYWdyIGFtIGFycSBhcnQgYXRvIGIgYmlvIGJsb2cgYm1kIGNpbSBjbmcgY250IGNvbSBjb29wIGVjbiBlZHUgZW5nIGVzcCBldGMgZXRpIGZhciBmbG9nIGZtIGZuZCBmb3QgZnN0IGcxMiBnZ2YgZ292IGltYiBpbmQgaW5mIGpvciBqdXMgbGVsIG1hdCBtZWQgbWlsIG11cyBuZXQgbm9tIG5vdCBudHIgb2RvIG9yZyBwcGcgcHJvIHBzYyBwc2kgcXNsIHJlYyBzbGcgc3J2IHRtcCB0cmQgdHVyIHR2IHZldCB2bG9nIHdpa2kgemxnICcsCiAgICAgICdicyc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnYnonOiAnIGR1IGV0IG9tIG92IHJnICcsCiAgICAgICdjYSc6ICcgYWIgYmMgbWIgbmIgbmYgbmwgbnMgbnQgbnUgb24gcGUgcWMgc2sgeWsgJywKICAgICAgJ2NrJzogJyBiaXogY28gZWR1IGdlbiBnb3YgaW5mbyBuZXQgb3JnICcsCiAgICAgICdjbic6ICcgYWMgYWggYmogY29tIGNxIGVkdSBmaiBnZCBnb3YgZ3MgZ3ggZ3ogaGEgaGIgaGUgaGkgaGwgaG4gamwganMganggbG4gbWlsIG5ldCBubSBueCBvcmcgcWggc2Mgc2Qgc2ggc24gc3ggdGogdHcgeGogeHogeW4gemogJywKICAgICAgJ2NvJzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG5vbSBvcmcgJywKICAgICAgJ2NyJzogJyBhYyBjIGNvIGVkIGZpIGdvIG9yIHNhICcsCiAgICAgICdjeSc6ICcgYWMgYml6IGNvbSBla2xvZ2VzIGdvdiBsdGQgbmFtZSBuZXQgb3JnIHBhcmxpYW1lbnQgcHJlc3MgcHJvIHRtICcsCiAgICAgICdkbyc6ICcgYXJ0IGNvbSBlZHUgZ29iIGdvdiBtaWwgbmV0IG9yZyBzbGQgd2ViICcsCiAgICAgICdkeic6ICcgYXJ0IGFzc28gY29tIGVkdSBnb3YgbmV0IG9yZyBwb2wgJywKICAgICAgJ2VjJzogJyBjb20gZWR1IGZpbiBnb3YgaW5mbyBtZWQgbWlsIG5ldCBvcmcgcHJvICcsCiAgICAgICdlZyc6ICcgY29tIGVkdSBldW4gZ292IG1pbCBuYW1lIG5ldCBvcmcgc2NpICcsCiAgICAgICdlcic6ICcgY29tIGVkdSBnb3YgaW5kIG1pbCBuZXQgb3JnIHJvY2hlc3QgdyAnLAogICAgICAnZXMnOiAnIGNvbSBlZHUgZ29iIG5vbSBvcmcgJywKICAgICAgJ2V0JzogJyBiaXogY29tIGVkdSBnb3YgaW5mbyBuYW1lIG5ldCBvcmcgJywKICAgICAgJ2ZqJzogJyBhYyBiaXogY29tIGluZm8gbWlsIG5hbWUgbmV0IG9yZyBwcm8gJywKICAgICAgJ2ZrJzogJyBhYyBjbyBnb3YgbmV0IG5vbSBvcmcgJywKICAgICAgJ2ZyJzogJyBhc3NvIGNvbSBmIGdvdXYgbm9tIHByZCBwcmVzc2UgdG0gJywKICAgICAgJ2dnJzogJyBjbyBuZXQgb3JnICcsCiAgICAgICdnaCc6ICcgY29tIGVkdSBnb3YgbWlsIG9yZyAnLAogICAgICAnZ24nOiAnIGFjIGNvbSBnb3YgbmV0IG9yZyAnLAogICAgICAnZ3InOiAnIGNvbSBlZHUgZ292IG1pbCBuZXQgb3JnICcsCiAgICAgICdndCc6ICcgY29tIGVkdSBnb2IgaW5kIG1pbCBuZXQgb3JnICcsCiAgICAgICdndSc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnaGsnOiAnIGNvbSBlZHUgZ292IGlkdiBuZXQgb3JnICcsCiAgICAgICdodSc6ICcgMjAwMCBhZ3JhciBib2x0IGNhc2lubyBjaXR5IGNvIGVyb3RpY2EgZXJvdGlrYSBmaWxtIGZvcnVtIGdhbWVzIGhvdGVsIGluZm8gaW5nYXRsYW4gam9nYXN6IGtvbnl2ZWxvIGxha2FzIG1lZGlhIG5ld3Mgb3JnIHByaXYgcmVrbGFtIHNleCBzaG9wIHNwb3J0IHN1bGkgc3pleCB0bSB0b3pzZGUgdXRhemFzIHZpZGVvICcsCiAgICAgICdpZCc6ICcgYWMgY28gZ28gbWlsIG5ldCBvciBzY2ggd2ViICcsCiAgICAgICdpbCc6ICcgYWMgY28gZ292IGlkZiBrMTIgbXVuaSBuZXQgb3JnICcsCiAgICAgICdpbic6ICcgYWMgY28gZWR1IGVybmV0IGZpcm0gZ2VuIGdvdiBpIGluZCBtaWwgbmV0IG5pYyBvcmcgcmVzICcsCiAgICAgICdpcSc6ICcgY29tIGVkdSBnb3YgaSBtaWwgbmV0IG9yZyAnLAogICAgICAnaXInOiAnIGFjIGNvIGRuc3NlYyBnb3YgaSBpZCBuZXQgb3JnIHNjaCAnLAogICAgICAnaXQnOiAnIGVkdSBnb3YgJywKICAgICAgJ2plJzogJyBjbyBuZXQgb3JnICcsCiAgICAgICdqbyc6ICcgY29tIGVkdSBnb3YgbWlsIG5hbWUgbmV0IG9yZyBzY2ggJywKICAgICAgJ2pwJzogJyBhYyBhZCBjbyBlZCBnbyBnciBsZyBuZSBvciAnLAogICAgICAna2UnOiAnIGFjIGNvIGdvIGluZm8gbWUgbW9iaSBuZSBvciBzYyAnLAogICAgICAna2gnOiAnIGNvbSBlZHUgZ292IG1pbCBuZXQgb3JnIHBlciAnLAogICAgICAna2knOiAnIGJpeiBjb20gZGUgZWR1IGdvdiBpbmZvIG1vYiBuZXQgb3JnIHRlbCAnLAogICAgICAna20nOiAnIGFzc28gY29tIGNvb3AgZWR1IGdvdXYgayBtZWRlY2luIG1pbCBub20gbm90YWlyZXMgcGhhcm1hY2llbnMgcHJlc3NlIHRtIHZldGVyaW5haXJlICcsCiAgICAgICdrbic6ICcgZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdrcic6ICcgYWMgYnVzYW4gY2h1bmdidWsgY2h1bmduYW0gY28gZGFlZ3UgZGFlamVvbiBlcyBnYW5nd29uIGdvIGd3YW5nanUgZ3llb25nYnVrIGd5ZW9uZ2dpIGd5ZW9uZ25hbSBocyBpbmNoZW9uIGplanUgamVvbmJ1ayBqZW9ubmFtIGsga2cgbWlsIG1zIG5lIG9yIHBlIHJlIHNjIHNlb3VsIHVsc2FuICcsCiAgICAgICdrdyc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAna3knOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2t6JzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG9yZyAnLAogICAgICAnbGInOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2xrJzogJyBhc3NuIGNvbSBlZHUgZ292IGdycCBob3RlbCBpbnQgbHRkIG5ldCBuZ28gb3JnIHNjaCBzb2Mgd2ViICcsCiAgICAgICdscic6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnbHYnOiAnIGFzbiBjb20gY29uZiBlZHUgZ292IGlkIG1pbCBuZXQgb3JnICcsCiAgICAgICdseSc6ICcgY29tIGVkdSBnb3YgaWQgbWVkIG5ldCBvcmcgcGxjIHNjaCAnLAogICAgICAnbWEnOiAnIGFjIGNvIGdvdiBtIG5ldCBvcmcgcHJlc3MgJywKICAgICAgJ21jJzogJyBhc3NvIHRtICcsCiAgICAgICdtZSc6ICcgYWMgY28gZWR1IGdvdiBpdHMgbmV0IG9yZyBwcml2ICcsCiAgICAgICdtZyc6ICcgY29tIGVkdSBnb3YgbWlsIG5vbSBvcmcgcHJkIHRtICcsCiAgICAgICdtayc6ICcgY29tIGVkdSBnb3YgaW5mIG5hbWUgbmV0IG9yZyBwcm8gJywKICAgICAgJ21sJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnIHByZXNzZSAnLAogICAgICAnbW4nOiAnIGVkdSBnb3Ygb3JnICcsCiAgICAgICdtbyc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnbXQnOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ212JzogJyBhZXJvIGJpeiBjb20gY29vcCBlZHUgZ292IGluZm8gaW50IG1pbCBtdXNldW0gbmFtZSBuZXQgb3JnIHBybyAnLAogICAgICAnbXcnOiAnIGFjIGNvIGNvbSBjb29wIGVkdSBnb3YgaW50IG11c2V1bSBuZXQgb3JnICcsCiAgICAgICdteCc6ICcgY29tIGVkdSBnb2IgbmV0IG9yZyAnLAogICAgICAnbXknOiAnIGNvbSBlZHUgZ292IG1pbCBuYW1lIG5ldCBvcmcgc2NoICcsCiAgICAgICduZic6ICcgYXJ0cyBjb20gZmlybSBpbmZvIG5ldCBvdGhlciBwZXIgcmVjIHN0b3JlIHdlYiAnLAogICAgICAnbmcnOiAnIGJpeiBjb20gZWR1IGdvdiBtaWwgbW9iaSBuYW1lIG5ldCBvcmcgc2NoICcsCiAgICAgICduaSc6ICcgYWMgY28gY29tIGVkdSBnb2IgbWlsIG5ldCBub20gb3JnICcsCiAgICAgICducCc6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgJywKICAgICAgJ25yJzogJyBiaXogY29tIGVkdSBnb3YgaW5mbyBuZXQgb3JnICcsCiAgICAgICdvbSc6ICcgYWMgYml6IGNvIGNvbSBlZHUgZ292IG1lZCBtaWwgbXVzZXVtIG5ldCBvcmcgcHJvIHNjaCAnLAogICAgICAncGUnOiAnIGNvbSBlZHUgZ29iIG1pbCBuZXQgbm9tIG9yZyBzbGQgJywKICAgICAgJ3BoJzogJyBjb20gZWR1IGdvdiBpIG1pbCBuZXQgbmdvIG9yZyAnLAogICAgICAncGsnOiAnIGJpeiBjb20gZWR1IGZhbSBnb2IgZ29rIGdvbiBnb3AgZ29zIGdvdiBuZXQgb3JnIHdlYiAnLAogICAgICAncGwnOiAnIGFydCBiaWFseXN0b2sgYml6IGNvbSBlZHUgZ2RhIGdkYW5zayBnb3J6b3cgZ292IGluZm8ga2F0b3dpY2Uga3Jha293IGxvZHogbHVibGluIG1pbCBuZXQgbmdvIG9sc3p0eW4gb3JnIHBvem5hbiBwd3IgcmFkb20gc2x1cHNrIHN6Y3plY2luIHRvcnVuIHdhcnN6YXdhIHdhdyB3cm9jIHdyb2NsYXcgemdvcmEgJywKICAgICAgJ3ByJzogJyBhYyBiaXogY29tIGVkdSBlc3QgZ292IGluZm8gaXNsYSBuYW1lIG5ldCBvcmcgcHJvIHByb2YgJywKICAgICAgJ3BzJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnIHBsbyBzZWMgJywKICAgICAgJ3B3JzogJyBiZWxhdSBjbyBlZCBnbyBuZSBvciAnLAogICAgICAncm8nOiAnIGFydHMgY29tIGZpcm0gaW5mbyBub20gbnQgb3JnIHJlYyBzdG9yZSB0bSB3d3cgJywKICAgICAgJ3JzJzogJyBhYyBjbyBlZHUgZ292IGluIG9yZyAnLAogICAgICAnc2InOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ3NjJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdzaCc6ICcgY28gY29tIGVkdSBnb3YgbmV0IG5vbSBvcmcgJywKICAgICAgJ3NsJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdzdCc6ICcgY28gY29tIGNvbnN1bGFkbyBlZHUgZW1iYWl4YWRhIGdvdiBtaWwgbmV0IG9yZyBwcmluY2lwZSBzYW90b21lIHN0b3JlICcsCiAgICAgICdzdic6ICcgY29tIGVkdSBnb2Igb3JnIHJlZCAnLAogICAgICAnc3onOiAnIGFjIGNvIG9yZyAnLAogICAgICAndHInOiAnIGF2IGJicyBiZWwgYml6IGNvbSBkciBlZHUgZ2VuIGdvdiBpbmZvIGsxMiBuYW1lIG5ldCBvcmcgcG9sIHRlbCB0c2sgdHYgd2ViICcsCiAgICAgICd0dCc6ICcgYWVybyBiaXogY2F0IGNvIGNvbSBjb29wIGVkdSBnb3YgaW5mbyBpbnQgam9icyBtaWwgbW9iaSBtdXNldW0gbmFtZSBuZXQgb3JnIHBybyB0ZWwgdHJhdmVsICcsCiAgICAgICd0dyc6ICcgY2x1YiBjb20gZWJpeiBlZHUgZ2FtZSBnb3YgaWR2IG1pbCBuZXQgb3JnICcsCiAgICAgICdtdSc6ICcgYWMgY28gY29tIGdvdiBuZXQgb3Igb3JnICcsCiAgICAgICdteic6ICcgYWMgY28gZWR1IGdvdiBvcmcgJywKICAgICAgJ25hJzogJyBjbyBjb20gJywKICAgICAgJ256JzogJyBhYyBjbyBjcmkgZ2VlayBnZW4gZ292dCBoZWFsdGggaXdpIG1hb3JpIG1pbCBuZXQgb3JnIHBhcmxpYW1lbnQgc2Nob29sICcsCiAgICAgICdwYSc6ICcgYWJvIGFjIGNvbSBlZHUgZ29iIGluZyBtZWQgbmV0IG5vbSBvcmcgc2xkICcsCiAgICAgICdwdCc6ICcgY29tIGVkdSBnb3YgaW50IG5ldCBub21lIG9yZyBwdWJsICcsCiAgICAgICdweSc6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgJywKICAgICAgJ3FhJzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG9yZyAnLAogICAgICAncmUnOiAnIGFzc28gY29tIG5vbSAnLAogICAgICAncnUnOiAnIGFjIGFkeWdleWEgYWx0YWkgYW11ciBhcmtoYW5nZWxzayBhc3RyYWtoYW4gYmFzaGtpcmlhIGJlbGdvcm9kIGJpciBicnlhbnNrIGJ1cnlhdGlhIGNiZyBjaGVsIGNoZWx5YWJpbnNrIGNoaXRhIGNodWtvdGthIGNodXZhc2hpYSBjb20gZGFnZXN0YW4gZS1idXJnIGVkdSBnb3YgZ3Jvem55IGludCBpcmt1dHNrIGl2YW5vdm8gaXpoZXZzayBqYXIgam9zaGthci1vbGEga2FsbXlraWEga2FsdWdhIGthbWNoYXRrYSBrYXJlbGlhIGthemFuIGtjaHIga2VtZXJvdm8ga2hhYmFyb3ZzayBraGFrYXNzaWEga2h2IGtpcm92IGtvZW5pZyBrb21pIGtvc3Ryb21hIGtyYW5veWFyc2sga3ViYW4ga3VyZ2FuIGt1cnNrIGxpcGV0c2sgbWFnYWRhbiBtYXJpIG1hcmktZWwgbWFyaW5lIG1pbCBtb3Jkb3ZpYSBtb3NyZWcgbXNrIG11cm1hbnNrIG5hbGNoaWsgbmV0IG5ub3Ygbm92IG5vdm9zaWJpcnNrIG5zayBvbXNrIG9yZW5idXJnIG9yZyBvcnlvbCBwZW56YSBwZXJtIHBwIHBza292IHB0eiBybmQgcnlhemFuIHNha2hhbGluIHNhbWFyYSBzYXJhdG92IHNpbWJpcnNrIHNtb2xlbnNrIHNwYiBzdGF2cm9wb2wgc3R2IHN1cmd1dCB0YW1ib3YgdGF0YXJzdGFuIHRvbSB0b21zayB0c2FyaXRzeW4gdHNrIHR1bGEgdHV2YSB0dmVyIHR5dW1lbiB1ZG0gdWRtdXJ0aWEgdWxhbi11ZGUgdmxhZGlrYXZrYXogdmxhZGltaXIgdmxhZGl2b3N0b2sgdm9sZ29ncmFkIHZvbG9nZGEgdm9yb25lemggdnJuIHZ5YXRrYSB5YWt1dGlhIHlhbWFsIHlla2F0ZXJpbmJ1cmcgeXV6aG5vLXNha2hhbGluc2sgJywKICAgICAgJ3J3JzogJyBhYyBjbyBjb20gZWR1IGdvdXYgZ292IGludCBtaWwgbmV0ICcsCiAgICAgICdzYSc6ICcgY29tIGVkdSBnb3YgbWVkIG5ldCBvcmcgcHViIHNjaCAnLAogICAgICAnc2QnOiAnIGNvbSBlZHUgZ292IGluZm8gbWVkIG5ldCBvcmcgdHYgJywKICAgICAgJ3NlJzogJyBhIGFjIGIgYmQgYyBkIGUgZiBnIGggaSBrIGwgbSBuIG8gb3JnIHAgcGFydGkgcHAgcHJlc3MgciBzIHQgdG0gdSB3IHggeSB6ICcsCiAgICAgICdzZyc6ICcgY29tIGVkdSBnb3YgaWRuIG5ldCBvcmcgcGVyICcsCiAgICAgICdzbic6ICcgYXJ0IGNvbSBlZHUgZ291diBvcmcgcGVyc28gdW5pdiAnLAogICAgICAnc3knOiAnIGNvbSBlZHUgZ292IG1pbCBuZXQgbmV3cyBvcmcgJywKICAgICAgJ3RoJzogJyBhYyBjbyBnbyBpbiBtaSBuZXQgb3IgJywKICAgICAgJ3RqJzogJyBhYyBiaXogY28gY29tIGVkdSBnbyBnb3YgaW5mbyBpbnQgbWlsIG5hbWUgbmV0IG5pYyBvcmcgdGVzdCB3ZWIgJywKICAgICAgJ3RuJzogJyBhZ3JpbmV0IGNvbSBkZWZlbnNlIGVkdW5ldCBlbnMgZmluIGdvdiBpbmQgaW5mbyBpbnRsIG1pbmNvbSBuYXQgbmV0IG9yZyBwZXJzbyBybnJ0IHJucyBybnUgdG91cmlzbSAnLAogICAgICAndHonOiAnIGFjIGNvIGdvIG5lIG9yICcsCiAgICAgICd1YSc6ICcgYml6IGNoZXJrYXNzeSBjaGVybmlnb3YgY2hlcm5vdnRzeSBjayBjbiBjbyBjb20gY3JpbWVhIGN2IGRuIGRuZXByb3BldHJvdnNrIGRvbmV0c2sgZHAgZWR1IGdvdiBpZiBpbiBpdmFuby1mcmFua2l2c2sga2gga2hhcmtvdiBraGVyc29uIGtobWVsbml0c2tpeSBraWV2IGtpcm92b2dyYWQga20ga3Iga3Mga3YgbGcgbHVnYW5zayBsdXRzayBsdml2IG1lIG1rIG5ldCBuaWtvbGFldiBvZCBvZGVzc2Egb3JnIHBsIHBvbHRhdmEgcHAgcm92bm8gcnYgc2ViYXN0b3BvbCBzdW15IHRlIHRlcm5vcGlsIHV6aGdvcm9kIHZpbm5pY2Egdm4gemFwb3Jpemh6aGUgemhpdG9taXIgenAgenQgJywKICAgICAgJ3VnJzogJyBhYyBjbyBnbyBuZSBvciBvcmcgc2MgJywKICAgICAgJ3VrJzogJyBhYyBibCBicml0aXNoLWxpYnJhcnkgY28gY3ltIGdvdiBnb3Z0IGljbmV0IGpldCBsZWEgbHRkIG1lIG1pbCBtb2QgbmF0aW9uYWwtbGlicmFyeS1zY290bGFuZCBuZWwgbmV0IG5ocyBuaWMgbmxzIG9yZyBvcmduIHBhcmxpYW1lbnQgcGxjIHBvbGljZSBzY2ggc2NvdCBzb2MgJywKICAgICAgJ3VzJzogJyBkbmkgZmVkIGlzYSBraWRzIG5zbiAnLAogICAgICAndXknOiAnIGNvbSBlZHUgZ3ViIG1pbCBuZXQgb3JnICcsCiAgICAgICd2ZSc6ICcgY28gY29tIGVkdSBnb2IgaW5mbyBtaWwgbmV0IG9yZyB3ZWIgJywKICAgICAgJ3ZpJzogJyBjbyBjb20gazEyIG5ldCBvcmcgJywKICAgICAgJ3ZuJzogJyBhYyBiaXogY29tIGVkdSBnb3YgaGVhbHRoIGluZm8gaW50IG5hbWUgbmV0IG9yZyBwcm8gJywKICAgICAgJ3llJzogJyBjbyBjb20gZ292IGx0ZCBtZSBuZXQgb3JnIHBsYyAnLAogICAgICAneXUnOiAnIGFjIGNvIGVkdSBnb3Ygb3JnICcsCiAgICAgICd6YSc6ICcgYWMgYWdyaWMgYWx0IGJvdXJzZSBjaXR5IGNvIGN5YmVybmV0IGRiIGVkdSBnb3YgZ3JvbmRhciBpYWNjZXNzIGltdCBpbmNhIGxhbmRlc2lnbiBsYXcgbWlsIG5ldCBuZ28gbmlzIG5vbSBvbGl2ZXR0aSBvcmcgcGl4IHNjaG9vbCB0bSB3ZWIgJywKICAgICAgJ3ptJzogJyBhYyBjbyBjb20gZWR1IGdvdiBuZXQgb3JnIHNjaCAnCiAgICB9LAogICAgLy8gZ29yaGlsbCAyMDEzLTEwLTI1OiBVc2luZyBpbmRleE9mKCkgaW5zdGVhZCBSZWdleHAoKS4gU2lnbmlmaWNhbnQgYm9vc3QKICAgIC8vIGluIGJvdGggcGVyZm9ybWFuY2UgYW5kIG1lbW9yeSBmb290cHJpbnQuIE5vIGluaXRpYWxpemF0aW9uIHJlcXVpcmVkLgogICAgLy8gaHR0cDovL2pzcGVyZi5jb20vdXJpLWpzLXNsZC1yZWdleC12cy1iaW5hcnktc2VhcmNoLzQKICAgIC8vIEZvbGxvd2luZyBtZXRob2RzIHVzZSBsYXN0SW5kZXhPZigpIHJhdGhlciB0aGFuIGFycmF5LnNwbGl0KCkgaW4gb3JkZXIKICAgIC8vIHRvIGF2b2lkIGFueSBtZW1vcnkgYWxsb2NhdGlvbnMuCiAgICBoYXM6IGZ1bmN0aW9uIGhhcyhkb21haW4pIHsKICAgICAgdmFyIHRsZE9mZnNldCA9IGRvbWFpbi5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAodGxkT2Zmc2V0IDw9IDAgfHwgdGxkT2Zmc2V0ID49IGRvbWFpbi5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBzbGRPZmZzZXQgPSBkb21haW4ubGFzdEluZGV4T2YoJy4nLCB0bGRPZmZzZXQgLSAxKTsKICAgICAgaWYgKHNsZE9mZnNldCA8PSAwIHx8IHNsZE9mZnNldCA+PSB0bGRPZmZzZXQgLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBzbGRMaXN0ID0gU0xELmxpc3RbZG9tYWluLnNsaWNlKHRsZE9mZnNldCArIDEpXTsKICAgICAgaWYgKCFzbGRMaXN0KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiBzbGRMaXN0LmluZGV4T2YoJyAnICsgZG9tYWluLnNsaWNlKHNsZE9mZnNldCArIDEsIHRsZE9mZnNldCkgKyAnICcpID49IDA7CiAgICB9LAogICAgaXM6IGZ1bmN0aW9uIGlzKGRvbWFpbikgewogICAgICB2YXIgdGxkT2Zmc2V0ID0gZG9tYWluLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgIGlmICh0bGRPZmZzZXQgPD0gMCB8fCB0bGRPZmZzZXQgPj0gZG9tYWluLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIHNsZE9mZnNldCA9IGRvbWFpbi5sYXN0SW5kZXhPZignLicsIHRsZE9mZnNldCAtIDEpOwogICAgICBpZiAoc2xkT2Zmc2V0ID49IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIHNsZExpc3QgPSBTTEQubGlzdFtkb21haW4uc2xpY2UodGxkT2Zmc2V0ICsgMSldOwogICAgICBpZiAoIXNsZExpc3QpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHNsZExpc3QuaW5kZXhPZignICcgKyBkb21haW4uc2xpY2UoMCwgdGxkT2Zmc2V0KSArICcgJykgPj0gMDsKICAgIH0sCiAgICBnZXQ6IGZ1bmN0aW9uIGdldChkb21haW4pIHsKICAgICAgdmFyIHRsZE9mZnNldCA9IGRvbWFpbi5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAodGxkT2Zmc2V0IDw9IDAgfHwgdGxkT2Zmc2V0ID49IGRvbWFpbi5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIHNsZE9mZnNldCA9IGRvbWFpbi5sYXN0SW5kZXhPZignLicsIHRsZE9mZnNldCAtIDEpOwogICAgICBpZiAoc2xkT2Zmc2V0IDw9IDAgfHwgc2xkT2Zmc2V0ID49IHRsZE9mZnNldCAtIDEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YXIgc2xkTGlzdCA9IFNMRC5saXN0W2RvbWFpbi5zbGljZSh0bGRPZmZzZXQgKyAxKV07CiAgICAgIGlmICghc2xkTGlzdCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlmIChzbGRMaXN0LmluZGV4T2YoJyAnICsgZG9tYWluLnNsaWNlKHNsZE9mZnNldCArIDEsIHRsZE9mZnNldCkgKyAnICcpIDwgMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBkb21haW4uc2xpY2Uoc2xkT2Zmc2V0ICsgMSk7CiAgICB9LAogICAgbm9Db25mbGljdDogZnVuY3Rpb24gbm9Db25mbGljdCgpIHsKICAgICAgaWYgKHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zID09PSB0aGlzKSB7CiAgICAgICAgcm9vdC5TZWNvbmRMZXZlbERvbWFpbnMgPSBfU2Vjb25kTGV2ZWxEb21haW5zOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CgogIHJldHVybiBTTEQ7Cn0pOwoKfSx7fV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsKCi8qIQogKiBVUkkuanMgLSBNdXRhdGluZyBVUkxzCiAqCiAqIFZlcnNpb246IDEuMTguMAogKgogKiBBdXRob3I6IFJvZG5leSBSZWhtCiAqIFdlYjogaHR0cDovL21lZGlhbGl6ZS5naXRodWIuaW8vVVJJLmpzLwogKgogKiBMaWNlbnNlZCB1bmRlcgogKiAgIE1JVCBMaWNlbnNlIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UKICoKICovCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICd1c2Ugc3RyaWN0JzsKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvbWFzdGVyL3JldHVybkV4cG9ydHMuanMKCiAgaWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JykgewogICAgLy8gTm9kZQogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJy4vcHVueWNvZGUnKSwgcmVxdWlyZSgnLi9JUHY2JyksIHJlcXVpcmUoJy4vU2Vjb25kTGV2ZWxEb21haW5zJykpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuCiAgICBkZWZpbmUoWycuL3B1bnljb2RlJywgJy4vSVB2NicsICcuL1NlY29uZExldmVsRG9tYWlucyddLCBmYWN0b3J5KTsKICB9IGVsc2UgewogICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgIHJvb3QuVVJJID0gZmFjdG9yeShyb290LnB1bnljb2RlLCByb290LklQdjYsIHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zLCByb290KTsKICB9Cn0pKHVuZGVmaW5lZCwgZnVuY3Rpb24gKHB1bnljb2RlLCBJUHY2LCBTTEQsIHJvb3QpIHsKICAndXNlIHN0cmljdCc7CiAgLypnbG9iYWwgbG9jYXRpb24sIGVzY2FwZSwgdW5lc2NhcGUgKi8KICAvLyBGSVhNRTogdjIuMC4wIHJlbmFtY2Ugbm9uLWNhbWVsQ2FzZSBwcm9wZXJ0aWVzIHRvIHVwcGVyY2FzZQogIC8qanNoaW50IGNhbWVsY2FzZTogZmFsc2UgKi8KCiAgLy8gc2F2ZSBjdXJyZW50IFVSSSB2YXJpYWJsZSwgaWYgYW55CgogIHZhciBfVVJJID0gcm9vdCAmJiByb290LlVSSTsKCiAgZnVuY3Rpb24gVVJJKHVybCwgYmFzZSkgewogICAgdmFyIF91cmxTdXBwbGllZCA9IGFyZ3VtZW50cy5sZW5ndGggPj0gMTsKICAgIHZhciBfYmFzZVN1cHBsaWVkID0gYXJndW1lbnRzLmxlbmd0aCA+PSAyOwoKICAgIC8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFVSSSkpIHsKICAgICAgaWYgKF91cmxTdXBwbGllZCkgewogICAgICAgIGlmIChfYmFzZVN1cHBsaWVkKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFVSSSh1cmwsIGJhc2UpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBVUkkodXJsKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBVUkkoKTsKICAgIH0KCiAgICBpZiAodXJsID09PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKF91cmxTdXBwbGllZCkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3VuZGVmaW5lZCBpcyBub3QgYSB2YWxpZCBhcmd1bWVudCBmb3IgVVJJJyk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgbG9jYXRpb24gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgdXJsID0gbG9jYXRpb24uaHJlZiArICcnOwogICAgICB9IGVsc2UgewogICAgICAgIHVybCA9ICcnOwogICAgICB9CiAgICB9CgogICAgdGhpcy5ocmVmKHVybCk7CgogICAgLy8gcmVzb2x2ZSB0byBiYXNlIGFjY29yZGluZyB0byBodHRwOi8vZHZjcy53My5vcmcvaGcvdXJsL3Jhdy1maWxlL3RpcC9PdmVydmlldy5odG1sI2NvbnN0cnVjdG9yCiAgICBpZiAoYmFzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzLmFic29sdXRlVG8oYmFzZSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBVUkkudmVyc2lvbiA9ICcxLjE4LjAnOwoKICB2YXIgcCA9IFVSSS5wcm90b3R5cGU7CiAgdmFyIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4KHN0cmluZykgewogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21lZGlhbGl6ZS9VUkkuanMvY29tbWl0Lzg1YWMyMTc4M2MxMWY4Y2NhYjA2MTA2ZGJhOTczNWEzMWE4NjkyNGQjY29tbWl0Y29tbWVudC04MjE5NjMKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvKFsuKis/Xj0hOiR7fSgpfFtcXVwvXFxdKS9nLCAnXFwkMScpOwogIH0KCiAgZnVuY3Rpb24gZ2V0VHlwZSh2YWx1ZSkgewogICAgLy8gSUU4IGRvZXNuJ3QgcmV0dXJuIFtPYmplY3QgVW5kZWZpbmVkXSBidXQgW09iamVjdCBPYmplY3RdIGZvciB1bmRlZmluZWQgdmFsdWUKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiAnVW5kZWZpbmVkJzsKICAgIH0KCiAgICByZXR1cm4gU3RyaW5nKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkpLnNsaWNlKDgsIC0xKTsKICB9CgogIGZ1bmN0aW9uIGlzQXJyYXkob2JqKSB7CiAgICByZXR1cm4gZ2V0VHlwZShvYmopID09PSAnQXJyYXknOwogIH0KCiAgZnVuY3Rpb24gZmlsdGVyQXJyYXlWYWx1ZXMoZGF0YSwgdmFsdWUpIHsKICAgIHZhciBsb29rdXAgPSB7fTsKICAgIHZhciBpLCBsZW5ndGg7CgogICAgaWYgKGdldFR5cGUodmFsdWUpID09PSAnUmVnRXhwJykgewogICAgICBsb29rdXAgPSBudWxsOwogICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFt2YWx1ZVtpXV0gPSB0cnVlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsb29rdXBbdmFsdWVdID0gdHJ1ZTsKICAgIH0KCiAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIC8qanNoaW50IGxheGJyZWFrOiB0cnVlICovCiAgICAgIHZhciBfbWF0Y2ggPSBsb29rdXAgJiYgbG9va3VwW2RhdGFbaV1dICE9PSB1bmRlZmluZWQgfHwgIWxvb2t1cCAmJiB2YWx1ZS50ZXN0KGRhdGFbaV0pOwogICAgICAvKmpzaGludCBsYXhicmVhazogZmFsc2UgKi8KICAgICAgaWYgKF9tYXRjaCkgewogICAgICAgIGRhdGEuc3BsaWNlKGksIDEpOwogICAgICAgIGxlbmd0aC0tOwogICAgICAgIGktLTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBkYXRhOwogIH0KCiAgZnVuY3Rpb24gYXJyYXlDb250YWlucyhsaXN0LCB2YWx1ZSkgewogICAgdmFyIGksIGxlbmd0aDsKCiAgICAvLyB2YWx1ZSBtYXkgYmUgc3RyaW5nLCBudW1iZXIsIGFycmF5LCByZWdleHAKICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAvLyBOb3RlOiB0aGlzIGNhbiBiZSBvcHRpbWl6ZWQgdG8gTyhuKSAoaW5zdGVhZCBvZiBjdXJyZW50IE8obSAqIG4pKQogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmICghYXJyYXlDb250YWlucyhsaXN0LCB2YWx1ZVtpXSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHZhciBfdHlwZSA9IGdldFR5cGUodmFsdWUpOwogICAgZm9yIChpID0gMCwgbGVuZ3RoID0gbGlzdC5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBpZiAoX3R5cGUgPT09ICdSZWdFeHAnKSB7CiAgICAgICAgaWYgKHR5cGVvZiBsaXN0W2ldID09PSAnc3RyaW5nJyAmJiBsaXN0W2ldLm1hdGNoKHZhbHVlKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGxpc3RbaV0gPT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBhcnJheXNFcXVhbChvbmUsIHR3bykgewogICAgaWYgKCFpc0FycmF5KG9uZSkgfHwgIWlzQXJyYXkodHdvKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gYXJyYXlzIGNhbid0IGJlIGVxdWFsIGlmIHRoZXkgaGF2ZSBkaWZmZXJlbnQgYW1vdW50IG9mIGNvbnRlbnQKICAgIGlmIChvbmUubGVuZ3RoICE9PSB0d28ubGVuZ3RoKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBvbmUuc29ydCgpOwogICAgdHdvLnNvcnQoKTsKCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IG9uZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaWYgKG9uZVtpXSAhPT0gdHdvW2ldKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmltU2xhc2hlcyh0ZXh0KSB7CiAgICB2YXIgdHJpbV9leHByZXNzaW9uID0gL15cLyt8XC8rJC9nOwogICAgcmV0dXJuIHRleHQucmVwbGFjZSh0cmltX2V4cHJlc3Npb24sICcnKTsKICB9CgogIFVSSS5fcGFydHMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICBwcm90b2NvbDogbnVsbCwKICAgICAgdXNlcm5hbWU6IG51bGwsCiAgICAgIHBhc3N3b3JkOiBudWxsLAogICAgICBob3N0bmFtZTogbnVsbCwKICAgICAgdXJuOiBudWxsLAogICAgICBwb3J0OiBudWxsLAogICAgICBwYXRoOiBudWxsLAogICAgICBxdWVyeTogbnVsbCwKICAgICAgZnJhZ21lbnQ6IG51bGwsCiAgICAgIC8vIHN0YXRlCiAgICAgIGR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVyczogVVJJLmR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycywKICAgICAgZXNjYXBlUXVlcnlTcGFjZTogVVJJLmVzY2FwZVF1ZXJ5U3BhY2UKICAgIH07CiAgfTsKICAvLyBzdGF0ZTogYWxsb3cgZHVwbGljYXRlIHF1ZXJ5IHBhcmFtZXRlcnMgKGE9MSZhPTEpCiAgVVJJLmR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycyA9IGZhbHNlOwogIC8vIHN0YXRlOiByZXBsYWNlcyArIHdpdGggJTIwIChzcGFjZSBpbiBxdWVyeSBzdHJpbmdzKQogIFVSSS5lc2NhcGVRdWVyeVNwYWNlID0gdHJ1ZTsKICAvLyBzdGF0aWMgcHJvcGVydGllcwogIFVSSS5wcm90b2NvbF9leHByZXNzaW9uID0gL15bYS16XVthLXowLTkuKy1dKiQvaTsKICBVUkkuaWRuX2V4cHJlc3Npb24gPSAvW15hLXowLTlcLi1dL2k7CiAgVVJJLnB1bnljb2RlX2V4cHJlc3Npb24gPSAvKHhuLS0pL2k7CiAgLy8gd2VsbCwgMzMzLjQ0NC41NTUuNjY2IG1hdGNoZXMsIGJ1dCBpdCBzdXJlIGFpbid0IG5vIElQdjQgLSBkbyB3ZSBjYXJlPwogIFVSSS5pcDRfZXhwcmVzc2lvbiA9IC9eXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfVwuXGR7MSwzfSQvOwogIC8vIGNyZWRpdHMgdG8gUmljaCBCcm93bgogIC8vIHNvdXJjZTogaHR0cDovL2ZvcnVtcy5pbnRlcm1hcHBlci5jb20vdmlld3RvcGljLnBocD9wPTEwOTYjMTA5NgogIC8vIHNwZWNpZmljYXRpb246IGh0dHA6Ly93d3cuaWV0Zi5vcmcvcmZjL3JmYzQyOTEudHh0CiAgVVJJLmlwNl9leHByZXNzaW9uID0gL15ccyooKChbMC05QS1GYS1mXXsxLDR9Oil7N30oWzAtOUEtRmEtZl17MSw0fXw6KSl8KChbMC05QS1GYS1mXXsxLDR9Oil7Nn0oOlswLTlBLUZhLWZdezEsNH18KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXs1fSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDJ9KXw6KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXs0fSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDN9KXwoKDpbMC05QS1GYS1mXXsxLDR9KT86KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pKXw6KSl8KChbMC05QS1GYS1mXXsxLDR9Oil7M30oKCg6WzAtOUEtRmEtZl17MSw0fSl7MSw0fSl8KCg6WzAtOUEtRmEtZl17MSw0fSl7MCwyfTooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSkpfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXsyfSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDV9KXwoKDpbMC05QS1GYS1mXXsxLDR9KXswLDN9OigoMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkoXC4oMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkpezN9KSl8OikpfCgoWzAtOUEtRmEtZl17MSw0fTopezF9KCgoOlswLTlBLUZhLWZdezEsNH0pezEsNn0pfCgoOlswLTlBLUZhLWZdezEsNH0pezAsNH06KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pKXw6KSl8KDooKCg6WzAtOUEtRmEtZl17MSw0fSl7MSw3fSl8KCg6WzAtOUEtRmEtZl17MSw0fSl7MCw1fTooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSkpfDopKSkoJS4rKT9ccyokLzsKICAvLyBleHByZXNzaW9uIHVzZWQgaXMgImdydWJlciByZXZpc2VkIiAoQGdydWJlciB2MikgZGV0ZXJtaW5lZCB0byBiZSB0aGUKICAvLyBiZXN0IHNvbHV0aW9uIGluIGEgcmVnZXgtZ29sZiB3ZSBkaWQgYSBjb3VwbGUgb2YgYWdlcyBhZ28gYXQKICAvLyAqIGh0dHA6Ly9tYXRoaWFzYnluZW5zLmJlL2RlbW8vdXJsLXJlZ2V4CiAgLy8gKiBodHRwOi8vcm9kbmV5cmVobS5kZS90L3VybC1yZWdleC5odG1sCiAgVVJJLmZpbmRfdXJpX2V4cHJlc3Npb24gPSAvXGIoKD86W2Etel1bXHctXSs6KD86XC97MSwzfXxbYS16MC05JV0pfHd3d1xkezAsM31bLl18W2EtejAtOS5cLV0rWy5dW2Etel17Miw0fVwvKSg/OlteXHMoKTw+XSt8XCgoW15ccygpPD5dK3woXChbXlxzKCk8Pl0rXCkpKSpcKSkrKD86XCgoW15ccygpPD5dK3woXChbXlxzKCk8Pl0rXCkpKSpcKXxbXlxzYCEoKVxbXF17fTs6JyIuLDw+P8KrwrvigJzigJ3igJjigJldKSkvaWc7CiAgVVJJLmZpbmRVcmkgPSB7CiAgICAvLyB2YWxpZCAic2NoZW1lOi8vIiBvciAid3d3LiIKICAgIHN0YXJ0OiAvXGIoPzooW2Etel1bYS16MC05ListXSo6XC9cLyl8d3d3XC4pL2dpLAogICAgLy8gZXZlcnl0aGluZyB1cCB0byB0aGUgbmV4dCB3aGl0ZXNwYWNlCiAgICBlbmQ6IC9bXHNcclxuXXwkLywKICAgIC8vIHRyaW0gdHJhaWxpbmcgcHVuY3R1YXRpb24gY2FwdHVyZWQgYnkgZW5kIFJlZ0V4cAogICAgdHJpbTogL1tgISgpXFtcXXt9OzonIi4sPD4/wqvCu+KAnOKAneKAnuKAmOKAmV0rJC8KICB9OwogIC8vIGh0dHA6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvdXJpLXNjaGVtZXMuaHRtbAogIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9UQ1BfYW5kX1VEUF9wb3J0X251bWJlcnMjV2VsbC1rbm93bl9wb3J0cwogIFVSSS5kZWZhdWx0UG9ydHMgPSB7CiAgICBodHRwOiAnODAnLAogICAgaHR0cHM6ICc0NDMnLAogICAgZnRwOiAnMjEnLAogICAgZ29waGVyOiAnNzAnLAogICAgd3M6ICc4MCcsCiAgICB3c3M6ICc0NDMnCiAgfTsKICAvLyBhbGxvd2VkIGhvc3RuYW1lIGNoYXJhY3RlcnMgYWNjb3JkaW5nIHRvIFJGQyAzOTg2CiAgLy8gQUxQSEEgRElHSVQgIi0iICIuIiAiXyIgIn4iICIhIiAiJCIgIiYiICInIiAiKCIgIikiICIqIiAiKyIgIiwiICI7IiAiPSIgJWVuY29kZWQKICAvLyBJJ3ZlIG5ldmVyIHNlZW4gYSAobm9uLUlETikgaG9zdG5hbWUgb3RoZXIgdGhhbjogQUxQSEEgRElHSVQgLiAtCiAgVVJJLmludmFsaWRfaG9zdG5hbWVfY2hhcmFjdGVycyA9IC9bXmEtekEtWjAtOVwuLV0vOwogIC8vIG1hcCBET00gRWxlbWVudHMgdG8gdGhlaXIgVVJJIGF0dHJpYnV0ZQogIFVSSS5kb21BdHRyaWJ1dGVzID0gewogICAgJ2EnOiAnaHJlZicsCiAgICAnYmxvY2txdW90ZSc6ICdjaXRlJywKICAgICdsaW5rJzogJ2hyZWYnLAogICAgJ2Jhc2UnOiAnaHJlZicsCiAgICAnc2NyaXB0JzogJ3NyYycsCiAgICAnZm9ybSc6ICdhY3Rpb24nLAogICAgJ2ltZyc6ICdzcmMnLAogICAgJ2FyZWEnOiAnaHJlZicsCiAgICAnaWZyYW1lJzogJ3NyYycsCiAgICAnZW1iZWQnOiAnc3JjJywKICAgICdzb3VyY2UnOiAnc3JjJywKICAgICd0cmFjayc6ICdzcmMnLAogICAgJ2lucHV0JzogJ3NyYycsIC8vIGJ1dCBvbmx5IGlmIHR5cGU9ImltYWdlIgogICAgJ2F1ZGlvJzogJ3NyYycsCiAgICAndmlkZW8nOiAnc3JjJwogIH07CiAgVVJJLmdldERvbUF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICBpZiAoIW5vZGUgfHwgIW5vZGUubm9kZU5hbWUpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICB2YXIgbm9kZU5hbWUgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAvLyA8aW5wdXQ+IHNob3VsZCBvbmx5IGV4cG9zZSBzcmMgZm9yIHR5cGU9ImltYWdlIgogICAgaWYgKG5vZGVOYW1lID09PSAnaW5wdXQnICYmIG5vZGUudHlwZSAhPT0gJ2ltYWdlJykgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQoKICAgIHJldHVybiBVUkkuZG9tQXR0cmlidXRlc1tub2RlTmFtZV07CiAgfTsKCiAgZnVuY3Rpb24gZXNjYXBlRm9yRHVtYkZpcmVmb3gzNih2YWx1ZSkgewogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21lZGlhbGl6ZS9VUkkuanMvaXNzdWVzLzkxCiAgICByZXR1cm4gZXNjYXBlKHZhbHVlKTsKICB9CgogIC8vIGVuY29kaW5nIC8gZGVjb2RpbmcgYWNjb3JkaW5nIHRvIFJGQzM5ODYKICBmdW5jdGlvbiBzdHJpY3RFbmNvZGVVUklDb21wb25lbnQoc3RyaW5nKSB7CiAgICAvLyBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9lbmNvZGVVUklDb21wb25lbnQKICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5nKS5yZXBsYWNlKC9bIScoKSpdL2csIGVzY2FwZUZvckR1bWJGaXJlZm94MzYpLnJlcGxhY2UoL1wqL2csICclMkEnKTsKICB9CiAgVVJJLmVuY29kZSA9IHN0cmljdEVuY29kZVVSSUNvbXBvbmVudDsKICBVUkkuZGVjb2RlID0gZGVjb2RlVVJJQ29tcG9uZW50OwogIFVSSS5pc284ODU5ID0gZnVuY3Rpb24gKCkgewogICAgVVJJLmVuY29kZSA9IGVzY2FwZTsKICAgIFVSSS5kZWNvZGUgPSB1bmVzY2FwZTsKICB9OwogIFVSSS51bmljb2RlID0gZnVuY3Rpb24gKCkgewogICAgVVJJLmVuY29kZSA9IHN0cmljdEVuY29kZVVSSUNvbXBvbmVudDsKICAgIFVSSS5kZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQ7CiAgfTsKICBVUkkuY2hhcmFjdGVycyA9IHsKICAgIHBhdGhuYW1lOiB7CiAgICAgIGVuY29kZTogewogICAgICAgIC8vIFJGQzM5ODYgMi4xOiBGb3IgY29uc2lzdGVuY3ksIFVSSSBwcm9kdWNlcnMgYW5kIG5vcm1hbGl6ZXJzIHNob3VsZAogICAgICAgIC8vIHVzZSB1cHBlcmNhc2UgaGV4YWRlY2ltYWwgZGlnaXRzIGZvciBhbGwgcGVyY2VudC1lbmNvZGluZ3MuCiAgICAgICAgZXhwcmVzc2lvbjogLyUoMjR8MjZ8MkJ8MkN8M0J8M0R8M0F8NDApL2lnLAogICAgICAgIG1hcDogewogICAgICAgICAgLy8gLS5ffiEnKCkqCiAgICAgICAgICAnJTI0JzogJyQnLAogICAgICAgICAgJyUyNic6ICcmJywKICAgICAgICAgICclMkInOiAnKycsCiAgICAgICAgICAnJTJDJzogJywnLAogICAgICAgICAgJyUzQic6ICc7JywKICAgICAgICAgICclM0QnOiAnPScsCiAgICAgICAgICAnJTNBJzogJzonLAogICAgICAgICAgJyU0MCc6ICdAJwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVjb2RlOiB7CiAgICAgICAgZXhwcmVzc2lvbjogL1tcL1w/I10vZywKICAgICAgICBtYXA6IHsKICAgICAgICAgICcvJzogJyUyRicsCiAgICAgICAgICAnPyc6ICclM0YnLAogICAgICAgICAgJyMnOiAnJTIzJwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHJlc2VydmVkOiB7CiAgICAgIGVuY29kZTogewogICAgICAgIC8vIFJGQzM5ODYgMi4xOiBGb3IgY29uc2lzdGVuY3ksIFVSSSBwcm9kdWNlcnMgYW5kIG5vcm1hbGl6ZXJzIHNob3VsZAogICAgICAgIC8vIHVzZSB1cHBlcmNhc2UgaGV4YWRlY2ltYWwgZGlnaXRzIGZvciBhbGwgcGVyY2VudC1lbmNvZGluZ3MuCiAgICAgICAgZXhwcmVzc2lvbjogLyUoMjF8MjN8MjR8MjZ8Mjd8Mjh8Mjl8MkF8MkJ8MkN8MkZ8M0F8M0J8M0R8M0Z8NDB8NUJ8NUQpL2lnLAogICAgICAgIG1hcDogewogICAgICAgICAgLy8gZ2VuLWRlbGltcwogICAgICAgICAgJyUzQSc6ICc6JywKICAgICAgICAgICclMkYnOiAnLycsCiAgICAgICAgICAnJTNGJzogJz8nLAogICAgICAgICAgJyUyMyc6ICcjJywKICAgICAgICAgICclNUInOiAnWycsCiAgICAgICAgICAnJTVEJzogJ10nLAogICAgICAgICAgJyU0MCc6ICdAJywKICAgICAgICAgIC8vIHN1Yi1kZWxpbXMKICAgICAgICAgICclMjEnOiAnIScsCiAgICAgICAgICAnJTI0JzogJyQnLAogICAgICAgICAgJyUyNic6ICcmJywKICAgICAgICAgICclMjcnOiAnXCcnLAogICAgICAgICAgJyUyOCc6ICcoJywKICAgICAgICAgICclMjknOiAnKScsCiAgICAgICAgICAnJTJBJzogJyonLAogICAgICAgICAgJyUyQic6ICcrJywKICAgICAgICAgICclMkMnOiAnLCcsCiAgICAgICAgICAnJTNCJzogJzsnLAogICAgICAgICAgJyUzRCc6ICc9JwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHVybnBhdGg6IHsKICAgICAgLy8gVGhlIGNoYXJhY3RlcnMgdW5kZXIgYGVuY29kZWAgYXJlIHRoZSBjaGFyYWN0ZXJzIGNhbGxlZCBvdXQgYnkgUkZDIDIxNDEgYXMgYmVpbmcgYWNjZXB0YWJsZQogICAgICAvLyBmb3IgdXNhZ2UgaW4gYSBVUk4uIFJGQzIxNDEgYWxzbyBjYWxscyBvdXQgIi0iLCAiLiIsIGFuZCAiXyIgYXMgYWNjZXB0YWJsZSBjaGFyYWN0ZXJzLCBidXQKICAgICAgLy8gdGhlc2UgYXJlbid0IGVuY29kZWQgYnkgZW5jb2RlVVJJQ29tcG9uZW50LCBzbyB3ZSBkb24ndCBoYXZlIHRvIGNhbGwgdGhlbSBvdXQgaGVyZS4gQWxzbwogICAgICAvLyBub3RlIHRoYXQgdGhlIGNvbG9uIGNoYXJhY3RlciBpcyBub3QgZmVhdHVyZWQgaW4gdGhlIGVuY29kaW5nIG1hcDsgdGhpcyBpcyBiZWNhdXNlIFVSSS5qcwogICAgICAvLyBnaXZlcyB0aGUgY29sb25zIGluIFVSTnMgc2VtYW50aWMgbWVhbmluZyBhcyB0aGUgZGVsaW1pdGVycyBvZiBwYXRoIHNlZ2VtZW50cywgYW5kIHNvIGl0CiAgICAgIC8vIHNob3VsZCBub3QgYXBwZWFyIHVuZW5jb2RlZCBpbiBhIHNlZ21lbnQgaXRzZWxmLgogICAgICAvLyBTZWUgYWxzbyB0aGUgbm90ZSBhYm92ZSBhYm91dCBSRkMzOTg2IGFuZCBjYXBpdGFsYWxpemVkIGhleCBkaWdpdHMuCiAgICAgIGVuY29kZTogewogICAgICAgIGV4cHJlc3Npb246IC8lKDIxfDI0fDI3fDI4fDI5fDJBfDJCfDJDfDNCfDNEfDQwKS9pZywKICAgICAgICBtYXA6IHsKICAgICAgICAgICclMjEnOiAnIScsCiAgICAgICAgICAnJTI0JzogJyQnLAogICAgICAgICAgJyUyNyc6ICdcJycsCiAgICAgICAgICAnJTI4JzogJygnLAogICAgICAgICAgJyUyOSc6ICcpJywKICAgICAgICAgICclMkEnOiAnKicsCiAgICAgICAgICAnJTJCJzogJysnLAogICAgICAgICAgJyUyQyc6ICcsJywKICAgICAgICAgICclM0InOiAnOycsCiAgICAgICAgICAnJTNEJzogJz0nLAogICAgICAgICAgJyU0MCc6ICdAJwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gVGhlc2UgY2hhcmFjdGVycyBhcmUgdGhlIGNoYXJhY3RlcnMgY2FsbGVkIG91dCBieSBSRkMyMTQxIGFzICJyZXNlcnZlZCIgY2hhcmFjdGVycyB0aGF0CiAgICAgIC8vIHNob3VsZCBuZXZlciBhcHBlYXIgaW4gYSBVUk4sIHBsdXMgdGhlIGNvbG9uIGNoYXJhY3RlciAoc2VlIG5vdGUgYWJvdmUpLgogICAgICBkZWNvZGU6IHsKICAgICAgICBleHByZXNzaW9uOiAvW1wvXD8jOl0vZywKICAgICAgICBtYXA6IHsKICAgICAgICAgICcvJzogJyUyRicsCiAgICAgICAgICAnPyc6ICclM0YnLAogICAgICAgICAgJyMnOiAnJTIzJywKICAgICAgICAgICc6JzogJyUzQScKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogIFVSSS5lbmNvZGVRdWVyeSA9IGZ1bmN0aW9uIChzdHJpbmcsIGVzY2FwZVF1ZXJ5U3BhY2UpIHsKICAgIHZhciBlc2NhcGVkID0gVVJJLmVuY29kZShzdHJpbmcgKyAnJyk7CiAgICBpZiAoZXNjYXBlUXVlcnlTcGFjZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGVzY2FwZVF1ZXJ5U3BhY2UgPSBVUkkuZXNjYXBlUXVlcnlTcGFjZTsKICAgIH0KCiAgICByZXR1cm4gZXNjYXBlUXVlcnlTcGFjZSA/IGVzY2FwZWQucmVwbGFjZSgvJTIwL2csICcrJykgOiBlc2NhcGVkOwogIH07CiAgVVJJLmRlY29kZVF1ZXJ5ID0gZnVuY3Rpb24gKHN0cmluZywgZXNjYXBlUXVlcnlTcGFjZSkgewogICAgc3RyaW5nICs9ICcnOwogICAgaWYgKGVzY2FwZVF1ZXJ5U3BhY2UgPT09IHVuZGVmaW5lZCkgewogICAgICBlc2NhcGVRdWVyeVNwYWNlID0gVVJJLmVzY2FwZVF1ZXJ5U3BhY2U7CiAgICB9CgogICAgdHJ5IHsKICAgICAgcmV0dXJuIFVSSS5kZWNvZGUoZXNjYXBlUXVlcnlTcGFjZSA/IHN0cmluZy5yZXBsYWNlKC9cKy9nLCAnJTIwJykgOiBzdHJpbmcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICAvLyB3ZSdyZSBub3QgZ29pbmcgdG8gbWVzcyB3aXRoIHdlaXJkIGVuY29kaW5ncywKICAgICAgLy8gZ2l2ZSB1cCBhbmQgcmV0dXJuIHRoZSB1bmRlY29kZWQgb3JpZ2luYWwgc3RyaW5nCiAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbWVkaWFsaXplL1VSSS5qcy9pc3N1ZXMvODcKICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tZWRpYWxpemUvVVJJLmpzL2lzc3Vlcy85MgogICAgICByZXR1cm4gc3RyaW5nOwogICAgfQogIH07CiAgLy8gZ2VuZXJhdGUgZW5jb2RlL2RlY29kZSBwYXRoIGZ1bmN0aW9ucwogIHZhciBfcGFydHMgPSB7ICdlbmNvZGUnOiAnZW5jb2RlJywgJ2RlY29kZSc6ICdkZWNvZGUnIH07CiAgdmFyIF9wYXJ0OwogIHZhciBnZW5lcmF0ZUFjY2Vzc29yID0gZnVuY3Rpb24gZ2VuZXJhdGVBY2Nlc3NvcihfZ3JvdXAsIF9wYXJ0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHN0cmluZykgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBVUklbX3BhcnRdKHN0cmluZyArICcnKS5yZXBsYWNlKFVSSS5jaGFyYWN0ZXJzW19ncm91cF1bX3BhcnRdLmV4cHJlc3Npb24sIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICByZXR1cm4gVVJJLmNoYXJhY3RlcnNbX2dyb3VwXVtfcGFydF0ubWFwW2NdOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gd2UncmUgbm90IGdvaW5nIHRvIG1lc3Mgd2l0aCB3ZWlyZCBlbmNvZGluZ3MsCiAgICAgICAgLy8gZ2l2ZSB1cCBhbmQgcmV0dXJuIHRoZSB1bmRlY29kZWQgb3JpZ2luYWwgc3RyaW5nCiAgICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tZWRpYWxpemUvVVJJLmpzL2lzc3Vlcy84NwogICAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbWVkaWFsaXplL1VSSS5qcy9pc3N1ZXMvOTIKICAgICAgICByZXR1cm4gc3RyaW5nOwogICAgICB9CiAgICB9OwogIH07CgogIGZvciAoX3BhcnQgaW4gX3BhcnRzKSB7CiAgICBVUklbX3BhcnQgKyAnUGF0aFNlZ21lbnQnXSA9IGdlbmVyYXRlQWNjZXNzb3IoJ3BhdGhuYW1lJywgX3BhcnRzW19wYXJ0XSk7CiAgICBVUklbX3BhcnQgKyAnVXJuUGF0aFNlZ21lbnQnXSA9IGdlbmVyYXRlQWNjZXNzb3IoJ3VybnBhdGgnLCBfcGFydHNbX3BhcnRdKTsKICB9CgogIHZhciBnZW5lcmF0ZVNlZ21lbnRlZFBhdGhGdW5jdGlvbiA9IGZ1bmN0aW9uIGdlbmVyYXRlU2VnbWVudGVkUGF0aEZ1bmN0aW9uKF9zZXAsIF9jb2RpbmdGdW5jTmFtZSwgX2lubmVyQ29kaW5nRnVuY05hbWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgIC8vIFdoeSBwYXNzIGluIG5hbWVzIG9mIGZ1bmN0aW9ucywgcmF0aGVyIHRoYW4gdGhlIGZ1bmN0aW9uIG9iamVjdHMgdGhlbXNlbHZlcz8gVGhlCiAgICAgIC8vIGRlZmluaXRpb25zIG9mIHNvbWUgZnVuY3Rpb25zIChidXQgaW4gcGFydGljdWxhciwgVVJJLmRlY29kZSkgd2lsbCBvY2Nhc2lvbmFsbHkgY2hhbmdlIGR1ZQogICAgICAvLyB0byBVUkkuanMgaGF2aW5nIElTTzg4NTkgYW5kIFVuaWNvZGUgbW9kZXMuIFBhc3NpbmcgaW4gdGhlIG5hbWUgYW5kIGdldHRpbmcgaXQgd2lsbCBlbnN1cmUKICAgICAgLy8gdGhhdCB0aGUgZnVuY3Rpb25zIHdlIHVzZSBoZXJlIGFyZSAiZnJlc2giLgogICAgICB2YXIgYWN0dWFsQ29kaW5nRnVuYzsKICAgICAgaWYgKCFfaW5uZXJDb2RpbmdGdW5jTmFtZSkgewogICAgICAgIGFjdHVhbENvZGluZ0Z1bmMgPSBVUklbX2NvZGluZ0Z1bmNOYW1lXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3R1YWxDb2RpbmdGdW5jID0gZnVuY3Rpb24gYWN0dWFsQ29kaW5nRnVuYyhzdHJpbmcpIHsKICAgICAgICAgIHJldHVybiBVUklbX2NvZGluZ0Z1bmNOYW1lXShVUklbX2lubmVyQ29kaW5nRnVuY05hbWVdKHN0cmluZykpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBzZWdtZW50cyA9IChzdHJpbmcgKyAnJykuc3BsaXQoX3NlcCk7CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBzZWdtZW50c1tpXSA9IGFjdHVhbENvZGluZ0Z1bmMoc2VnbWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gc2VnbWVudHMuam9pbihfc2VwKTsKICAgIH07CiAgfTsKCiAgLy8gVGhpcyB0YWtlcyBwbGFjZSBvdXRzaWRlIHRoZSBhYm92ZSBsb29wIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCwgZS5nLiwgZW5jb2RlVXJuUGF0aCBmdW5jdGlvbnMuCiAgVVJJLmRlY29kZVBhdGggPSBnZW5lcmF0ZVNlZ21lbnRlZFBhdGhGdW5jdGlvbignLycsICdkZWNvZGVQYXRoU2VnbWVudCcpOwogIFVSSS5kZWNvZGVVcm5QYXRoID0gZ2VuZXJhdGVTZWdtZW50ZWRQYXRoRnVuY3Rpb24oJzonLCAnZGVjb2RlVXJuUGF0aFNlZ21lbnQnKTsKICBVUkkucmVjb2RlUGF0aCA9IGdlbmVyYXRlU2VnbWVudGVkUGF0aEZ1bmN0aW9uKCcvJywgJ2VuY29kZVBhdGhTZWdtZW50JywgJ2RlY29kZScpOwogIFVSSS5yZWNvZGVVcm5QYXRoID0gZ2VuZXJhdGVTZWdtZW50ZWRQYXRoRnVuY3Rpb24oJzonLCAnZW5jb2RlVXJuUGF0aFNlZ21lbnQnLCAnZGVjb2RlJyk7CgogIFVSSS5lbmNvZGVSZXNlcnZlZCA9IGdlbmVyYXRlQWNjZXNzb3IoJ3Jlc2VydmVkJywgJ2VuY29kZScpOwoKICBVUkkucGFyc2UgPSBmdW5jdGlvbiAoc3RyaW5nLCBwYXJ0cykgewogICAgdmFyIHBvczsKICAgIGlmICghcGFydHMpIHsKICAgICAgcGFydHMgPSB7fTsKICAgIH0KICAgIC8vIFtwcm90b2NvbCI6Ly8iW3VzZXJuYW1lWyI6InBhc3N3b3JkXSJAIl1ob3N0bmFtZVsiOiJwb3J0XSIvIj9dW3BhdGhdWyI/InF1ZXJ5c3RyaW5nXVsiIyJmcmFnbWVudF0KCiAgICAvLyBleHRyYWN0IGZyYWdtZW50CiAgICBwb3MgPSBzdHJpbmcuaW5kZXhPZignIycpOwogICAgaWYgKHBvcyA+IC0xKSB7CiAgICAgIC8vIGVzY2FwaW5nPwogICAgICBwYXJ0cy5mcmFnbWVudCA9IHN0cmluZy5zdWJzdHJpbmcocG9zICsgMSkgfHwgbnVsbDsKICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZygwLCBwb3MpOwogICAgfQoKICAgIC8vIGV4dHJhY3QgcXVlcnkKICAgIHBvcyA9IHN0cmluZy5pbmRleE9mKCc/Jyk7CiAgICBpZiAocG9zID4gLTEpIHsKICAgICAgLy8gZXNjYXBpbmc/CiAgICAgIHBhcnRzLnF1ZXJ5ID0gc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAxKSB8fCBudWxsOwogICAgICBzdHJpbmcgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHBvcyk7CiAgICB9CgogICAgLy8gZXh0cmFjdCBwcm90b2NvbAogICAgaWYgKHN0cmluZy5zdWJzdHJpbmcoMCwgMikgPT09ICcvLycpIHsKICAgICAgLy8gcmVsYXRpdmUtc2NoZW1lCiAgICAgIHBhcnRzLnByb3RvY29sID0gbnVsbDsKICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZygyKTsKICAgICAgLy8gZXh0cmFjdCAidXNlcjpwYXNzQGhvc3Q6cG9ydCIKICAgICAgc3RyaW5nID0gVVJJLnBhcnNlQXV0aG9yaXR5KHN0cmluZywgcGFydHMpOwogICAgfSBlbHNlIHsKICAgICAgcG9zID0gc3RyaW5nLmluZGV4T2YoJzonKTsKICAgICAgaWYgKHBvcyA+IC0xKSB7CiAgICAgICAgcGFydHMucHJvdG9jb2wgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHBvcykgfHwgbnVsbDsKICAgICAgICBpZiAocGFydHMucHJvdG9jb2wgJiYgIXBhcnRzLnByb3RvY29sLm1hdGNoKFVSSS5wcm90b2NvbF9leHByZXNzaW9uKSkgewogICAgICAgICAgLy8gOiBtYXkgYmUgd2l0aGluIHRoZSBwYXRoCiAgICAgICAgICBwYXJ0cy5wcm90b2NvbCA9IHVuZGVmaW5lZDsKICAgICAgICB9IGVsc2UgaWYgKHN0cmluZy5zdWJzdHJpbmcocG9zICsgMSwgcG9zICsgMykgPT09ICcvLycpIHsKICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5zdWJzdHJpbmcocG9zICsgMyk7CgogICAgICAgICAgLy8gZXh0cmFjdCAidXNlcjpwYXNzQGhvc3Q6cG9ydCIKICAgICAgICAgIHN0cmluZyA9IFVSSS5wYXJzZUF1dGhvcml0eShzdHJpbmcsIHBhcnRzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAxKTsKICAgICAgICAgIHBhcnRzLnVybiA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gd2hhdCdzIGxlZnQgbXVzdCBiZSB0aGUgcGF0aAogICAgcGFydHMucGF0aCA9IHN0cmluZzsKCiAgICAvLyBhbmQgd2UncmUgZG9uZQogICAgcmV0dXJuIHBhcnRzOwogIH07CiAgVVJJLnBhcnNlSG9zdCA9IGZ1bmN0aW9uIChzdHJpbmcsIHBhcnRzKSB7CiAgICAvLyBDb3B5IGNocm9tZSwgSUUsIG9wZXJhIGJhY2tzbGFzaC1oYW5kbGluZyBiZWhhdmlvci4KICAgIC8vIEJhY2sgc2xhc2hlcyBiZWZvcmUgdGhlIHF1ZXJ5IHN0cmluZyBnZXQgY29udmVydGVkIHRvIGZvcndhcmQgc2xhc2hlcwogICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vam95ZW50L25vZGUvYmxvYi8zODZmZDI0ZjQ5YjBlOWQxYThhMDc2NTkyYTQwNDE2OGZhZWVjYzM0L2xpYi91cmwuanMjTDExNS1MMTI0CiAgICAvLyBTZWU6IGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0yNTkxNgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21lZGlhbGl6ZS9VUkkuanMvcHVsbC8yMzMKICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9cXC9nLCAnLycpOwoKICAgIC8vIGV4dHJhY3QgaG9zdDpwb3J0CiAgICB2YXIgcG9zID0gc3RyaW5nLmluZGV4T2YoJy8nKTsKICAgIHZhciBicmFja2V0UG9zOwogICAgdmFyIHQ7CgogICAgaWYgKHBvcyA9PT0gLTEpIHsKICAgICAgcG9zID0gc3RyaW5nLmxlbmd0aDsKICAgIH0KCiAgICBpZiAoc3RyaW5nLmNoYXJBdCgwKSA9PT0gJ1snKSB7CiAgICAgIC8vIElQdjYgaG9zdCAtIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL2RyYWZ0LWlldGYtNm1hbi10ZXh0LWFkZHItcmVwcmVzZW50YXRpb24tMDQjc2VjdGlvbi02CiAgICAgIC8vIEkgY2xhaW0gbW9zdCBjbGllbnQgc29mdHdhcmUgYnJlYWtzIG9uIElQdjYgYW55d2F5cy4gVG8gc2ltcGxpZnkgdGhpbmdzLCBVUkkgb25seSBhY2NlcHRzCiAgICAgIC8vIElQdjYrcG9ydCBpbiB0aGUgZm9ybWF0IFsyMDAxOmRiODo6MV06ODAgKGZvciB0aGUgdGltZSBiZWluZykKICAgICAgYnJhY2tldFBvcyA9IHN0cmluZy5pbmRleE9mKCddJyk7CiAgICAgIHBhcnRzLmhvc3RuYW1lID0gc3RyaW5nLnN1YnN0cmluZygxLCBicmFja2V0UG9zKSB8fCBudWxsOwogICAgICBwYXJ0cy5wb3J0ID0gc3RyaW5nLnN1YnN0cmluZyhicmFja2V0UG9zICsgMiwgcG9zKSB8fCBudWxsOwogICAgICBpZiAocGFydHMucG9ydCA9PT0gJy8nKSB7CiAgICAgICAgcGFydHMucG9ydCA9IG51bGw7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBmaXJzdENvbG9uID0gc3RyaW5nLmluZGV4T2YoJzonKTsKICAgICAgdmFyIGZpcnN0U2xhc2ggPSBzdHJpbmcuaW5kZXhPZignLycpOwogICAgICB2YXIgbmV4dENvbG9uID0gc3RyaW5nLmluZGV4T2YoJzonLCBmaXJzdENvbG9uICsgMSk7CiAgICAgIGlmIChuZXh0Q29sb24gIT09IC0xICYmIChmaXJzdFNsYXNoID09PSAtMSB8fCBuZXh0Q29sb24gPCBmaXJzdFNsYXNoKSkgewogICAgICAgIC8vIElQdjYgaG9zdCBjb250YWlucyBtdWx0aXBsZSBjb2xvbnMgLSBidXQgbm8gcG9ydAogICAgICAgIC8vIHRoaXMgbm90YXRpb24gaXMgYWN0dWFsbHkgbm90IGFsbG93ZWQgYnkgUkZDIDM5ODYsIGJ1dCB3ZSdyZSBhIGxpYmVyYWwgcGFyc2VyCiAgICAgICAgcGFydHMuaG9zdG5hbWUgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHBvcykgfHwgbnVsbDsKICAgICAgICBwYXJ0cy5wb3J0ID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ID0gc3RyaW5nLnN1YnN0cmluZygwLCBwb3MpLnNwbGl0KCc6Jyk7CiAgICAgICAgcGFydHMuaG9zdG5hbWUgPSB0WzBdIHx8IG51bGw7CiAgICAgICAgcGFydHMucG9ydCA9IHRbMV0gfHwgbnVsbDsKICAgICAgfQogICAgfQoKICAgIGlmIChwYXJ0cy5ob3N0bmFtZSAmJiBzdHJpbmcuc3Vic3RyaW5nKHBvcykuY2hhckF0KDApICE9PSAnLycpIHsKICAgICAgcG9zKys7CiAgICAgIHN0cmluZyA9ICcvJyArIHN0cmluZzsKICAgIH0KCiAgICByZXR1cm4gc3RyaW5nLnN1YnN0cmluZyhwb3MpIHx8ICcvJzsKICB9OwogIFVSSS5wYXJzZUF1dGhvcml0eSA9IGZ1bmN0aW9uIChzdHJpbmcsIHBhcnRzKSB7CiAgICBzdHJpbmcgPSBVUkkucGFyc2VVc2VyaW5mbyhzdHJpbmcsIHBhcnRzKTsKICAgIHJldHVybiBVUkkucGFyc2VIb3N0KHN0cmluZywgcGFydHMpOwogIH07CiAgVVJJLnBhcnNlVXNlcmluZm8gPSBmdW5jdGlvbiAoc3RyaW5nLCBwYXJ0cykgewogICAgLy8gZXh0cmFjdCB1c2VybmFtZTpwYXNzd29yZAogICAgdmFyIGZpcnN0U2xhc2ggPSBzdHJpbmcuaW5kZXhPZignLycpOwogICAgdmFyIHBvcyA9IHN0cmluZy5sYXN0SW5kZXhPZignQCcsIGZpcnN0U2xhc2ggPiAtMSA/IGZpcnN0U2xhc2ggOiBzdHJpbmcubGVuZ3RoIC0gMSk7CiAgICB2YXIgdDsKCiAgICAvLyBhdXRob3JpdHlAIG11c3QgY29tZSBiZWZvcmUgL3BhdGgKICAgIGlmIChwb3MgPiAtMSAmJiAoZmlyc3RTbGFzaCA9PT0gLTEgfHwgcG9zIDwgZmlyc3RTbGFzaCkpIHsKICAgICAgdCA9IHN0cmluZy5zdWJzdHJpbmcoMCwgcG9zKS5zcGxpdCgnOicpOwogICAgICBwYXJ0cy51c2VybmFtZSA9IHRbMF0gPyBVUkkuZGVjb2RlKHRbMF0pIDogbnVsbDsKICAgICAgdC5zaGlmdCgpOwogICAgICBwYXJ0cy5wYXNzd29yZCA9IHRbMF0gPyBVUkkuZGVjb2RlKHQuam9pbignOicpKSA6IG51bGw7CiAgICAgIHN0cmluZyA9IHN0cmluZy5zdWJzdHJpbmcocG9zICsgMSk7CiAgICB9IGVsc2UgewogICAgICBwYXJ0cy51c2VybmFtZSA9IG51bGw7CiAgICAgIHBhcnRzLnBhc3N3b3JkID0gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gc3RyaW5nOwogIH07CiAgVVJJLnBhcnNlUXVlcnkgPSBmdW5jdGlvbiAoc3RyaW5nLCBlc2NhcGVRdWVyeVNwYWNlKSB7CiAgICBpZiAoIXN0cmluZykgewogICAgICByZXR1cm4ge307CiAgICB9CgogICAgLy8gdGhyb3cgb3V0IHRoZSBmdW5reSBidXNpbmVzcyAtICI/IltuYW1lIj0idmFsdWUiJiJdKwogICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLyYrL2csICcmJykucmVwbGFjZSgvXlw/KiYqfCYrJC9nLCAnJyk7CgogICAgaWYgKCFzdHJpbmcpIHsKICAgICAgcmV0dXJuIHt9OwogICAgfQoKICAgIHZhciBpdGVtcyA9IHt9OwogICAgdmFyIHNwbGl0cyA9IHN0cmluZy5zcGxpdCgnJicpOwogICAgdmFyIGxlbmd0aCA9IHNwbGl0cy5sZW5ndGg7CiAgICB2YXIgdiwgbmFtZSwgdmFsdWU7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2ID0gc3BsaXRzW2ldLnNwbGl0KCc9Jyk7CiAgICAgIG5hbWUgPSBVUkkuZGVjb2RlUXVlcnkodi5zaGlmdCgpLCBlc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgLy8gbm8gIj0iIGlzIG51bGwgYWNjb3JkaW5nIHRvIGh0dHA6Ly9kdmNzLnczLm9yZy9oZy91cmwvcmF3LWZpbGUvdGlwL092ZXJ2aWV3Lmh0bWwjY29sbGVjdC11cmwtcGFyYW1ldGVycwogICAgICB2YWx1ZSA9IHYubGVuZ3RoID8gVVJJLmRlY29kZVF1ZXJ5KHYuam9pbignPScpLCBlc2NhcGVRdWVyeVNwYWNlKSA6IG51bGw7CgogICAgICBpZiAoaGFzT3duLmNhbGwoaXRlbXMsIG5hbWUpKSB7CiAgICAgICAgaWYgKHR5cGVvZiBpdGVtc1tuYW1lXSA9PT0gJ3N0cmluZycgfHwgaXRlbXNbbmFtZV0gPT09IG51bGwpIHsKICAgICAgICAgIGl0ZW1zW25hbWVdID0gW2l0ZW1zW25hbWVdXTsKICAgICAgICB9CgogICAgICAgIGl0ZW1zW25hbWVdLnB1c2godmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW1zW25hbWVdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gaXRlbXM7CiAgfTsKCiAgVVJJLmJ1aWxkID0gZnVuY3Rpb24gKHBhcnRzKSB7CiAgICB2YXIgdCA9ICcnOwoKICAgIGlmIChwYXJ0cy5wcm90b2NvbCkgewogICAgICB0ICs9IHBhcnRzLnByb3RvY29sICsgJzonOwogICAgfQoKICAgIGlmICghcGFydHMudXJuICYmICh0IHx8IHBhcnRzLmhvc3RuYW1lKSkgewogICAgICB0ICs9ICcvLyc7CiAgICB9CgogICAgdCArPSBVUkkuYnVpbGRBdXRob3JpdHkocGFydHMpIHx8ICcnOwoKICAgIGlmICh0eXBlb2YgcGFydHMucGF0aCA9PT0gJ3N0cmluZycpIHsKICAgICAgaWYgKHBhcnRzLnBhdGguY2hhckF0KDApICE9PSAnLycgJiYgdHlwZW9mIHBhcnRzLmhvc3RuYW1lID09PSAnc3RyaW5nJykgewogICAgICAgIHQgKz0gJy8nOwogICAgICB9CgogICAgICB0ICs9IHBhcnRzLnBhdGg7CiAgICB9CgogICAgaWYgKHR5cGVvZiBwYXJ0cy5xdWVyeSA9PT0gJ3N0cmluZycgJiYgcGFydHMucXVlcnkpIHsKICAgICAgdCArPSAnPycgKyBwYXJ0cy5xdWVyeTsKICAgIH0KCiAgICBpZiAodHlwZW9mIHBhcnRzLmZyYWdtZW50ID09PSAnc3RyaW5nJyAmJiBwYXJ0cy5mcmFnbWVudCkgewogICAgICB0ICs9ICcjJyArIHBhcnRzLmZyYWdtZW50OwogICAgfQogICAgcmV0dXJuIHQ7CiAgfTsKICBVUkkuYnVpbGRIb3N0ID0gZnVuY3Rpb24gKHBhcnRzKSB7CiAgICB2YXIgdCA9ICcnOwoKICAgIGlmICghcGFydHMuaG9zdG5hbWUpIHsKICAgICAgcmV0dXJuICcnOwogICAgfSBlbHNlIGlmIChVUkkuaXA2X2V4cHJlc3Npb24udGVzdChwYXJ0cy5ob3N0bmFtZSkpIHsKICAgICAgdCArPSAnWycgKyBwYXJ0cy5ob3N0bmFtZSArICddJzsKICAgIH0gZWxzZSB7CiAgICAgIHQgKz0gcGFydHMuaG9zdG5hbWU7CiAgICB9CgogICAgaWYgKHBhcnRzLnBvcnQpIHsKICAgICAgdCArPSAnOicgKyBwYXJ0cy5wb3J0OwogICAgfQoKICAgIHJldHVybiB0OwogIH07CiAgVVJJLmJ1aWxkQXV0aG9yaXR5ID0gZnVuY3Rpb24gKHBhcnRzKSB7CiAgICByZXR1cm4gVVJJLmJ1aWxkVXNlcmluZm8ocGFydHMpICsgVVJJLmJ1aWxkSG9zdChwYXJ0cyk7CiAgfTsKICBVUkkuYnVpbGRVc2VyaW5mbyA9IGZ1bmN0aW9uIChwYXJ0cykgewogICAgdmFyIHQgPSAnJzsKCiAgICBpZiAocGFydHMudXNlcm5hbWUpIHsKICAgICAgdCArPSBVUkkuZW5jb2RlKHBhcnRzLnVzZXJuYW1lKTsKICAgIH0KCiAgICBpZiAocGFydHMucGFzc3dvcmQpIHsKICAgICAgdCArPSAnOicgKyBVUkkuZW5jb2RlKHBhcnRzLnBhc3N3b3JkKTsKICAgIH0KCiAgICBpZiAodCkgewogICAgICB0ICs9ICdAJzsKICAgIH0KCiAgICByZXR1cm4gdDsKICB9OwogIFVSSS5idWlsZFF1ZXJ5ID0gZnVuY3Rpb24gKGRhdGEsIGR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycywgZXNjYXBlUXVlcnlTcGFjZSkgewogICAgLy8gYWNjb3JkaW5nIHRvIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM5ODYgb3IgaHR0cDovL2xhYnMuYXBhY2hlLm9yZy93ZWJhcmNoL3VyaS9yZmMvcmZjMzk4Ni5odG1sCiAgICAvLyBiZWluZyDCuy0uX34hJCYnKCkqKyw7PTpALz/CqyAlSEVYIGFuZCBhbG51bSBhcmUgYWxsb3dlZAogICAgLy8gdGhlIFJGQyBleHBsaWNpdGx5IHN0YXRlcyA/L2ZvbyBiZWluZyBhIHZhbGlkIHVzZSBjYXNlLCBubyBtZW50aW9uIG9mIHBhcmFtZXRlciBzeW50YXghCiAgICAvLyBVUkkuanMgdHJlYXRzIHRoZSBxdWVyeSBzdHJpbmcgYXMgYmVpbmcgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkCiAgICAvLyBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLWh0bWw0MC9pbnRlcmFjdC9mb3Jtcy5odG1sI2Zvcm0tY29udGVudC10eXBlCgogICAgdmFyIHQgPSAnJzsKICAgIHZhciB1bmlxdWUsIGtleSwgaSwgbGVuZ3RoOwogICAgZm9yIChrZXkgaW4gZGF0YSkgewogICAgICBpZiAoaGFzT3duLmNhbGwoZGF0YSwga2V5KSAmJiBrZXkpIHsKICAgICAgICBpZiAoaXNBcnJheShkYXRhW2tleV0pKSB7CiAgICAgICAgICB1bmlxdWUgPSB7fTsKICAgICAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGRhdGFba2V5XS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZGF0YVtrZXldW2ldICE9PSB1bmRlZmluZWQgJiYgdW5pcXVlW2RhdGFba2V5XVtpXSArICcnXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdCArPSAnJicgKyBVUkkuYnVpbGRRdWVyeVBhcmFtZXRlcihrZXksIGRhdGFba2V5XVtpXSwgZXNjYXBlUXVlcnlTcGFjZSk7CiAgICAgICAgICAgICAgaWYgKGR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycyAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdW5pcXVlW2RhdGFba2V5XVtpXSArICcnXSA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdCArPSAnJicgKyBVUkkuYnVpbGRRdWVyeVBhcmFtZXRlcihrZXksIGRhdGFba2V5XSwgZXNjYXBlUXVlcnlTcGFjZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHQuc3Vic3RyaW5nKDEpOwogIH07CiAgVVJJLmJ1aWxkUXVlcnlQYXJhbWV0ZXIgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGVzY2FwZVF1ZXJ5U3BhY2UpIHsKICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL1JFQy1odG1sNDAvaW50ZXJhY3QvZm9ybXMuaHRtbCNmb3JtLWNvbnRlbnQtdHlwZSAtLSBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQKICAgIC8vIGRvbid0IGFwcGVuZCAiPSIgZm9yIG51bGwgdmFsdWVzLCBhY2NvcmRpbmcgdG8gaHR0cDovL2R2Y3MudzMub3JnL2hnL3VybC9yYXctZmlsZS90aXAvT3ZlcnZpZXcuaHRtbCN1cmwtcGFyYW1ldGVyLXNlcmlhbGl6YXRpb24KICAgIHJldHVybiBVUkkuZW5jb2RlUXVlcnkobmFtZSwgZXNjYXBlUXVlcnlTcGFjZSkgKyAodmFsdWUgIT09IG51bGwgPyAnPScgKyBVUkkuZW5jb2RlUXVlcnkodmFsdWUsIGVzY2FwZVF1ZXJ5U3BhY2UpIDogJycpOwogIH07CgogIFVSSS5hZGRRdWVyeSA9IGZ1bmN0aW9uIChkYXRhLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKCh0eXBlb2YgbmFtZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YobmFtZSkpID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIGlmIChoYXNPd24uY2FsbChuYW1lLCBrZXkpKSB7CiAgICAgICAgICBVUkkuYWRkUXVlcnkoZGF0YSwga2V5LCBuYW1lW2tleV0pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgaWYgKGRhdGFbbmFtZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGRhdGFbbmFtZV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGFbbmFtZV0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgZGF0YVtuYW1lXSA9IFtkYXRhW25hbWVdXTsKICAgICAgfQoKICAgICAgaWYgKCFpc0FycmF5KHZhbHVlKSkgewogICAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgICAgfQoKICAgICAgZGF0YVtuYW1lXSA9IChkYXRhW25hbWVdIHx8IFtdKS5jb25jYXQodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVVJJLmFkZFF1ZXJ5KCkgYWNjZXB0cyBhbiBvYmplY3QsIHN0cmluZyBhcyB0aGUgbmFtZSBwYXJhbWV0ZXInKTsKICAgIH0KICB9OwogIFVSSS5yZW1vdmVRdWVyeSA9IGZ1bmN0aW9uIChkYXRhLCBuYW1lLCB2YWx1ZSkgewogICAgdmFyIGksIGxlbmd0aCwga2V5OwoKICAgIGlmIChpc0FycmF5KG5hbWUpKSB7CiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IG5hbWUubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBkYXRhW25hbWVbaV1dID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGdldFR5cGUobmFtZSkgPT09ICdSZWdFeHAnKSB7CiAgICAgIGZvciAoa2V5IGluIGRhdGEpIHsKICAgICAgICBpZiAobmFtZS50ZXN0KGtleSkpIHsKICAgICAgICAgIGRhdGFba2V5XSA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoKHR5cGVvZiBuYW1lID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihuYW1lKSkgPT09ICdvYmplY3QnKSB7CiAgICAgIGZvciAoa2V5IGluIG5hbWUpIHsKICAgICAgICBpZiAoaGFzT3duLmNhbGwobmFtZSwga2V5KSkgewogICAgICAgICAgVVJJLnJlbW92ZVF1ZXJ5KGRhdGEsIGtleSwgbmFtZVtrZXldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnKSB7CiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGdldFR5cGUodmFsdWUpID09PSAnUmVnRXhwJykgewogICAgICAgICAgaWYgKCFpc0FycmF5KGRhdGFbbmFtZV0pICYmIHZhbHVlLnRlc3QoZGF0YVtuYW1lXSkpIHsKICAgICAgICAgICAgZGF0YVtuYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGFbbmFtZV0gPSBmaWx0ZXJBcnJheVZhbHVlcyhkYXRhW25hbWVdLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhW25hbWVdID09PSBTdHJpbmcodmFsdWUpICYmICghaXNBcnJheSh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID09PSAxKSkgewogICAgICAgICAgZGF0YVtuYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkoZGF0YVtuYW1lXSkpIHsKICAgICAgICAgIGRhdGFbbmFtZV0gPSBmaWx0ZXJBcnJheVZhbHVlcyhkYXRhW25hbWVdLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGRhdGFbbmFtZV0gPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VSSS5yZW1vdmVRdWVyeSgpIGFjY2VwdHMgYW4gb2JqZWN0LCBzdHJpbmcsIFJlZ0V4cCBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyJyk7CiAgICB9CiAgfTsKICBVUkkuaGFzUXVlcnkgPSBmdW5jdGlvbiAoZGF0YSwgbmFtZSwgdmFsdWUsIHdpdGhpbkFycmF5KSB7CiAgICBzd2l0Y2ggKGdldFR5cGUobmFtZSkpIHsKICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAvLyBOb3RoaW5nIHRvIGRvIGhlcmUKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ1JlZ0V4cCc6CiAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHsKICAgICAgICAgIGlmIChoYXNPd24uY2FsbChkYXRhLCBrZXkpKSB7CiAgICAgICAgICAgIGlmIChuYW1lLnRlc3Qoa2V5KSAmJiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCBVUkkuaGFzUXVlcnkoZGF0YSwga2V5LCB2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgIGNhc2UgJ09iamVjdCc6CiAgICAgICAgZm9yICh2YXIgX2tleSBpbiBuYW1lKSB7CiAgICAgICAgICBpZiAoaGFzT3duLmNhbGwobmFtZSwgX2tleSkpIHsKICAgICAgICAgICAgaWYgKCFVUkkuaGFzUXVlcnkoZGF0YSwgX2tleSwgbmFtZVtfa2V5XSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVUkkuaGFzUXVlcnkoKSBhY2NlcHRzIGEgc3RyaW5nLCByZWd1bGFyIGV4cHJlc3Npb24gb3Igb2JqZWN0IGFzIHRoZSBuYW1lIHBhcmFtZXRlcicpOwogICAgfQoKICAgIHN3aXRjaCAoZ2V0VHlwZSh2YWx1ZSkpIHsKICAgICAgY2FzZSAnVW5kZWZpbmVkJzoKICAgICAgICAvLyB0cnVlIGlmIGV4aXN0cyAoYnV0IG1heSBiZSBlbXB0eSkKICAgICAgICByZXR1cm4gbmFtZSBpbiBkYXRhOyAvLyBkYXRhW25hbWVdICE9PSB1bmRlZmluZWQ7CgogICAgICBjYXNlICdCb29sZWFuJzoKICAgICAgICAvLyB0cnVlIGlmIGV4aXN0cyBhbmQgbm9uLWVtcHR5CiAgICAgICAgdmFyIF9ib29seSA9IEJvb2xlYW4oaXNBcnJheShkYXRhW25hbWVdKSA/IGRhdGFbbmFtZV0ubGVuZ3RoIDogZGF0YVtuYW1lXSk7CiAgICAgICAgcmV0dXJuIHZhbHVlID09PSBfYm9vbHk7CgogICAgICBjYXNlICdGdW5jdGlvbic6CiAgICAgICAgLy8gYWxsb3cgY29tcGxleCBjb21wYXJpc29uCiAgICAgICAgcmV0dXJuICEhdmFsdWUoZGF0YVtuYW1lXSwgbmFtZSwgZGF0YSk7CgogICAgICBjYXNlICdBcnJheSc6CiAgICAgICAgaWYgKCFpc0FycmF5KGRhdGFbbmFtZV0pKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgb3AgPSB3aXRoaW5BcnJheSA/IGFycmF5Q29udGFpbnMgOiBhcnJheXNFcXVhbDsKICAgICAgICByZXR1cm4gb3AoZGF0YVtuYW1lXSwgdmFsdWUpOwoKICAgICAgY2FzZSAnUmVnRXhwJzoKICAgICAgICBpZiAoIWlzQXJyYXkoZGF0YVtuYW1lXSkpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKGRhdGFbbmFtZV0gJiYgZGF0YVtuYW1lXS5tYXRjaCh2YWx1ZSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF3aXRoaW5BcnJheSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFycmF5Q29udGFpbnMoZGF0YVtuYW1lXSwgdmFsdWUpOwoKICAgICAgY2FzZSAnTnVtYmVyJzoKICAgICAgICB2YWx1ZSA9IFN0cmluZyh2YWx1ZSk7CiAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICBpZiAoIWlzQXJyYXkoZGF0YVtuYW1lXSkpIHsKICAgICAgICAgIHJldHVybiBkYXRhW25hbWVdID09PSB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmICghd2l0aGluQXJyYXkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheUNvbnRhaW5zKGRhdGFbbmFtZV0sIHZhbHVlKTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVVJJLmhhc1F1ZXJ5KCkgYWNjZXB0cyB1bmRlZmluZWQsIGJvb2xlYW4sIHN0cmluZywgbnVtYmVyLCBSZWdFeHAsIEZ1bmN0aW9uIGFzIHRoZSB2YWx1ZSBwYXJhbWV0ZXInKTsKICAgIH0KICB9OwoKICBVUkkuam9pblBhdGhzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGlucHV0ID0gW107CiAgICB2YXIgc2VnbWVudHMgPSBbXTsKICAgIHZhciBub25FbXB0eVNlZ21lbnRzID0gMDsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgdXJsID0gbmV3IFVSSShhcmd1bWVudHNbaV0pOwogICAgICBpbnB1dC5wdXNoKHVybCk7CiAgICAgIHZhciBfc2VnbWVudHMgPSB1cmwuc2VnbWVudCgpOwogICAgICBmb3IgKHZhciBzID0gMDsgcyA8IF9zZWdtZW50cy5sZW5ndGg7IHMrKykgewogICAgICAgIGlmICh0eXBlb2YgX3NlZ21lbnRzW3NdID09PSAnc3RyaW5nJykgewogICAgICAgICAgc2VnbWVudHMucHVzaChfc2VnbWVudHNbc10pOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9zZWdtZW50c1tzXSkgewogICAgICAgICAgbm9uRW1wdHlTZWdtZW50cysrOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmICghc2VnbWVudHMubGVuZ3RoIHx8ICFub25FbXB0eVNlZ21lbnRzKSB7CiAgICAgIHJldHVybiBuZXcgVVJJKCcnKTsKICAgIH0KCiAgICB2YXIgdXJpID0gbmV3IFVSSSgnJykuc2VnbWVudChzZWdtZW50cyk7CgogICAgaWYgKGlucHV0WzBdLnBhdGgoKSA9PT0gJycgfHwgaW5wdXRbMF0ucGF0aCgpLnNsaWNlKDAsIDEpID09PSAnLycpIHsKICAgICAgdXJpLnBhdGgoJy8nICsgdXJpLnBhdGgoKSk7CiAgICB9CgogICAgcmV0dXJuIHVyaS5ub3JtYWxpemUoKTsKICB9OwoKICBVUkkuY29tbW9uUGF0aCA9IGZ1bmN0aW9uIChvbmUsIHR3bykgewogICAgdmFyIGxlbmd0aCA9IE1hdGgubWluKG9uZS5sZW5ndGgsIHR3by5sZW5ndGgpOwogICAgdmFyIHBvczsKCiAgICAvLyBmaW5kIGZpcnN0IG5vbi1tYXRjaGluZyBjaGFyYWN0ZXIKICAgIGZvciAocG9zID0gMDsgcG9zIDwgbGVuZ3RoOyBwb3MrKykgewogICAgICBpZiAob25lLmNoYXJBdChwb3MpICE9PSB0d28uY2hhckF0KHBvcykpIHsKICAgICAgICBwb3MtLTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIGlmIChwb3MgPCAxKSB7CiAgICAgIHJldHVybiBvbmUuY2hhckF0KDApID09PSB0d28uY2hhckF0KDApICYmIG9uZS5jaGFyQXQoMCkgPT09ICcvJyA/ICcvJyA6ICcnOwogICAgfQoKICAgIC8vIHJldmVydCB0byBsYXN0IC8KICAgIGlmIChvbmUuY2hhckF0KHBvcykgIT09ICcvJyB8fCB0d28uY2hhckF0KHBvcykgIT09ICcvJykgewogICAgICBwb3MgPSBvbmUuc3Vic3RyaW5nKDAsIHBvcykubGFzdEluZGV4T2YoJy8nKTsKICAgIH0KCiAgICByZXR1cm4gb25lLnN1YnN0cmluZygwLCBwb3MgKyAxKTsKICB9OwoKICBVUkkud2l0aGluU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZywgY2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB2YXIgX3N0YXJ0ID0gb3B0aW9ucy5zdGFydCB8fCBVUkkuZmluZFVyaS5zdGFydDsKICAgIHZhciBfZW5kID0gb3B0aW9ucy5lbmQgfHwgVVJJLmZpbmRVcmkuZW5kOwogICAgdmFyIF90cmltID0gb3B0aW9ucy50cmltIHx8IFVSSS5maW5kVXJpLnRyaW07CiAgICB2YXIgX2F0dHJpYnV0ZU9wZW4gPSAvW2EtejAtOS1dPVsiJ10/JC9pOwoKICAgIF9zdGFydC5sYXN0SW5kZXggPSAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgdmFyIG1hdGNoID0gX3N0YXJ0LmV4ZWMoc3RyaW5nKTsKICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB2YXIgc3RhcnQgPSBtYXRjaC5pbmRleDsKICAgICAgaWYgKG9wdGlvbnMuaWdub3JlSHRtbCkgewogICAgICAgIC8vIGF0dHJpYnV0KGU9WyInXT8kKQogICAgICAgIHZhciBhdHRyaWJ1dGVPcGVuID0gc3RyaW5nLnNsaWNlKE1hdGgubWF4KHN0YXJ0IC0gMywgMCksIHN0YXJ0KTsKICAgICAgICBpZiAoYXR0cmlidXRlT3BlbiAmJiBfYXR0cmlidXRlT3Blbi50ZXN0KGF0dHJpYnV0ZU9wZW4pKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBlbmQgPSBzdGFydCArIHN0cmluZy5zbGljZShzdGFydCkuc2VhcmNoKF9lbmQpOwogICAgICB2YXIgc2xpY2UgPSBzdHJpbmcuc2xpY2Uoc3RhcnQsIGVuZCkucmVwbGFjZShfdHJpbSwgJycpOwogICAgICBpZiAob3B0aW9ucy5pZ25vcmUgJiYgb3B0aW9ucy5pZ25vcmUudGVzdChzbGljZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgZW5kID0gc3RhcnQgKyBzbGljZS5sZW5ndGg7CiAgICAgIHZhciByZXN1bHQgPSBjYWxsYmFjayhzbGljZSwgc3RhcnQsIGVuZCwgc3RyaW5nKTsKICAgICAgc3RyaW5nID0gc3RyaW5nLnNsaWNlKDAsIHN0YXJ0KSArIHJlc3VsdCArIHN0cmluZy5zbGljZShlbmQpOwogICAgICBfc3RhcnQubGFzdEluZGV4ID0gc3RhcnQgKyByZXN1bHQubGVuZ3RoOwogICAgfQoKICAgIF9zdGFydC5sYXN0SW5kZXggPSAwOwogICAgcmV0dXJuIHN0cmluZzsKICB9OwoKICBVUkkuZW5zdXJlVmFsaWRIb3N0bmFtZSA9IGZ1bmN0aW9uICh2KSB7CiAgICAvLyBUaGVvcmV0aWNhbGx5IFVSSXMgYWxsb3cgcGVyY2VudC1lbmNvZGluZyBpbiBIb3N0bmFtZXMgKGFjY29yZGluZyB0byBSRkMgMzk4NikKICAgIC8vIHRoZXkgYXJlIG5vdCBwYXJ0IG9mIEROUyBhbmQgdGhlcmVmb3JlIGlnbm9yZWQgYnkgVVJJLmpzCgogICAgaWYgKHYubWF0Y2goVVJJLmludmFsaWRfaG9zdG5hbWVfY2hhcmFjdGVycykpIHsKICAgICAgLy8gdGVzdCBwdW55Y29kZQogICAgICBpZiAoIXB1bnljb2RlKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSG9zdG5hbWUgIicgKyB2ICsgJyIgY29udGFpbnMgY2hhcmFjdGVycyBvdGhlciB0aGFuIFtBLVowLTkuLV0gYW5kIFB1bnljb2RlLmpzIGlzIG5vdCBhdmFpbGFibGUnKTsKICAgICAgfQoKICAgICAgaWYgKHB1bnljb2RlLnRvQVNDSUkodikubWF0Y2goVVJJLmludmFsaWRfaG9zdG5hbWVfY2hhcmFjdGVycykpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdIb3N0bmFtZSAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOS4tXScpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gbm9Db25mbGljdAogIFVSSS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKHJlbW92ZUFsbCkgewogICAgaWYgKHJlbW92ZUFsbCkgewogICAgICB2YXIgdW5jb25mbGljdGVkID0gewogICAgICAgIFVSSTogdGhpcy5ub0NvbmZsaWN0KCkKICAgICAgfTsKCiAgICAgIGlmIChyb290LlVSSVRlbXBsYXRlICYmIHR5cGVvZiByb290LlVSSVRlbXBsYXRlLm5vQ29uZmxpY3QgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB1bmNvbmZsaWN0ZWQuVVJJVGVtcGxhdGUgPSByb290LlVSSVRlbXBsYXRlLm5vQ29uZmxpY3QoKTsKICAgICAgfQoKICAgICAgaWYgKHJvb3QuSVB2NiAmJiB0eXBlb2Ygcm9vdC5JUHY2Lm5vQ29uZmxpY3QgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB1bmNvbmZsaWN0ZWQuSVB2NiA9IHJvb3QuSVB2Ni5ub0NvbmZsaWN0KCk7CiAgICAgIH0KCiAgICAgIGlmIChyb290LlNlY29uZExldmVsRG9tYWlucyAmJiB0eXBlb2Ygcm9vdC5TZWNvbmRMZXZlbERvbWFpbnMubm9Db25mbGljdCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHVuY29uZmxpY3RlZC5TZWNvbmRMZXZlbERvbWFpbnMgPSByb290LlNlY29uZExldmVsRG9tYWlucy5ub0NvbmZsaWN0KCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1bmNvbmZsaWN0ZWQ7CiAgICB9IGVsc2UgaWYgKHJvb3QuVVJJID09PSB0aGlzKSB7CiAgICAgIHJvb3QuVVJJID0gX1VSSTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICBwLmJ1aWxkID0gZnVuY3Rpb24gKGRlZmVyQnVpbGQpIHsKICAgIGlmIChkZWZlckJ1aWxkID09PSB0cnVlKSB7CiAgICAgIHRoaXMuX2RlZmVycmVkX2J1aWxkID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoZGVmZXJCdWlsZCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuX2RlZmVycmVkX2J1aWxkKSB7CiAgICAgIHRoaXMuX3N0cmluZyA9IFVSSS5idWlsZCh0aGlzLl9wYXJ0cyk7CiAgICAgIHRoaXMuX2RlZmVycmVkX2J1aWxkID0gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgcC5jbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBuZXcgVVJJKHRoaXMpOwogIH07CgogIHAudmFsdWVPZiA9IHAudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5idWlsZChmYWxzZSkuX3N0cmluZzsKICB9OwoKICBmdW5jdGlvbiBnZW5lcmF0ZVNpbXBsZUFjY2Vzc29yKF9wYXJ0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydHNbX3BhcnRdIHx8ICcnOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3BhcnRzW19wYXJ0XSA9IHYgfHwgbnVsbDsKICAgICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBnZW5lcmF0ZVByZWZpeEFjY2Vzc29yKF9wYXJ0LCBfa2V5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydHNbX3BhcnRdIHx8ICcnOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh2ICE9PSBudWxsKSB7CiAgICAgICAgICB2ID0gdiArICcnOwogICAgICAgICAgaWYgKHYuY2hhckF0KDApID09PSBfa2V5KSB7CiAgICAgICAgICAgIHYgPSB2LnN1YnN0cmluZygxKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX3BhcnRzW19wYXJ0XSA9IHY7CiAgICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9OwogIH0KCiAgcC5wcm90b2NvbCA9IGdlbmVyYXRlU2ltcGxlQWNjZXNzb3IoJ3Byb3RvY29sJyk7CiAgcC51c2VybmFtZSA9IGdlbmVyYXRlU2ltcGxlQWNjZXNzb3IoJ3VzZXJuYW1lJyk7CiAgcC5wYXNzd29yZCA9IGdlbmVyYXRlU2ltcGxlQWNjZXNzb3IoJ3Bhc3N3b3JkJyk7CiAgcC5ob3N0bmFtZSA9IGdlbmVyYXRlU2ltcGxlQWNjZXNzb3IoJ2hvc3RuYW1lJyk7CiAgcC5wb3J0ID0gZ2VuZXJhdGVTaW1wbGVBY2Nlc3NvcigncG9ydCcpOwogIHAucXVlcnkgPSBnZW5lcmF0ZVByZWZpeEFjY2Vzc29yKCdxdWVyeScsICc/Jyk7CiAgcC5mcmFnbWVudCA9IGdlbmVyYXRlUHJlZml4QWNjZXNzb3IoJ2ZyYWdtZW50JywgJyMnKTsKCiAgcC5zZWFyY2ggPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIHZhciB0ID0gdGhpcy5xdWVyeSh2LCBidWlsZCk7CiAgICByZXR1cm4gdHlwZW9mIHQgPT09ICdzdHJpbmcnICYmIHQubGVuZ3RoID8gJz8nICsgdCA6IHQ7CiAgfTsKICBwLmhhc2ggPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIHZhciB0ID0gdGhpcy5mcmFnbWVudCh2LCBidWlsZCk7CiAgICByZXR1cm4gdHlwZW9mIHQgPT09ICdzdHJpbmcnICYmIHQubGVuZ3RoID8gJyMnICsgdCA6IHQ7CiAgfTsKCiAgcC5wYXRobmFtZSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSB0cnVlKSB7CiAgICAgIHZhciByZXMgPSB0aGlzLl9wYXJ0cy5wYXRoIHx8ICh0aGlzLl9wYXJ0cy5ob3N0bmFtZSA/ICcvJyA6ICcnKTsKICAgICAgcmV0dXJuIHYgPyAodGhpcy5fcGFydHMudXJuID8gVVJJLmRlY29kZVVyblBhdGggOiBVUkkuZGVjb2RlUGF0aCkocmVzKSA6IHJlczsKICAgIH0gZWxzZSB7CiAgICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgICB0aGlzLl9wYXJ0cy5wYXRoID0gdiA/IFVSSS5yZWNvZGVVcm5QYXRoKHYpIDogJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fcGFydHMucGF0aCA9IHYgPyBVUkkucmVjb2RlUGF0aCh2KSA6ICcvJzsKICAgICAgfQogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5wYXRoID0gcC5wYXRobmFtZTsKICBwLmhyZWYgPSBmdW5jdGlvbiAoaHJlZiwgYnVpbGQpIHsKICAgIHZhciBrZXk7CgogICAgaWYgKGhyZWYgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy50b1N0cmluZygpOwogICAgfQoKICAgIHRoaXMuX3N0cmluZyA9ICcnOwogICAgdGhpcy5fcGFydHMgPSBVUkkuX3BhcnRzKCk7CgogICAgdmFyIF9VUkkgPSBocmVmIGluc3RhbmNlb2YgVVJJOwogICAgdmFyIF9vYmplY3QgPSAodHlwZW9mIGhyZWYgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGhyZWYpKSA9PT0gJ29iamVjdCcgJiYgKGhyZWYuaG9zdG5hbWUgfHwgaHJlZi5wYXRoIHx8IGhyZWYucGF0aG5hbWUpOwogICAgaWYgKGhyZWYubm9kZU5hbWUpIHsKICAgICAgdmFyIGF0dHJpYnV0ZSA9IFVSSS5nZXREb21BdHRyaWJ1dGUoaHJlZik7CiAgICAgIGhyZWYgPSBocmVmW2F0dHJpYnV0ZV0gfHwgJyc7CiAgICAgIF9vYmplY3QgPSBmYWxzZTsKICAgIH0KCiAgICAvLyB3aW5kb3cubG9jYXRpb24gaXMgcmVwb3J0ZWQgdG8gYmUgYW4gb2JqZWN0LCBidXQgaXQncyBub3QgdGhlIHNvcnQKICAgIC8vIG9mIG9iamVjdCB3ZSdyZSBsb29raW5nIGZvcjoKICAgIC8vICogbG9jYXRpb24ucHJvdG9jb2wgZW5kcyB3aXRoIGEgY29sb24KICAgIC8vICogbG9jYXRpb24ucXVlcnkgIT0gb2JqZWN0LnNlYXJjaAogICAgLy8gKiBsb2NhdGlvbi5oYXNoICE9IG9iamVjdC5mcmFnbWVudAogICAgLy8gc2ltcGx5IHNlcmlhbGl6aW5nIHRoZSB1bmtub3duIG9iamVjdCBzaG91bGQgZG8gdGhlIHRyaWNrCiAgICAvLyAoZm9yIGxvY2F0aW9uLCBub3QgZm9yIGV2ZXJ5dGhpbmcuLi4pCiAgICBpZiAoIV9VUkkgJiYgX29iamVjdCAmJiBocmVmLnBhdGhuYW1lICE9PSB1bmRlZmluZWQpIHsKICAgICAgaHJlZiA9IGhyZWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIGhyZWYgPT09ICdzdHJpbmcnIHx8IGhyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgdGhpcy5fcGFydHMgPSBVUkkucGFyc2UoU3RyaW5nKGhyZWYpLCB0aGlzLl9wYXJ0cyk7CiAgICB9IGVsc2UgaWYgKF9VUkkgfHwgX29iamVjdCkgewogICAgICB2YXIgc3JjID0gX1VSSSA/IGhyZWYuX3BhcnRzIDogaHJlZjsKICAgICAgZm9yIChrZXkgaW4gc3JjKSB7CiAgICAgICAgaWYgKGhhc093bi5jYWxsKHRoaXMuX3BhcnRzLCBrZXkpKSB7CiAgICAgICAgICB0aGlzLl9wYXJ0c1trZXldID0gc3JjW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGlucHV0Jyk7CiAgICB9CgogICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gaWRlbnRpZmljYXRpb24gYWNjZXNzb3JzCiAgcC5pcyA9IGZ1bmN0aW9uICh3aGF0KSB7CiAgICB2YXIgaXAgPSBmYWxzZTsKICAgIHZhciBpcDQgPSBmYWxzZTsKICAgIHZhciBpcDYgPSBmYWxzZTsKICAgIHZhciBuYW1lID0gZmFsc2U7CiAgICB2YXIgc2xkID0gZmFsc2U7CiAgICB2YXIgaWRuID0gZmFsc2U7CiAgICB2YXIgcHVueWNvZGUgPSBmYWxzZTsKICAgIHZhciByZWxhdGl2ZSA9ICF0aGlzLl9wYXJ0cy51cm47CgogICAgaWYgKHRoaXMuX3BhcnRzLmhvc3RuYW1lKSB7CiAgICAgIHJlbGF0aXZlID0gZmFsc2U7CiAgICAgIGlwNCA9IFVSSS5pcDRfZXhwcmVzc2lvbi50ZXN0KHRoaXMuX3BhcnRzLmhvc3RuYW1lKTsKICAgICAgaXA2ID0gVVJJLmlwNl9leHByZXNzaW9uLnRlc3QodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICBpcCA9IGlwNCB8fCBpcDY7CiAgICAgIG5hbWUgPSAhaXA7CiAgICAgIHNsZCA9IG5hbWUgJiYgU0xEICYmIFNMRC5oYXModGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICBpZG4gPSBuYW1lICYmIFVSSS5pZG5fZXhwcmVzc2lvbi50ZXN0KHRoaXMuX3BhcnRzLmhvc3RuYW1lKTsKICAgICAgcHVueWNvZGUgPSBuYW1lICYmIFVSSS5wdW55Y29kZV9leHByZXNzaW9uLnRlc3QodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgfQoKICAgIHN3aXRjaCAod2hhdC50b0xvd2VyQ2FzZSgpKSB7CiAgICAgIGNhc2UgJ3JlbGF0aXZlJzoKICAgICAgICByZXR1cm4gcmVsYXRpdmU7CgogICAgICBjYXNlICdhYnNvbHV0ZSc6CiAgICAgICAgcmV0dXJuICFyZWxhdGl2ZTsKCiAgICAgIC8vIGhvc3RuYW1lIGlkZW50aWZpY2F0aW9uCiAgICAgIGNhc2UgJ2RvbWFpbic6CiAgICAgIGNhc2UgJ25hbWUnOgogICAgICAgIHJldHVybiBuYW1lOwoKICAgICAgY2FzZSAnc2xkJzoKICAgICAgICByZXR1cm4gc2xkOwoKICAgICAgY2FzZSAnaXAnOgogICAgICAgIHJldHVybiBpcDsKCiAgICAgIGNhc2UgJ2lwNCc6CiAgICAgIGNhc2UgJ2lwdjQnOgogICAgICBjYXNlICdpbmV0NCc6CiAgICAgICAgcmV0dXJuIGlwNDsKCiAgICAgIGNhc2UgJ2lwNic6CiAgICAgIGNhc2UgJ2lwdjYnOgogICAgICBjYXNlICdpbmV0Nic6CiAgICAgICAgcmV0dXJuIGlwNjsKCiAgICAgIGNhc2UgJ2lkbic6CiAgICAgICAgcmV0dXJuIGlkbjsKCiAgICAgIGNhc2UgJ3VybCc6CiAgICAgICAgcmV0dXJuICF0aGlzLl9wYXJ0cy51cm47CgogICAgICBjYXNlICd1cm4nOgogICAgICAgIHJldHVybiAhIXRoaXMuX3BhcnRzLnVybjsKCiAgICAgIGNhc2UgJ3B1bnljb2RlJzoKICAgICAgICByZXR1cm4gcHVueWNvZGU7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgLy8gY29tcG9uZW50IHNwZWNpZmljIGlucHV0IHZhbGlkYXRpb24KICB2YXIgX3Byb3RvY29sID0gcC5wcm90b2NvbDsKICB2YXIgX3BvcnQgPSBwLnBvcnQ7CiAgdmFyIF9ob3N0bmFtZSA9IHAuaG9zdG5hbWU7CgogIHAucHJvdG9jb2wgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKHYpIHsKICAgICAgICAvLyBhY2NlcHQgdHJhaWxpbmcgOi8vCiAgICAgICAgdiA9IHYucmVwbGFjZSgvOihcL1wvKT8kLywgJycpOwoKICAgICAgICBpZiAoIXYubWF0Y2goVVJJLnByb3RvY29sX2V4cHJlc3Npb24pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdQcm90b2NvbCAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOS4rLV0gb3IgZG9lc25cJ3Qgc3RhcnQgd2l0aCBbQS1aXScpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIF9wcm90b2NvbC5jYWxsKHRoaXMsIHYsIGJ1aWxkKTsKICB9OwogIHAuc2NoZW1lID0gcC5wcm90b2NvbDsKICBwLnBvcnQgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICh2ID09PSAwKSB7CiAgICAgICAgdiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh2KSB7CiAgICAgICAgdiArPSAnJzsKICAgICAgICBpZiAodi5jaGFyQXQoMCkgPT09ICc6JykgewogICAgICAgICAgdiA9IHYuc3Vic3RyaW5nKDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHYubWF0Y2goL1teMC05XS8pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdQb3J0ICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbMC05XScpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIF9wb3J0LmNhbGwodGhpcywgdiwgYnVpbGQpOwogIH07CiAgcC5ob3N0bmFtZSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHggPSB7fTsKICAgICAgdmFyIHJlcyA9IFVSSS5wYXJzZUhvc3QodiwgeCk7CiAgICAgIGlmIChyZXMgIT09ICcvJykgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hvc3RuYW1lICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05Li1dJyk7CiAgICAgIH0KCiAgICAgIHYgPSB4Lmhvc3RuYW1lOwogICAgfQogICAgcmV0dXJuIF9ob3N0bmFtZS5jYWxsKHRoaXMsIHYsIGJ1aWxkKTsKICB9OwoKICAvLyBjb21wb3VuZCBhY2Nlc3NvcnMKICBwLm9yaWdpbiA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHByb3RvY29sID0gdGhpcy5wcm90b2NvbCgpOwogICAgICB2YXIgYXV0aG9yaXR5ID0gdGhpcy5hdXRob3JpdHkoKTsKICAgICAgaWYgKCFhdXRob3JpdHkpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KCiAgICAgIHJldHVybiAocHJvdG9jb2wgPyBwcm90b2NvbCArICc6Ly8nIDogJycpICsgdGhpcy5hdXRob3JpdHkoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBvcmlnaW4gPSBVUkkodik7CiAgICAgIHRoaXMucHJvdG9jb2wob3JpZ2luLnByb3RvY29sKCkpLmF1dGhvcml0eShvcmlnaW4uYXV0aG9yaXR5KCkpLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5ob3N0ID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy5fcGFydHMuaG9zdG5hbWUgPyBVUkkuYnVpbGRIb3N0KHRoaXMuX3BhcnRzKSA6ICcnOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJlcyA9IFVSSS5wYXJzZUhvc3QodiwgdGhpcy5fcGFydHMpOwogICAgICBpZiAocmVzICE9PSAnLycpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdIb3N0bmFtZSAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOS4tXScpOwogICAgICB9CgogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5hdXRob3JpdHkgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA/IFVSSS5idWlsZEF1dGhvcml0eSh0aGlzLl9wYXJ0cykgOiAnJzsKICAgIH0gZWxzZSB7CiAgICAgIHZhciByZXMgPSBVUkkucGFyc2VBdXRob3JpdHkodiwgdGhpcy5fcGFydHMpOwogICAgICBpZiAocmVzICE9PSAnLycpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdIb3N0bmFtZSAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOS4tXScpOwogICAgICB9CgogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC51c2VyaW5mbyA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHQgPSBVUkkuYnVpbGRVc2VyaW5mbyh0aGlzLl9wYXJ0cyk7CiAgICAgIHJldHVybiB0ID8gdC5zdWJzdHJpbmcoMCwgdC5sZW5ndGggLSAxKSA6IHQ7CiAgICB9IGVsc2UgewogICAgICBpZiAodlt2Lmxlbmd0aCAtIDFdICE9PSAnQCcpIHsKICAgICAgICB2ICs9ICdAJzsKICAgICAgfQoKICAgICAgVVJJLnBhcnNlVXNlcmluZm8odiwgdGhpcy5fcGFydHMpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5yZXNvdXJjZSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgdmFyIHBhcnRzOwoKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXMucGF0aCgpICsgdGhpcy5zZWFyY2goKSArIHRoaXMuaGFzaCgpOwogICAgfQoKICAgIHBhcnRzID0gVVJJLnBhcnNlKHYpOwogICAgdGhpcy5fcGFydHMucGF0aCA9IHBhcnRzLnBhdGg7CiAgICB0aGlzLl9wYXJ0cy5xdWVyeSA9IHBhcnRzLnF1ZXJ5OwogICAgdGhpcy5fcGFydHMuZnJhZ21lbnQgPSBwYXJ0cy5mcmFnbWVudDsKICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIGZyYWN0aW9uIGFjY2Vzc29ycwogIHAuc3ViZG9tYWluID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgLy8gY29udmVuaWVuY2UsIHJldHVybiAid3d3IiBmcm9tICJ3d3cuZXhhbXBsZS5vcmciCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5fcGFydHMuaG9zdG5hbWUgfHwgdGhpcy5pcygnSVAnKSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgLy8gZ3JhYiBkb21haW4gYW5kIGFkZCBhbm90aGVyIHNlZ21lbnQKICAgICAgdmFyIGVuZCA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLmxlbmd0aCAtIHRoaXMuZG9tYWluKCkubGVuZ3RoIC0gMTsKICAgICAgcmV0dXJuIHRoaXMuX3BhcnRzLmhvc3RuYW1lLnN1YnN0cmluZygwLCBlbmQpIHx8ICcnOwogICAgfSBlbHNlIHsKICAgICAgdmFyIGUgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5sZW5ndGggLSB0aGlzLmRvbWFpbigpLmxlbmd0aDsKICAgICAgdmFyIHN1YiA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLnN1YnN0cmluZygwLCBlKTsKICAgICAgdmFyIHJlcGxhY2UgPSBuZXcgUmVnRXhwKCdeJyArIGVzY2FwZVJlZ0V4KHN1YikpOwoKICAgICAgaWYgKHYgJiYgdi5jaGFyQXQodi5sZW5ndGggLSAxKSAhPT0gJy4nKSB7CiAgICAgICAgdiArPSAnLic7CiAgICAgIH0KCiAgICAgIGlmICh2KSB7CiAgICAgICAgVVJJLmVuc3VyZVZhbGlkSG9zdG5hbWUodik7CiAgICAgIH0KCiAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gdGhpcy5fcGFydHMuaG9zdG5hbWUucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAuZG9tYWluID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHR5cGVvZiB2ID09PSAnYm9vbGVhbicpIHsKICAgICAgYnVpbGQgPSB2OwogICAgICB2ID0gdW5kZWZpbmVkOwogICAgfQoKICAgIC8vIGNvbnZlbmllbmNlLCByZXR1cm4gImV4YW1wbGUub3JnIiBmcm9tICJ3d3cuZXhhbXBsZS5vcmciCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5fcGFydHMuaG9zdG5hbWUgfHwgdGhpcy5pcygnSVAnKSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgLy8gaWYgaG9zdG5hbWUgY29uc2lzdHMgb2YgMSBvciAyIHNlZ21lbnRzLCBpdCBtdXN0IGJlIHRoZSBkb21haW4KICAgICAgdmFyIHQgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5tYXRjaCgvXC4vZyk7CiAgICAgIGlmICh0ICYmIHQubGVuZ3RoIDwgMikgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0cy5ob3N0bmFtZTsKICAgICAgfQoKICAgICAgLy8gZ3JhYiB0bGQgYW5kIGFkZCBhbm90aGVyIHNlZ21lbnQKICAgICAgdmFyIGVuZCA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLmxlbmd0aCAtIHRoaXMudGxkKGJ1aWxkKS5sZW5ndGggLSAxOwogICAgICBlbmQgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5sYXN0SW5kZXhPZignLicsIGVuZCAtIDEpICsgMTsKICAgICAgcmV0dXJuIHRoaXMuX3BhcnRzLmhvc3RuYW1lLnN1YnN0cmluZyhlbmQpIHx8ICcnOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCF2KSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignY2Fubm90IHNldCBkb21haW4gZW1wdHknKTsKICAgICAgfQoKICAgICAgVVJJLmVuc3VyZVZhbGlkSG9zdG5hbWUodik7CgogICAgICBpZiAoIXRoaXMuX3BhcnRzLmhvc3RuYW1lIHx8IHRoaXMuaXMoJ0lQJykpIHsKICAgICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KHRoaXMuZG9tYWluKCkpICsgJyQnKTsKICAgICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLnJlcGxhY2UocmVwbGFjZSwgdik7CiAgICAgIH0KCiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLnRsZCA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh0eXBlb2YgdiA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgIGJ1aWxkID0gdjsKICAgICAgdiA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICAvLyByZXR1cm4gIm9yZyIgZnJvbSAid3d3LmV4YW1wbGUub3JnIgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoIXRoaXMuX3BhcnRzLmhvc3RuYW1lIHx8IHRoaXMuaXMoJ0lQJykpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KCiAgICAgIHZhciBwb3MgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5sYXN0SW5kZXhPZignLicpOwogICAgICB2YXIgdGxkID0gdGhpcy5fcGFydHMuaG9zdG5hbWUuc3Vic3RyaW5nKHBvcyArIDEpOwoKICAgICAgaWYgKGJ1aWxkICE9PSB0cnVlICYmIFNMRCAmJiBTTEQubGlzdFt0bGQudG9Mb3dlckNhc2UoKV0pIHsKICAgICAgICByZXR1cm4gU0xELmdldCh0aGlzLl9wYXJ0cy5ob3N0bmFtZSkgfHwgdGxkOwogICAgICB9CgogICAgICByZXR1cm4gdGxkOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJlcGxhY2U7CgogICAgICBpZiAoIXYpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdjYW5ub3Qgc2V0IFRMRCBlbXB0eScpOwogICAgICB9IGVsc2UgaWYgKHYubWF0Y2goL1teYS16QS1aMC05LV0vKSkgewogICAgICAgIGlmIChTTEQgJiYgU0xELmlzKHYpKSB7CiAgICAgICAgICByZXBsYWNlID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeCh0aGlzLnRsZCgpKSArICckJyk7CiAgICAgICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLnJlcGxhY2UocmVwbGFjZSwgdik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RMRCAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOV0nKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX3BhcnRzLmhvc3RuYW1lIHx8IHRoaXMuaXMoJ0lQJykpIHsKICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoJ2Nhbm5vdCBzZXQgVExEIG9uIG5vbi1kb21haW4gaG9zdCcpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KHRoaXMudGxkKCkpICsgJyQnKTsKICAgICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLnJlcGxhY2UocmVwbGFjZSwgdik7CiAgICAgIH0KCiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLmRpcmVjdG9yeSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQgfHwgdiA9PT0gdHJ1ZSkgewogICAgICBpZiAoIXRoaXMuX3BhcnRzLnBhdGggJiYgIXRoaXMuX3BhcnRzLmhvc3RuYW1lKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICBpZiAodGhpcy5fcGFydHMucGF0aCA9PT0gJy8nKSB7CiAgICAgICAgcmV0dXJuICcvJzsKICAgICAgfQoKICAgICAgdmFyIGVuZCA9IHRoaXMuX3BhcnRzLnBhdGgubGVuZ3RoIC0gdGhpcy5maWxlbmFtZSgpLmxlbmd0aCAtIDE7CiAgICAgIHZhciByZXMgPSB0aGlzLl9wYXJ0cy5wYXRoLnN1YnN0cmluZygwLCBlbmQpIHx8ICh0aGlzLl9wYXJ0cy5ob3N0bmFtZSA/ICcvJyA6ICcnKTsKCiAgICAgIHJldHVybiB2ID8gVVJJLmRlY29kZVBhdGgocmVzKSA6IHJlczsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBlID0gdGhpcy5fcGFydHMucGF0aC5sZW5ndGggLSB0aGlzLmZpbGVuYW1lKCkubGVuZ3RoOwogICAgICB2YXIgZGlyZWN0b3J5ID0gdGhpcy5fcGFydHMucGF0aC5zdWJzdHJpbmcoMCwgZSk7CiAgICAgIHZhciByZXBsYWNlID0gbmV3IFJlZ0V4cCgnXicgKyBlc2NhcGVSZWdFeChkaXJlY3RvcnkpKTsKCiAgICAgIC8vIGZ1bGx5IHF1YWxpZmllciBkaXJlY3RvcmllcyBiZWdpbiB3aXRoIGEgc2xhc2gKICAgICAgaWYgKCF0aGlzLmlzKCdyZWxhdGl2ZScpKSB7CiAgICAgICAgaWYgKCF2KSB7CiAgICAgICAgICB2ID0gJy8nOwogICAgICAgIH0KCiAgICAgICAgaWYgKHYuY2hhckF0KDApICE9PSAnLycpIHsKICAgICAgICAgIHYgPSAnLycgKyB2OwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gZGlyZWN0b3JpZXMgYWx3YXlzIGVuZCB3aXRoIGEgc2xhc2gKICAgICAgaWYgKHYgJiYgdi5jaGFyQXQodi5sZW5ndGggLSAxKSAhPT0gJy8nKSB7CiAgICAgICAgdiArPSAnLyc7CiAgICAgIH0KCiAgICAgIHYgPSBVUkkucmVjb2RlUGF0aCh2KTsKICAgICAgdGhpcy5fcGFydHMucGF0aCA9IHRoaXMuX3BhcnRzLnBhdGgucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAuZmlsZW5hbWUgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkIHx8IHYgPT09IHRydWUpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJ0cy5wYXRoIHx8IHRoaXMuX3BhcnRzLnBhdGggPT09ICcvJykgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgdmFyIHBvcyA9IHRoaXMuX3BhcnRzLnBhdGgubGFzdEluZGV4T2YoJy8nKTsKICAgICAgdmFyIHJlcyA9IHRoaXMuX3BhcnRzLnBhdGguc3Vic3RyaW5nKHBvcyArIDEpOwoKICAgICAgcmV0dXJuIHYgPyBVUkkuZGVjb2RlUGF0aFNlZ21lbnQocmVzKSA6IHJlczsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBtdXRhdGVkRGlyZWN0b3J5ID0gZmFsc2U7CgogICAgICBpZiAodi5jaGFyQXQoMCkgPT09ICcvJykgewogICAgICAgIHYgPSB2LnN1YnN0cmluZygxKTsKICAgICAgfQoKICAgICAgaWYgKHYubWF0Y2goL1wuP1wvLykpIHsKICAgICAgICBtdXRhdGVkRGlyZWN0b3J5ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgdmFyIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KHRoaXMuZmlsZW5hbWUoKSkgKyAnJCcpOwogICAgICB2ID0gVVJJLnJlY29kZVBhdGgodik7CiAgICAgIHRoaXMuX3BhcnRzLnBhdGggPSB0aGlzLl9wYXJ0cy5wYXRoLnJlcGxhY2UocmVwbGFjZSwgdik7CgogICAgICBpZiAobXV0YXRlZERpcmVjdG9yeSkgewogICAgICAgIHRoaXMubm9ybWFsaXplUGF0aChidWlsZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAuc3VmZml4ID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSB0cnVlKSB7CiAgICAgIGlmICghdGhpcy5fcGFydHMucGF0aCB8fCB0aGlzLl9wYXJ0cy5wYXRoID09PSAnLycpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KCiAgICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuZmlsZW5hbWUoKTsKICAgICAgdmFyIHBvcyA9IGZpbGVuYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgIHZhciBzLCByZXM7CgogICAgICBpZiAocG9zID09PSAtMSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgLy8gc3VmZml4IG1heSBvbmx5IGNvbnRhaW4gYWxudW0gY2hhcmFjdGVycyAoeXVwLCBJIG1hZGUgdGhpcyB1cC4pCiAgICAgIHMgPSBmaWxlbmFtZS5zdWJzdHJpbmcocG9zICsgMSk7CiAgICAgIHJlcyA9IC9eW2EtejAtOSVdKyQvaS50ZXN0KHMpID8gcyA6ICcnOwogICAgICByZXR1cm4gdiA/IFVSSS5kZWNvZGVQYXRoU2VnbWVudChyZXMpIDogcmVzOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHYuY2hhckF0KDApID09PSAnLicpIHsKICAgICAgICB2ID0gdi5zdWJzdHJpbmcoMSk7CiAgICAgIH0KCiAgICAgIHZhciBzdWZmaXggPSB0aGlzLnN1ZmZpeCgpOwogICAgICB2YXIgcmVwbGFjZTsKCiAgICAgIGlmICghc3VmZml4KSB7CiAgICAgICAgaWYgKCF2KSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3BhcnRzLnBhdGggKz0gJy4nICsgVVJJLnJlY29kZVBhdGgodik7CiAgICAgIH0gZWxzZSBpZiAoIXYpIHsKICAgICAgICByZXBsYWNlID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeCgnLicgKyBzdWZmaXgpICsgJyQnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXBsYWNlID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeChzdWZmaXgpICsgJyQnKTsKICAgICAgfQoKICAgICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICB2ID0gVVJJLnJlY29kZVBhdGgodik7CiAgICAgICAgdGhpcy5fcGFydHMucGF0aCA9IHRoaXMuX3BhcnRzLnBhdGgucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgfQoKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAuc2VnbWVudCA9IGZ1bmN0aW9uIChzZWdtZW50LCB2LCBidWlsZCkgewogICAgdmFyIHNlcGFyYXRvciA9IHRoaXMuX3BhcnRzLnVybiA/ICc6JyA6ICcvJzsKICAgIHZhciBwYXRoID0gdGhpcy5wYXRoKCk7CiAgICB2YXIgYWJzb2x1dGUgPSBwYXRoLnN1YnN0cmluZygwLCAxKSA9PT0gJy8nOwogICAgdmFyIHNlZ21lbnRzID0gcGF0aC5zcGxpdChzZXBhcmF0b3IpOwoKICAgIGlmIChzZWdtZW50ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHNlZ21lbnQgIT09ICdudW1iZXInKSB7CiAgICAgIGJ1aWxkID0gdjsKICAgICAgdiA9IHNlZ21lbnQ7CiAgICAgIHNlZ21lbnQgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKHNlZ21lbnQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2VnbWVudCAhPT0gJ251bWJlcicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgc2VnbWVudCAiJyArIHNlZ21lbnQgKyAnIiwgbXVzdCBiZSAwLWJhc2VkIGludGVnZXInKTsKICAgIH0KCiAgICBpZiAoYWJzb2x1dGUpIHsKICAgICAgc2VnbWVudHMuc2hpZnQoKTsKICAgIH0KCiAgICBpZiAoc2VnbWVudCA8IDApIHsKICAgICAgLy8gYWxsb3cgbmVnYXRpdmUgaW5kZXhlcyB0byBhZGRyZXNzIGZyb20gdGhlIGVuZAogICAgICBzZWdtZW50ID0gTWF0aC5tYXgoc2VnbWVudHMubGVuZ3RoICsgc2VnbWVudCwgMCk7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICAvKmpzaGludCBsYXhicmVhazogdHJ1ZSAqLwogICAgICByZXR1cm4gc2VnbWVudCA9PT0gdW5kZWZpbmVkID8gc2VnbWVudHMgOiBzZWdtZW50c1tzZWdtZW50XTsKICAgICAgLypqc2hpbnQgbGF4YnJlYWs6IGZhbHNlICovCiAgICB9IGVsc2UgaWYgKHNlZ21lbnQgPT09IG51bGwgfHwgc2VnbWVudHNbc2VnbWVudF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChpc0FycmF5KHYpKSB7CiAgICAgICAgICBzZWdtZW50cyA9IFtdOwogICAgICAgICAgLy8gY29sbGFwc2UgZW1wdHkgZWxlbWVudHMgd2l0aGluIGFycmF5CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHYubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghdltpXS5sZW5ndGggJiYgKCFzZWdtZW50cy5sZW5ndGggfHwgIXNlZ21lbnRzW3NlZ21lbnRzLmxlbmd0aCAtIDFdLmxlbmd0aCkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCAmJiAhc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2VnbWVudHMucG9wKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlZ21lbnRzLnB1c2godHJpbVNsYXNoZXModltpXSkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodiB8fCB0eXBlb2YgdiA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHYgPSB0cmltU2xhc2hlcyh2KTsKICAgICAgICAgIGlmIChzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXSA9PT0gJycpIHsKICAgICAgICAgICAgLy8gZW1wdHkgdHJhaWxpbmcgZWxlbWVudHMgaGF2ZSB0byBiZSBvdmVyd3JpdHRlbgogICAgICAgICAgICAvLyB0byBwcmV2ZW50IHJlc3VsdHMgc3VjaCBhcyAvZm9vLy9iYXIKICAgICAgICAgICAgc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV0gPSB2OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VnbWVudHMucHVzaCh2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHYpIHsKICAgICAgICAgIHNlZ21lbnRzW3NlZ21lbnRdID0gdHJpbVNsYXNoZXModik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlZ21lbnRzLnNwbGljZShzZWdtZW50LCAxKTsKICAgICAgICB9CiAgICAgIH0KCiAgICBpZiAoYWJzb2x1dGUpIHsKICAgICAgc2VnbWVudHMudW5zaGlmdCgnJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMucGF0aChzZWdtZW50cy5qb2luKHNlcGFyYXRvciksIGJ1aWxkKTsKICB9OwogIHAuc2VnbWVudENvZGVkID0gZnVuY3Rpb24gKHNlZ21lbnQsIHYsIGJ1aWxkKSB7CiAgICB2YXIgc2VnbWVudHMsIGksIGw7CgogICAgaWYgKHR5cGVvZiBzZWdtZW50ICE9PSAnbnVtYmVyJykgewogICAgICBidWlsZCA9IHY7CiAgICAgIHYgPSBzZWdtZW50OwogICAgICBzZWdtZW50ID0gdW5kZWZpbmVkOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgc2VnbWVudHMgPSB0aGlzLnNlZ21lbnQoc2VnbWVudCwgdiwgYnVpbGQpOwogICAgICBpZiAoIWlzQXJyYXkoc2VnbWVudHMpKSB7CiAgICAgICAgc2VnbWVudHMgPSBzZWdtZW50cyAhPT0gdW5kZWZpbmVkID8gVVJJLmRlY29kZShzZWdtZW50cykgOiB1bmRlZmluZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChpID0gMCwgbCA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgc2VnbWVudHNbaV0gPSBVUkkuZGVjb2RlKHNlZ21lbnRzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWdtZW50czsKICAgIH0KCiAgICBpZiAoIWlzQXJyYXkodikpIHsKICAgICAgdiA9IHR5cGVvZiB2ID09PSAnc3RyaW5nJyB8fCB2IGluc3RhbmNlb2YgU3RyaW5nID8gVVJJLmVuY29kZSh2KSA6IHY7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGkgPSAwLCBsID0gdi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2W2ldID0gVVJJLmVuY29kZSh2W2ldKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzLnNlZ21lbnQoc2VnbWVudCwgdiwgYnVpbGQpOwogIH07CgogIC8vIG11dGF0aW5nIHF1ZXJ5IHN0cmluZwogIHZhciBxID0gcC5xdWVyeTsKICBwLnF1ZXJ5ID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodiA9PT0gdHJ1ZSkgewogICAgICByZXR1cm4gVVJJLnBhcnNlUXVlcnkodGhpcy5fcGFydHMucXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB2YXIgZGF0YSA9IFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgdmFyIHJlc3VsdCA9IHYuY2FsbCh0aGlzLCBkYXRhKTsKICAgICAgdGhpcy5fcGFydHMucXVlcnkgPSBVUkkuYnVpbGRRdWVyeShyZXN1bHQgfHwgZGF0YSwgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0gZWxzZSBpZiAodiAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2ICE9PSAnc3RyaW5nJykgewogICAgICB0aGlzLl9wYXJ0cy5xdWVyeSA9IFVSSS5idWlsZFF1ZXJ5KHYsIHRoaXMuX3BhcnRzLmR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycywgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcS5jYWxsKHRoaXMsIHYsIGJ1aWxkKTsKICAgIH0KICB9OwogIHAuc2V0UXVlcnkgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGJ1aWxkKSB7CiAgICB2YXIgZGF0YSA9IFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKCiAgICBpZiAodHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnIHx8IG5hbWUgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgZGF0YVtuYW1lXSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IG51bGw7CiAgICB9IGVsc2UgaWYgKCh0eXBlb2YgbmFtZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YobmFtZSkpID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIGlmIChoYXNPd24uY2FsbChuYW1lLCBrZXkpKSB7CiAgICAgICAgICBkYXRhW2tleV0gPSBuYW1lW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVUkkuYWRkUXVlcnkoKSBhY2NlcHRzIGFuIG9iamVjdCwgc3RyaW5nIGFzIHRoZSBuYW1lIHBhcmFtZXRlcicpOwogICAgfQoKICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gVVJJLmJ1aWxkUXVlcnkoZGF0YSwgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgYnVpbGQgPSB2YWx1ZTsKICAgIH0KCiAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHAuYWRkUXVlcnkgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGJ1aWxkKSB7CiAgICB2YXIgZGF0YSA9IFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIFVSSS5hZGRRdWVyeShkYXRhLCBuYW1lLCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHZhbHVlKTsKICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gVVJJLmJ1aWxkUXVlcnkoZGF0YSwgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgYnVpbGQgPSB2YWx1ZTsKICAgIH0KCiAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHAucmVtb3ZlUXVlcnkgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGJ1aWxkKSB7CiAgICB2YXIgZGF0YSA9IFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIFVSSS5yZW1vdmVRdWVyeShkYXRhLCBuYW1lLCB2YWx1ZSk7CiAgICB0aGlzLl9wYXJ0cy5xdWVyeSA9IFVSSS5idWlsZFF1ZXJ5KGRhdGEsIHRoaXMuX3BhcnRzLmR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycywgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB7CiAgICAgIGJ1aWxkID0gdmFsdWU7CiAgICB9CgogICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBwLmhhc1F1ZXJ5ID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCB3aXRoaW5BcnJheSkgewogICAgdmFyIGRhdGEgPSBVUkkucGFyc2VRdWVyeSh0aGlzLl9wYXJ0cy5xdWVyeSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CiAgICByZXR1cm4gVVJJLmhhc1F1ZXJ5KGRhdGEsIG5hbWUsIHZhbHVlLCB3aXRoaW5BcnJheSk7CiAgfTsKICBwLnNldFNlYXJjaCA9IHAuc2V0UXVlcnk7CiAgcC5hZGRTZWFyY2ggPSBwLmFkZFF1ZXJ5OwogIHAucmVtb3ZlU2VhcmNoID0gcC5yZW1vdmVRdWVyeTsKICBwLmhhc1NlYXJjaCA9IHAuaGFzUXVlcnk7CgogIC8vIHNhbml0aXppbmcgVVJMcwogIHAubm9ybWFsaXplID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdGhpcy5ub3JtYWxpemVQcm90b2NvbChmYWxzZSkubm9ybWFsaXplUGF0aChmYWxzZSkubm9ybWFsaXplUXVlcnkoZmFsc2UpLm5vcm1hbGl6ZUZyYWdtZW50KGZhbHNlKS5idWlsZCgpOwogICAgfQoKICAgIHJldHVybiB0aGlzLm5vcm1hbGl6ZVByb3RvY29sKGZhbHNlKS5ub3JtYWxpemVIb3N0bmFtZShmYWxzZSkubm9ybWFsaXplUG9ydChmYWxzZSkubm9ybWFsaXplUGF0aChmYWxzZSkubm9ybWFsaXplUXVlcnkoZmFsc2UpLm5vcm1hbGl6ZUZyYWdtZW50KGZhbHNlKS5idWlsZCgpOwogIH07CiAgcC5ub3JtYWxpemVQcm90b2NvbCA9IGZ1bmN0aW9uIChidWlsZCkgewogICAgaWYgKHR5cGVvZiB0aGlzLl9wYXJ0cy5wcm90b2NvbCA9PT0gJ3N0cmluZycpIHsKICAgICAgdGhpcy5fcGFydHMucHJvdG9jb2wgPSB0aGlzLl9wYXJ0cy5wcm90b2NvbC50b0xvd2VyQ2FzZSgpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBwLm5vcm1hbGl6ZUhvc3RuYW1lID0gZnVuY3Rpb24gKGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMuaG9zdG5hbWUpIHsKICAgICAgaWYgKHRoaXMuaXMoJ0lETicpICYmIHB1bnljb2RlKSB7CiAgICAgICAgdGhpcy5fcGFydHMuaG9zdG5hbWUgPSBwdW55Y29kZS50b0FTQ0lJKHRoaXMuX3BhcnRzLmhvc3RuYW1lKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzKCdJUHY2JykgJiYgSVB2NikgewogICAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gSVB2Ni5iZXN0KHRoaXMuX3BhcnRzLmhvc3RuYW1lKTsKICAgICAgfQoKICAgICAgdGhpcy5fcGFydHMuaG9zdG5hbWUgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBwLm5vcm1hbGl6ZVBvcnQgPSBmdW5jdGlvbiAoYnVpbGQpIHsKICAgIC8vIHJlbW92ZSBwb3J0IG9mIGl0J3MgdGhlIHByb3RvY29sJ3MgZGVmYXVsdAogICAgaWYgKHR5cGVvZiB0aGlzLl9wYXJ0cy5wcm90b2NvbCA9PT0gJ3N0cmluZycgJiYgdGhpcy5fcGFydHMucG9ydCA9PT0gVVJJLmRlZmF1bHRQb3J0c1t0aGlzLl9wYXJ0cy5wcm90b2NvbF0pIHsKICAgICAgdGhpcy5fcGFydHMucG9ydCA9IG51bGw7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwogIHAubm9ybWFsaXplUGF0aCA9IGZ1bmN0aW9uIChidWlsZCkgewogICAgdmFyIF9wYXRoID0gdGhpcy5fcGFydHMucGF0aDsKICAgIGlmICghX3BhdGgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICB0aGlzLl9wYXJ0cy5wYXRoID0gVVJJLnJlY29kZVVyblBhdGgodGhpcy5fcGFydHMucGF0aCk7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKHRoaXMuX3BhcnRzLnBhdGggPT09ICcvJykgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBfcGF0aCA9IFVSSS5yZWNvZGVQYXRoKF9wYXRoKTsKCiAgICB2YXIgX3dhc19yZWxhdGl2ZTsKICAgIHZhciBfbGVhZGluZ1BhcmVudHMgPSAnJzsKICAgIHZhciBfcGFyZW50LCBfcG9zOwoKICAgIC8vIGhhbmRsZSByZWxhdGl2ZSBwYXRocwogICAgaWYgKF9wYXRoLmNoYXJBdCgwKSAhPT0gJy8nKSB7CiAgICAgIF93YXNfcmVsYXRpdmUgPSB0cnVlOwogICAgICBfcGF0aCA9ICcvJyArIF9wYXRoOwogICAgfQoKICAgIC8vIGhhbmRsZSByZWxhdGl2ZSBmaWxlcyAoYXMgb3Bwb3NlZCB0byBkaXJlY3RvcmllcykKICAgIGlmIChfcGF0aC5zbGljZSgtMykgPT09ICcvLi4nIHx8IF9wYXRoLnNsaWNlKC0yKSA9PT0gJy8uJykgewogICAgICBfcGF0aCArPSAnLyc7CiAgICB9CgogICAgLy8gcmVzb2x2ZSBzaW1wbGVzCiAgICBfcGF0aCA9IF9wYXRoLnJlcGxhY2UoLyhcLyhcLlwvKSspfChcL1wuJCkvZywgJy8nKS5yZXBsYWNlKC9cL3syLH0vZywgJy8nKTsKCiAgICAvLyByZW1lbWJlciBsZWFkaW5nIHBhcmVudHMKICAgIGlmIChfd2FzX3JlbGF0aXZlKSB7CiAgICAgIF9sZWFkaW5nUGFyZW50cyA9IF9wYXRoLnN1YnN0cmluZygxKS5tYXRjaCgvXihcLlwuXC8pKy8pIHx8ICcnOwogICAgICBpZiAoX2xlYWRpbmdQYXJlbnRzKSB7CiAgICAgICAgX2xlYWRpbmdQYXJlbnRzID0gX2xlYWRpbmdQYXJlbnRzWzBdOwogICAgICB9CiAgICB9CgogICAgLy8gcmVzb2x2ZSBwYXJlbnRzCiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBfcGFyZW50ID0gX3BhdGguc2VhcmNoKC9cL1wuXC4oXC98JCkvKTsKICAgICAgaWYgKF9wYXJlbnQgPT09IC0xKSB7CiAgICAgICAgLy8gbm8gbW9yZSAuLi8gdG8gcmVzb2x2ZQogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgaWYgKF9wYXJlbnQgPT09IDApIHsKICAgICAgICAvLyB0b3AgbGV2ZWwgY2Fubm90IGJlIHJlbGF0aXZlLCBza2lwIGl0CiAgICAgICAgX3BhdGggPSBfcGF0aC5zdWJzdHJpbmcoMyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIF9wb3MgPSBfcGF0aC5zdWJzdHJpbmcoMCwgX3BhcmVudCkubGFzdEluZGV4T2YoJy8nKTsKICAgICAgaWYgKF9wb3MgPT09IC0xKSB7CiAgICAgICAgX3BvcyA9IF9wYXJlbnQ7CiAgICAgIH0KICAgICAgX3BhdGggPSBfcGF0aC5zdWJzdHJpbmcoMCwgX3BvcykgKyBfcGF0aC5zdWJzdHJpbmcoX3BhcmVudCArIDMpOwogICAgfQoKICAgIC8vIHJldmVydCB0byByZWxhdGl2ZQogICAgaWYgKF93YXNfcmVsYXRpdmUgJiYgdGhpcy5pcygncmVsYXRpdmUnKSkgewogICAgICBfcGF0aCA9IF9sZWFkaW5nUGFyZW50cyArIF9wYXRoLnN1YnN0cmluZygxKTsKICAgIH0KCiAgICB0aGlzLl9wYXJ0cy5wYXRoID0gX3BhdGg7CiAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHAubm9ybWFsaXplUGF0aG5hbWUgPSBwLm5vcm1hbGl6ZVBhdGg7CiAgcC5ub3JtYWxpemVRdWVyeSA9IGZ1bmN0aW9uIChidWlsZCkgewogICAgaWYgKHR5cGVvZiB0aGlzLl9wYXJ0cy5xdWVyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJ0cy5xdWVyeS5sZW5ndGgpIHsKICAgICAgICB0aGlzLl9wYXJ0cy5xdWVyeSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5xdWVyeShVUkkucGFyc2VRdWVyeSh0aGlzLl9wYXJ0cy5xdWVyeSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSkpOwogICAgICB9CgogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBwLm5vcm1hbGl6ZUZyYWdtZW50ID0gZnVuY3Rpb24gKGJ1aWxkKSB7CiAgICBpZiAoIXRoaXMuX3BhcnRzLmZyYWdtZW50KSB7CiAgICAgIHRoaXMuX3BhcnRzLmZyYWdtZW50ID0gbnVsbDsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH07CiAgcC5ub3JtYWxpemVTZWFyY2ggPSBwLm5vcm1hbGl6ZVF1ZXJ5OwogIHAubm9ybWFsaXplSGFzaCA9IHAubm9ybWFsaXplRnJhZ21lbnQ7CgogIHAuaXNvODg1OSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIGV4cGVjdCB1bmljb2RlIGlucHV0LCBpc284ODU5IG91dHB1dAogICAgdmFyIGUgPSBVUkkuZW5jb2RlOwogICAgdmFyIGQgPSBVUkkuZGVjb2RlOwoKICAgIFVSSS5lbmNvZGUgPSBlc2NhcGU7CiAgICBVUkkuZGVjb2RlID0gZGVjb2RlVVJJQ29tcG9uZW50OwogICAgdHJ5IHsKICAgICAgdGhpcy5ub3JtYWxpemUoKTsKICAgIH0gZmluYWxseSB7CiAgICAgIFVSSS5lbmNvZGUgPSBlOwogICAgICBVUkkuZGVjb2RlID0gZDsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH07CgogIHAudW5pY29kZSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIGV4cGVjdCBpc284ODU5IGlucHV0LCB1bmljb2RlIG91dHB1dAogICAgdmFyIGUgPSBVUkkuZW5jb2RlOwogICAgdmFyIGQgPSBVUkkuZGVjb2RlOwoKICAgIFVSSS5lbmNvZGUgPSBzdHJpY3RFbmNvZGVVUklDb21wb25lbnQ7CiAgICBVUkkuZGVjb2RlID0gdW5lc2NhcGU7CiAgICB0cnkgewogICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgVVJJLmVuY29kZSA9IGU7CiAgICAgIFVSSS5kZWNvZGUgPSBkOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgcC5yZWFkYWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB1cmkgPSB0aGlzLmNsb25lKCk7CiAgICAvLyByZW1vdmluZyB1c2VybmFtZSwgcGFzc3dvcmQsIGJlY2F1c2UgdGhleSBzaG91bGRuJ3QgYmUgZGlzcGxheWVkIGFjY29yZGluZyB0byBSRkMgMzk4NgogICAgdXJpLnVzZXJuYW1lKCcnKS5wYXNzd29yZCgnJykubm9ybWFsaXplKCk7CiAgICB2YXIgdCA9ICcnOwogICAgaWYgKHVyaS5fcGFydHMucHJvdG9jb2wpIHsKICAgICAgdCArPSB1cmkuX3BhcnRzLnByb3RvY29sICsgJzovLyc7CiAgICB9CgogICAgaWYgKHVyaS5fcGFydHMuaG9zdG5hbWUpIHsKICAgICAgaWYgKHVyaS5pcygncHVueWNvZGUnKSAmJiBwdW55Y29kZSkgewogICAgICAgIHQgKz0gcHVueWNvZGUudG9Vbmljb2RlKHVyaS5fcGFydHMuaG9zdG5hbWUpOwogICAgICAgIGlmICh1cmkuX3BhcnRzLnBvcnQpIHsKICAgICAgICAgIHQgKz0gJzonICsgdXJpLl9wYXJ0cy5wb3J0OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0ICs9IHVyaS5ob3N0KCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAodXJpLl9wYXJ0cy5ob3N0bmFtZSAmJiB1cmkuX3BhcnRzLnBhdGggJiYgdXJpLl9wYXJ0cy5wYXRoLmNoYXJBdCgwKSAhPT0gJy8nKSB7CiAgICAgIHQgKz0gJy8nOwogICAgfQoKICAgIHQgKz0gdXJpLnBhdGgodHJ1ZSk7CiAgICBpZiAodXJpLl9wYXJ0cy5xdWVyeSkgewogICAgICB2YXIgcSA9ICcnOwogICAgICBmb3IgKHZhciBpID0gMCwgcXAgPSB1cmkuX3BhcnRzLnF1ZXJ5LnNwbGl0KCcmJyksIGwgPSBxcC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIga3YgPSAocXBbaV0gfHwgJycpLnNwbGl0KCc9Jyk7CiAgICAgICAgcSArPSAnJicgKyBVUkkuZGVjb2RlUXVlcnkoa3ZbMF0sIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpLnJlcGxhY2UoLyYvZywgJyUyNicpOwoKICAgICAgICBpZiAoa3ZbMV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcSArPSAnPScgKyBVUkkuZGVjb2RlUXVlcnkoa3ZbMV0sIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpLnJlcGxhY2UoLyYvZywgJyUyNicpOwogICAgICAgIH0KICAgICAgfQogICAgICB0ICs9ICc/JyArIHEuc3Vic3RyaW5nKDEpOwogICAgfQoKICAgIHQgKz0gVVJJLmRlY29kZVF1ZXJ5KHVyaS5oYXNoKCksIHRydWUpOwogICAgcmV0dXJuIHQ7CiAgfTsKCiAgLy8gcmVzb2x2aW5nIHJlbGF0aXZlIGFuZCBhYnNvbHV0ZSBVUkxzCiAgcC5hYnNvbHV0ZVRvID0gZnVuY3Rpb24gKGJhc2UpIHsKICAgIHZhciByZXNvbHZlZCA9IHRoaXMuY2xvbmUoKTsKICAgIHZhciBwcm9wZXJ0aWVzID0gWydwcm90b2NvbCcsICd1c2VybmFtZScsICdwYXNzd29yZCcsICdob3N0bmFtZScsICdwb3J0J107CiAgICB2YXIgYmFzZWRpciwgaSwgcDsKCiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVVJOcyBkbyBub3QgaGF2ZSBhbnkgZ2VuZXJhbGx5IGRlZmluZWQgaGllcmFyY2hpY2FsIGNvbXBvbmVudHMnKTsKICAgIH0KCiAgICBpZiAoIShiYXNlIGluc3RhbmNlb2YgVVJJKSkgewogICAgICBiYXNlID0gbmV3IFVSSShiYXNlKTsKICAgIH0KCiAgICBpZiAoIXJlc29sdmVkLl9wYXJ0cy5wcm90b2NvbCkgewogICAgICByZXNvbHZlZC5fcGFydHMucHJvdG9jb2wgPSBiYXNlLl9wYXJ0cy5wcm90b2NvbDsKICAgIH0KCiAgICBpZiAodGhpcy5fcGFydHMuaG9zdG5hbWUpIHsKICAgICAgcmV0dXJuIHJlc29sdmVkOwogICAgfQoKICAgIGZvciAoaSA9IDA7IHAgPSBwcm9wZXJ0aWVzW2ldOyBpKyspIHsKICAgICAgcmVzb2x2ZWQuX3BhcnRzW3BdID0gYmFzZS5fcGFydHNbcF07CiAgICB9CgogICAgaWYgKCFyZXNvbHZlZC5fcGFydHMucGF0aCkgewogICAgICByZXNvbHZlZC5fcGFydHMucGF0aCA9IGJhc2UuX3BhcnRzLnBhdGg7CiAgICAgIGlmICghcmVzb2x2ZWQuX3BhcnRzLnF1ZXJ5KSB7CiAgICAgICAgcmVzb2x2ZWQuX3BhcnRzLnF1ZXJ5ID0gYmFzZS5fcGFydHMucXVlcnk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAocmVzb2x2ZWQuX3BhcnRzLnBhdGguc3Vic3RyaW5nKC0yKSA9PT0gJy4uJykgewogICAgICByZXNvbHZlZC5fcGFydHMucGF0aCArPSAnLyc7CiAgICB9CgogICAgaWYgKHJlc29sdmVkLnBhdGgoKS5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICBiYXNlZGlyID0gYmFzZS5kaXJlY3RvcnkoKTsKICAgICAgYmFzZWRpciA9IGJhc2VkaXIgPyBiYXNlZGlyIDogYmFzZS5wYXRoKCkuaW5kZXhPZignLycpID09PSAwID8gJy8nIDogJyc7CiAgICAgIHJlc29sdmVkLl9wYXJ0cy5wYXRoID0gKGJhc2VkaXIgPyBiYXNlZGlyICsgJy8nIDogJycpICsgcmVzb2x2ZWQuX3BhcnRzLnBhdGg7CiAgICAgIHJlc29sdmVkLm5vcm1hbGl6ZVBhdGgoKTsKICAgIH0KCiAgICByZXNvbHZlZC5idWlsZCgpOwogICAgcmV0dXJuIHJlc29sdmVkOwogIH07CiAgcC5yZWxhdGl2ZVRvID0gZnVuY3Rpb24gKGJhc2UpIHsKICAgIHZhciByZWxhdGl2ZSA9IHRoaXMuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgIHZhciByZWxhdGl2ZVBhcnRzLCBiYXNlUGFydHMsIGNvbW1vbiwgcmVsYXRpdmVQYXRoLCBiYXNlUGF0aDsKCiAgICBpZiAocmVsYXRpdmUuX3BhcnRzLnVybikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VSTnMgZG8gbm90IGhhdmUgYW55IGdlbmVyYWxseSBkZWZpbmVkIGhpZXJhcmNoaWNhbCBjb21wb25lbnRzJyk7CiAgICB9CgogICAgYmFzZSA9IG5ldyBVUkkoYmFzZSkubm9ybWFsaXplKCk7CiAgICByZWxhdGl2ZVBhcnRzID0gcmVsYXRpdmUuX3BhcnRzOwogICAgYmFzZVBhcnRzID0gYmFzZS5fcGFydHM7CiAgICByZWxhdGl2ZVBhdGggPSByZWxhdGl2ZS5wYXRoKCk7CiAgICBiYXNlUGF0aCA9IGJhc2UucGF0aCgpOwoKICAgIGlmIChyZWxhdGl2ZVBhdGguY2hhckF0KDApICE9PSAnLycpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdVUkkgaXMgYWxyZWFkeSByZWxhdGl2ZScpOwogICAgfQoKICAgIGlmIChiYXNlUGF0aC5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjYWxjdWxhdGUgYSBVUkkgcmVsYXRpdmUgdG8gYW5vdGhlciByZWxhdGl2ZSBVUkknKTsKICAgIH0KCiAgICBpZiAocmVsYXRpdmVQYXJ0cy5wcm90b2NvbCA9PT0gYmFzZVBhcnRzLnByb3RvY29sKSB7CiAgICAgIHJlbGF0aXZlUGFydHMucHJvdG9jb2wgPSBudWxsOwogICAgfQoKICAgIGlmIChyZWxhdGl2ZVBhcnRzLnVzZXJuYW1lICE9PSBiYXNlUGFydHMudXNlcm5hbWUgfHwgcmVsYXRpdmVQYXJ0cy5wYXNzd29yZCAhPT0gYmFzZVBhcnRzLnBhc3N3b3JkKSB7CiAgICAgIHJldHVybiByZWxhdGl2ZS5idWlsZCgpOwogICAgfQoKICAgIGlmIChyZWxhdGl2ZVBhcnRzLnByb3RvY29sICE9PSBudWxsIHx8IHJlbGF0aXZlUGFydHMudXNlcm5hbWUgIT09IG51bGwgfHwgcmVsYXRpdmVQYXJ0cy5wYXNzd29yZCAhPT0gbnVsbCkgewogICAgICByZXR1cm4gcmVsYXRpdmUuYnVpbGQoKTsKICAgIH0KCiAgICBpZiAocmVsYXRpdmVQYXJ0cy5ob3N0bmFtZSA9PT0gYmFzZVBhcnRzLmhvc3RuYW1lICYmIHJlbGF0aXZlUGFydHMucG9ydCA9PT0gYmFzZVBhcnRzLnBvcnQpIHsKICAgICAgcmVsYXRpdmVQYXJ0cy5ob3N0bmFtZSA9IG51bGw7CiAgICAgIHJlbGF0aXZlUGFydHMucG9ydCA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcmVsYXRpdmUuYnVpbGQoKTsKICAgIH0KCiAgICBpZiAocmVsYXRpdmVQYXRoID09PSBiYXNlUGF0aCkgewogICAgICByZWxhdGl2ZVBhcnRzLnBhdGggPSAnJzsKICAgICAgcmV0dXJuIHJlbGF0aXZlLmJ1aWxkKCk7CiAgICB9CgogICAgLy8gZGV0ZXJtaW5lIGNvbW1vbiBzdWIgcGF0aAogICAgY29tbW9uID0gVVJJLmNvbW1vblBhdGgocmVsYXRpdmVQYXRoLCBiYXNlUGF0aCk7CgogICAgLy8gSWYgdGhlIHBhdGhzIGhhdmUgbm90aGluZyBpbiBjb21tb24sIHJldHVybiBhIHJlbGF0aXZlIFVSTCB3aXRoIHRoZSBhYnNvbHV0ZSBwYXRoLgogICAgaWYgKCFjb21tb24pIHsKICAgICAgcmV0dXJuIHJlbGF0aXZlLmJ1aWxkKCk7CiAgICB9CgogICAgdmFyIHBhcmVudHMgPSBiYXNlUGFydHMucGF0aC5zdWJzdHJpbmcoY29tbW9uLmxlbmd0aCkucmVwbGFjZSgvW15cL10qJC8sICcnKS5yZXBsYWNlKC8uKj9cLy9nLCAnLi4vJyk7CgogICAgcmVsYXRpdmVQYXJ0cy5wYXRoID0gcGFyZW50cyArIHJlbGF0aXZlUGFydHMucGF0aC5zdWJzdHJpbmcoY29tbW9uLmxlbmd0aCkgfHwgJy4vJzsKCiAgICByZXR1cm4gcmVsYXRpdmUuYnVpbGQoKTsKICB9OwoKICAvLyBjb21wYXJpbmcgVVJJcwogIHAuZXF1YWxzID0gZnVuY3Rpb24gKHVyaSkgewogICAgdmFyIG9uZSA9IHRoaXMuY2xvbmUoKTsKICAgIHZhciB0d28gPSBuZXcgVVJJKHVyaSk7CiAgICB2YXIgb25lX21hcCA9IHt9OwogICAgdmFyIHR3b19tYXAgPSB7fTsKICAgIHZhciBjaGVja2VkID0ge307CiAgICB2YXIgb25lX3F1ZXJ5LCB0d29fcXVlcnksIGtleTsKCiAgICBvbmUubm9ybWFsaXplKCk7CiAgICB0d28ubm9ybWFsaXplKCk7CgogICAgLy8gZXhhY3QgbWF0Y2gKICAgIGlmIChvbmUudG9TdHJpbmcoKSA9PT0gdHdvLnRvU3RyaW5nKCkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gZXh0cmFjdCBxdWVyeSBzdHJpbmcKICAgIG9uZV9xdWVyeSA9IG9uZS5xdWVyeSgpOwogICAgdHdvX3F1ZXJ5ID0gdHdvLnF1ZXJ5KCk7CiAgICBvbmUucXVlcnkoJycpOwogICAgdHdvLnF1ZXJ5KCcnKTsKCiAgICAvLyBkZWZpbml0ZWx5IG5vdCBlcXVhbCBpZiBub3QgZXZlbiBub24tcXVlcnkgcGFydHMgbWF0Y2gKICAgIGlmIChvbmUudG9TdHJpbmcoKSAhPT0gdHdvLnRvU3RyaW5nKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIHF1ZXJ5IHBhcmFtZXRlcnMgaGF2ZSB0aGUgc2FtZSBsZW5ndGgsIGV2ZW4gaWYgdGhleSdyZSBwZXJtdXRlZAogICAgaWYgKG9uZV9xdWVyeS5sZW5ndGggIT09IHR3b19xdWVyeS5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIG9uZV9tYXAgPSBVUkkucGFyc2VRdWVyeShvbmVfcXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgdHdvX21hcCA9IFVSSS5wYXJzZVF1ZXJ5KHR3b19xdWVyeSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CgogICAgZm9yIChrZXkgaW4gb25lX21hcCkgewogICAgICBpZiAoaGFzT3duLmNhbGwob25lX21hcCwga2V5KSkgewogICAgICAgIGlmICghaXNBcnJheShvbmVfbWFwW2tleV0pKSB7CiAgICAgICAgICBpZiAob25lX21hcFtrZXldICE9PSB0d29fbWFwW2tleV0pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWFycmF5c0VxdWFsKG9uZV9tYXBba2V5XSwgdHdvX21hcFtrZXldKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgY2hlY2tlZFtrZXldID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGZvciAoa2V5IGluIHR3b19tYXApIHsKICAgICAgaWYgKGhhc093bi5jYWxsKHR3b19tYXAsIGtleSkpIHsKICAgICAgICBpZiAoIWNoZWNrZWRba2V5XSkgewogICAgICAgICAgLy8gdHdvIGNvbnRhaW5zIGEgcGFyYW1ldGVyIG5vdCBwcmVzZW50IGluIG9uZQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIHN0YXRlCiAgcC5kdXBsaWNhdGVRdWVyeVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAodikgewogICAgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzID0gISF2OwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgcC5lc2NhcGVRdWVyeVNwYWNlID0gZnVuY3Rpb24gKHYpIHsKICAgIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UgPSAhIXY7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICByZXR1cm4gVVJJOwp9KTsKCn0seyIuL0lQdjYiOjMsIi4vU2Vjb25kTGV2ZWxEb21haW5zIjo0LCIuL3B1bnljb2RlIjo2fV0sNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoZ2xvYmFsKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyohIGh0dHBzOi8vbXRocy5iZS9wdW55Y29kZSB2MS40LjAgYnkgQG1hdGhpYXMgKi8KOyhmdW5jdGlvbiAocm9vdCkgewoKCS8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZXMgKi8KCXZhciBmcmVlRXhwb3J0cyA9ICh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09ICdvYmplY3QnICYmIGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0czsKCXZhciBmcmVlTW9kdWxlID0gKHR5cGVvZiBtb2R1bGUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG1vZHVsZSkpID09ICdvYmplY3QnICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsKCXZhciBmcmVlR2xvYmFsID0gKHR5cGVvZiBnbG9iYWwgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGdsb2JhbCkpID09ICdvYmplY3QnICYmIGdsb2JhbDsKCWlmIChmcmVlR2xvYmFsLmdsb2JhbCA9PT0gZnJlZUdsb2JhbCB8fCBmcmVlR2xvYmFsLndpbmRvdyA9PT0gZnJlZUdsb2JhbCB8fCBmcmVlR2xvYmFsLnNlbGYgPT09IGZyZWVHbG9iYWwpIHsKCQlyb290ID0gZnJlZUdsb2JhbDsKCX0KCgkvKioKICAqIFRoZSBgcHVueWNvZGVgIG9iamVjdC4KICAqIEBuYW1lIHB1bnljb2RlCiAgKiBAdHlwZSBPYmplY3QKICAqLwoJdmFyIHB1bnljb2RlLAoKCgkvKiogSGlnaGVzdCBwb3NpdGl2ZSBzaWduZWQgMzItYml0IGZsb2F0IHZhbHVlICovCgltYXhJbnQgPSAyMTQ3NDgzNjQ3LAoJICAgIC8vIGFrYS4gMHg3RkZGRkZGRiBvciAyXjMxLTEKCgkvKiogQm9vdHN0cmluZyBwYXJhbWV0ZXJzICovCgliYXNlID0gMzYsCgkgICAgdE1pbiA9IDEsCgkgICAgdE1heCA9IDI2LAoJICAgIHNrZXcgPSAzOCwKCSAgICBkYW1wID0gNzAwLAoJICAgIGluaXRpYWxCaWFzID0gNzIsCgkgICAgaW5pdGlhbE4gPSAxMjgsCgkgICAgLy8gMHg4MAoJZGVsaW1pdGVyID0gJy0nLAoJICAgIC8vICdceDJEJwoKCS8qKiBSZWd1bGFyIGV4cHJlc3Npb25zICovCglyZWdleFB1bnljb2RlID0gL154bi0tLywKCSAgICByZWdleE5vbkFTQ0lJID0gL1teXHgyMC1ceDdFXS8sCgkgICAgLy8gdW5wcmludGFibGUgQVNDSUkgY2hhcnMgKyBub24tQVNDSUkgY2hhcnMKCXJlZ2V4U2VwYXJhdG9ycyA9IC9bXHgyRVx1MzAwMlx1RkYwRVx1RkY2MV0vZywKCSAgICAvLyBSRkMgMzQ5MCBzZXBhcmF0b3JzCgoJLyoqIEVycm9yIG1lc3NhZ2VzICovCgllcnJvcnMgPSB7CgkJJ292ZXJmbG93JzogJ092ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzJywKCQknbm90LWJhc2ljJzogJ0lsbGVnYWwgaW5wdXQgPj0gMHg4MCAobm90IGEgYmFzaWMgY29kZSBwb2ludCknLAoJCSdpbnZhbGlkLWlucHV0JzogJ0ludmFsaWQgaW5wdXQnCgl9LAoKCgkvKiogQ29udmVuaWVuY2Ugc2hvcnRjdXRzICovCgliYXNlTWludXNUTWluID0gYmFzZSAtIHRNaW4sCgkgICAgZmxvb3IgPSBNYXRoLmZsb29yLAoJICAgIHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUsCgoKCS8qKiBUZW1wb3JhcnkgdmFyaWFibGUgKi8KCWtleTsKCgkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCgkvKioKICAqIEEgZ2VuZXJpYyBlcnJvciB1dGlsaXR5IGZ1bmN0aW9uLgogICogQHByaXZhdGUKICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBlcnJvciB0eXBlLgogICogQHJldHVybnMge0Vycm9yfSBUaHJvd3MgYSBgUmFuZ2VFcnJvcmAgd2l0aCB0aGUgYXBwbGljYWJsZSBlcnJvciBtZXNzYWdlLgogICovCglmdW5jdGlvbiBlcnJvcih0eXBlKSB7CgkJdGhyb3cgbmV3IFJhbmdlRXJyb3IoZXJyb3JzW3R5cGVdKTsKCX0KCgkvKioKICAqIEEgZ2VuZXJpYyBgQXJyYXkjbWFwYCB1dGlsaXR5IGZ1bmN0aW9uLgogICogQHByaXZhdGUKICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuCiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCBmb3IgZXZlcnkgYXJyYXkKICAqIGl0ZW0uCiAgKiBAcmV0dXJucyB7QXJyYXl9IEEgbmV3IGFycmF5IG9mIHZhbHVlcyByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2sgZnVuY3Rpb24uCiAgKi8KCWZ1bmN0aW9uIG1hcChhcnJheSwgZm4pIHsKCQl2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoJCXZhciByZXN1bHQgPSBbXTsKCQl3aGlsZSAobGVuZ3RoLS0pIHsKCQkJcmVzdWx0W2xlbmd0aF0gPSBmbihhcnJheVtsZW5ndGhdKTsKCQl9CgkJcmV0dXJuIHJlc3VsdDsKCX0KCgkvKioKICAqIEEgc2ltcGxlIGBBcnJheSNtYXBgLWxpa2Ugd3JhcHBlciB0byB3b3JrIHdpdGggZG9tYWluIG5hbWUgc3RyaW5ncyBvciBlbWFpbAogICogYWRkcmVzc2VzLgogICogQHByaXZhdGUKICAqIEBwYXJhbSB7U3RyaW5nfSBkb21haW4gVGhlIGRvbWFpbiBuYW1lIG9yIGVtYWlsIGFkZHJlc3MuCiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCBmb3IgZXZlcnkKICAqIGNoYXJhY3Rlci4KICAqIEByZXR1cm5zIHtBcnJheX0gQSBuZXcgc3RyaW5nIG9mIGNoYXJhY3RlcnMgcmV0dXJuZWQgYnkgdGhlIGNhbGxiYWNrCiAgKiBmdW5jdGlvbi4KICAqLwoJZnVuY3Rpb24gbWFwRG9tYWluKHN0cmluZywgZm4pIHsKCQl2YXIgcGFydHMgPSBzdHJpbmcuc3BsaXQoJ0AnKTsKCQl2YXIgcmVzdWx0ID0gJyc7CgkJaWYgKHBhcnRzLmxlbmd0aCA+IDEpIHsKCQkJLy8gSW4gZW1haWwgYWRkcmVzc2VzLCBvbmx5IHRoZSBkb21haW4gbmFtZSBzaG91bGQgYmUgcHVueWNvZGVkLiBMZWF2ZQoJCQkvLyB0aGUgbG9jYWwgcGFydCAoaS5lLiBldmVyeXRoaW5nIHVwIHRvIGBAYCkgaW50YWN0LgoJCQlyZXN1bHQgPSBwYXJ0c1swXSArICdAJzsKCQkJc3RyaW5nID0gcGFydHNbMV07CgkJfQoJCS8vIEF2b2lkIGBzcGxpdChyZWdleClgIGZvciBJRTggY29tcGF0aWJpbGl0eS4gU2VlICMxNy4KCQlzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShyZWdleFNlcGFyYXRvcnMsICdceDJFJyk7CgkJdmFyIGxhYmVscyA9IHN0cmluZy5zcGxpdCgnLicpOwoJCXZhciBlbmNvZGVkID0gbWFwKGxhYmVscywgZm4pLmpvaW4oJy4nKTsKCQlyZXR1cm4gcmVzdWx0ICsgZW5jb2RlZDsKCX0KCgkvKioKICAqIENyZWF0ZXMgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgbnVtZXJpYyBjb2RlIHBvaW50cyBvZiBlYWNoIFVuaWNvZGUKICAqIGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nLiBXaGlsZSBKYXZhU2NyaXB0IHVzZXMgVUNTLTIgaW50ZXJuYWxseSwKICAqIHRoaXMgZnVuY3Rpb24gd2lsbCBjb252ZXJ0IGEgcGFpciBvZiBzdXJyb2dhdGUgaGFsdmVzIChlYWNoIG9mIHdoaWNoCiAgKiBVQ1MtMiBleHBvc2VzIGFzIHNlcGFyYXRlIGNoYXJhY3RlcnMpIGludG8gYSBzaW5nbGUgY29kZSBwb2ludCwKICAqIG1hdGNoaW5nIFVURi0xNi4KICAqIEBzZWUgYHB1bnljb2RlLnVjczIuZW5jb2RlYAogICogQHNlZSA8aHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtZW5jb2Rpbmc+CiAgKiBAbWVtYmVyT2YgcHVueWNvZGUudWNzMgogICogQG5hbWUgZGVjb2RlCiAgKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIFRoZSBVbmljb2RlIGlucHV0IHN0cmluZyAoVUNTLTIpLgogICogQHJldHVybnMge0FycmF5fSBUaGUgbmV3IGFycmF5IG9mIGNvZGUgcG9pbnRzLgogICovCglmdW5jdGlvbiB1Y3MyZGVjb2RlKHN0cmluZykgewoJCXZhciBvdXRwdXQgPSBbXSwKCQkgICAgY291bnRlciA9IDAsCgkJICAgIGxlbmd0aCA9IHN0cmluZy5sZW5ndGgsCgkJICAgIHZhbHVlLAoJCSAgICBleHRyYTsKCQl3aGlsZSAoY291bnRlciA8IGxlbmd0aCkgewoJCQl2YWx1ZSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7CgkJCWlmICh2YWx1ZSA+PSAweEQ4MDAgJiYgdmFsdWUgPD0gMHhEQkZGICYmIGNvdW50ZXIgPCBsZW5ndGgpIHsKCQkJCS8vIGhpZ2ggc3Vycm9nYXRlLCBhbmQgdGhlcmUgaXMgYSBuZXh0IGNoYXJhY3RlcgoJCQkJZXh0cmEgPSBzdHJpbmcuY2hhckNvZGVBdChjb3VudGVyKyspOwoJCQkJaWYgKChleHRyYSAmIDB4RkMwMCkgPT0gMHhEQzAwKSB7CgkJCQkJLy8gbG93IHN1cnJvZ2F0ZQoJCQkJCW91dHB1dC5wdXNoKCgodmFsdWUgJiAweDNGRikgPDwgMTApICsgKGV4dHJhICYgMHgzRkYpICsgMHgxMDAwMCk7CgkJCQl9IGVsc2UgewoJCQkJCS8vIHVubWF0Y2hlZCBzdXJyb2dhdGU7IG9ubHkgYXBwZW5kIHRoaXMgY29kZSB1bml0LCBpbiBjYXNlIHRoZSBuZXh0CgkJCQkJLy8gY29kZSB1bml0IGlzIHRoZSBoaWdoIHN1cnJvZ2F0ZSBvZiBhIHN1cnJvZ2F0ZSBwYWlyCgkJCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCQkJCWNvdW50ZXItLTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCW91dHB1dC5wdXNoKHZhbHVlKTsKCQkJfQoJCX0KCQlyZXR1cm4gb3V0cHV0OwoJfQoKCS8qKgogICogQ3JlYXRlcyBhIHN0cmluZyBiYXNlZCBvbiBhbiBhcnJheSBvZiBudW1lcmljIGNvZGUgcG9pbnRzLgogICogQHNlZSBgcHVueWNvZGUudWNzMi5kZWNvZGVgCiAgKiBAbWVtYmVyT2YgcHVueWNvZGUudWNzMgogICogQG5hbWUgZW5jb2RlCiAgKiBAcGFyYW0ge0FycmF5fSBjb2RlUG9pbnRzIFRoZSBhcnJheSBvZiBudW1lcmljIGNvZGUgcG9pbnRzLgogICogQHJldHVybnMge1N0cmluZ30gVGhlIG5ldyBVbmljb2RlIHN0cmluZyAoVUNTLTIpLgogICovCglmdW5jdGlvbiB1Y3MyZW5jb2RlKGFycmF5KSB7CgkJcmV0dXJuIG1hcChhcnJheSwgZnVuY3Rpb24gKHZhbHVlKSB7CgkJCXZhciBvdXRwdXQgPSAnJzsKCQkJaWYgKHZhbHVlID4gMHhGRkZGKSB7CgkJCQl2YWx1ZSAtPSAweDEwMDAwOwoJCQkJb3V0cHV0ICs9IHN0cmluZ0Zyb21DaGFyQ29kZSh2YWx1ZSA+Pj4gMTAgJiAweDNGRiB8IDB4RDgwMCk7CgkJCQl2YWx1ZSA9IDB4REMwMCB8IHZhbHVlICYgMHgzRkY7CgkJCX0KCQkJb3V0cHV0ICs9IHN0cmluZ0Zyb21DaGFyQ29kZSh2YWx1ZSk7CgkJCXJldHVybiBvdXRwdXQ7CgkJfSkuam9pbignJyk7Cgl9CgoJLyoqCiAgKiBDb252ZXJ0cyBhIGJhc2ljIGNvZGUgcG9pbnQgaW50byBhIGRpZ2l0L2ludGVnZXIuCiAgKiBAc2VlIGBkaWdpdFRvQmFzaWMoKWAKICAqIEBwcml2YXRlCiAgKiBAcGFyYW0ge051bWJlcn0gY29kZVBvaW50IFRoZSBiYXNpYyBudW1lcmljIGNvZGUgcG9pbnQgdmFsdWUuCiAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQgKGZvciB1c2UgaW4KICAqIHJlcHJlc2VudGluZyBpbnRlZ2VycykgaW4gdGhlIHJhbmdlIGAwYCB0byBgYmFzZSAtIDFgLCBvciBgYmFzZWAgaWYKICAqIHRoZSBjb2RlIHBvaW50IGRvZXMgbm90IHJlcHJlc2VudCBhIHZhbHVlLgogICovCglmdW5jdGlvbiBiYXNpY1RvRGlnaXQoY29kZVBvaW50KSB7CgkJaWYgKGNvZGVQb2ludCAtIDQ4IDwgMTApIHsKCQkJcmV0dXJuIGNvZGVQb2ludCAtIDIyOwoJCX0KCQlpZiAoY29kZVBvaW50IC0gNjUgPCAyNikgewoJCQlyZXR1cm4gY29kZVBvaW50IC0gNjU7CgkJfQoJCWlmIChjb2RlUG9pbnQgLSA5NyA8IDI2KSB7CgkJCXJldHVybiBjb2RlUG9pbnQgLSA5NzsKCQl9CgkJcmV0dXJuIGJhc2U7Cgl9CgoJLyoqCiAgKiBDb252ZXJ0cyBhIGRpZ2l0L2ludGVnZXIgaW50byBhIGJhc2ljIGNvZGUgcG9pbnQuCiAgKiBAc2VlIGBiYXNpY1RvRGlnaXQoKWAKICAqIEBwcml2YXRlCiAgKiBAcGFyYW0ge051bWJlcn0gZGlnaXQgVGhlIG51bWVyaWMgdmFsdWUgb2YgYSBiYXNpYyBjb2RlIHBvaW50LgogICogQHJldHVybnMge051bWJlcn0gVGhlIGJhc2ljIGNvZGUgcG9pbnQgd2hvc2UgdmFsdWUgKHdoZW4gdXNlZCBmb3IKICAqIHJlcHJlc2VudGluZyBpbnRlZ2VycykgaXMgYGRpZ2l0YCwgd2hpY2ggbmVlZHMgdG8gYmUgaW4gdGhlIHJhbmdlCiAgKiBgMGAgdG8gYGJhc2UgLSAxYC4gSWYgYGZsYWdgIGlzIG5vbi16ZXJvLCB0aGUgdXBwZXJjYXNlIGZvcm0gaXMKICAqIHVzZWQ7IGVsc2UsIHRoZSBsb3dlcmNhc2UgZm9ybSBpcyB1c2VkLiBUaGUgYmVoYXZpb3IgaXMgdW5kZWZpbmVkCiAgKiBpZiBgZmxhZ2AgaXMgbm9uLXplcm8gYW5kIGBkaWdpdGAgaGFzIG5vIHVwcGVyY2FzZSBmb3JtLgogICovCglmdW5jdGlvbiBkaWdpdFRvQmFzaWMoZGlnaXQsIGZsYWcpIHsKCQkvLyAgMC4uMjUgbWFwIHRvIEFTQ0lJIGEuLnogb3IgQS4uWgoJCS8vIDI2Li4zNSBtYXAgdG8gQVNDSUkgMC4uOQoJCXJldHVybiBkaWdpdCArIDIyICsgNzUgKiAoZGlnaXQgPCAyNikgLSAoKGZsYWcgIT0gMCkgPDwgNSk7Cgl9CgoJLyoqCiAgKiBCaWFzIGFkYXB0YXRpb24gZnVuY3Rpb24gYXMgcGVyIHNlY3Rpb24gMy40IG9mIFJGQyAzNDkyLgogICogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0OTIjc2VjdGlvbi0zLjQKICAqIEBwcml2YXRlCiAgKi8KCWZ1bmN0aW9uIGFkYXB0KGRlbHRhLCBudW1Qb2ludHMsIGZpcnN0VGltZSkgewoJCXZhciBrID0gMDsKCQlkZWx0YSA9IGZpcnN0VGltZSA/IGZsb29yKGRlbHRhIC8gZGFtcCkgOiBkZWx0YSA+PiAxOwoJCWRlbHRhICs9IGZsb29yKGRlbHRhIC8gbnVtUG9pbnRzKTsKCQlmb3IgKDsgLyogbm8gaW5pdGlhbGl6YXRpb24gKi9kZWx0YSA+IGJhc2VNaW51c1RNaW4gKiB0TWF4ID4+IDE7IGsgKz0gYmFzZSkgewoJCQlkZWx0YSA9IGZsb29yKGRlbHRhIC8gYmFzZU1pbnVzVE1pbik7CgkJfQoJCXJldHVybiBmbG9vcihrICsgKGJhc2VNaW51c1RNaW4gKyAxKSAqIGRlbHRhIC8gKGRlbHRhICsgc2tldykpOwoJfQoKCS8qKgogICogQ29udmVydHMgYSBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzIHRvIGEgc3RyaW5nIG9mIFVuaWNvZGUKICAqIHN5bWJvbHMuCiAgKiBAbWVtYmVyT2YgcHVueWNvZGUKICAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy4KICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSByZXN1bHRpbmcgc3RyaW5nIG9mIFVuaWNvZGUgc3ltYm9scy4KICAqLwoJZnVuY3Rpb24gZGVjb2RlKGlucHV0KSB7CgkJLy8gRG9uJ3QgdXNlIFVDUy0yCgkJdmFyIG91dHB1dCA9IFtdLAoJCSAgICBpbnB1dExlbmd0aCA9IGlucHV0Lmxlbmd0aCwKCQkgICAgb3V0LAoJCSAgICBpID0gMCwKCQkgICAgbiA9IGluaXRpYWxOLAoJCSAgICBiaWFzID0gaW5pdGlhbEJpYXMsCgkJICAgIGJhc2ljLAoJCSAgICBqLAoJCSAgICBpbmRleCwKCQkgICAgb2xkaSwKCQkgICAgdywKCQkgICAgaywKCQkgICAgZGlnaXQsCgkJICAgIHQsCgoJCS8qKiBDYWNoZWQgY2FsY3VsYXRpb24gcmVzdWx0cyAqLwoJCWJhc2VNaW51c1Q7CgoJCS8vIEhhbmRsZSB0aGUgYmFzaWMgY29kZSBwb2ludHM6IGxldCBgYmFzaWNgIGJlIHRoZSBudW1iZXIgb2YgaW5wdXQgY29kZQoJCS8vIHBvaW50cyBiZWZvcmUgdGhlIGxhc3QgZGVsaW1pdGVyLCBvciBgMGAgaWYgdGhlcmUgaXMgbm9uZSwgdGhlbiBjb3B5CgkJLy8gdGhlIGZpcnN0IGJhc2ljIGNvZGUgcG9pbnRzIHRvIHRoZSBvdXRwdXQuCgoJCWJhc2ljID0gaW5wdXQubGFzdEluZGV4T2YoZGVsaW1pdGVyKTsKCQlpZiAoYmFzaWMgPCAwKSB7CgkJCWJhc2ljID0gMDsKCQl9CgoJCWZvciAoaiA9IDA7IGogPCBiYXNpYzsgKytqKSB7CgkJCS8vIGlmIGl0J3Mgbm90IGEgYmFzaWMgY29kZSBwb2ludAoJCQlpZiAoaW5wdXQuY2hhckNvZGVBdChqKSA+PSAweDgwKSB7CgkJCQllcnJvcignbm90LWJhc2ljJyk7CgkJCX0KCQkJb3V0cHV0LnB1c2goaW5wdXQuY2hhckNvZGVBdChqKSk7CgkJfQoKCQkvLyBNYWluIGRlY29kaW5nIGxvb3A6IHN0YXJ0IGp1c3QgYWZ0ZXIgdGhlIGxhc3QgZGVsaW1pdGVyIGlmIGFueSBiYXNpYyBjb2RlCgkJLy8gcG9pbnRzIHdlcmUgY29waWVkOyBzdGFydCBhdCB0aGUgYmVnaW5uaW5nIG90aGVyd2lzZS4KCgkJZm9yIChpbmRleCA9IGJhc2ljID4gMCA/IGJhc2ljICsgMSA6IDA7IGluZGV4IDwgaW5wdXRMZW5ndGg7KSAvKiBubyBmaW5hbCBleHByZXNzaW9uICovewoKCQkJLy8gYGluZGV4YCBpcyB0aGUgaW5kZXggb2YgdGhlIG5leHQgY2hhcmFjdGVyIHRvIGJlIGNvbnN1bWVkLgoJCQkvLyBEZWNvZGUgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlciBpbnRvIGBkZWx0YWAsCgkJCS8vIHdoaWNoIGdldHMgYWRkZWQgdG8gYGlgLiBUaGUgb3ZlcmZsb3cgY2hlY2tpbmcgaXMgZWFzaWVyCgkJCS8vIGlmIHdlIGluY3JlYXNlIGBpYCBhcyB3ZSBnbywgdGhlbiBzdWJ0cmFjdCBvZmYgaXRzIHN0YXJ0aW5nCgkJCS8vIHZhbHVlIGF0IHRoZSBlbmQgdG8gb2J0YWluIGBkZWx0YWAuCgkJCWZvciAob2xkaSA9IGksIHcgPSAxLCBrID0gYmFzZTs7IC8qIG5vIGNvbmRpdGlvbiAqL2sgKz0gYmFzZSkgewoKCQkJCWlmIChpbmRleCA+PSBpbnB1dExlbmd0aCkgewoJCQkJCWVycm9yKCdpbnZhbGlkLWlucHV0Jyk7CgkJCQl9CgoJCQkJZGlnaXQgPSBiYXNpY1RvRGlnaXQoaW5wdXQuY2hhckNvZGVBdChpbmRleCsrKSk7CgoJCQkJaWYgKGRpZ2l0ID49IGJhc2UgfHwgZGlnaXQgPiBmbG9vcigobWF4SW50IC0gaSkgLyB3KSkgewoJCQkJCWVycm9yKCdvdmVyZmxvdycpOwoJCQkJfQoKCQkJCWkgKz0gZGlnaXQgKiB3OwoJCQkJdCA9IGsgPD0gYmlhcyA/IHRNaW4gOiBrID49IGJpYXMgKyB0TWF4ID8gdE1heCA6IGsgLSBiaWFzOwoKCQkJCWlmIChkaWdpdCA8IHQpIHsKCQkJCQlicmVhazsKCQkJCX0KCgkJCQliYXNlTWludXNUID0gYmFzZSAtIHQ7CgkJCQlpZiAodyA+IGZsb29yKG1heEludCAvIGJhc2VNaW51c1QpKSB7CgkJCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJCQl9CgoJCQkJdyAqPSBiYXNlTWludXNUOwoJCQl9CgoJCQlvdXQgPSBvdXRwdXQubGVuZ3RoICsgMTsKCQkJYmlhcyA9IGFkYXB0KGkgLSBvbGRpLCBvdXQsIG9sZGkgPT0gMCk7CgoJCQkvLyBgaWAgd2FzIHN1cHBvc2VkIHRvIHdyYXAgYXJvdW5kIGZyb20gYG91dGAgdG8gYDBgLAoJCQkvLyBpbmNyZW1lbnRpbmcgYG5gIGVhY2ggdGltZSwgc28gd2UnbGwgZml4IHRoYXQgbm93OgoJCQlpZiAoZmxvb3IoaSAvIG91dCkgPiBtYXhJbnQgLSBuKSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoKCQkJbiArPSBmbG9vcihpIC8gb3V0KTsKCQkJaSAlPSBvdXQ7CgoJCQkvLyBJbnNlcnQgYG5gIGF0IHBvc2l0aW9uIGBpYCBvZiB0aGUgb3V0cHV0CgkJCW91dHB1dC5zcGxpY2UoaSsrLCAwLCBuKTsKCQl9CgoJCXJldHVybiB1Y3MyZW5jb2RlKG91dHB1dCk7Cgl9CgoJLyoqCiAgKiBDb252ZXJ0cyBhIHN0cmluZyBvZiBVbmljb2RlIHN5bWJvbHMgKGUuZy4gYSBkb21haW4gbmFtZSBsYWJlbCkgdG8gYQogICogUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy4KICAqIEBtZW1iZXJPZiBwdW55Y29kZQogICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBzdHJpbmcgb2YgVW5pY29kZSBzeW1ib2xzLgogICogQHJldHVybnMge1N0cmluZ30gVGhlIHJlc3VsdGluZyBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogICovCglmdW5jdGlvbiBlbmNvZGUoaW5wdXQpIHsKCQl2YXIgbiwKCQkgICAgZGVsdGEsCgkJICAgIGhhbmRsZWRDUENvdW50LAoJCSAgICBiYXNpY0xlbmd0aCwKCQkgICAgYmlhcywKCQkgICAgaiwKCQkgICAgbSwKCQkgICAgcSwKCQkgICAgaywKCQkgICAgdCwKCQkgICAgY3VycmVudFZhbHVlLAoJCSAgICBvdXRwdXQgPSBbXSwKCgkJLyoqIGBpbnB1dExlbmd0aGAgd2lsbCBob2xkIHRoZSBudW1iZXIgb2YgY29kZSBwb2ludHMgaW4gYGlucHV0YC4gKi8KCQlpbnB1dExlbmd0aCwKCgkJLyoqIENhY2hlZCBjYWxjdWxhdGlvbiByZXN1bHRzICovCgkJaGFuZGxlZENQQ291bnRQbHVzT25lLAoJCSAgICBiYXNlTWludXNULAoJCSAgICBxTWludXNUOwoKCQkvLyBDb252ZXJ0IHRoZSBpbnB1dCBpbiBVQ1MtMiB0byBVbmljb2RlCgkJaW5wdXQgPSB1Y3MyZGVjb2RlKGlucHV0KTsKCgkJLy8gQ2FjaGUgdGhlIGxlbmd0aAoJCWlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwoKCQkvLyBJbml0aWFsaXplIHRoZSBzdGF0ZQoJCW4gPSBpbml0aWFsTjsKCQlkZWx0YSA9IDA7CgkJYmlhcyA9IGluaXRpYWxCaWFzOwoKCQkvLyBIYW5kbGUgdGhlIGJhc2ljIGNvZGUgcG9pbnRzCgkJZm9yIChqID0gMDsgaiA8IGlucHV0TGVuZ3RoOyArK2opIHsKCQkJY3VycmVudFZhbHVlID0gaW5wdXRbal07CgkJCWlmIChjdXJyZW50VmFsdWUgPCAweDgwKSB7CgkJCQlvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoY3VycmVudFZhbHVlKSk7CgkJCX0KCQl9CgoJCWhhbmRsZWRDUENvdW50ID0gYmFzaWNMZW5ndGggPSBvdXRwdXQubGVuZ3RoOwoKCQkvLyBgaGFuZGxlZENQQ291bnRgIGlzIHRoZSBudW1iZXIgb2YgY29kZSBwb2ludHMgdGhhdCBoYXZlIGJlZW4gaGFuZGxlZDsKCQkvLyBgYmFzaWNMZW5ndGhgIGlzIHRoZSBudW1iZXIgb2YgYmFzaWMgY29kZSBwb2ludHMuCgoJCS8vIEZpbmlzaCB0aGUgYmFzaWMgc3RyaW5nIC0gaWYgaXQgaXMgbm90IGVtcHR5IC0gd2l0aCBhIGRlbGltaXRlcgoJCWlmIChiYXNpY0xlbmd0aCkgewoJCQlvdXRwdXQucHVzaChkZWxpbWl0ZXIpOwoJCX0KCgkJLy8gTWFpbiBlbmNvZGluZyBsb29wOgoJCXdoaWxlIChoYW5kbGVkQ1BDb3VudCA8IGlucHV0TGVuZ3RoKSB7CgoJCQkvLyBBbGwgbm9uLWJhc2ljIGNvZGUgcG9pbnRzIDwgbiBoYXZlIGJlZW4gaGFuZGxlZCBhbHJlYWR5LiBGaW5kIHRoZSBuZXh0CgkJCS8vIGxhcmdlciBvbmU6CgkJCWZvciAobSA9IG1heEludCwgaiA9IDA7IGogPCBpbnB1dExlbmd0aDsgKytqKSB7CgkJCQljdXJyZW50VmFsdWUgPSBpbnB1dFtqXTsKCQkJCWlmIChjdXJyZW50VmFsdWUgPj0gbiAmJiBjdXJyZW50VmFsdWUgPCBtKSB7CgkJCQkJbSA9IGN1cnJlbnRWYWx1ZTsKCQkJCX0KCQkJfQoKCQkJLy8gSW5jcmVhc2UgYGRlbHRhYCBlbm91Z2ggdG8gYWR2YW5jZSB0aGUgZGVjb2RlcidzIDxuLGk+IHN0YXRlIHRvIDxtLDA+LAoJCQkvLyBidXQgZ3VhcmQgYWdhaW5zdCBvdmVyZmxvdwoJCQloYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CgkJCWlmIChtIC0gbiA+IGZsb29yKChtYXhJbnQgLSBkZWx0YSkgLyBoYW5kbGVkQ1BDb3VudFBsdXNPbmUpKSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoKCQkJZGVsdGEgKz0gKG0gLSBuKSAqIGhhbmRsZWRDUENvdW50UGx1c09uZTsKCQkJbiA9IG07CgoJCQlmb3IgKGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikgewoJCQkJY3VycmVudFZhbHVlID0gaW5wdXRbal07CgoJCQkJaWYgKGN1cnJlbnRWYWx1ZSA8IG4gJiYgKytkZWx0YSA+IG1heEludCkgewoJCQkJCWVycm9yKCdvdmVyZmxvdycpOwoJCQkJfQoKCQkJCWlmIChjdXJyZW50VmFsdWUgPT0gbikgewoJCQkJCS8vIFJlcHJlc2VudCBkZWx0YSBhcyBhIGdlbmVyYWxpemVkIHZhcmlhYmxlLWxlbmd0aCBpbnRlZ2VyCgkJCQkJZm9yIChxID0gZGVsdGEsIGsgPSBiYXNlOzsgLyogbm8gY29uZGl0aW9uICovayArPSBiYXNlKSB7CgkJCQkJCXQgPSBrIDw9IGJpYXMgPyB0TWluIDogayA+PSBiaWFzICsgdE1heCA/IHRNYXggOiBrIC0gYmlhczsKCQkJCQkJaWYgKHEgPCB0KSB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQlxTWludXNUID0gcSAtIHQ7CgkJCQkJCWJhc2VNaW51c1QgPSBiYXNlIC0gdDsKCQkJCQkJb3V0cHV0LnB1c2goc3RyaW5nRnJvbUNoYXJDb2RlKGRpZ2l0VG9CYXNpYyh0ICsgcU1pbnVzVCAlIGJhc2VNaW51c1QsIDApKSk7CgkJCQkJCXEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CgkJCQkJfQoKCQkJCQlvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoZGlnaXRUb0Jhc2ljKHEsIDApKSk7CgkJCQkJYmlhcyA9IGFkYXB0KGRlbHRhLCBoYW5kbGVkQ1BDb3VudFBsdXNPbmUsIGhhbmRsZWRDUENvdW50ID09IGJhc2ljTGVuZ3RoKTsKCQkJCQlkZWx0YSA9IDA7CgkJCQkJKytoYW5kbGVkQ1BDb3VudDsKCQkJCX0KCQkJfQoKCQkJKytkZWx0YTsKCQkJKytuOwoJCX0KCQlyZXR1cm4gb3V0cHV0LmpvaW4oJycpOwoJfQoKCS8qKgogICogQ29udmVydHMgYSBQdW55Y29kZSBzdHJpbmcgcmVwcmVzZW50aW5nIGEgZG9tYWluIG5hbWUgb3IgYW4gZW1haWwgYWRkcmVzcwogICogdG8gVW5pY29kZS4gT25seSB0aGUgUHVueWNvZGVkIHBhcnRzIG9mIHRoZSBpbnB1dCB3aWxsIGJlIGNvbnZlcnRlZCwgaS5lLgogICogaXQgZG9lc24ndCBtYXR0ZXIgaWYgeW91IGNhbGwgaXQgb24gYSBzdHJpbmcgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCiAgKiBjb252ZXJ0ZWQgdG8gVW5pY29kZS4KICAqIEBtZW1iZXJPZiBwdW55Y29kZQogICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBQdW55Y29kZWQgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcyB0bwogICogY29udmVydCB0byBVbmljb2RlLgogICogQHJldHVybnMge1N0cmluZ30gVGhlIFVuaWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIFB1bnljb2RlCiAgKiBzdHJpbmcuCiAgKi8KCWZ1bmN0aW9uIHRvVW5pY29kZShpbnB1dCkgewoJCXJldHVybiBtYXBEb21haW4oaW5wdXQsIGZ1bmN0aW9uIChzdHJpbmcpIHsKCQkJcmV0dXJuIHJlZ2V4UHVueWNvZGUudGVzdChzdHJpbmcpID8gZGVjb2RlKHN0cmluZy5zbGljZSg0KS50b0xvd2VyQ2FzZSgpKSA6IHN0cmluZzsKCQl9KTsKCX0KCgkvKioKICAqIENvbnZlcnRzIGEgVW5pY29kZSBzdHJpbmcgcmVwcmVzZW50aW5nIGEgZG9tYWluIG5hbWUgb3IgYW4gZW1haWwgYWRkcmVzcyB0bwogICogUHVueWNvZGUuIE9ubHkgdGhlIG5vbi1BU0NJSSBwYXJ0cyBvZiB0aGUgZG9tYWluIG5hbWUgd2lsbCBiZSBjb252ZXJ0ZWQsCiAgKiBpLmUuIGl0IGRvZXNuJ3QgbWF0dGVyIGlmIHlvdSBjYWxsIGl0IHdpdGggYSBkb21haW4gdGhhdCdzIGFscmVhZHkgaW4KICAqIEFTQ0lJLgogICogQG1lbWJlck9mIHB1bnljb2RlCiAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIGRvbWFpbiBuYW1lIG9yIGVtYWlsIGFkZHJlc3MgdG8gY29udmVydCwgYXMgYQogICogVW5pY29kZSBzdHJpbmcuCiAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgUHVueWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIGRvbWFpbiBuYW1lIG9yCiAgKiBlbWFpbCBhZGRyZXNzLgogICovCglmdW5jdGlvbiB0b0FTQ0lJKGlucHV0KSB7CgkJcmV0dXJuIG1hcERvbWFpbihpbnB1dCwgZnVuY3Rpb24gKHN0cmluZykgewoJCQlyZXR1cm4gcmVnZXhOb25BU0NJSS50ZXN0KHN0cmluZykgPyAneG4tLScgKyBlbmNvZGUoc3RyaW5nKSA6IHN0cmluZzsKCQl9KTsKCX0KCgkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCgkvKiogRGVmaW5lIHRoZSBwdWJsaWMgQVBJICovCglwdW55Y29kZSA9IHsKCQkvKioKICAgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgUHVueWNvZGUuanMgdmVyc2lvbiBudW1iZXIuCiAgICogQG1lbWJlck9mIHB1bnljb2RlCiAgICogQHR5cGUgU3RyaW5nCiAgICovCgkJJ3ZlcnNpb24nOiAnMS4zLjInLAoJCS8qKgogICAqIEFuIG9iamVjdCBvZiBtZXRob2RzIHRvIGNvbnZlcnQgZnJvbSBKYXZhU2NyaXB0J3MgaW50ZXJuYWwgY2hhcmFjdGVyCiAgICogcmVwcmVzZW50YXRpb24gKFVDUy0yKSB0byBVbmljb2RlIGNvZGUgcG9pbnRzLCBhbmQgYmFjay4KICAgKiBAc2VlIDxodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZz4KICAgKiBAbWVtYmVyT2YgcHVueWNvZGUKICAgKiBAdHlwZSBPYmplY3QKICAgKi8KCQkndWNzMic6IHsKCQkJJ2RlY29kZSc6IHVjczJkZWNvZGUsCgkJCSdlbmNvZGUnOiB1Y3MyZW5jb2RlCgkJfSwKCQknZGVjb2RlJzogZGVjb2RlLAoJCSdlbmNvZGUnOiBlbmNvZGUsCgkJJ3RvQVNDSUknOiB0b0FTQ0lJLAoJCSd0b1VuaWNvZGUnOiB0b1VuaWNvZGUKCX07CgoJLyoqIEV4cG9zZSBgcHVueWNvZGVgICovCgkvLyBTb21lIEFNRCBidWlsZCBvcHRpbWl6ZXJzLCBsaWtlIHIuanMsIGNoZWNrIGZvciBzcGVjaWZpYyBjb25kaXRpb24gcGF0dGVybnMKCS8vIGxpa2UgdGhlIGZvbGxvd2luZzoKCWlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgX3R5cGVvZihkZWZpbmUuYW1kKSA9PSAnb2JqZWN0JyAmJiBkZWZpbmUuYW1kKSB7CgkJZGVmaW5lKCdwdW55Y29kZScsIGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIHB1bnljb2RlOwoJCX0pOwoJfSBlbHNlIGlmIChmcmVlRXhwb3J0cyAmJiBmcmVlTW9kdWxlKSB7CgkJaWYgKG1vZHVsZS5leHBvcnRzID09IGZyZWVFeHBvcnRzKSB7CgkJCS8vIGluIE5vZGUuanMsIGlvLmpzLCBvciBSaW5nb0pTIHYwLjguMCsKCQkJZnJlZU1vZHVsZS5leHBvcnRzID0gcHVueWNvZGU7CgkJfSBlbHNlIHsKCQkJLy8gaW4gTmFyd2hhbCBvciBSaW5nb0pTIHYwLjcuMC0KCQkJZm9yIChrZXkgaW4gcHVueWNvZGUpIHsKCQkJCXB1bnljb2RlLmhhc093blByb3BlcnR5KGtleSkgJiYgKGZyZWVFeHBvcnRzW2tleV0gPSBwdW55Y29kZVtrZXldKTsKCQkJfQoJCX0KCX0gZWxzZSB7CgkJLy8gaW4gUmhpbm8gb3IgYSB3ZWIgYnJvd3NlcgoJCXJvb3QucHVueWNvZGUgPSBwdW55Y29kZTsKCX0KfSkodW5kZWZpbmVkKTsKCn0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9KQp9LHt9XSw3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKfSk7CgpleHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoZGF0YU9iamVjdCwgcG9zaXRpb24pIHsKICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUoR3JvdXBDaGF0KSwgewogICAgICAgIF9kYXRhT2JqZWN0OiBkYXRhT2JqZWN0LAogICAgICAgIG5hbWU6IGRhdGFPYmplY3QuZGF0YS5uYW1lLAogICAgICAgIHN0YXJ0aW5nVGltZTogZGF0YU9iamVjdC5kYXRhLnN0YXJ0aW5nVGltZSwKICAgICAgICBtZXNzYWdlczogW10sCiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uCiAgICB9KTsKfTsKCnZhciBfR3JvdXBDaGF0TWVzc2FnZSA9IHJlcXVpcmUoJy4vR3JvdXBDaGF0TWVzc2FnZScpOwoKdmFyIF9Hcm91cENoYXRNZXNzYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0dyb3VwQ2hhdE1lc3NhZ2UpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCnZhciBHcm91cENoYXQgPSB7CiAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24gc2VuZE1lc3NhZ2UobWVzc2FnZSwgZGlzdGFuY2UpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICByZXR1cm4gdGhpcy5fZGF0YU9iamVjdC5hZGRDaGlsZCgnY2hhdG1lc3NhZ2VzJywgeyBjaGF0TWVzc2FnZTogbWVzc2FnZSwgZGlzdGFuY2U6IGRpc3RhbmNlLCBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbi52YWx1ZS5jb29yZHMgfSkudGhlbihmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgX3RoaXMubWVzc2FnZXMucHVzaCgoMCwgX0dyb3VwQ2hhdE1lc3NhZ2UyLmRlZmF1bHQpKGNoaWxkLCB0cnVlKSk7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5tZXNzYWdlc1tfdGhpcy5tZXNzYWdlcy5sZW5ndGggLSAxXTsKICAgICAgICB9KTsKICAgIH0sCiAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uIG9uTWVzc2FnZShjYWxsYmFjaykgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICB0aGlzLl9kYXRhT2JqZWN0Lm9uQWRkQ2hpbGQoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgIHZhciBjaGlsZERhdGEgPSBjaGlsZC5kYXRhID8gY2hpbGQuZGF0YSA6IGNoaWxkLnZhbHVlOwogICAgICAgICAgICBpZiAoY2hpbGREYXRhLmRpc3RhbmNlICYmIF90aGlzMi5fZGlzdGFuY2UoX3RoaXMyLnBvc2l0aW9uLmNvb3JkcywgY2hpbGREYXRhLnBvc2l0aW9uKSA+IGRpc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIF90aGlzMi5tZXNzYWdlcy5wdXNoKCgwLCBfR3JvdXBDaGF0TWVzc2FnZTIuZGVmYXVsdCkoY2hpbGQsIGZhbHNlKSk7CiAgICAgICAgICAgIGNhbGxiYWNrKF90aGlzMi5tZXNzYWdlc1tfdGhpczIubWVzc2FnZXMubGVuZ3RoIC0gMV0pOwogICAgICAgIH0pOwogICAgfSwKICAgIF9kaXN0YW5jZTogZnVuY3Rpb24gX2Rpc3RhbmNlKGxhdDEsIGxvbjEsIGxhdDIsIGxvbjIsIHVuaXQpIHsKICAgICAgICB2YXIgcmFkbGF0MSA9IE1hdGguUEkgKiBsYXQxIC8gMTgwOwogICAgICAgIHZhciByYWRsYXQyID0gTWF0aC5QSSAqIGxhdDIgLyAxODA7CiAgICAgICAgdmFyIHRoZXRhID0gbG9uMSAtIGxvbjI7CiAgICAgICAgdmFyIHJhZHRoZXRhID0gTWF0aC5QSSAqIHRoZXRhIC8gMTgwOwogICAgICAgIHZhciBkaXN0ID0gTWF0aC5zaW4ocmFkbGF0MSkgKiBNYXRoLnNpbihyYWRsYXQyKSArIE1hdGguY29zKHJhZGxhdDEpICogTWF0aC5jb3MocmFkbGF0MikgKiBNYXRoLmNvcyhyYWR0aGV0YSk7CiAgICAgICAgZGlzdCA9IE1hdGguYWNvcyhkaXN0KTsKICAgICAgICBkaXN0ID0gZGlzdCAqIDE4MCAvIE1hdGguUEk7CiAgICAgICAgZGlzdCA9IGRpc3QgKiA2MCAqIDEuMTUxNTsKICAgICAgICBpZiAodW5pdCA9PSAiSyIpIHsKICAgICAgICAgICAgZGlzdCA9IGRpc3QgKiAxLjYwOTM0NDsKICAgICAgICB9CiAgICAgICAgaWYgKHVuaXQgPT0gIk4iKSB7CiAgICAgICAgICAgIGRpc3QgPSBkaXN0ICogMC44Njg0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGlzdDsKICAgIH0KfTsKCn0seyIuL0dyb3VwQ2hhdE1lc3NhZ2UiOjl9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZGVmYXVsdCA9IGFjdGl2YXRlOwoKdmFyIF9IeXBlcnR5RGlzY292ZXJ5ID0gcmVxdWlyZSgnc2VydmljZS1mcmFtZXdvcmsvZGlzdC9IeXBlcnR5RGlzY292ZXJ5Jyk7Cgp2YXIgX0h5cGVydHlEaXNjb3ZlcnkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfSHlwZXJ0eURpc2NvdmVyeSk7Cgp2YXIgX3VyaWpzID0gcmVxdWlyZSgndXJpanMnKTsKCnZhciBfdXJpanMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXJpanMpOwoKdmFyIF9TeW5jaGVyID0gcmVxdWlyZSgnc2VydmljZS1mcmFtZXdvcmsvZGlzdC9TeW5jaGVyJyk7Cgp2YXIgX0dyb3VwQ2hhdCA9IHJlcXVpcmUoJy4vR3JvdXBDaGF0Jyk7Cgp2YXIgX0dyb3VwQ2hhdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Hcm91cENoYXQpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKdmFyIENvbW11bmljYXRpb24gPSBmdW5jdGlvbiBDb21tdW5pY2F0aW9uKG5hbWUpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb21tdW5pY2F0aW9uKTsKCiAgICB0aGlzLnN0YXJ0aW5nVGltZSA9IERhdGUubm93KCk7CiAgICB0aGlzLmxhc3RNb2RpZmllZCA9IERhdGUubm93KCk7CiAgICB0aGlzLnN0YXR1cyA9ICJwZW5kaW5nIjsKICAgIHRoaXMucmVzb3VyY2VzID0gW107CiAgICB0aGlzLmNoaWxkcmVuID0gW107CiAgICB0aGlzLm5hbWUgPSBuYW1lOwp9OwoKdmFyIEdyb3VwQ2hhdEh5cGVydHkgPSB7CiAgICBfZ2V0SHlGb3I6IGZ1bmN0aW9uIF9nZXRIeUZvcihwYXJ0aWNpcGFudHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocGFydGljaXBhbnRzLm1hcChmdW5jdGlvbiAocCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMuaHlwZXJ0eURpc2NvdmVyeVNlcnZpY2UuZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyKHAuZW1haWwsIHAuZG9tYWluKS50aGVuKGZ1bmN0aW9uIChoeXBlcnRpZXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhoeXBlcnRpZXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsga2V5OiBrZXksIGRlc2NyaXB0b3I6IGh5cGVydGllc1trZXldLmRlc2NyaXB0b3IsIGxhc3RNb2RpZmllZDogaHlwZXJ0aWVzW2tleV0ubGFzdE1vZGlmaWVkIH07CiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKGRlc2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVzYy5kZXNjcmlwdG9yLmVuZHNXaXRoKCdHcm91cENoYXRIeXBlcnR5Jyk7CiAgICAgICAgICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGEubGFzdE1vZGlmaWVkKSA8IG5ldyBEYXRlKGIubGFzdE1vZGlmaWVkKSA/IDEgOiAtMTsKICAgICAgICAgICAgICAgIH0pLnNoaWZ0KCkua2V5OwogICAgICAgICAgICB9KTsKICAgICAgICB9KSk7CiAgICB9LAogICAgX2NyZWF0ZVN5bmNoZXI6IGZ1bmN0aW9uIF9jcmVhdGVTeW5jaGVyKG5hbWUsIGh5cGVydGllcykgewogICAgICAgIHJldHVybiB0aGlzLnN5bmNoZXIuY3JlYXRlKHRoaXMub2JqZWN0RGVzY1VSTCwgaHlwZXJ0aWVzLCBuZXcgQ29tbXVuaWNhdGlvbihuYW1lKSk7CiAgICB9LAogICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUobmFtZSwgcGFydGljaXBhbnRzKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIHJldHVybiB0aGlzLl9nZXRIeUZvcihwYXJ0aWNpcGFudHMpLnRoZW4oZnVuY3Rpb24gKGh5cGVydGllcykgewogICAgICAgICAgICByZXR1cm4gX3RoaXMyLl9jcmVhdGVTeW5jaGVyKG5hbWUsIGh5cGVydGllcyk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdFJlcG9ydGVyKSB7CiAgICAgICAgICAgIGRhdGFPYmplY3RSZXBvcnRlci5vblN1YnNjcmlwdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5hY2NlcHQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiAoMCwgX0dyb3VwQ2hhdDIuZGVmYXVsdCkoZGF0YU9iamVjdFJlcG9ydGVyLCBfdGhpczIuX3Bvc2l0aW9uLmRhdGEpOwogICAgICAgIH0pOwogICAgfSwKICAgIG9uSW52aXRlOiBmdW5jdGlvbiBvbkludml0ZShjYWxsYmFjaykgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICByZXR1cm4gdGhpcy5zeW5jaGVyLm9uTm90aWZpY2F0aW9uKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBpZiAoZXZlbnQuc2NoZW1hID09PSBfdGhpczMubG9jYXRpb25EZXNjVVJMKSB7CiAgICAgICAgICAgICAgICBfdGhpczMuc3luY2hlci5zdWJzY3JpYmUoX3RoaXMzLmxvY2F0aW9uRGVzY1VSTCwgZXZlbnQudXJsKS50aGVuKGZ1bmN0aW9uIChkYXRhT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMzLl9wb3NpdGlvbiA9IGRhdGFPYmplY3Q7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5zY2hlbWEgPT09IF90aGlzMy5vYmplY3REZXNjVVJMKSB7CiAgICAgICAgICAgICAgICBfdGhpczMuc3luY2hlci5zdWJzY3JpYmUoX3RoaXMzLm9iamVjdERlc2NVUkwsIGV2ZW50LnVybCkudGhlbihmdW5jdGlvbiAoZGF0YU9iamVjdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygoMCwgX0dyb3VwQ2hhdDIuZGVmYXVsdCkoZGF0YU9iamVjdCwgX3RoaXMzLl9wb3NpdGlvbi5kYXRhKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9OwoKdmFyIGdyb3VwQ2hhdEZhY3RvcnkgPSBmdW5jdGlvbiBncm91cENoYXRGYWN0b3J5KGh5cGVydHlVUkwsIGJ1cywgY29uZmlnKSB7CiAgICB2YXIgc3luY2hlciA9IG5ldyBfU3luY2hlci5TeW5jaGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlnKTsKICAgIHZhciBoeXBlcnR5RGlzY292ZXJ5ID0gbmV3IF9IeXBlcnR5RGlzY292ZXJ5Mi5kZWZhdWx0KGh5cGVydHlVUkwsIGJ1cyk7CiAgICB2YXIgdXJpID0gbmV3IF91cmlqczIuZGVmYXVsdChoeXBlcnR5VVJMKTsKCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKEdyb3VwQ2hhdEh5cGVydHkpLCB7CiAgICAgICAgJ19wb3NpdGlvbic6IHVuZGVmaW5lZCwKICAgICAgICAnc3luY2hlcic6IHN5bmNoZXIsCiAgICAgICAgJ2h5cGVydHlEaXNjb3ZlcnlTZXJ2aWNlJzogaHlwZXJ0eURpc2NvdmVyeSwKICAgICAgICAnb2JqZWN0RGVzY1VSTCc6ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyB1cmkuaG9zdG5hbWUoKSArICcvLndlbGwta25vd24vZGF0YXNjaGVtYXMvQ29tbXVuaWNhdGlvbkRhdGFTY2hlbWEnLAogICAgICAgICdsb2NhdGlvbkRlc2NVUkwnOiAnaHlwZXJ0eS1jYXRhbG9ndWU6Ly8nICsgdXJpLmhvc3RuYW1lKCkgKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL0NvbnRleHREYXRhU2NoZW1hJwogICAgfSk7Cn07CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZykgewogICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnR3JvdXAgQ2hhdCBIeXBlcnR5JywKICAgICAgICBpbnN0YW5jZTogZ3JvdXBDaGF0RmFjdG9yeShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZykKICAgIH07Cn0KCn0seyIuL0dyb3VwQ2hhdCI6Nywic2VydmljZS1mcmFtZXdvcmsvZGlzdC9IeXBlcnR5RGlzY292ZXJ5IjoxLCJzZXJ2aWNlLWZyYW1ld29yay9kaXN0L1N5bmNoZXIiOjIsInVyaWpzIjo1fV0sOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKGRhdGFPYmplY3RDaGlsZCwgaXNNZSkgewogICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShHcm91cENoYXRNZXNzYWdlKSwgewogICAgICAgIF9kYXRhT2JqZWN0Q2hpbGQ6IGRhdGFPYmplY3RDaGlsZCwKICAgICAgICBpc01lOiBpc01lLAogICAgICAgIHRleHQ6IGRhdGFPYmplY3RDaGlsZC5kYXRhID8gZGF0YU9iamVjdENoaWxkLmRhdGEuY2hhdE1lc3NhZ2UgOiBkYXRhT2JqZWN0Q2hpbGQudmFsdWUuY2hhdE1lc3NhZ2UKICAgIH0pOwp9OwoKdmFyIEdyb3VwQ2hhdE1lc3NhZ2UgPSB7fTsKCn0se31dfSx7fSxbOF0pKDgpCn0pOw==",
      "sourceCodeClassname": "GroupChatHyperty",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of GroupChatHyperty",
    "objectName": "GroupChatHyperty",
    "configuration": {},
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "LocationHyperty": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX1N5bmNPYmplY3QgPSByZXF1aXJlKCcuL1N5bmNPYmplY3QnKTsKCnZhciBfU3luY09iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TeW5jT2JqZWN0KTsKCnZhciBfRGF0YU9iamVjdENoaWxkID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Q2hpbGQnKTsKCnZhciBfRGF0YU9iamVjdENoaWxkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3RDaGlsZCk7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCi8qKgogKiBNYWluIGV4dGVuc2lvbiBjbGFzcyBmb3Igb2JzZXJ2ZXJzIGFuZCByZXBvcnRlcnMsIHdpdGggY29tbW9uIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAqIENoaWxkcmVuIG1hbmFnZW1lbnQgaXMgY29tbW9uIGZvciBvYnNlcnZlcnMgYW5kIHJlcG9ydGVycy4KICovCgp2YXIgRGF0YU9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgX3ZlcnNpb246IG51bWJlcgogICBfb3duZXI6IEh5cGVydHlVUkwKICBfdXJsOiBPYmplY3RVUkwKICBfc2NoZW1hOiBTY2hlbWEKICBfYnVzOiBNaW5pQnVzCiAgX3N0YXR1czogb24gfCBwYXVzZWQKICBfc3luY09iajogU3luY0RhdGEKICAgX2NoaWxkcmVuOiB7IGlkOiBEYXRhT2JqZWN0Q2hpbGQgfQogIF9jaGlsZHJlbkxpc3RlbmVyczogW01zZ0xpc3RlbmVyXQogICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tCiAgX29uQWRkQ2hpbGRIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQKICAqLwoKICAvKioKICAgKiBAaWdub3JlCiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIgY3JlYXRlIG9yIHN1YnNjcmliZSBtZXRob2QncwogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0KHN5bmNoZXIsIHVybCwgc2NoZW1hLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW5zKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdCk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fc3luY2hlciA9IHN5bmNoZXI7CiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX3NjaGVtYSA9IHNjaGVtYTsKICAgIF90aGlzLl9zdGF0dXMgPSBpbml0aWFsU3RhdHVzOwogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyLmRlZmF1bHQoaW5pdGlhbERhdGEpOwogICAgX3RoaXMuX2NoaWxkcmVucyA9IGNoaWxkcmVuczsKCiAgICBfdGhpcy5fdmVyc2lvbiA9IDA7CiAgICBfdGhpcy5fY2hpbGRJZCA9IDA7CiAgICBfdGhpcy5fY2hpbGRyZW5PYmplY3RzID0ge307CiAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMgPSBbXTsKCiAgICBfdGhpcy5fb3duZXIgPSBzeW5jaGVyLl9vd25lcjsKICAgIF90aGlzLl9idXMgPSBzeW5jaGVyLl9idXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YU9iamVjdCwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgY2hpbGRCYXNlVVJMID0gX3RoaXMuX3VybCArICcvY2hpbGRyZW4vJzsKICAgICAgaWYgKF90aGlzLl9jaGlsZHJlbnMpIHsKICAgICAgICBfdGhpcy5fY2hpbGRyZW5zLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICB2YXIgY2hpbGRVUkwgPSBjaGlsZEJhc2VVUkwgKyBjaGlsZDsKICAgICAgICAgIHZhciBsaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoY2hpbGRVUkwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgLy9pZ25vcmUgbXNnIHNlbnQgYnkgaGltc2VsZgogICAgICAgICAgICBpZiAobXNnLmZyb20gIT09IF90aGlzMi5fb3duZXIpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdC1DaGlsZHJlbi1SQ1Y6ICcsIG1zZyk7CiAgICAgICAgICAgICAgc3dpdGNoIChtc2cudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgICAgICAgICAgX3RoaXMuX29uQ2hpbGRDcmVhdGUobXNnKTticmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7YnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBfdGhpcy5fY2hhbmdlQ2hpbGRyZW4obXNnKTticmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIGxpc3RlbmVyLnJlbW92ZSgpOwogICAgICB9KTsKCiAgICAgIE9iamVjdC5rZXlzKF90aGlzLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNba2V5XS5fcmVsZWFzZUxpc3RlbmVycygpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIE9iamVjdCBVUkwgb2YgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIKICAgICAqIEB0eXBlIHtPYmplY3RVUkx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAncGF1c2UnLAoKCiAgICAvKioKICAgICAqIEBpZ25vcmUKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAvL1RPRE86IHRoaXMgZmVhdHVyZSBuZWVkcyBtb3JlIGFuYWxpc2UKICAgICAgdGhyb3cgJ05vdCBpbXBsZW1lbnRlZCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAncmVzdW1lJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZQogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioKICAgICAqIEBpZ25vcmUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzdG9wJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAvL1RPRE86IHNob3VsZCByZW1vdmUgdGhlIHN1YnNjcmlwdGlvbiBhbmQgc2VuZCBtZXNzYWdlIHVuc3Vic2NyaWJlPwogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYWRkIGEgY2hpbGRyZW4gdG8gdGhlIHN1YnNjcmlwdGlvbiBncm91cC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSByZXNvdXJjZSAtIFJlc291cmNlIG5hbWUsIG9uZSBvZiB0aGUgaXRlbXMgaW4gdGhlIHNjaGVtYS5wcm9wZXJ0aWVzLnNjaGVtZSBvZiB0aGUgcGFyZW50IG9iamVjdC4KICAgICAqIEBwYXJhbSB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIGNoaWxkCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RDaGlsZD59IC0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgQ2hpbGRyZW4uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnYWRkQ2hpbGQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZENoaWxkKHJlc291cmNlLCBpbml0aWFsRGF0YSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9jcmVhdGUgbmV3IGNoaWxkIHVuaXF1ZSBJRCwgYmFzZWQgb24gaHlwZXJ0eVVSTAogICAgICBfdGhpcy5fY2hpbGRJZCsrOwogICAgICB2YXIgbXNnQ2hpbGRJZCA9IF90aGlzLl9vd25lciArICcjJyArIF90aGlzLl9jaGlsZElkOwogICAgICB2YXIgbXNnQ2hpbGRQYXRoID0gX3RoaXMuX3VybCArICcvY2hpbGRyZW4vJyArIHJlc291cmNlOwoKICAgICAgdmFyIHJlcXVlc3RNc2cgPSB7CiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IG1zZ0NoaWxkUGF0aCwKICAgICAgICBib2R5OiB7IHJlc291cmNlOiBtc2dDaGlsZElkLCB2YWx1ZTogaW5pdGlhbERhdGEgfQogICAgICB9OwoKICAgICAgLy9yZXR1cm5zIHByb21pc2UsIGluIHRoZSBmdXR1cmUsIHRoZSBBUEkgbWF5IGNoYW5nZSB0byBhc3luY2hyb25vdXMgY2FsbAogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgbXNnSWQgPSBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcXVlc3RNc2cpOwoKICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAnICsgX3RoaXMuX293bmVyICsgJyApOiAnLCByZXF1ZXN0TXNnKTsKICAgICAgICB2YXIgbmV3Q2hpbGQgPSBuZXcgX0RhdGFPYmplY3RDaGlsZDIuZGVmYXVsdChfdGhpcywgbXNnQ2hpbGRJZCwgaW5pdGlhbERhdGEsIF90aGlzLl9vd25lciwgbXNnSWQpOwogICAgICAgIG5ld0NoaWxkLm9uQ2hhbmdlKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX29uQ2hhbmdlKGV2ZW50LCB7IHBhdGg6IG1zZ0NoaWxkUGF0aCwgY2hpbGRJZDogbXNnQ2hpbGRJZCB9KTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1ttc2dDaGlsZElkXSA9IG5ld0NoaWxkOwoKICAgICAgICByZXNvbHZlKG5ld0NoaWxkKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyBjcmVhdGUgYW5kIGRlbGV0ZSBjaGlsZHJlbnMKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbkFkZENoaWxkJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkFkZENoaWxkKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQ2hpbGRDcmVhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoaWxkQ3JlYXRlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgbXNnQ2hpbGRJZCA9IG1zZy5ib2R5LnJlc291cmNlOwoKICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZS1vYnNlcnZlci1jaGlsZCggJyArIF90aGlzLl9vd25lciArICcgKTogJywgbXNnKTsKICAgICAgdmFyIG5ld0NoaWxkID0gbmV3IF9EYXRhT2JqZWN0Q2hpbGQyLmRlZmF1bHQoX3RoaXMsIG1zZ0NoaWxkSWQsIG1zZy5ib2R5LnZhbHVlKTsKICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1ttc2dDaGlsZElkXSA9IG5ld0NoaWxkOwoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgIGJvZHk6IHsgY29kZTogMjAwLCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIGZyb206IG1zZy5mcm9tLAogICAgICAgIHVybDogbXNnLnRvLAogICAgICAgIHZhbHVlOiBtc2cuYm9keS52YWx1ZSwKICAgICAgICBjaGlsZElkOiBtc2dDaGlsZElkLAogICAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdBREQtQ0hJTERSRU4tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CgogICAgLy9zZW5kIGRlbHRhIG1lc3NhZ2VzIHRvIHN1YnNjcmlwdGlvbnMKCiAgfSwgewogICAga2V5OiAnX29uQ2hhbmdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2UoZXZlbnQsIGNoaWxkSW5mbykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuX3ZlcnNpb24rKzsKCiAgICAgIGlmIChfdGhpcy5fc3RhdHVzID09PSAnb24nKSB7CiAgICAgICAgdmFyIGNoYW5nZU1zZyA9IHsKICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogX3RoaXMuX3VybCArICcvY2hhbmdlcycsCiAgICAgICAgICBib2R5OiB7IHZlcnNpb246IF90aGlzLl92ZXJzaW9uLCBzb3VyY2U6IF90aGlzLl9vd25lciwgYXR0cmlidXRlOiBldmVudC5maWVsZCB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKGV2ZW50Lm9UeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLk9CSkVDVCkgewogICAgICAgICAgaWYgKGV2ZW50LmNUeXBlICE9PSBfU3luY09iamVjdC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICBjaGFuZ2VNc2cuYm9keS52YWx1ZSA9IGV2ZW50LmRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LmF0dHJpYnV0ZVR5cGUgPSBldmVudC5vVHlwZTsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LnZhbHVlID0gZXZlbnQuZGF0YTsKICAgICAgICAgIGlmIChldmVudC5jVHlwZSAhPT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5VUERBVEUpIHsKICAgICAgICAgICAgY2hhbmdlTXNnLmJvZHkub3BlcmF0aW9uID0gZXZlbnQuY1R5cGU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL2NoaWxkSW5mbyBtdXN0IGhhdmUgKHBhdGgsIGNoaWxkSWQpCiAgICAgICAgaWYgKGNoaWxkSW5mbykgewogICAgICAgICAgY2hhbmdlTXNnLnRvID0gY2hpbGRJbmZvLnBhdGg7CiAgICAgICAgICBjaGFuZ2VNc2cuYm9keS5yZXNvdXJjZSA9IGNoaWxkSW5mby5jaGlsZElkOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShjaGFuZ2VNc2cpOwogICAgICB9CiAgICB9CgogICAgLy9yZWNlaXZlIGFuZCBwcm9jZXNzIGRlbHRhIG1lc3NhZ2VzCgogIH0sIHsKICAgIGtleTogJ19jaGFuZ2VPYmplY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGFuZ2VPYmplY3Qoc3luY09iaiwgbXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHVwZGF0ZSB2ZXJzaW9uID8KICAgICAgLy9ob3cgdG8gaGFuZGxlIGFuIGluY29ycmVjdCB2ZXJzaW9uID8gRXhhbXBsZTogcmVjZWl2ZSBhIHZlcnNpb24gMyB3aGVuIHRoZSBvYnNlcnZlciBpcyBpbiB2ZXJzaW9uIDEsIHdoZXJlIGlzIHRoZSB2ZXJzaW9uIDIgPwogICAgICAvL3dpbGwgd2UgbmVlZCB0byBjb25maXJtIHRoZSByZWNlcHRpb24gPwogICAgICBpZiAoX3RoaXMuX3ZlcnNpb24gKyAxID09PSBtc2cuYm9keS52ZXJzaW9uKSB7CiAgICAgICAgX3RoaXMuX3ZlcnNpb24rKzsKICAgICAgICB2YXIgcGF0aCA9IG1zZy5ib2R5LmF0dHJpYnV0ZTsKICAgICAgICB2YXIgdmFsdWUgPSAoMCwgX3V0aWxzLmRlZXBDbG9uZSkobXNnLmJvZHkudmFsdWUpOwogICAgICAgIHZhciBmaW5kUmVzdWx0ID0gc3luY09iai5maW5kQmVmb3JlKHBhdGgpOwoKICAgICAgICBpZiAobXNnLmJvZHkuYXR0cmlidXRlVHlwZSA9PT0gX1N5bmNPYmplY3QuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgaWYgKG1zZy5ib2R5Lm9wZXJhdGlvbiA9PT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgdmFyIGFyciA9IGZpbmRSZXN1bHQub2JqOwogICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoYXJyLCBbaW5kZXgsIDBdLmNvbmNhdCh2YWx1ZSkpOwogICAgICAgICAgfSBlbHNlIGlmIChtc2cuYm9keS5vcGVyYXRpb24gPT09IF9TeW5jT2JqZWN0LkNoYW5nZVR5cGUuUkVNT1ZFKSB7CiAgICAgICAgICAgIHZhciBfYXJyID0gZmluZFJlc3VsdC5vYmo7CiAgICAgICAgICAgIHZhciBfaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIF9hcnIuc3BsaWNlKF9pbmRleCwgdmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmluZFJlc3VsdC5vYmpbZmluZFJlc3VsdC5sYXN0XSA9IHZhbHVlOyAvLyBVUERBVEUKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobXNnLmJvZHkudmFsdWUpIHsKICAgICAgICAgICAgICBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdID0gdmFsdWU7IC8vIFVQREFURSBvciBBREQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdOyAvLyBSRU1PVkUKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL1RPRE86IGhvdyB0byBoYW5kbGUgdW5zeW5jaHJvbml6ZWQgdmVyc2lvbnM/CiAgICAgICAgICBjb25zb2xlLmxvZygnVU5TWU5DSFJPTklaRUQgVkVSU0lPTjogKGRhdGEgPT4gJyArIF90aGlzLl92ZXJzaW9uICsgJywgbXNnID0+ICcgKyBtc2cuYm9keS52ZXJzaW9uICsgJyknKTsKICAgICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2NoYW5nZUNoaWxkcmVuJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hhbmdlQ2hpbGRyZW4obXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGNvbnNvbGUubG9nKCdDaGFuZ2UgY2hpbGRyZW46ICcsIF90aGlzLl9vd25lciwgbXNnKTsKCiAgICAgIHZhciBjaGlsZElkID0gbXNnLmJvZHkucmVzb3VyY2U7CiAgICAgIHZhciBjaGlsZHJlbiA9IF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRJZF07CgogICAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgICBfdGhpcy5fY2hhbmdlT2JqZWN0KGNoaWxkcmVuLl9zeW5jT2JqLCBtc2cpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBjaGlsZHJlbiBmb3VuZCBmb3I6ICcsIGNoaWxkSWQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQoKICAgIC8qKgogICAgICogT2JqZWN0IHNjaGVtYSBVUkwgKHRoaXMgZmllbGQgaXMgbm90IHlldCBzdGFibGUsIGFuZCBpcyBzdWJzamVjdCB0byBjaGFuZ2UpCiAgICAgKiBAdHlwZSB7U2NoZW1hVVJMfQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3NjaGVtYScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXR1cyBvZiB0aGUgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIgY29ubmVjdGlvbiAodGhpcyBmaWVsZCBpcyBub3QgeWV0IHN0YWJsZSwgYW5kIGlzIHN1YnNqZWN0IHRvIGNoYW5nZSkKICAgICAqIEB0eXBlIHtTdGF0dXN9IC0gRW51bSBvZjogb24gfCBwYXVzZWQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzdGF0dXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBEYXRhIHN0cnVjdHVyZSB0byBiZSBzeW5jaHJvbml6ZWQuCiAgICAgKiBAdHlwZSB7SlNPTn0gLSBKU09OIHN0cnVjdHVyZSB0aGF0IHNob3VsZCBmb2xsb3cgdGhlIGRlZmluZWQgc2NoZW1hLCBpZiBhbnkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZGF0YScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBjcmVhdGVkIGNoaWxkcmVuJ3Mgc2luY2UgdGhlIHN1YnNjcmlwdGlvbiwgZG9lc24ndCBjb250YWluIGFsbCBjaGlsZHJlbidzIHNpbmNlIHJlcG9ydGVyIGNyZWF0aW9uLgogICAgICogQHR5cGUge09iamVjdDxDaGlsZElkLCBEYXRhT2JqZWN0Q2hpbGQ+fQogICAgICovCgogIH0sIHsKICAgIGtleTogJ2NoaWxkcmVucycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuT2JqZWN0czsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0Owp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBEYXRhT2JqZWN0OwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjo4LCIuL0RhdGFPYmplY3RDaGlsZCI6MiwiLi9TeW5jT2JqZWN0Ijo2fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOyAvKioKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqKi8KCnZhciBfU3luY09iamVjdCA9IHJlcXVpcmUoJy4vU3luY09iamVjdCcpOwoKdmFyIF9TeW5jT2JqZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1N5bmNPYmplY3QpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiAqIFRoZSBjbGFzcyByZXR1cm5lZCBmcm9tIHRoZSBEYXRhT2JqZWN0IGFkZENoaWxkcmVuIGNhbGwgb3IgZnJvbSBvbkFkZENoaWxkcmVuIGlmIHJlbW90ZWx5IGNyZWF0ZWQuCiAqIENoaWxkcmVuIG9iamVjdCBzeW5jaHJvbml6YXRpb24gaXMgYSBhIGZhc3QgZm9yd2FyZCBtZWNoYW5pc20sIG5vIG5lZWQgZm9yIGRpcmVjdCBzdWJzY3JpcHRpb25zLCBpdCB1c2VzIHRoZSBhbHJlYWR5IGF1dGhvcml6ZWQgc3Vic2NyaXB0aW9uIGZyb20gdGhlIHBhcmVudCBEYXRhT2JqZWN0LgogKi8KCnZhciBEYXRhT2JqZWN0Q2hpbGQgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkCiAgKi8KCiAgLyoqCiAgICogQGlnbm9yZQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBEYXRhT2JqZWN0LmFkZENoaWxkcmVuCiAgICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3RDaGlsZChwYXJlbnQsIGNoaWxkSWQsIGluaXRpYWxEYXRhLCBvd25lciwgbXNnSWQpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0Q2hpbGQpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgIF90aGlzLl9jaGlsZElkID0gY2hpbGRJZDsKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX21zZ0lkID0gbXNnSWQ7CgogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyLmRlZmF1bHQoaW5pdGlhbERhdGEpOwoKICAgIF90aGlzLl9idXMgPSBwYXJlbnQuX2J1czsKICAgIF90aGlzLl9hbGxvY2F0ZUxpc3RlbmVycygpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RDaGlsZCwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy90aGlzIGlzIG9ubHkgbmVlZGVkIGZvciBjaGlsZHJlbiByZXBvcnRlcnMKICAgICAgaWYgKF90aGlzLl9vd25lcikgewogICAgICAgIF90aGlzLl9saXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoX3RoaXMuX293bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICBpZiAobXNnLnR5cGUgPT09ICdyZXNwb25zZScgJiYgbXNnLmlkID09PSBfdGhpcy5fbXNnSWQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RDaGlsZC5vblJlc3BvbnNlOicsIG1zZyk7CiAgICAgICAgICAgIF90aGlzLl9vblJlc3BvbnNlKG1zZyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfcmVsZWFzZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbGVhc2VMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuX2xpc3RlbmVyKSB7CiAgICAgICAgX3RoaXMuX2xpc3RlbmVyLnJlbW92ZSgpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuZCBkZWxldGUgb2JqZWN0IGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkZWxldGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBkZWxldGUgX3RoaXMuX3BhcmVudC5fY2hpbGRyZW5bX3RoaXMuX2NoaWxkSWRdOwoKICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKCiAgICAgIC8vVE9ETzogc2VuZCBkZWxldGUgbWVzc2FnZSA/CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGlsZHJlbiBJRCBnZW5lcmF0ZWQgb24gYWRkQ2hpbGRyZW4uIFVuaXF1ZSBpZGVudGlmaWVyCiAgICAgKiBAdHlwZSB7VVJMfSAtIFVSTCBvZiB0aGUgZm9ybWF0IDxIeXBlcnR5VVJMPiM8bnVtZXJpYy1zZXF1ZW5jZT4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbkNoYW5nZScsCgoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgdGhlIGNoYW5nZSBsaXN0ZW5lcnMgc2VudCBieSB0aGUgcmVwb3J0ZXIgY2hpbGQKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2hhbmdlKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBjYWxsYmFjayhldmVudCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgcmVzcG9uc2Ugbm90aWZpY2F0aW9ucyBvZiB0aGUgY3JlYXRlcwogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjawogICAgICovCgogIH0sIHsKICAgIGtleTogJ29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVzcG9uc2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVzcG9uc2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgdXJsOiBtc2cuYm9keS5zb3VyY2UsCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdjaGlsZElkJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgIH0KCiAgICAvKioKICAgICAqIERhdGEgU3RydWN0dXJlIHRvIGJlIHN5bmNocm9uaXplZC4KICAgICAqIEB0eXBlIHtKU09OfSAtIEpTT04gc3RydWN0dXJlIHRoYXQgc2hvdWxkIGZvbGxvdyB0aGUgZGVmaW5lZCBzY2hlbWEsIGlmIGFueS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkYXRhJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RDaGlsZDsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gRGF0YU9iamVjdENoaWxkOwoKfSx7Ii4vU3luY09iamVjdCI6Nn1dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KG9iamVjdCwgcHJvcGVydHksIHJlY2VpdmVyKSB7IGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH07Cgp2YXIgX0RhdGFPYmplY3QyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Jyk7Cgp2YXIgX0RhdGFPYmplY3QzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdDIpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RDaGlsZCcpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdENoaWxkKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0gLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgRmlsdGVyVHlwZSA9IHsgQU5ZOiAnYW55JywgU1RBUlQ6ICdzdGFydCcsIEVYQUNUOiAnZXhhY3QnIH07CgovKioKICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIFN5bmNoZXIgc3Vic2NyaWJlIGNhbGwuCiAqIFRvIGJlIHVzZWQgYXMgYW4gb2JzZXJ2YXRpb24gcG9pbnQgZnJvbSBhIERhdGFPYmplY3RSZXBvcnRlciBjaGFuZ2UuCiAqLwoKdmFyIERhdGFPYmplY3RPYnNlcnZlciA9IGZ1bmN0aW9uIChfRGF0YU9iamVjdCkgewogIF9pbmhlcml0cyhEYXRhT2JqZWN0T2JzZXJ2ZXIsIF9EYXRhT2JqZWN0KTsKCiAgLyogcHJpdmF0ZQogIF9jaGFuZ2VMaXN0ZW5lcjogTXNnTGlzdGVuZXIKICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9maWx0ZXJzOiB7PGZpbHRlcj46IHt0eXBlOiA8c3RhcnQsIGV4YWN0PiwgY2FsbGJhY2s6IDxmdW5jdGlvbj59IH0KICAqLwoKICAvKioKICAgKiBAaWdub3JlCiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIuc3Vic2NyaWJlIG1ldGhvZAogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0T2JzZXJ2ZXIoc3luY2hlciwgdXJsLCBzY2hlbWEsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbnMsIGluaXRpYWxWZXJzaW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdE9ic2VydmVyKTsKCiAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RPYnNlcnZlcikuY2FsbCh0aGlzLCBzeW5jaGVyLCB1cmwsIHNjaGVtYSwgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEuZGF0YSwgY2hpbGRyZW5zKSk7CgogICAgdmFyIF90aGlzID0gX3RoaXMyOwoKICAgIF90aGlzLl92ZXJzaW9uID0gaW5pdGlhbFZlcnNpb247CiAgICBfdGhpcy5fZmlsdGVycyA9IHt9OwoKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLl9vbkZpbHRlcihldmVudCk7CiAgICB9KTsKCiAgICAvL3NldHVwIGNoaWxkcmVucyBkYXRhIGZyb20gc3Vic2NyaXB0aW9uCiAgICBPYmplY3Qua2V5cyhpbml0aWFsRGF0YS5jaGlsZHJlbnMpLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkSWQpIHsKICAgICAgdmFyIGNoaWxkRGF0YSA9IGluaXRpYWxEYXRhLmNoaWxkcmVuc1tjaGlsZElkXTsKICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZElkXSA9IG5ldyBfRGF0YU9iamVjdENoaWxkMi5kZWZhdWx0KF90aGlzLCBjaGlsZElkLCBjaGlsZERhdGEpOwogICAgfSk7CgogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gX3RoaXMyOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RPYnNlcnZlciwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihEYXRhT2JqZWN0T2JzZXJ2ZXIucHJvdG90eXBlKSwgJ19hbGxvY2F0ZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl91cmwgKyAnL2NoYW5nZXMnLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgaWYgKG1zZy50eXBlID09PSAndXBkYXRlJykgewogICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci0nICsgX3RoaXMuX3VybCArICctUkNWOiAnLCBtc2cpOwogICAgICAgICAgX3RoaXMuX2NoYW5nZU9iamVjdChfdGhpcy5fc3luY09iaiwgbXNnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdE9ic2VydmVyLnByb3RvdHlwZSksICdfcmVsZWFzZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIucmVtb3ZlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuZCBkZWxldGUgb2JqZWN0IGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkZWxldGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpOwogICAgICBkZWxldGUgX3RoaXMuX3N5bmNoZXIuX29ic2VydmVyc1tfdGhpcy5fdXJsXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgYW5kIGRlbGV0ZSBvYmplY3QgZGF0YQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3Vuc3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciB1blN1YnNjcmliZU1zZyA9IHsKICAgICAgICB0eXBlOiAndW5zdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBfdGhpcy5fc3luY2hlci5fc3ViVVJMLAogICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IF90aGlzLl91cmwgfQogICAgICB9OwoKICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh1blN1YnNjcmliZU1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci1VTlNVQlNDUklCRTogJywgcmVwbHkpOwogICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fb2JzZXJ2ZXJzW190aGlzLl91cmxdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWdpc3RlciB0aGUgY2hhbmdlIGxpc3RlbmVycyBzZW50IGJ5IHRoZSByZXBvcnRlcgogICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciAtIEZpbHRlciB0aGF0IGlkZW50aWZpZXMgdGhlIGZpZWxkIChzZXBhcmV0ZWQgZG90IHBhdGgpLiBBY2NlcHRzICogYXQgdGhlIGVuZCBmb3IgYSBtb3JlIHVucmVzdHJpY3RlZCBmaWx0ZXJpbmcuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnb25DaGFuZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2hhbmdlKGZpbHRlciwgY2FsbGJhY2spIHsKICAgICAgdmFyIGtleSA9IGZpbHRlcjsKICAgICAgdmFyIGZpbHRlck9iaiA9IHsKICAgICAgICB0eXBlOiBGaWx0ZXJUeXBlLkVYQUNULAogICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjawogICAgICB9OwoKICAgICAgdmFyIGlkeCA9IGZpbHRlci5pbmRleE9mKCcqJyk7CiAgICAgIGlmIChpZHggPT09IGZpbHRlci5sZW5ndGggLSAxKSB7CiAgICAgICAgaWYgKGlkeCA9PT0gMCkgewogICAgICAgICAgZmlsdGVyT2JqLnR5cGUgPSBGaWx0ZXJUeXBlLkFOWTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmlsdGVyT2JqLnR5cGUgPSBGaWx0ZXJUeXBlLlNUQVJUOwogICAgICAgICAga2V5ID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIubGVuZ3RoIC0gMSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9maWx0ZXJzW2tleV0gPSBmaWx0ZXJPYmo7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRmlsdGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25GaWx0ZXIoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5rZXlzKF90aGlzLl9maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgZmlsdGVyID0gX3RoaXMuX2ZpbHRlcnNba2V5XTsKICAgICAgICBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuQU5ZKSB7CiAgICAgICAgICAvL21hdGNoIGFueXRoaW5nCiAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuU1RBUlQpIHsKICAgICAgICAgIC8vaWYgc3RhcnRzIHdpdGggZmlsdGVyLi4uCiAgICAgICAgICBpZiAoZXZlbnQuZmllbGQuaW5kZXhPZihrZXkpID09PSAwKSB7CiAgICAgICAgICAgIGZpbHRlci5jYWxsYmFjayhldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5FWEFDVCkgewogICAgICAgICAgLy9leGFjdCBtYXRjaAogICAgICAgICAgaWYgKGV2ZW50LmZpZWxkID09PSBrZXkpIHsKICAgICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RPYnNlcnZlcjsKfShfRGF0YU9iamVjdDMuZGVmYXVsdCAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8pOwoKZXhwb3J0cy5kZWZhdWx0ID0gRGF0YU9iamVjdE9ic2VydmVyOwoKfSx7Ii4vRGF0YU9iamVjdCI6MSwiLi9EYXRhT2JqZWN0Q2hpbGQiOjJ9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7Cgp2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgeyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9OwoKdmFyIF9EYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdCcpOwoKdmFyIF9EYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3QyKTsKCnZhciBfdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfSAvKioKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IEFwaXplZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqKi8KCi8qKgogKiBUaGUgY2xhc3MgcmV0dXJuZWQgZnJvbSB0aGUgU3luY2hlciBjcmVhdGUgY2FsbC4KICogVG8gYmUgdXNlZCBhcyBhIHJlcG9ydGVyIHBvaW50LCBjaGFuZ2VzIHdpbGwgYmUgc3VibWl0ZWQgdG8gRGF0YU9iamVjdE9ic2VydmVyIGluc3RhbmNlcy4KICovCgp2YXIgRGF0YU9iamVjdFJlcG9ydGVyID0gZnVuY3Rpb24gKF9EYXRhT2JqZWN0KSB7CiAgX2luaGVyaXRzKERhdGFPYmplY3RSZXBvcnRlciwgX0RhdGFPYmplY3QpOwoKICAvKiBwcml2YXRlCiAgX3N1YnNjcmlwdGlvbnM6IDxoeXBlcnR5VXJsOiB7IHN0YXR1czogc3RyaW5nIH0gfT4KICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9vblN1YnNjcmlwdGlvbkhhbmRsZXI6IChldmVudCkgPT4gdm9pZAogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkCiAgKi8KCiAgLyoqCiAgICogQGlnbm9yZQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyLmNyZWF0ZSBtZXRob2QKICAgKi8KCiAgZnVuY3Rpb24gRGF0YU9iamVjdFJlcG9ydGVyKHN5bmNoZXIsIHVybCwgc2NoZW1hLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW5zKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RSZXBvcnRlcikuY2FsbCh0aGlzLCBzeW5jaGVyLCB1cmwsIHNjaGVtYSwgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEsIGNoaWxkcmVucykpOwoKICAgIHZhciBfdGhpcyA9IF90aGlzMjsKCiAgICBfdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9OwoKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItJyArIHVybCArICctU0VORDogJywgZXZlbnQpOwogICAgICBfdGhpcy5fb25DaGFuZ2UoZXZlbnQpOwogICAgfSk7CgogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gX3RoaXMyOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RSZXBvcnRlciwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihEYXRhT2JqZWN0UmVwb3J0ZXIucHJvdG90eXBlKSwgJ19hbGxvY2F0ZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVzcG9uc2VMaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3Jlc3BvbnNlJykgewogICAgICAgICAgX3RoaXMuX29uUmVzcG9uc2UobXNnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdFJlcG9ydGVyLnByb3RvdHlwZSksICdfcmVsZWFzZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVzcG9uc2VMaXN0ZW5lci5yZW1vdmUoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdpbnZpdGVPYnNlcnZlcnMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGludml0ZU9ic2VydmVycyhvYnNlcnZlcnMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBpbnZpdGVNc2cgPSB7CiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9zeW5jaGVyLl9vd25lciwgdG86IF90aGlzLl9zeW5jaGVyLl9zdWJVUkwsCiAgICAgICAgYm9keTogeyByZXNvdXJjZTogX3RoaXMuX3VybCwgc2NoZW1hOiBfdGhpcy5fc2NoZW1hLCB2YWx1ZTogX3RoaXMuX3N5bmNPYmouZGF0YSwgYXV0aG9yaXNlOiBvYnNlcnZlcnMgfQogICAgICB9OwoKICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShpbnZpdGVNc2cpOwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbmQgZGVsZXRlIG9iamVjdCBkYXRhCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZGVsZXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVsZXRlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGRlbGV0ZU1zZyA9IHsKICAgICAgICB0eXBlOiAnZGVsZXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N5bmNoZXIuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsIH0KICAgICAgfTsKCiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoZGVsZXRlTXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLURFTEVURTogJywgcmVwbHkpOwogICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fcmVwb3J0ZXJzW190aGlzLl91cmxdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdWJzY3JpcHRpb25zIHJlcXVlc3RlZCBhbmQgYWNjZXB0ZWQgdG8gdGhpcyByZXBvcnRlcgogICAgICogQHR5cGUge09iamVjdDxIeXBlcnR5VVJMLCBTeW5jU3Vic2NyaXB0aW9uPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvblN1YnNjcmlwdGlvbicsCgoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3Mgc3Vic2NyaWJlIGFuZCB1bnN1YnNjcmliZSBub3RpZmljYXRpb25zCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBvblN1YnNjcmlwdGlvbihjYWxsYmFjaykgewogICAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIHJlc3BvbnNlIG5vdGlmaWNhdGlvbnMgb2YgdGhlIGNyZWF0ZSdzCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXNwb25zZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcndhcmQobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLVJDVjogJywgbXNnKTsKICAgICAgc3dpdGNoIChtc2cuYm9keS50eXBlKSB7CiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblN1YnNjcmliZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblVuU3Vic2NyaWJlKG1zZyk7YnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy5ib2R5LnR5cGUsCiAgICAgICAgdXJsOiBoeXBlcnR5VXJsLAoKICAgICAgICBhY2NlcHQ6IGZ1bmN0aW9uIGFjY2VwdCgpIHsKICAgICAgICAgIC8vY3JlYXRlIG5ldyBzdWJzY3JpcHRpb24KICAgICAgICAgIHZhciBzdWIgPSB7IHVybDogaHlwZXJ0eVVybCwgc3RhdHVzOiAnb24nIH07CiAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXSA9IHN1YjsKCiAgICAgICAgICAvL3Byb2Nlc3MgYW5kIHNlbmQgY2hpbGRyZW5zIGRhdGEKICAgICAgICAgIHZhciBjaGlsZHJlblZhbHVlcyA9IHt9OwogICAgICAgICAgT2JqZWN0LmtleXMoX3RoaXMuX2NoaWxkcmVuT2JqZWN0cykuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGRJZCkgewogICAgICAgICAgICB2YXIgY2hpbGREYXRhID0gX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZElkXS5kYXRhOwogICAgICAgICAgICBjaGlsZHJlblZhbHVlc1tjaGlsZElkXSA9ICgwLCBfdXRpbHMuZGVlcENsb25lKShjaGlsZERhdGEpOwogICAgICAgICAgfSk7CgogICAgICAgICAgLy9zZW5kIG9rIHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogX3RoaXMuX3NjaGVtYSwgdmVyc2lvbjogX3RoaXMuX3ZlcnNpb24sIHZhbHVlOiB7IGRhdGE6ICgwLCBfdXRpbHMuZGVlcENsb25lKShfdGhpcy5kYXRhKSwgY2hpbGRyZW5zOiBjaGlsZHJlblZhbHVlcyB9IH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBzdWI7CiAgICAgICAgfSwKCiAgICAgICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocmVhc29uKSB7CiAgICAgICAgICAvL3NlbmQgcmVqZWN0IHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiA0MDMsIGRlc2M6IHJlYXNvbiB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdTVUJTQ1JJUFRJT04tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblVuU3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25VblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIHN1YiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdOwogICAgICBkZWxldGUgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF07CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLmJvZHkudHlwZSwKICAgICAgICB1cmw6IGh5cGVydHlVcmwsCiAgICAgICAgb2JqZWN0OiBzdWIKICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1VOLVNVQlNDUklQVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlc3BvbnNlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIHVybDogbXNnLmZyb20sCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdSRVNQT05TRS1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdWJzY3JpcHRpb25zJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uczsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0UmVwb3J0ZXI7Cn0oX0RhdGFPYmplY3QzLmRlZmF1bHQgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovKTsKCmV4cG9ydHMuZGVmYXVsdCA9IERhdGFPYmplY3RSZXBvcnRlcjsKCn0seyIuLi91dGlscy91dGlscy5qcyI6OCwiLi9EYXRhT2JqZWN0IjoxfV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8qKgogKiBAYWNjZXNzIHByaXZhdGUKICovCgp2YXIgRGF0YVByb3Zpc2lvbmFsID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICBfY2hpbGRyZW5MaXN0ZW5lcnM6IFtNc2dMaXN0ZW5lcl0KICBfbGlzdGVuZXI6IE1zZ0xpc3RlbmVyCiAgIF9jaGFuZ2VzOiBbXQogICovCgogIGZ1bmN0aW9uIERhdGFQcm92aXNpb25hbChvd25lciwgdXJsLCBidXMsIGNoaWxkcmVuKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YVByb3Zpc2lvbmFsKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX3VybCA9IHVybDsKICAgIF90aGlzLl9idXMgPSBidXM7CiAgICBfdGhpcy5fY2hpbGRyZW4gPSBjaGlsZHJlbjsKCiAgICBfdGhpcy5fY2hhbmdlcyA9IFtdOwogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YVByb3Zpc2lvbmFsLCBbewogICAga2V5OiAnX2FsbG9jYXRlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfYWxsb2NhdGVMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fbGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl91cmwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGF0YVByb3Zpc2lvbmFsLScgKyBfdGhpcy5fdXJsICsgJy1SQ1Y6ICcsIG1zZyk7CiAgICAgICAgX3RoaXMuX2NoYW5nZXMucHVzaChtc2cpOwogICAgICB9KTsKCiAgICAgIC8qCiAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycyA9IFtdOwogICAgICBpZiAoX3RoaXMuX2NoaWxkcmVuKSB7CiAgICAgICAgbGV0IGNoaWxkQmFzZVVSTCA9IHVybCArICcvY2hpbGRyZW4vJzsKICAgICAgICBfdGhpcy5fY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHsKICAgICAgICAgIGxldCBjaGlsZFVSTCA9IGNoaWxkQmFzZVVSTCArIGNoaWxkOwogICAgICAgICAgbGV0IGxpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgKG1zZykgPT4gewogICAgICAgICAgICAvL2lnbm9yZSBtc2cgc2VudCBieSBoaW1zZWxmCiAgICAgICAgICAgIGlmIChtc2cuZnJvbSAhPT0gb3duZXIpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICAgICAgfSk7CiAgICAgIH0qLwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl9saXN0ZW5lci5yZW1vdmUoKTsKCiAgICAgIC8qX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7CiAgICAgICAgbGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgIH0pOyovCiAgICB9CiAgfSwgewogICAga2V5OiAnYXBwbHknLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5KG9ic2VydmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgIG9ic2VydmVyLl9jaGFuZ2VPYmplY3Qob2JzZXJ2ZXIuX3N5bmNPYmosIGNoYW5nZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ2NoaWxkcmVuJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW47CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YVByb3Zpc2lvbmFsOwp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBEYXRhUHJvdmlzaW9uYWw7Cgp9LHt9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLk9iamVjdFR5cGUgPSBleHBvcnRzLkNoYW5nZVR5cGUgPSB1bmRlZmluZWQ7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX3V0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKi8KCnZhciBTeW5jT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgIF9kYXRhOiBhbnk7CiAgICBfb2JzZXJ2ZXJzOiAoKGV2ZW50OiBDaGFuZ2VFdmVudCkgPT4gdm9pZClbXQogICovCgogIGZ1bmN0aW9uIFN5bmNPYmplY3QoaW5pdGlhbERhdGEpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jT2JqZWN0KTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vYnNlcnZlcnMgPSBbXTsKICAgIF90aGlzLl9maWx0ZXJzID0ge307CgogICAgaWYgKGluaXRpYWxEYXRhKSB7CiAgICAgIF90aGlzLl9kYXRhID0gKDAsIF91dGlscy5kZWVwQ2xvbmUpKGluaXRpYWxEYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIF90aGlzLl9kYXRhID0ge307CiAgICB9CgogICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShuZXcgUGF0aCgpLCBfdGhpcy5fZGF0YSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU3luY09iamVjdCwgW3sKICAgIGtleTogJ29ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9ic2VydmUoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmQocGF0aCkgewogICAgICB2YXIgbGlzdCA9IHBhdGguc3BsaXQoJy4nKTsKCiAgICAgIHJldHVybiB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmRCZWZvcmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRCZWZvcmUocGF0aCkgewogICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgIHZhciBsaXN0ID0gcGF0aC5zcGxpdCgnLicpOwogICAgICByZXN1bHQubGFzdCA9IGxpc3QucG9wKCk7CiAgICAgIHJlc3VsdC5vYmogPSB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmluZFdpdGhTcGxpdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRXaXRoU3BsaXQobGlzdCkgewogICAgICB2YXIgb2JqID0gdGhpcy5fZGF0YTsKICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG9iaiA9IG9ialt2YWx1ZV07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG9iajsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmlyZUV2ZW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmlyZUV2ZW50KGV2ZW50KSB7CiAgICAgIHRoaXMuX29ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGV2ZW50KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2lzT2JzZXJ2YWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzT2JzZXJ2YWJsZShvYmopIHsKICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ19pbnRlcm5hbE9ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pbnRlcm5hbE9ic2VydmUocGF0aCwgb2JqKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmopKSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKGNoYW5nZXMpIHsKICAgICAgICAgIF90aGlzLl9vbkNoYW5nZXMocGF0aCwgY2hhbmdlcyk7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICBPYmplY3Qub2JzZXJ2ZShvYmosIGhhbmRsZXIpOwogICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgICAgICAgaWYgKF90aGlzLl9pc09ic2VydmFibGUob2JqW3Byb3BdKSkgewogICAgICAgICAgICAgIF90aGlzLl9pbnRlcm5hbE9ic2VydmUocGF0aC5uZXcocHJvcCksIG9ialtwcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgIEFycmF5Lm9ic2VydmUob2JqLCBoYW5kbGVyKTsKICAgICAgICAgIGZvciAodmFyIF9wcm9wIGluIG9iaikgewogICAgICAgICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmpbX3Byb3BdKSkgewogICAgICAgICAgICAgIHZhciBucCA9IHBhdGgubmV3KG5ldyBBcnJheUluZGV4KG9ialtfcHJvcF0sIF9wcm9wKSk7CiAgICAgICAgICAgICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShucCwgb2JqW19wcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25DaGFuZ2VzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2VzKHBhdGgsIGNoYW5nZXMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBmb3IgKHZhciBpIGluIGNoYW5nZXMpIHsKICAgICAgICB2YXIgb2JqID0gY2hhbmdlc1tpXS5vYmplY3Q7CiAgICAgICAgdmFyIG9ialR5cGUgPSB2b2lkIDA7CgogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgb2JqVHlwZSA9IE9iamVjdFR5cGUuT0JKRUNUOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgIG9ialR5cGUgPSBPYmplY3RUeXBlLkFSUkFZOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNoYW5nZXNbaV0udHlwZSA9PT0gJ3NwbGljZScpIHsKICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpZHggPSBjaGFuZ2VzW2ldLmluZGV4OwogICAgICAgICAgICB2YXIgZmllbGQgPSBwYXRoLm5ldygnJyArIGlkeCk7CiAgICAgICAgICAgIHZhciBmaWVsZFN0cmluZyA9IGZpZWxkLnRvU3RyaW5nKCk7CgogICAgICAgICAgICB2YXIgcmVtb3ZlU2l6ZSA9IGNoYW5nZXNbaV0ucmVtb3ZlZC5sZW5ndGg7CiAgICAgICAgICAgIGlmIChyZW1vdmVTaXplICE9PSAwKSB7CiAgICAgICAgICAgICAgdmFyIHJlbW92ZVZhbHVlcyA9IGNoYW5nZXNbaV0ucmVtb3ZlZDsKICAgICAgICAgICAgICByZW1vdmVWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLl9pc09ic2VydmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHBhdGgucmVtb3ZlSW5kZXgoaWR4ICsgaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczIuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5SRU1PVkUsCiAgICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICAgIGRhdGE6IHJlbW92ZVNpemUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFkZFNpemUgPSBjaGFuZ2VzW2ldLmFkZGVkQ291bnQ7CiAgICAgICAgICAgIGlmIChhZGRTaXplICE9PSAwKSB7CiAgICAgICAgICAgICAgdmFyIGFkZFZhbHVlcyA9IG9iai5zbGljZShpZHgsIGlkeCArIGFkZFNpemUpOwogICAgICAgICAgICAgIGFkZFZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczIuX2lzT2JzZXJ2YWJsZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5wID0gcGF0aC5uZXcobmV3IEFycmF5SW5kZXgodmFsdWUsIGlkeCArIGluZGV4KSk7CiAgICAgICAgICAgICAgICAgIF90aGlzMi5faW50ZXJuYWxPYnNlcnZlKG5wLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMi5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLkFERCwKICAgICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nLAogICAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKGFkZFZhbHVlcykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9yZS1kZWZpbmUgcGF0aHMuLi4KICAgICAgICAgICAgaWYgKGlkeCAhPT0gb2JqLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICBwYXRoLnJlSW5kZXhGcm9tKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBfZmllbGQgPSBwYXRoLm5ldyhjaGFuZ2VzW2ldLm5hbWUpOwogICAgICAgICAgdmFyIF9maWVsZFN0cmluZyA9IF9maWVsZC50b1N0cmluZygpOwoKICAgICAgICAgIGlmIChfZmllbGRTdHJpbmcuaW5kZXhPZignU3ltYm9sJykgIT09IC0xKSB7CiAgICAgICAgICAgIC8vaGFjayBmb3IgUGhhbnRvbUpTMgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdTWU1CT0w6ICcsIGNoYW5nZXNbaV0pOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2xldCBvbGRWYWx1ZSA9IGNoYW5nZXNbaV0ub2xkVmFsdWU7CiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBvYmpbY2hhbmdlc1tpXS5uYW1lXTsKICAgICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICd1cGRhdGUnKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuVVBEQVRFLAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBfZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnYWRkJykgewogICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9ic2VydmUoX2ZpZWxkLCBuZXdWYWx1ZSk7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuQURELAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBfZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnZGVsZXRlJykgewogICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoewogICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlJFTU9WRSwKICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICBmaWVsZDogX2ZpZWxkU3RyaW5nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2RhdGEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN5bmNPYmplY3Q7Cn0oKTsKCi8vZHluYW1pYyBwYXRoIGZvciBBcnJheSBpbmRleC4uLgoKCnZhciBQYXRoID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFBhdGgoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGF0aCk7CgogICAgdGhpcy5fcGF0aCA9IFtdOwogICAgdGhpcy5fb2JzZXJ2YWJsZXMgPSB7fTsgLy88aW5kZXg6QXJyYXlJbmRleD4KICB9CgogIF9jcmVhdGVDbGFzcyhQYXRoLCBbewogICAga2V5OiAncmVtb3ZlSW5kZXgnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUluZGV4KGlkeCkgewogICAgICAvL2NvbnNvbGUubG9nKCdSRU1PVkUtUEFUSCAnICsgaWR4KTsKICAgICAgZGVsZXRlIHRoaXMuX29ic2VydmFibGVzW2lkeF07CiAgICB9CiAgfSwgewogICAga2V5OiAncmVJbmRleEZyb20nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlSW5kZXhGcm9tKGFycmF5KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgT2JqZWN0LmtleXModGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBhcnJheUluZGV4ID0gX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgIHZhciBpZHggPSBhcnJheS5pbmRleE9mKGFycmF5SW5kZXgub2JqKTsKICAgICAgICBpZiAoYXJyYXlJbmRleC5pZHggIT0gaWR4KSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdSRS1JTkRFWDogJyArIGtleSArICctPicgKyBpZHgpOwogICAgICAgICAgYXJyYXlJbmRleC5pZHggPSBpZHg7CiAgICAgICAgICBkZWxldGUgX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgICAgX3RoaXMzLl9vYnNlcnZhYmxlc1tpZHhdID0gYXJyYXlJbmRleDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ25ldycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX25ldyhpZHgpIHsKICAgICAgaWYgKGlkeC5jb25zdHJ1Y3RvciA9PSBBcnJheUluZGV4KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnUEFUSC1PQlNFUlY6ICcsIGlkeCk7CiAgICAgICAgdGhpcy5fb2JzZXJ2YWJsZXNbaWR4LmlkeF0gPSBpZHg7CiAgICAgIH0KCiAgICAgIHZhciBuUGF0aCA9IHRoaXMuY2xvbmUoKTsKICAgICAgblBhdGguX3BhdGgucHVzaChpZHgpOwoKICAgICAgcmV0dXJuIG5QYXRoOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Nsb25lJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgdmFyIG5QYXRoID0gbmV3IFBhdGgoKTsKICAgICAgdGhpcy5fcGF0aC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG5QYXRoLl9wYXRoLnB1c2godmFsdWUpOwogICAgICB9KTsKCiAgICAgIHJldHVybiBuUGF0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIC8vVE9ETzogb3B0aW1pemUhIQogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICBzdHIgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHIgKz0gJy4nICsgdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICB9XSk7CgogIHJldHVybiBQYXRoOwp9KCk7Cgp2YXIgQXJyYXlJbmRleCA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBcnJheUluZGV4KG9iaiwgaWR4KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXJyYXlJbmRleCk7CgogICAgdGhpcy5vYmogPSBvYmo7CiAgICB0aGlzLmlkeCA9IGlkeDsKICB9CgogIF9jcmVhdGVDbGFzcyhBcnJheUluZGV4LCBbewogICAga2V5OiAndG9TdHJpbmcnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy5pZHgudG9TdHJpbmcoKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBBcnJheUluZGV4Owp9KCk7Cgp2YXIgQ2hhbmdlVHlwZSA9IGV4cG9ydHMuQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAndXBkYXRlJywgQUREOiAnYWRkJywgUkVNT1ZFOiAncmVtb3ZlJyB9Owp2YXIgT2JqZWN0VHlwZSA9IGV4cG9ydHMuT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAnb2JqZWN0JywgQVJSQVk6ICdhcnJheScgfTsKZXhwb3J0cy5kZWZhdWx0ID0gU3luY09iamVjdDsKCn0seyIuLi91dGlscy91dGlscy5qcyI6OH1dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlciA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdFJlcG9ydGVyJyk7Cgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0UmVwb3J0ZXIpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RPYnNlcnZlcicpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdE9ic2VydmVyKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsID0gcmVxdWlyZSgnLi9EYXRhUHJvdmlzaW9uYWwnKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFQcm92aXNpb25hbCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgovKioKICogVGhlIG1haW4gY2xhc3MgZm9yIHRoZSBzeW5jaGVyIHBhY2thZ2UuCiAqIFRoZSBTeW5jaGVyIGlzIGEgc2luZ2xldG9uIGNsYXNzIHBlciBIeXBlcnR5L1VSTCBhbmQgaXQgaXMgdGhlIG93bmVyIG9mIGFsbCBjcmVhdGVkIERhdGEgU3luYyBPYmplY3RzIGFjY29yZGluZyB0byB0aGUgUmVwb3J0ZXIgLSBPYnNlcnZlciBwYXR0ZXJuLgogKiBNYWluIGZ1bmN0aW9uYWxpdHkgaXMgdG8gY3JlYXRlIHJlcG9ydGVycyBhbmQgdG8gc3Vic2NyaWJlIHRvIGV4aXN0aW5nIG9uZXMuCiAqLwoKdmFyIFN5bmNoZXIgPSBmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQogIF9vd25lcjogVVJMCiAgX2J1czogTWluaUJ1cwogICBfc3ViVVJMOiBVUkwKICAgX3JlcG9ydGVyczogPHVybDogRGF0YU9iamVjdFJlcG9ydGVyPgogIF9vYnNlcnZlcnM6IDx1cmw6IERhdGFPYmplY3RPYnNlcnZlcj4KICBfcHJvdmlzaW9uYWxzOiA8dXJsOiBEYXRhUHJvdmlzaW9uYWw+CiAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0KICBfb25Ob3RpZmljYXRpb25IYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQKICAqLwoKICAvKioKICAgKiBDb25zdHJ1Y3RvciB0aGF0IHNob3VsZCBiZSB1c2VkIGJ5IHRoZSBIeXBlcnR5IG93bmVyCiAgICogQHBhcmFtIHtIeXBlcnR5VVJMfSBvd25lciAtIEh5cGVydHkgVVJMIG93bmVyLiBBbiBVUkwgYWxsb2NhdGVkIGJ5IHRoZSBydW50aW1lIHRoYXQgdW5pcXVlbHkgaWRlbnRpZmllcyB0aGUgSHlwZXJ0eS4KICAgKiBAcGFyYW0ge01pbmlCdXN9IGJ1cyAtIEFuIGluc3RhbmNlIG9mIHRoZSBNaW5pQnVzIHByb3ZpZGVkIGluIHRoZSBzYW5kYm94LiBXaGVuIGFuIG9iamVjdCAoUmVwb3J0ZXIgb3IgT2JzZXJ2ZWQpIGlzIGNyZWF0ZWQsIHRoZSBTeW5jaGVyTWFuYWdlciB3aWxsIGFkZCBhIGxpc3RlbmVyIGluIHRoZSBNaW5pQnVzIHRvIHJlY2VpdmUvc2VuZCBNZXNzYWdlcyBvZiB0aGF0IG9iamVjdC4KICAgKiBAcGFyYW0ge0pTT059IGNvbmZpZyAtIENvbmZpZ3VyYXRpb24gZGF0YS4gVGhlIG9ubHkgcmVxdWlyZWQgZmllbGQgZm9yIG5vdyBpcyB0aGUgcnVudGltZVVSTC4KICAgKi8KCiAgZnVuY3Rpb24gU3luY2hlcihvd25lciwgYnVzLCBjb25maWcpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jaGVyKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKCiAgICBfdGhpcy5fc3ViVVJMID0gY29uZmlnLnJ1bnRpbWVVUkwgKyAnL3NtJzsKCiAgICBfdGhpcy5fcmVwb3J0ZXJzID0ge307CiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0ge307CiAgICBfdGhpcy5fcHJvdmlzaW9uYWxzID0ge307CgogICAgYnVzLmFkZExpc3RlbmVyKG93bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIC8vaWdub3JlIG1zZyBzZW50IGJ5IGhpbXNlbGYKICAgICAgaWYgKG1zZy5mcm9tICE9PSBvd25lcikgewogICAgICAgIGNvbnNvbGUubG9nKCdTeW5jaGVyLVJDVjogJywgbXNnKTsKICAgICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CiAgICAgICAgICBjYXNlICdmb3J3YXJkJzoKICAgICAgICAgICAgX3RoaXMuX29uRm9yd2FyZChtc2cpO2JyZWFrOwogICAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgICAgX3RoaXMuX29uUmVtb3RlQ3JlYXRlKG1zZyk7YnJlYWs7CiAgICAgICAgICBjYXNlICdkZWxldGUnOgogICAgICAgICAgICBfdGhpcy5fb25SZW1vdGVEZWxldGUobXNnKTticmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogVGhlIG93bmVyIG9mIHRoZSBTeW5jaGVyIGFuZCBhbGwgY3JlYXRlZCByZXBvcnRlcnMuCiAgICogQHR5cGUge0h5cGVydHlVUkx9CiAgICovCgoKICBfY3JlYXRlQ2xhc3MoU3luY2hlciwgW3sKICAgIGtleTogJ2NyZWF0ZScsCgoKICAgIC8qKgogICAgICogUmVxdWVzdCBhIERhdGFPYmplY3RSZXBvcnRlciBjcmVhdGlvbi4gVGhlIFVSTCB3aWxsIGJlIGJlIHJlcXVlc3RlZCBieSB0aGUgYWxsb2NhdGlvbiBtZWNoYW5pc20uCiAgICAgKiBAcGFyYW0gIHtTY2hlbWFVUkx9IHNjaGVtYSAtIFVSTCBvZiB0aGUgb2JqZWN0IGRlc2NyaXB0b3IKICAgICAqIEBwYXJhbSAge0h5cGVydHlVUkxbXX0gb2JzZXJ2ZXJzIC0gTGlzdCBvZiBoeXBlcnRpZXMgdGhhdCBhcmUgcHJlLWF1dGhvcml6ZWQgZm9yIHN1YnNjcmlwdGlvbgogICAgICogQHBhcmFtICB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIHJlcG9ydGVyCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RSZXBvcnRlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IFJlcG9ydGVyLiBUaGUgcmVwb3J0ZXIgY2FuIGJlIGFjY2VwdGVkIG9yIHJlamVjdGVkIGJ5IHRoZSBQRVAKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZShzY2hlbWEsIG9ic2VydmVycywgaW5pdGlhbERhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGluaXRpYWxEYXRhLnJlcG9ydGVyID0gX3RoaXMuX293bmVyOwogICAgICBpbml0aWFsRGF0YS5zY2hlbWEgPSBzY2hlbWE7CgogICAgICB2YXIgcmVxdWVzdE1zZyA9IHsKICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHNjaGVtYTogc2NoZW1hLCB2YWx1ZTogaW5pdGlhbERhdGEsIGF1dGhvcmlzZTogb2JzZXJ2ZXJzIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgLy9yZXF1ZXN0IGNyZWF0ZSB0byB0aGUgQWxsb2NhdGlvbiBzeXN0ZW0/IENhbiBiZSByZWplY3RlZCBieSB0aGUgUG9saWN5RW5naW5lLgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgdmFyIG9ialVSTCA9IHJlcGx5LmJvZHkucmVzb3VyY2U7CgogICAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIGFjY2VwdGVkCiAgICAgICAgICAgIHZhciBuZXdPYmogPSBuZXcgX0RhdGFPYmplY3RSZXBvcnRlcjIuZGVmYXVsdChfdGhpcywgb2JqVVJMLCBzY2hlbWEsICdvbicsIGluaXRpYWxEYXRhLCByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzKTsKICAgICAgICAgICAgX3RoaXMuX3JlcG9ydGVyc1tvYmpVUkxdID0gbmV3T2JqOwoKICAgICAgICAgICAgcmVzb2x2ZShuZXdPYmopOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiByZWplY3RlZAogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXF1ZXN0IGEgc3Vic2NyaXB0aW9uIHRvIGFuIGV4aXN0ZW50IG9iamVjdC4KICAgICAqIEBwYXJhbSB7U2NoZW1hVVJMfSBzY2hlbWEgLSBVUkwgb2YgdGhlIG9iamVjdCBkZXNjcmlwdG9yCiAgICAgKiBAcGFyYW0ge09iamVjdFVSTH0gb2JqVVJMIC0gQWRkcmVzcyBvZiB0aGUgZXhpc3RlbnQgcmVwb3J0ZXIgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IG9ic2VydmVyLgogICAgICovCgogIH0sIHsKICAgIGtleTogJ3N1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3Vic2NyaWJlKHNjaGVtYSwgb2JqVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHZhbGlkYXRlIGlmIHN1YnNjcmlwdGlvbiBhbHJlYWR5IGV4aXN0cyA/CiAgICAgIHZhciBzdWJzY3JpYmVNc2cgPSB7CiAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsCiAgICAgICAgYm9keTogeyBzY2hlbWE6IHNjaGVtYSwgcmVzb3VyY2U6IG9ialVSTCB9CiAgICAgIH07CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIC8vcmVxdWVzdCBzdWJzY3JpcHRpb24KICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHN1YnNjcmliZU1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnc3Vic2NyaWJlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICB2YXIgbmV3UHJvdmlzaW9uYWwgPSBfdGhpcy5fcHJvdmlzaW9uYWxzW29ialVSTF07CiAgICAgICAgICBkZWxldGUgX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdOwogICAgICAgICAgaWYgKG5ld1Byb3Zpc2lvbmFsKSBuZXdQcm92aXNpb25hbC5fcmVsZWFzZUxpc3RlbmVycygpOwoKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAyMDApIHsKICAgICAgICAgICAgbmV3UHJvdmlzaW9uYWwgPSBuZXcgX0RhdGFQcm92aXNpb25hbDIuZGVmYXVsdChfdGhpcy5fb3duZXIsIG9ialVSTCwgX3RoaXMuX2J1cywgcmVwbHkuYm9keS5jaGlsZHJlblJlc291cmNlcyk7CiAgICAgICAgICAgIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXSA9IG5ld1Byb3Zpc2lvbmFsOwogICAgICAgICAgfSBlbHNlIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICB2YXIgbmV3T2JqID0gbmV3IF9EYXRhT2JqZWN0T2JzZXJ2ZXIyLmRlZmF1bHQoX3RoaXMsIG9ialVSTCwgc2NoZW1hLCAnb24nLCByZXBseS5ib2R5LnZhbHVlLCBuZXdQcm92aXNpb25hbC5jaGlsZHJlbiwgcmVwbHkuYm9keS52ZXJzaW9uKTsKICAgICAgICAgICAgX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdID0gbmV3T2JqOwoKICAgICAgICAgICAgcmVzb2x2ZShuZXdPYmopOwogICAgICAgICAgICBuZXdQcm92aXNpb25hbC5hcHBseShuZXdPYmopOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgY3JlYXRlIGFuZCBkZWxldGUgZXZlbnRzIG9mIHJlbW92ZSBSZXBvcnRlciBvYmplY3RzLgogICAgICogVGhpcyBpcyByZWxlYXRlZCB0byB0aGUgbWVzc2FnZW5zIHNlbnQgYnkgY3JlYXRlIHRvIHRoZSBvYnNlcnZlcnMgSHlwZXJ0eSBhcnJheS4KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbk5vdGlmaWNhdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Ob3RpZmljYXRpb24oY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRm9yd2FyZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9yd2FyZChtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciByZXBvcnRlciA9IF90aGlzLl9yZXBvcnRlcnNbbXNnLmJvZHkudG9dOwogICAgICByZXBvcnRlci5fb25Gb3J3YXJkKG1zZyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVtb3RlQ3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZW1vdGVDcmVhdGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL3JlbW92ZSAiL3N1YnNjcmlwdGlvbiIgZnJvbSB0aGUgVVJMCiAgICAgIHZhciByZXNvdXJjZSA9IG1zZy5mcm9tLnNsaWNlKDAsIC0xMyk7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgZnJvbTogbXNnLmJvZHkuc291cmNlLAogICAgICAgIHVybDogcmVzb3VyY2UsCiAgICAgICAgc2NoZW1hOiBtc2cuYm9keS5zY2hlbWEsCiAgICAgICAgdmFsdWU6IG1zZy5ib2R5LnZhbHVlLAogICAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSwKCiAgICAgICAgYWNrOiBmdW5jdGlvbiBhY2sodHlwZSkgewogICAgICAgICAgdmFyIGxUeXBlID0gMjAwOwogICAgICAgICAgaWYgKHR5cGUpIHsKICAgICAgICAgICAgbFR5cGUgPSB0eXBlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ05PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVtb3RlRGVsZXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZW1vdGVEZWxldGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL3JlbW92ZSAiL3N1YnNjcmlwdGlvbiIgZnJvbSB0aGUgVVJMCiAgICAgIHZhciByZXNvdXJjZSA9IG1zZy5ib2R5LnJlc291cmNlOwoKICAgICAgdmFyIG9iamVjdCA9IF90aGlzLl9vYnNlcnZlcnNbcmVzb3VyY2VdOwogICAgICBpZiAob2JqZWN0KSB7CiAgICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgICB1cmw6IHJlc291cmNlLAogICAgICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LAoKICAgICAgICAgIGFjazogZnVuY3Rpb24gYWNrKHR5cGUpIHsKICAgICAgICAgICAgdmFyIGxUeXBlID0gMjAwOwogICAgICAgICAgICBpZiAodHlwZSkgewogICAgICAgICAgICAgIGxUeXBlID0gdHlwZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9UT0RPOiBhbnkgb3RoZXIgZGlmZmVyZW50IG9wdGlvbnMgZm9yIHRoZSByZWxlYXNlIHByb2Nlc3MsIGxpa2UgYWNjZXB0IGJ1dCBub3IgcmVsZWFzZSBsb2NhbD8KICAgICAgICAgICAgaWYgKGxUeXBlID09PSAyMDApIHsKICAgICAgICAgICAgICBvYmplY3QuZGVsZXRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlLCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnTk9USUZJQ0FUSU9OLUVWRU5UOiAnLCBldmVudCk7CiAgICAgICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgIGJvZHk6IHsgY29kZTogNDA0LCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdvd25lcicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogQWxsIG93bmVkIHJlcG9ydGVycywgdGhlIG9uZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgYSBjcmVhdGUKICAgICAqIEB0eXBlIHtPYmplY3Q8VVJMLCBEYXRhT2JqZWN0UmVwb3J0ZXI+fQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3JlcG9ydGVycycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBvd25lZCBvYnNlcnZlcnMsIHRoZSBvbmVzIHRoYXQgd2VyZSBjcmVhdGVkIGJ5IGEgbG9jYWwgc3Vic2NyaXB0aW9uCiAgICAgKiBAdHlwZSB7T2JqZWN0PFVSTCwgRGF0YU9iamVjdE9ic2VydmVyPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvYnNlcnZlcnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnM7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3luY2hlcjsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gU3luY2hlcjsKCn0seyIuL0RhdGFPYmplY3RPYnNlcnZlciI6MywiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiOjQsIi4vRGF0YVByb3Zpc2lvbmFsIjo1fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kaXZpZGVVUkwgPSBkaXZpZGVVUkw7CmV4cG9ydHMuZGVlcENsb25lID0gZGVlcENsb25lOwovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8qKgogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsCiAqIEBtb2R1bGUgdXRpbHMKICovCgovKioKICogQHR5cGVkZWYgZGl2aWRlVVJMCiAqIEB0eXBlIE9iamVjdAogKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkwKICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTAogKi8KCi8qKgogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkKICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3MKICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTAogKi8KZnVuY3Rpb24gZGl2aWRlVVJMKHVybCkgewoKICAvLyBsZXQgcmUgPSAvKFthLXpBLVotXSopPzpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKSooXC9bXC9cZFx3XC4tXSopKig/OltcP10pKiguKykqL2dpOwogIHZhciByZSA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpOwogIHZhciBzdWJzdCA9ICckMSwkMiwkMyc7CiAgdmFyIHBhcnRzID0gdXJsLnJlcGxhY2UocmUsIHN1YnN0KS5zcGxpdCgnLCcpOwoKICAvLyBJZiB0aGUgdXJsIGhhcyBubyBwcm90b2NvbCwgdGhlIGRlZmF1bHQgcHJvdG9jb2wgc2V0IGlzIGh0dHBzCiAgaWYgKHBhcnRzWzBdID09PSB1cmwpIHsKICAgIHBhcnRzWzBdID0gJ2h0dHBzJzsKICAgIHBhcnRzWzFdID0gdXJsOwogIH0KCiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YQogKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkCiAqIEByZXR1cm4ge09iamVjdH0KICovCmZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHsKICAvL1RPRE86IHNpbXBsZSBidXQgaW5lZmZpY2llbnQgSlNPTiBkZWVwIGNsb25lLi4uCiAgaWYgKG9iaikgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCn0se31dLDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07CgovKiEKICogVVJJLmpzIC0gTXV0YXRpbmcgVVJMcwogKiBJUHY2IFN1cHBvcnQKICoKICogVmVyc2lvbjogMS4xOC4wCiAqCiAqIEF1dGhvcjogUm9kbmV5IFJlaG0KICogV2ViOiBodHRwOi8vbWVkaWFsaXplLmdpdGh1Yi5pby9VUkkuanMvCiAqCiAqIExpY2Vuc2VkIHVuZGVyCiAqICAgTUlUIExpY2Vuc2UgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZQogKgogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICd1c2Ugc3RyaWN0JzsKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvbWFzdGVyL3JldHVybkV4cG9ydHMuanMKCiAgaWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JykgewogICAgLy8gTm9kZQogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShmYWN0b3J5KTsKICB9IGVsc2UgewogICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgIHJvb3QuSVB2NiA9IGZhY3Rvcnkocm9vdCk7CiAgfQp9KSh1bmRlZmluZWQsIGZ1bmN0aW9uIChyb290KSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvKgogIHZhciBfaW4gPSAiZmU4MDowMDAwOjAwMDA6MDAwMDowMjA0OjYxZmY6ZmU5ZDpmMTU2IjsKICB2YXIgX291dCA9IElQdjYuYmVzdChfaW4pOwogIHZhciBfZXhwZWN0ZWQgPSAiZmU4MDo6MjA0OjYxZmY6ZmU5ZDpmMTU2IjsKICAgY29uc29sZS5sb2coX2luLCBfb3V0LCBfZXhwZWN0ZWQsIF9vdXQgPT09IF9leHBlY3RlZCk7CiAgKi8KCiAgLy8gc2F2ZSBjdXJyZW50IElQdjYgdmFyaWFibGUsIGlmIGFueQoKICB2YXIgX0lQdjYgPSByb290ICYmIHJvb3QuSVB2NjsKCiAgZnVuY3Rpb24gYmVzdFByZXNlbnRhdGlvbihhZGRyZXNzKSB7CiAgICAvLyBiYXNlZCBvbjoKICAgIC8vIEphdmFzY3JpcHQgdG8gdGVzdCBhbiBJUHY2IGFkZHJlc3MgZm9yIHByb3BlciBmb3JtYXQsIGFuZCB0bwogICAgLy8gcHJlc2VudCB0aGUgImJlc3QgdGV4dCByZXByZXNlbnRhdGlvbiIgYWNjb3JkaW5nIHRvIElFVEYgRHJhZnQgUkZDIGF0CiAgICAvLyBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9kcmFmdC1pZXRmLTZtYW4tdGV4dC1hZGRyLXJlcHJlc2VudGF0aW9uLTA0CiAgICAvLyA4IEZlYiAyMDEwIFJpY2ggQnJvd24sIERhcnR3YXJlLCBMTEMKICAgIC8vIFBsZWFzZSBmZWVsIGZyZWUgdG8gdXNlIHRoaXMgY29kZSBhcyBsb25nIGFzIHlvdSBwcm92aWRlIGEgbGluayB0bwogICAgLy8gaHR0cDovL3d3dy5pbnRlcm1hcHBlci5jb20KICAgIC8vIGh0dHA6Ly9pbnRlcm1hcHBlci5jb20vc3VwcG9ydC90b29scy9JUFY2LVZhbGlkYXRvci5hc3B4CiAgICAvLyBodHRwOi8vZG93bmxvYWQuZGFydHdhcmUuY29tL3RoaXJkcGFydHkvaXB2NnZhbGlkYXRvci5qcwoKICAgIHZhciBfYWRkcmVzcyA9IGFkZHJlc3MudG9Mb3dlckNhc2UoKTsKICAgIHZhciBzZWdtZW50cyA9IF9hZGRyZXNzLnNwbGl0KCc6Jyk7CiAgICB2YXIgbGVuZ3RoID0gc2VnbWVudHMubGVuZ3RoOwogICAgdmFyIHRvdGFsID0gODsKCiAgICAvLyB0cmltIGNvbG9ucyAoOjogb3IgOjphOmI6Y+KApiBvciDigKZhOmI6Yzo6KQogICAgaWYgKHNlZ21lbnRzWzBdID09PSAnJyAmJiBzZWdtZW50c1sxXSA9PT0gJycgJiYgc2VnbWVudHNbMl0gPT09ICcnKSB7CiAgICAgIC8vIG11c3QgaGF2ZSBiZWVuIDo6CiAgICAgIC8vIHJlbW92ZSBmaXJzdCB0d28gaXRlbXMKICAgICAgc2VnbWVudHMuc2hpZnQoKTsKICAgICAgc2VnbWVudHMuc2hpZnQoKTsKICAgIH0gZWxzZSBpZiAoc2VnbWVudHNbMF0gPT09ICcnICYmIHNlZ21lbnRzWzFdID09PSAnJykgewogICAgICAvLyBtdXN0IGhhdmUgYmVlbiA6Onh4eHgKICAgICAgLy8gcmVtb3ZlIHRoZSBmaXJzdCBpdGVtCiAgICAgIHNlZ21lbnRzLnNoaWZ0KCk7CiAgICB9IGVsc2UgaWYgKHNlZ21lbnRzW2xlbmd0aCAtIDFdID09PSAnJyAmJiBzZWdtZW50c1tsZW5ndGggLSAyXSA9PT0gJycpIHsKICAgICAgLy8gbXVzdCBoYXZlIGJlZW4geHh4eDo6CiAgICAgIHNlZ21lbnRzLnBvcCgpOwogICAgfQoKICAgIGxlbmd0aCA9IHNlZ21lbnRzLmxlbmd0aDsKCiAgICAvLyBhZGp1c3QgdG90YWwgc2VnbWVudHMgZm9yIElQdjQgdHJhaWxlcgogICAgaWYgKHNlZ21lbnRzW2xlbmd0aCAtIDFdLmluZGV4T2YoJy4nKSAhPT0gLTEpIHsKICAgICAgLy8gZm91bmQgYSAiLiIgd2hpY2ggbWVhbnMgSVB2NAogICAgICB0b3RhbCA9IDc7CiAgICB9CgogICAgLy8gZmlsbCBlbXB0eSBzZWdtZW50cyB0aGVtIHdpdGggIjAwMDAiCiAgICB2YXIgcG9zOwogICAgZm9yIChwb3MgPSAwOyBwb3MgPCBsZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmIChzZWdtZW50c1twb3NdID09PSAnJykgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgaWYgKHBvcyA8IHRvdGFsKSB7CiAgICAgIHNlZ21lbnRzLnNwbGljZShwb3MsIDEsICcwMDAwJyk7CiAgICAgIHdoaWxlIChzZWdtZW50cy5sZW5ndGggPCB0b3RhbCkgewogICAgICAgIHNlZ21lbnRzLnNwbGljZShwb3MsIDAsICcwMDAwJyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBzdHJpcCBsZWFkaW5nIHplcm9zCiAgICB2YXIgX3NlZ21lbnRzOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3RhbDsgaSsrKSB7CiAgICAgIF9zZWdtZW50cyA9IHNlZ21lbnRzW2ldLnNwbGl0KCcnKTsKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICBpZiAoX3NlZ21lbnRzWzBdID09PSAnMCcgJiYgX3NlZ21lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIF9zZWdtZW50cy5zcGxpY2UoMCwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2VnbWVudHNbaV0gPSBfc2VnbWVudHMuam9pbignJyk7CiAgICB9CgogICAgLy8gZmluZCBsb25nZXN0IHNlcXVlbmNlIG9mIHplcm9lcyBhbmQgY29hbGVzY2UgdGhlbSBpbnRvIG9uZSBzZWdtZW50CiAgICB2YXIgYmVzdCA9IC0xOwogICAgdmFyIF9iZXN0ID0gMDsKICAgIHZhciBfY3VycmVudCA9IDA7CiAgICB2YXIgY3VycmVudCA9IC0xOwogICAgdmFyIGluemVyb2VzID0gZmFsc2U7CiAgICAvLyBpOyBhbHJlYWR5IGRlY2xhcmVkCgogICAgZm9yIChpID0gMDsgaSA8IHRvdGFsOyBpKyspIHsKICAgICAgaWYgKGluemVyb2VzKSB7CiAgICAgICAgaWYgKHNlZ21lbnRzW2ldID09PSAnMCcpIHsKICAgICAgICAgIF9jdXJyZW50ICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluemVyb2VzID0gZmFsc2U7CiAgICAgICAgICBpZiAoX2N1cnJlbnQgPiBfYmVzdCkgewogICAgICAgICAgICBiZXN0ID0gY3VycmVudDsKICAgICAgICAgICAgX2Jlc3QgPSBfY3VycmVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNlZ21lbnRzW2ldID09PSAnMCcpIHsKICAgICAgICAgIGluemVyb2VzID0gdHJ1ZTsKICAgICAgICAgIGN1cnJlbnQgPSBpOwogICAgICAgICAgX2N1cnJlbnQgPSAxOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChfY3VycmVudCA+IF9iZXN0KSB7CiAgICAgIGJlc3QgPSBjdXJyZW50OwogICAgICBfYmVzdCA9IF9jdXJyZW50OwogICAgfQoKICAgIGlmIChfYmVzdCA+IDEpIHsKICAgICAgc2VnbWVudHMuc3BsaWNlKGJlc3QsIF9iZXN0LCAnJyk7CiAgICB9CgogICAgbGVuZ3RoID0gc2VnbWVudHMubGVuZ3RoOwoKICAgIC8vIGFzc2VtYmxlIHJlbWFpbmluZyBzZWdtZW50cwogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgaWYgKHNlZ21lbnRzWzBdID09PSAnJykgewogICAgICByZXN1bHQgPSAnOic7CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdCArPSBzZWdtZW50c1tpXTsKICAgICAgaWYgKGkgPT09IGxlbmd0aCAtIDEpIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmVzdWx0ICs9ICc6JzsKICAgIH0KCiAgICBpZiAoc2VnbWVudHNbbGVuZ3RoIC0gMV0gPT09ICcnKSB7CiAgICAgIHJlc3VsdCArPSAnOic7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KICAgIGlmIChyb290LklQdjYgPT09IHRoaXMpIHsKICAgICAgcm9vdC5JUHY2ID0gX0lQdjY7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICByZXR1cm4gewogICAgYmVzdDogYmVzdFByZXNlbnRhdGlvbiwKICAgIG5vQ29uZmxpY3Q6IG5vQ29uZmxpY3QKICB9Owp9KTsKCn0se31dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyohCiAqIFVSSS5qcyAtIE11dGF0aW5nIFVSTHMKICogU2Vjb25kIExldmVsIERvbWFpbiAoU0xEKSBTdXBwb3J0CiAqCiAqIFZlcnNpb246IDEuMTguMAogKgogKiBBdXRob3I6IFJvZG5leSBSZWhtCiAqIFdlYjogaHR0cDovL21lZGlhbGl6ZS5naXRodWIuaW8vVVJJLmpzLwogKgogKiBMaWNlbnNlZCB1bmRlcgogKiAgIE1JVCBMaWNlbnNlIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UKICoKICovCgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAndXNlIHN0cmljdCc7CiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3VtZGpzL3VtZC9ibG9iL21hc3Rlci9yZXR1cm5FeHBvcnRzLmpzCgogIGlmICgodHlwZW9mIGV4cG9ydHMgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGV4cG9ydHMpKSA9PT0gJ29iamVjdCcpIHsKICAgIC8vIE5vZGUKICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuCiAgICBkZWZpbmUoZmFjdG9yeSk7CiAgfSBlbHNlIHsKICAgIC8vIEJyb3dzZXIgZ2xvYmFscyAocm9vdCBpcyB3aW5kb3cpCiAgICByb290LlNlY29uZExldmVsRG9tYWlucyA9IGZhY3Rvcnkocm9vdCk7CiAgfQp9KSh1bmRlZmluZWQsIGZ1bmN0aW9uIChyb290KSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBzYXZlIGN1cnJlbnQgU2Vjb25kTGV2ZWxEb21haW5zIHZhcmlhYmxlLCBpZiBhbnkKCiAgdmFyIF9TZWNvbmRMZXZlbERvbWFpbnMgPSByb290ICYmIHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zOwoKICB2YXIgU0xEID0gewogICAgLy8gbGlzdCBvZiBrbm93biBTZWNvbmQgTGV2ZWwgRG9tYWlucwogICAgLy8gY29udmVydGVkIGxpc3Qgb2YgU0xEcyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9nYXZpbmdtaWxsZXIvc2Vjb25kLWxldmVsLWRvbWFpbnMKICAgIC8vIC0tLS0KICAgIC8vIHB1YmxpY3N1ZmZpeC5vcmcgaXMgbW9yZSBjdXJyZW50IGFuZCBhY3R1YWxseSB1c2VkIGJ5IGEgY291cGxlIG9mIGJyb3dzZXJzIGludGVybmFsbHkuCiAgICAvLyBkb3duc2lkZSBpcyBpdCBhbHNvIGNvbnRhaW5zIGRvbWFpbnMgbGlrZSAiZHluZG5zLm9yZyIgLSB3aGljaCBpcyBmaW5lIGZvciB0aGUgc2VjdXJpdHkKICAgIC8vIGlzc3VlcyBicm93c2VyIGhhdmUgdG8gZGVhbCB3aXRoIChTT1AgZm9yIGNvb2tpZXMsIGV0YykgLSBidXQgaXMgd2F5IG92ZXJib2FyZCBmb3IgVVJJLmpzCiAgICAvLyAtLS0tCiAgICBsaXN0OiB7CiAgICAgICdhYyc6ICcgY29tIGdvdiBtaWwgbmV0IG9yZyAnLAogICAgICAnYWUnOiAnIGFjIGNvIGdvdiBtaWwgbmFtZSBuZXQgb3JnIHBybyBzY2ggJywKICAgICAgJ2FmJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdhbCc6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgJywKICAgICAgJ2FvJzogJyBjbyBlZCBndiBpdCBvZyBwYiAnLAogICAgICAnYXInOiAnIGNvbSBlZHUgZ29iIGdvdiBpbnQgbWlsIG5ldCBvcmcgdHVyICcsCiAgICAgICdhdCc6ICcgYWMgY28gZ3Ygb3IgJywKICAgICAgJ2F1JzogJyBhc24gY29tIGNzaXJvIGVkdSBnb3YgaWQgbmV0IG9yZyAnLAogICAgICAnYmEnOiAnIGNvIGNvbSBlZHUgZ292IG1pbCBuZXQgb3JnIHJzIHVuYmkgdW5tbyB1bnNhIHVudHogdW56ZSAnLAogICAgICAnYmInOiAnIGJpeiBjbyBjb20gZWR1IGdvdiBpbmZvIG5ldCBvcmcgc3RvcmUgdHYgJywKICAgICAgJ2JoJzogJyBiaXogY2MgY29tIGVkdSBnb3YgaW5mbyBuZXQgb3JnICcsCiAgICAgICdibic6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnYm8nOiAnIGNvbSBlZHUgZ29iIGdvdiBpbnQgbWlsIG5ldCBvcmcgdHYgJywKICAgICAgJ2JyJzogJyBhZG0gYWR2IGFnciBhbSBhcnEgYXJ0IGF0byBiIGJpbyBibG9nIGJtZCBjaW0gY25nIGNudCBjb20gY29vcCBlY24gZWR1IGVuZyBlc3AgZXRjIGV0aSBmYXIgZmxvZyBmbSBmbmQgZm90IGZzdCBnMTIgZ2dmIGdvdiBpbWIgaW5kIGluZiBqb3IganVzIGxlbCBtYXQgbWVkIG1pbCBtdXMgbmV0IG5vbSBub3QgbnRyIG9kbyBvcmcgcHBnIHBybyBwc2MgcHNpIHFzbCByZWMgc2xnIHNydiB0bXAgdHJkIHR1ciB0diB2ZXQgdmxvZyB3aWtpIHpsZyAnLAogICAgICAnYnMnOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2J6JzogJyBkdSBldCBvbSBvdiByZyAnLAogICAgICAnY2EnOiAnIGFiIGJjIG1iIG5iIG5mIG5sIG5zIG50IG51IG9uIHBlIHFjIHNrIHlrICcsCiAgICAgICdjayc6ICcgYml6IGNvIGVkdSBnZW4gZ292IGluZm8gbmV0IG9yZyAnLAogICAgICAnY24nOiAnIGFjIGFoIGJqIGNvbSBjcSBlZHUgZmogZ2QgZ292IGdzIGd4IGd6IGhhIGhiIGhlIGhpIGhsIGhuIGpsIGpzIGp4IGxuIG1pbCBuZXQgbm0gbnggb3JnIHFoIHNjIHNkIHNoIHNuIHN4IHRqIHR3IHhqIHh6IHluIHpqICcsCiAgICAgICdjbyc6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBub20gb3JnICcsCiAgICAgICdjcic6ICcgYWMgYyBjbyBlZCBmaSBnbyBvciBzYSAnLAogICAgICAnY3knOiAnIGFjIGJpeiBjb20gZWtsb2dlcyBnb3YgbHRkIG5hbWUgbmV0IG9yZyBwYXJsaWFtZW50IHByZXNzIHBybyB0bSAnLAogICAgICAnZG8nOiAnIGFydCBjb20gZWR1IGdvYiBnb3YgbWlsIG5ldCBvcmcgc2xkIHdlYiAnLAogICAgICAnZHonOiAnIGFydCBhc3NvIGNvbSBlZHUgZ292IG5ldCBvcmcgcG9sICcsCiAgICAgICdlYyc6ICcgY29tIGVkdSBmaW4gZ292IGluZm8gbWVkIG1pbCBuZXQgb3JnIHBybyAnLAogICAgICAnZWcnOiAnIGNvbSBlZHUgZXVuIGdvdiBtaWwgbmFtZSBuZXQgb3JnIHNjaSAnLAogICAgICAnZXInOiAnIGNvbSBlZHUgZ292IGluZCBtaWwgbmV0IG9yZyByb2NoZXN0IHcgJywKICAgICAgJ2VzJzogJyBjb20gZWR1IGdvYiBub20gb3JnICcsCiAgICAgICdldCc6ICcgYml6IGNvbSBlZHUgZ292IGluZm8gbmFtZSBuZXQgb3JnICcsCiAgICAgICdmaic6ICcgYWMgYml6IGNvbSBpbmZvIG1pbCBuYW1lIG5ldCBvcmcgcHJvICcsCiAgICAgICdmayc6ICcgYWMgY28gZ292IG5ldCBub20gb3JnICcsCiAgICAgICdmcic6ICcgYXNzbyBjb20gZiBnb3V2IG5vbSBwcmQgcHJlc3NlIHRtICcsCiAgICAgICdnZyc6ICcgY28gbmV0IG9yZyAnLAogICAgICAnZ2gnOiAnIGNvbSBlZHUgZ292IG1pbCBvcmcgJywKICAgICAgJ2duJzogJyBhYyBjb20gZ292IG5ldCBvcmcgJywKICAgICAgJ2dyJzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG9yZyAnLAogICAgICAnZ3QnOiAnIGNvbSBlZHUgZ29iIGluZCBtaWwgbmV0IG9yZyAnLAogICAgICAnZ3UnOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2hrJzogJyBjb20gZWR1IGdvdiBpZHYgbmV0IG9yZyAnLAogICAgICAnaHUnOiAnIDIwMDAgYWdyYXIgYm9sdCBjYXNpbm8gY2l0eSBjbyBlcm90aWNhIGVyb3Rpa2EgZmlsbSBmb3J1bSBnYW1lcyBob3RlbCBpbmZvIGluZ2F0bGFuIGpvZ2FzeiBrb255dmVsbyBsYWthcyBtZWRpYSBuZXdzIG9yZyBwcml2IHJla2xhbSBzZXggc2hvcCBzcG9ydCBzdWxpIHN6ZXggdG0gdG96c2RlIHV0YXphcyB2aWRlbyAnLAogICAgICAnaWQnOiAnIGFjIGNvIGdvIG1pbCBuZXQgb3Igc2NoIHdlYiAnLAogICAgICAnaWwnOiAnIGFjIGNvIGdvdiBpZGYgazEyIG11bmkgbmV0IG9yZyAnLAogICAgICAnaW4nOiAnIGFjIGNvIGVkdSBlcm5ldCBmaXJtIGdlbiBnb3YgaSBpbmQgbWlsIG5ldCBuaWMgb3JnIHJlcyAnLAogICAgICAnaXEnOiAnIGNvbSBlZHUgZ292IGkgbWlsIG5ldCBvcmcgJywKICAgICAgJ2lyJzogJyBhYyBjbyBkbnNzZWMgZ292IGkgaWQgbmV0IG9yZyBzY2ggJywKICAgICAgJ2l0JzogJyBlZHUgZ292ICcsCiAgICAgICdqZSc6ICcgY28gbmV0IG9yZyAnLAogICAgICAnam8nOiAnIGNvbSBlZHUgZ292IG1pbCBuYW1lIG5ldCBvcmcgc2NoICcsCiAgICAgICdqcCc6ICcgYWMgYWQgY28gZWQgZ28gZ3IgbGcgbmUgb3IgJywKICAgICAgJ2tlJzogJyBhYyBjbyBnbyBpbmZvIG1lIG1vYmkgbmUgb3Igc2MgJywKICAgICAgJ2toJzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG9yZyBwZXIgJywKICAgICAgJ2tpJzogJyBiaXogY29tIGRlIGVkdSBnb3YgaW5mbyBtb2IgbmV0IG9yZyB0ZWwgJywKICAgICAgJ2ttJzogJyBhc3NvIGNvbSBjb29wIGVkdSBnb3V2IGsgbWVkZWNpbiBtaWwgbm9tIG5vdGFpcmVzIHBoYXJtYWNpZW5zIHByZXNzZSB0bSB2ZXRlcmluYWlyZSAnLAogICAgICAna24nOiAnIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAna3InOiAnIGFjIGJ1c2FuIGNodW5nYnVrIGNodW5nbmFtIGNvIGRhZWd1IGRhZWplb24gZXMgZ2FuZ3dvbiBnbyBnd2FuZ2p1IGd5ZW9uZ2J1ayBneWVvbmdnaSBneWVvbmduYW0gaHMgaW5jaGVvbiBqZWp1IGplb25idWsgamVvbm5hbSBrIGtnIG1pbCBtcyBuZSBvciBwZSByZSBzYyBzZW91bCB1bHNhbiAnLAogICAgICAna3cnOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2t5JzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdreic6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgJywKICAgICAgJ2xiJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdsayc6ICcgYXNzbiBjb20gZWR1IGdvdiBncnAgaG90ZWwgaW50IGx0ZCBuZXQgbmdvIG9yZyBzY2ggc29jIHdlYiAnLAogICAgICAnbHInOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ2x2JzogJyBhc24gY29tIGNvbmYgZWR1IGdvdiBpZCBtaWwgbmV0IG9yZyAnLAogICAgICAnbHknOiAnIGNvbSBlZHUgZ292IGlkIG1lZCBuZXQgb3JnIHBsYyBzY2ggJywKICAgICAgJ21hJzogJyBhYyBjbyBnb3YgbSBuZXQgb3JnIHByZXNzICcsCiAgICAgICdtYyc6ICcgYXNzbyB0bSAnLAogICAgICAnbWUnOiAnIGFjIGNvIGVkdSBnb3YgaXRzIG5ldCBvcmcgcHJpdiAnLAogICAgICAnbWcnOiAnIGNvbSBlZHUgZ292IG1pbCBub20gb3JnIHByZCB0bSAnLAogICAgICAnbWsnOiAnIGNvbSBlZHUgZ292IGluZiBuYW1lIG5ldCBvcmcgcHJvICcsCiAgICAgICdtbCc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyBwcmVzc2UgJywKICAgICAgJ21uJzogJyBlZHUgZ292IG9yZyAnLAogICAgICAnbW8nOiAnIGNvbSBlZHUgZ292IG5ldCBvcmcgJywKICAgICAgJ210JzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdtdic6ICcgYWVybyBiaXogY29tIGNvb3AgZWR1IGdvdiBpbmZvIGludCBtaWwgbXVzZXVtIG5hbWUgbmV0IG9yZyBwcm8gJywKICAgICAgJ213JzogJyBhYyBjbyBjb20gY29vcCBlZHUgZ292IGludCBtdXNldW0gbmV0IG9yZyAnLAogICAgICAnbXgnOiAnIGNvbSBlZHUgZ29iIG5ldCBvcmcgJywKICAgICAgJ215JzogJyBjb20gZWR1IGdvdiBtaWwgbmFtZSBuZXQgb3JnIHNjaCAnLAogICAgICAnbmYnOiAnIGFydHMgY29tIGZpcm0gaW5mbyBuZXQgb3RoZXIgcGVyIHJlYyBzdG9yZSB3ZWIgJywKICAgICAgJ25nJzogJyBiaXogY29tIGVkdSBnb3YgbWlsIG1vYmkgbmFtZSBuZXQgb3JnIHNjaCAnLAogICAgICAnbmknOiAnIGFjIGNvIGNvbSBlZHUgZ29iIG1pbCBuZXQgbm9tIG9yZyAnLAogICAgICAnbnAnOiAnIGNvbSBlZHUgZ292IG1pbCBuZXQgb3JnICcsCiAgICAgICducic6ICcgYml6IGNvbSBlZHUgZ292IGluZm8gbmV0IG9yZyAnLAogICAgICAnb20nOiAnIGFjIGJpeiBjbyBjb20gZWR1IGdvdiBtZWQgbWlsIG11c2V1bSBuZXQgb3JnIHBybyBzY2ggJywKICAgICAgJ3BlJzogJyBjb20gZWR1IGdvYiBtaWwgbmV0IG5vbSBvcmcgc2xkICcsCiAgICAgICdwaCc6ICcgY29tIGVkdSBnb3YgaSBtaWwgbmV0IG5nbyBvcmcgJywKICAgICAgJ3BrJzogJyBiaXogY29tIGVkdSBmYW0gZ29iIGdvayBnb24gZ29wIGdvcyBnb3YgbmV0IG9yZyB3ZWIgJywKICAgICAgJ3BsJzogJyBhcnQgYmlhbHlzdG9rIGJpeiBjb20gZWR1IGdkYSBnZGFuc2sgZ29yem93IGdvdiBpbmZvIGthdG93aWNlIGtyYWtvdyBsb2R6IGx1YmxpbiBtaWwgbmV0IG5nbyBvbHN6dHluIG9yZyBwb3puYW4gcHdyIHJhZG9tIHNsdXBzayBzemN6ZWNpbiB0b3J1biB3YXJzemF3YSB3YXcgd3JvYyB3cm9jbGF3IHpnb3JhICcsCiAgICAgICdwcic6ICcgYWMgYml6IGNvbSBlZHUgZXN0IGdvdiBpbmZvIGlzbGEgbmFtZSBuZXQgb3JnIHBybyBwcm9mICcsCiAgICAgICdwcyc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyBwbG8gc2VjICcsCiAgICAgICdwdyc6ICcgYmVsYXUgY28gZWQgZ28gbmUgb3IgJywKICAgICAgJ3JvJzogJyBhcnRzIGNvbSBmaXJtIGluZm8gbm9tIG50IG9yZyByZWMgc3RvcmUgdG0gd3d3ICcsCiAgICAgICdycyc6ICcgYWMgY28gZWR1IGdvdiBpbiBvcmcgJywKICAgICAgJ3NiJzogJyBjb20gZWR1IGdvdiBuZXQgb3JnICcsCiAgICAgICdzYyc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnc2gnOiAnIGNvIGNvbSBlZHUgZ292IG5ldCBub20gb3JnICcsCiAgICAgICdzbCc6ICcgY29tIGVkdSBnb3YgbmV0IG9yZyAnLAogICAgICAnc3QnOiAnIGNvIGNvbSBjb25zdWxhZG8gZWR1IGVtYmFpeGFkYSBnb3YgbWlsIG5ldCBvcmcgcHJpbmNpcGUgc2FvdG9tZSBzdG9yZSAnLAogICAgICAnc3YnOiAnIGNvbSBlZHUgZ29iIG9yZyByZWQgJywKICAgICAgJ3N6JzogJyBhYyBjbyBvcmcgJywKICAgICAgJ3RyJzogJyBhdiBiYnMgYmVsIGJpeiBjb20gZHIgZWR1IGdlbiBnb3YgaW5mbyBrMTIgbmFtZSBuZXQgb3JnIHBvbCB0ZWwgdHNrIHR2IHdlYiAnLAogICAgICAndHQnOiAnIGFlcm8gYml6IGNhdCBjbyBjb20gY29vcCBlZHUgZ292IGluZm8gaW50IGpvYnMgbWlsIG1vYmkgbXVzZXVtIG5hbWUgbmV0IG9yZyBwcm8gdGVsIHRyYXZlbCAnLAogICAgICAndHcnOiAnIGNsdWIgY29tIGViaXogZWR1IGdhbWUgZ292IGlkdiBtaWwgbmV0IG9yZyAnLAogICAgICAnbXUnOiAnIGFjIGNvIGNvbSBnb3YgbmV0IG9yIG9yZyAnLAogICAgICAnbXonOiAnIGFjIGNvIGVkdSBnb3Ygb3JnICcsCiAgICAgICduYSc6ICcgY28gY29tICcsCiAgICAgICdueic6ICcgYWMgY28gY3JpIGdlZWsgZ2VuIGdvdnQgaGVhbHRoIGl3aSBtYW9yaSBtaWwgbmV0IG9yZyBwYXJsaWFtZW50IHNjaG9vbCAnLAogICAgICAncGEnOiAnIGFibyBhYyBjb20gZWR1IGdvYiBpbmcgbWVkIG5ldCBub20gb3JnIHNsZCAnLAogICAgICAncHQnOiAnIGNvbSBlZHUgZ292IGludCBuZXQgbm9tZSBvcmcgcHVibCAnLAogICAgICAncHknOiAnIGNvbSBlZHUgZ292IG1pbCBuZXQgb3JnICcsCiAgICAgICdxYSc6ICcgY29tIGVkdSBnb3YgbWlsIG5ldCBvcmcgJywKICAgICAgJ3JlJzogJyBhc3NvIGNvbSBub20gJywKICAgICAgJ3J1JzogJyBhYyBhZHlnZXlhIGFsdGFpIGFtdXIgYXJraGFuZ2Vsc2sgYXN0cmFraGFuIGJhc2hraXJpYSBiZWxnb3JvZCBiaXIgYnJ5YW5zayBidXJ5YXRpYSBjYmcgY2hlbCBjaGVseWFiaW5zayBjaGl0YSBjaHVrb3RrYSBjaHV2YXNoaWEgY29tIGRhZ2VzdGFuIGUtYnVyZyBlZHUgZ292IGdyb3pueSBpbnQgaXJrdXRzayBpdmFub3ZvIGl6aGV2c2sgamFyIGpvc2hrYXItb2xhIGthbG15a2lhIGthbHVnYSBrYW1jaGF0a2Ega2FyZWxpYSBrYXphbiBrY2hyIGtlbWVyb3ZvIGtoYWJhcm92c2sga2hha2Fzc2lhIGtodiBraXJvdiBrb2VuaWcga29taSBrb3N0cm9tYSBrcmFub3lhcnNrIGt1YmFuIGt1cmdhbiBrdXJzayBsaXBldHNrIG1hZ2FkYW4gbWFyaSBtYXJpLWVsIG1hcmluZSBtaWwgbW9yZG92aWEgbW9zcmVnIG1zayBtdXJtYW5zayBuYWxjaGlrIG5ldCBubm92IG5vdiBub3Zvc2liaXJzayBuc2sgb21zayBvcmVuYnVyZyBvcmcgb3J5b2wgcGVuemEgcGVybSBwcCBwc2tvdiBwdHogcm5kIHJ5YXphbiBzYWtoYWxpbiBzYW1hcmEgc2FyYXRvdiBzaW1iaXJzayBzbW9sZW5zayBzcGIgc3RhdnJvcG9sIHN0diBzdXJndXQgdGFtYm92IHRhdGFyc3RhbiB0b20gdG9tc2sgdHNhcml0c3luIHRzayB0dWxhIHR1dmEgdHZlciB0eXVtZW4gdWRtIHVkbXVydGlhIHVsYW4tdWRlIHZsYWRpa2F2a2F6IHZsYWRpbWlyIHZsYWRpdm9zdG9rIHZvbGdvZ3JhZCB2b2xvZ2RhIHZvcm9uZXpoIHZybiB2eWF0a2EgeWFrdXRpYSB5YW1hbCB5ZWthdGVyaW5idXJnIHl1emhuby1zYWtoYWxpbnNrICcsCiAgICAgICdydyc6ICcgYWMgY28gY29tIGVkdSBnb3V2IGdvdiBpbnQgbWlsIG5ldCAnLAogICAgICAnc2EnOiAnIGNvbSBlZHUgZ292IG1lZCBuZXQgb3JnIHB1YiBzY2ggJywKICAgICAgJ3NkJzogJyBjb20gZWR1IGdvdiBpbmZvIG1lZCBuZXQgb3JnIHR2ICcsCiAgICAgICdzZSc6ICcgYSBhYyBiIGJkIGMgZCBlIGYgZyBoIGkgayBsIG0gbiBvIG9yZyBwIHBhcnRpIHBwIHByZXNzIHIgcyB0IHRtIHUgdyB4IHkgeiAnLAogICAgICAnc2cnOiAnIGNvbSBlZHUgZ292IGlkbiBuZXQgb3JnIHBlciAnLAogICAgICAnc24nOiAnIGFydCBjb20gZWR1IGdvdXYgb3JnIHBlcnNvIHVuaXYgJywKICAgICAgJ3N5JzogJyBjb20gZWR1IGdvdiBtaWwgbmV0IG5ld3Mgb3JnICcsCiAgICAgICd0aCc6ICcgYWMgY28gZ28gaW4gbWkgbmV0IG9yICcsCiAgICAgICd0aic6ICcgYWMgYml6IGNvIGNvbSBlZHUgZ28gZ292IGluZm8gaW50IG1pbCBuYW1lIG5ldCBuaWMgb3JnIHRlc3Qgd2ViICcsCiAgICAgICd0bic6ICcgYWdyaW5ldCBjb20gZGVmZW5zZSBlZHVuZXQgZW5zIGZpbiBnb3YgaW5kIGluZm8gaW50bCBtaW5jb20gbmF0IG5ldCBvcmcgcGVyc28gcm5ydCBybnMgcm51IHRvdXJpc20gJywKICAgICAgJ3R6JzogJyBhYyBjbyBnbyBuZSBvciAnLAogICAgICAndWEnOiAnIGJpeiBjaGVya2Fzc3kgY2hlcm5pZ292IGNoZXJub3Z0c3kgY2sgY24gY28gY29tIGNyaW1lYSBjdiBkbiBkbmVwcm9wZXRyb3ZzayBkb25ldHNrIGRwIGVkdSBnb3YgaWYgaW4gaXZhbm8tZnJhbmtpdnNrIGtoIGtoYXJrb3Yga2hlcnNvbiBraG1lbG5pdHNraXkga2lldiBraXJvdm9ncmFkIGttIGtyIGtzIGt2IGxnIGx1Z2Fuc2sgbHV0c2sgbHZpdiBtZSBtayBuZXQgbmlrb2xhZXYgb2Qgb2Rlc3NhIG9yZyBwbCBwb2x0YXZhIHBwIHJvdm5vIHJ2IHNlYmFzdG9wb2wgc3VteSB0ZSB0ZXJub3BpbCB1emhnb3JvZCB2aW5uaWNhIHZuIHphcG9yaXpoemhlIHpoaXRvbWlyIHpwIHp0ICcsCiAgICAgICd1Zyc6ICcgYWMgY28gZ28gbmUgb3Igb3JnIHNjICcsCiAgICAgICd1ayc6ICcgYWMgYmwgYnJpdGlzaC1saWJyYXJ5IGNvIGN5bSBnb3YgZ292dCBpY25ldCBqZXQgbGVhIGx0ZCBtZSBtaWwgbW9kIG5hdGlvbmFsLWxpYnJhcnktc2NvdGxhbmQgbmVsIG5ldCBuaHMgbmljIG5scyBvcmcgb3JnbiBwYXJsaWFtZW50IHBsYyBwb2xpY2Ugc2NoIHNjb3Qgc29jICcsCiAgICAgICd1cyc6ICcgZG5pIGZlZCBpc2Ega2lkcyBuc24gJywKICAgICAgJ3V5JzogJyBjb20gZWR1IGd1YiBtaWwgbmV0IG9yZyAnLAogICAgICAndmUnOiAnIGNvIGNvbSBlZHUgZ29iIGluZm8gbWlsIG5ldCBvcmcgd2ViICcsCiAgICAgICd2aSc6ICcgY28gY29tIGsxMiBuZXQgb3JnICcsCiAgICAgICd2bic6ICcgYWMgYml6IGNvbSBlZHUgZ292IGhlYWx0aCBpbmZvIGludCBuYW1lIG5ldCBvcmcgcHJvICcsCiAgICAgICd5ZSc6ICcgY28gY29tIGdvdiBsdGQgbWUgbmV0IG9yZyBwbGMgJywKICAgICAgJ3l1JzogJyBhYyBjbyBlZHUgZ292IG9yZyAnLAogICAgICAnemEnOiAnIGFjIGFncmljIGFsdCBib3Vyc2UgY2l0eSBjbyBjeWJlcm5ldCBkYiBlZHUgZ292IGdyb25kYXIgaWFjY2VzcyBpbXQgaW5jYSBsYW5kZXNpZ24gbGF3IG1pbCBuZXQgbmdvIG5pcyBub20gb2xpdmV0dGkgb3JnIHBpeCBzY2hvb2wgdG0gd2ViICcsCiAgICAgICd6bSc6ICcgYWMgY28gY29tIGVkdSBnb3YgbmV0IG9yZyBzY2ggJwogICAgfSwKICAgIC8vIGdvcmhpbGwgMjAxMy0xMC0yNTogVXNpbmcgaW5kZXhPZigpIGluc3RlYWQgUmVnZXhwKCkuIFNpZ25pZmljYW50IGJvb3N0CiAgICAvLyBpbiBib3RoIHBlcmZvcm1hbmNlIGFuZCBtZW1vcnkgZm9vdHByaW50LiBObyBpbml0aWFsaXphdGlvbiByZXF1aXJlZC4KICAgIC8vIGh0dHA6Ly9qc3BlcmYuY29tL3VyaS1qcy1zbGQtcmVnZXgtdnMtYmluYXJ5LXNlYXJjaC80CiAgICAvLyBGb2xsb3dpbmcgbWV0aG9kcyB1c2UgbGFzdEluZGV4T2YoKSByYXRoZXIgdGhhbiBhcnJheS5zcGxpdCgpIGluIG9yZGVyCiAgICAvLyB0byBhdm9pZCBhbnkgbWVtb3J5IGFsbG9jYXRpb25zLgogICAgaGFzOiBmdW5jdGlvbiBoYXMoZG9tYWluKSB7CiAgICAgIHZhciB0bGRPZmZzZXQgPSBkb21haW4ubGFzdEluZGV4T2YoJy4nKTsKICAgICAgaWYgKHRsZE9mZnNldCA8PSAwIHx8IHRsZE9mZnNldCA+PSBkb21haW4ubGVuZ3RoIC0gMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgc2xkT2Zmc2V0ID0gZG9tYWluLmxhc3RJbmRleE9mKCcuJywgdGxkT2Zmc2V0IC0gMSk7CiAgICAgIGlmIChzbGRPZmZzZXQgPD0gMCB8fCBzbGRPZmZzZXQgPj0gdGxkT2Zmc2V0IC0gMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgc2xkTGlzdCA9IFNMRC5saXN0W2RvbWFpbi5zbGljZSh0bGRPZmZzZXQgKyAxKV07CiAgICAgIGlmICghc2xkTGlzdCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gc2xkTGlzdC5pbmRleE9mKCcgJyArIGRvbWFpbi5zbGljZShzbGRPZmZzZXQgKyAxLCB0bGRPZmZzZXQpICsgJyAnKSA+PSAwOwogICAgfSwKICAgIGlzOiBmdW5jdGlvbiBpcyhkb21haW4pIHsKICAgICAgdmFyIHRsZE9mZnNldCA9IGRvbWFpbi5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAodGxkT2Zmc2V0IDw9IDAgfHwgdGxkT2Zmc2V0ID49IGRvbWFpbi5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBzbGRPZmZzZXQgPSBkb21haW4ubGFzdEluZGV4T2YoJy4nLCB0bGRPZmZzZXQgLSAxKTsKICAgICAgaWYgKHNsZE9mZnNldCA+PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBzbGRMaXN0ID0gU0xELmxpc3RbZG9tYWluLnNsaWNlKHRsZE9mZnNldCArIDEpXTsKICAgICAgaWYgKCFzbGRMaXN0KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiBzbGRMaXN0LmluZGV4T2YoJyAnICsgZG9tYWluLnNsaWNlKDAsIHRsZE9mZnNldCkgKyAnICcpID49IDA7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoZG9tYWluKSB7CiAgICAgIHZhciB0bGRPZmZzZXQgPSBkb21haW4ubGFzdEluZGV4T2YoJy4nKTsKICAgICAgaWYgKHRsZE9mZnNldCA8PSAwIHx8IHRsZE9mZnNldCA+PSBkb21haW4ubGVuZ3RoIC0gMSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBzbGRPZmZzZXQgPSBkb21haW4ubGFzdEluZGV4T2YoJy4nLCB0bGRPZmZzZXQgLSAxKTsKICAgICAgaWYgKHNsZE9mZnNldCA8PSAwIHx8IHNsZE9mZnNldCA+PSB0bGRPZmZzZXQgLSAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIHNsZExpc3QgPSBTTEQubGlzdFtkb21haW4uc2xpY2UodGxkT2Zmc2V0ICsgMSldOwogICAgICBpZiAoIXNsZExpc3QpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoc2xkTGlzdC5pbmRleE9mKCcgJyArIGRvbWFpbi5zbGljZShzbGRPZmZzZXQgKyAxLCB0bGRPZmZzZXQpICsgJyAnKSA8IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gZG9tYWluLnNsaWNlKHNsZE9mZnNldCArIDEpOwogICAgfSwKICAgIG5vQ29uZmxpY3Q6IGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAgIGlmIChyb290LlNlY29uZExldmVsRG9tYWlucyA9PT0gdGhpcykgewogICAgICAgIHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zID0gX1NlY29uZExldmVsRG9tYWluczsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwoKICByZXR1cm4gU0xEOwp9KTsKCn0se31dLDExOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyohCiAqIFVSSS5qcyAtIE11dGF0aW5nIFVSTHMKICoKICogVmVyc2lvbjogMS4xOC4wCiAqCiAqIEF1dGhvcjogUm9kbmV5IFJlaG0KICogV2ViOiBodHRwOi8vbWVkaWFsaXplLmdpdGh1Yi5pby9VUkkuanMvCiAqCiAqIExpY2Vuc2VkIHVuZGVyCiAqICAgTUlUIExpY2Vuc2UgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZQogKgogKi8KKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgJ3VzZSBzdHJpY3QnOwogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS91bWRqcy91bWQvYmxvYi9tYXN0ZXIvcmV0dXJuRXhwb3J0cy5qcwoKICBpZiAoKHR5cGVvZiBleHBvcnRzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihleHBvcnRzKSkgPT09ICdvYmplY3QnKSB7CiAgICAvLyBOb2RlCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnLi9wdW55Y29kZScpLCByZXF1aXJlKCcuL0lQdjYnKSwgcmVxdWlyZSgnLi9TZWNvbmRMZXZlbERvbWFpbnMnKSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShbJy4vcHVueWNvZGUnLCAnLi9JUHY2JywgJy4vU2Vjb25kTGV2ZWxEb21haW5zJ10sIGZhY3RvcnkpOwogIH0gZWxzZSB7CiAgICAvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KQogICAgcm9vdC5VUkkgPSBmYWN0b3J5KHJvb3QucHVueWNvZGUsIHJvb3QuSVB2Niwgcm9vdC5TZWNvbmRMZXZlbERvbWFpbnMsIHJvb3QpOwogIH0KfSkodW5kZWZpbmVkLCBmdW5jdGlvbiAocHVueWNvZGUsIElQdjYsIFNMRCwgcm9vdCkgewogICd1c2Ugc3RyaWN0JzsKICAvKmdsb2JhbCBsb2NhdGlvbiwgZXNjYXBlLCB1bmVzY2FwZSAqLwogIC8vIEZJWE1FOiB2Mi4wLjAgcmVuYW1jZSBub24tY2FtZWxDYXNlIHByb3BlcnRpZXMgdG8gdXBwZXJjYXNlCiAgLypqc2hpbnQgY2FtZWxjYXNlOiBmYWxzZSAqLwoKICAvLyBzYXZlIGN1cnJlbnQgVVJJIHZhcmlhYmxlLCBpZiBhbnkKCiAgdmFyIF9VUkkgPSByb290ICYmIHJvb3QuVVJJOwoKICBmdW5jdGlvbiBVUkkodXJsLCBiYXNlKSB7CiAgICB2YXIgX3VybFN1cHBsaWVkID0gYXJndW1lbnRzLmxlbmd0aCA+PSAxOwogICAgdmFyIF9iYXNlU3VwcGxpZWQgPSBhcmd1bWVudHMubGVuZ3RoID49IDI7CgogICAgLy8gQWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IHRoZSAnbmV3JyBrZXl3b3JkCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVVJJKSkgewogICAgICBpZiAoX3VybFN1cHBsaWVkKSB7CiAgICAgICAgaWYgKF9iYXNlU3VwcGxpZWQpIHsKICAgICAgICAgIHJldHVybiBuZXcgVVJJKHVybCwgYmFzZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3IFVSSSh1cmwpOwogICAgICB9CgogICAgICByZXR1cm4gbmV3IFVSSSgpOwogICAgfQoKICAgIGlmICh1cmwgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoX3VybFN1cHBsaWVkKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndW5kZWZpbmVkIGlzIG5vdCBhIHZhbGlkIGFyZ3VtZW50IGZvciBVUkknKTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB1cmwgPSBsb2NhdGlvbi5ocmVmICsgJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXJsID0gJyc7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmhyZWYodXJsKTsKCiAgICAvLyByZXNvbHZlIHRvIGJhc2UgYWNjb3JkaW5nIHRvIGh0dHA6Ly9kdmNzLnczLm9yZy9oZy91cmwvcmF3LWZpbGUvdGlwL092ZXJ2aWV3Lmh0bWwjY29uc3RydWN0b3IKICAgIGlmIChiYXNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuYWJzb2x1dGVUbyhiYXNlKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIFVSSS52ZXJzaW9uID0gJzEuMTguMCc7CgogIHZhciBwID0gVVJJLnByb3RvdHlwZTsKICB2YXIgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCiAgZnVuY3Rpb24gZXNjYXBlUmVnRXgoc3RyaW5nKSB7CiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWVkaWFsaXplL1VSSS5qcy9jb21taXQvODVhYzIxNzgzYzExZjhjY2FiMDYxMDZkYmE5NzM1YTMxYTg2OTI0ZCNjb21taXRjb21tZW50LTgyMTk2MwogICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC8oWy4qKz9ePSE6JHt9KCl8W1xdXC9cXF0pL2csICdcXCQxJyk7CiAgfQoKICBmdW5jdGlvbiBnZXRUeXBlKHZhbHVlKSB7CiAgICAvLyBJRTggZG9lc24ndCByZXR1cm4gW09iamVjdCBVbmRlZmluZWRdIGJ1dCBbT2JqZWN0IE9iamVjdF0gZm9yIHVuZGVmaW5lZCB2YWx1ZQogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuICdVbmRlZmluZWQnOwogICAgfQoKICAgIHJldHVybiBTdHJpbmcoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSkuc2xpY2UoOCwgLTEpOwogIH0KCiAgZnVuY3Rpb24gaXNBcnJheShvYmopIHsKICAgIHJldHVybiBnZXRUeXBlKG9iaikgPT09ICdBcnJheSc7CiAgfQoKICBmdW5jdGlvbiBmaWx0ZXJBcnJheVZhbHVlcyhkYXRhLCB2YWx1ZSkgewogICAgdmFyIGxvb2t1cCA9IHt9OwogICAgdmFyIGksIGxlbmd0aDsKCiAgICBpZiAoZ2V0VHlwZSh2YWx1ZSkgPT09ICdSZWdFeHAnKSB7CiAgICAgIGxvb2t1cCA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgbG9va3VwW3ZhbHVlW2ldXSA9IHRydWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxvb2t1cFt2YWx1ZV0gPSB0cnVlOwogICAgfQoKICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgLypqc2hpbnQgbGF4YnJlYWs6IHRydWUgKi8KICAgICAgdmFyIF9tYXRjaCA9IGxvb2t1cCAmJiBsb29rdXBbZGF0YVtpXV0gIT09IHVuZGVmaW5lZCB8fCAhbG9va3VwICYmIHZhbHVlLnRlc3QoZGF0YVtpXSk7CiAgICAgIC8qanNoaW50IGxheGJyZWFrOiBmYWxzZSAqLwogICAgICBpZiAoX21hdGNoKSB7CiAgICAgICAgZGF0YS5zcGxpY2UoaSwgMSk7CiAgICAgICAgbGVuZ3RoLS07CiAgICAgICAgaS0tOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRhdGE7CiAgfQoKICBmdW5jdGlvbiBhcnJheUNvbnRhaW5zKGxpc3QsIHZhbHVlKSB7CiAgICB2YXIgaSwgbGVuZ3RoOwoKICAgIC8vIHZhbHVlIG1heSBiZSBzdHJpbmcsIG51bWJlciwgYXJyYXksIHJlZ2V4cAogICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgIC8vIE5vdGU6IHRoaXMgY2FuIGJlIG9wdGltaXplZCB0byBPKG4pIChpbnN0ZWFkIG9mIGN1cnJlbnQgTyhtICogbikpCiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFhcnJheUNvbnRhaW5zKGxpc3QsIHZhbHVlW2ldKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgdmFyIF90eXBlID0gZ2V0VHlwZSh2YWx1ZSk7CiAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChfdHlwZSA9PT0gJ1JlZ0V4cCcpIHsKICAgICAgICBpZiAodHlwZW9mIGxpc3RbaV0gPT09ICdzdHJpbmcnICYmIGxpc3RbaV0ubWF0Y2godmFsdWUpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobGlzdFtpXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGFycmF5c0VxdWFsKG9uZSwgdHdvKSB7CiAgICBpZiAoIWlzQXJyYXkob25lKSB8fCAhaXNBcnJheSh0d28pKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBhcnJheXMgY2FuJ3QgYmUgZXF1YWwgaWYgdGhleSBoYXZlIGRpZmZlcmVudCBhbW91bnQgb2YgY29udGVudAogICAgaWYgKG9uZS5sZW5ndGggIT09IHR3by5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIG9uZS5zb3J0KCk7CiAgICB0d28uc29ydCgpOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gb25lLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAob25lW2ldICE9PSB0d29baV0pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHRyaW1TbGFzaGVzKHRleHQpIHsKICAgIHZhciB0cmltX2V4cHJlc3Npb24gPSAvXlwvK3xcLyskL2c7CiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHRyaW1fZXhwcmVzc2lvbiwgJycpOwogIH0KCiAgVVJJLl9wYXJ0cyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIHByb3RvY29sOiBudWxsLAogICAgICB1c2VybmFtZTogbnVsbCwKICAgICAgcGFzc3dvcmQ6IG51bGwsCiAgICAgIGhvc3RuYW1lOiBudWxsLAogICAgICB1cm46IG51bGwsCiAgICAgIHBvcnQ6IG51bGwsCiAgICAgIHBhdGg6IG51bGwsCiAgICAgIHF1ZXJ5OiBudWxsLAogICAgICBmcmFnbWVudDogbnVsbCwKICAgICAgLy8gc3RhdGUKICAgICAgZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzOiBVUkkuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLAogICAgICBlc2NhcGVRdWVyeVNwYWNlOiBVUkkuZXNjYXBlUXVlcnlTcGFjZQogICAgfTsKICB9OwogIC8vIHN0YXRlOiBhbGxvdyBkdXBsaWNhdGUgcXVlcnkgcGFyYW1ldGVycyAoYT0xJmE9MSkKICBVUkkuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzID0gZmFsc2U7CiAgLy8gc3RhdGU6IHJlcGxhY2VzICsgd2l0aCAlMjAgKHNwYWNlIGluIHF1ZXJ5IHN0cmluZ3MpCiAgVVJJLmVzY2FwZVF1ZXJ5U3BhY2UgPSB0cnVlOwogIC8vIHN0YXRpYyBwcm9wZXJ0aWVzCiAgVVJJLnByb3RvY29sX2V4cHJlc3Npb24gPSAvXlthLXpdW2EtejAtOS4rLV0qJC9pOwogIFVSSS5pZG5fZXhwcmVzc2lvbiA9IC9bXmEtejAtOVwuLV0vaTsKICBVUkkucHVueWNvZGVfZXhwcmVzc2lvbiA9IC8oeG4tLSkvaTsKICAvLyB3ZWxsLCAzMzMuNDQ0LjU1NS42NjYgbWF0Y2hlcywgYnV0IGl0IHN1cmUgYWluJ3Qgbm8gSVB2NCAtIGRvIHdlIGNhcmU/CiAgVVJJLmlwNF9leHByZXNzaW9uID0gL15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JC87CiAgLy8gY3JlZGl0cyB0byBSaWNoIEJyb3duCiAgLy8gc291cmNlOiBodHRwOi8vZm9ydW1zLmludGVybWFwcGVyLmNvbS92aWV3dG9waWMucGhwP3A9MTA5NiMxMDk2CiAgLy8gc3BlY2lmaWNhdGlvbjogaHR0cDovL3d3dy5pZXRmLm9yZy9yZmMvcmZjNDI5MS50eHQKICBVUkkuaXA2X2V4cHJlc3Npb24gPSAvXlxzKigoKFswLTlBLUZhLWZdezEsNH06KXs3fShbMC05QS1GYS1mXXsxLDR9fDopKXwoKFswLTlBLUZhLWZdezEsNH06KXs2fSg6WzAtOUEtRmEtZl17MSw0fXwoKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSl8OikpfCgoWzAtOUEtRmEtZl17MSw0fTopezV9KCgoOlswLTlBLUZhLWZdezEsNH0pezEsMn0pfDooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSl8OikpfCgoWzAtOUEtRmEtZl17MSw0fTopezR9KCgoOlswLTlBLUZhLWZdezEsNH0pezEsM30pfCgoOlswLTlBLUZhLWZdezEsNH0pPzooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSkpfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXszfSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDR9KXwoKDpbMC05QS1GYS1mXXsxLDR9KXswLDJ9OigoMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkoXC4oMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkpezN9KSl8OikpfCgoWzAtOUEtRmEtZl17MSw0fTopezJ9KCgoOlswLTlBLUZhLWZdezEsNH0pezEsNX0pfCgoOlswLTlBLUZhLWZdezEsNH0pezAsM306KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pKXw6KSl8KChbMC05QS1GYS1mXXsxLDR9Oil7MX0oKCg6WzAtOUEtRmEtZl17MSw0fSl7MSw2fSl8KCg6WzAtOUEtRmEtZl17MSw0fSl7MCw0fTooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0/XGQpKXszfSkpfDopKXwoOigoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDd9KXwoKDpbMC05QS1GYS1mXXsxLDR9KXswLDV9OigoMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkoXC4oMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkpezN9KSl8OikpKSglLispP1xzKiQvOwogIC8vIGV4cHJlc3Npb24gdXNlZCBpcyAiZ3J1YmVyIHJldmlzZWQiIChAZ3J1YmVyIHYyKSBkZXRlcm1pbmVkIHRvIGJlIHRoZQogIC8vIGJlc3Qgc29sdXRpb24gaW4gYSByZWdleC1nb2xmIHdlIGRpZCBhIGNvdXBsZSBvZiBhZ2VzIGFnbyBhdAogIC8vICogaHR0cDovL21hdGhpYXNieW5lbnMuYmUvZGVtby91cmwtcmVnZXgKICAvLyAqIGh0dHA6Ly9yb2RuZXlyZWhtLmRlL3QvdXJsLXJlZ2V4Lmh0bWwKICBVUkkuZmluZF91cmlfZXhwcmVzc2lvbiA9IC9cYigoPzpbYS16XVtcdy1dKzooPzpcL3sxLDN9fFthLXowLTklXSl8d3d3XGR7MCwzfVsuXXxbYS16MC05LlwtXStbLl1bYS16XXsyLDR9XC8pKD86W15ccygpPD5dK3xcKChbXlxzKCk8Pl0rfChcKFteXHMoKTw+XStcKSkpKlwpKSsoPzpcKChbXlxzKCk8Pl0rfChcKFteXHMoKTw+XStcKSkpKlwpfFteXHNgISgpXFtcXXt9OzonIi4sPD4/wqvCu+KAnOKAneKAmOKAmV0pKS9pZzsKICBVUkkuZmluZFVyaSA9IHsKICAgIC8vIHZhbGlkICJzY2hlbWU6Ly8iIG9yICJ3d3cuIgogICAgc3RhcnQ6IC9cYig/OihbYS16XVthLXowLTkuKy1dKjpcL1wvKXx3d3dcLikvZ2ksCiAgICAvLyBldmVyeXRoaW5nIHVwIHRvIHRoZSBuZXh0IHdoaXRlc3BhY2UKICAgIGVuZDogL1tcc1xyXG5dfCQvLAogICAgLy8gdHJpbSB0cmFpbGluZyBwdW5jdHVhdGlvbiBjYXB0dXJlZCBieSBlbmQgUmVnRXhwCiAgICB0cmltOiAvW2AhKClcW1xde307OiciLiw8Pj/Cq8K74oCc4oCd4oCe4oCY4oCZXSskLwogIH07CiAgLy8gaHR0cDovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy91cmktc2NoZW1lcy5odG1sCiAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX1RDUF9hbmRfVURQX3BvcnRfbnVtYmVycyNXZWxsLWtub3duX3BvcnRzCiAgVVJJLmRlZmF1bHRQb3J0cyA9IHsKICAgIGh0dHA6ICc4MCcsCiAgICBodHRwczogJzQ0MycsCiAgICBmdHA6ICcyMScsCiAgICBnb3BoZXI6ICc3MCcsCiAgICB3czogJzgwJywKICAgIHdzczogJzQ0MycKICB9OwogIC8vIGFsbG93ZWQgaG9zdG5hbWUgY2hhcmFjdGVycyBhY2NvcmRpbmcgdG8gUkZDIDM5ODYKICAvLyBBTFBIQSBESUdJVCAiLSIgIi4iICJfIiAifiIgIiEiICIkIiAiJiIgIiciICIoIiAiKSIgIioiICIrIiAiLCIgIjsiICI9IiAlZW5jb2RlZAogIC8vIEkndmUgbmV2ZXIgc2VlbiBhIChub24tSUROKSBob3N0bmFtZSBvdGhlciB0aGFuOiBBTFBIQSBESUdJVCAuIC0KICBVUkkuaW52YWxpZF9ob3N0bmFtZV9jaGFyYWN0ZXJzID0gL1teYS16QS1aMC05XC4tXS87CiAgLy8gbWFwIERPTSBFbGVtZW50cyB0byB0aGVpciBVUkkgYXR0cmlidXRlCiAgVVJJLmRvbUF0dHJpYnV0ZXMgPSB7CiAgICAnYSc6ICdocmVmJywKICAgICdibG9ja3F1b3RlJzogJ2NpdGUnLAogICAgJ2xpbmsnOiAnaHJlZicsCiAgICAnYmFzZSc6ICdocmVmJywKICAgICdzY3JpcHQnOiAnc3JjJywKICAgICdmb3JtJzogJ2FjdGlvbicsCiAgICAnaW1nJzogJ3NyYycsCiAgICAnYXJlYSc6ICdocmVmJywKICAgICdpZnJhbWUnOiAnc3JjJywKICAgICdlbWJlZCc6ICdzcmMnLAogICAgJ3NvdXJjZSc6ICdzcmMnLAogICAgJ3RyYWNrJzogJ3NyYycsCiAgICAnaW5wdXQnOiAnc3JjJywgLy8gYnV0IG9ubHkgaWYgdHlwZT0iaW1hZ2UiCiAgICAnYXVkaW8nOiAnc3JjJywKICAgICd2aWRlbyc6ICdzcmMnCiAgfTsKICBVUkkuZ2V0RG9tQXR0cmlidXRlID0gZnVuY3Rpb24gKG5vZGUpIHsKICAgIGlmICghbm9kZSB8fCAhbm9kZS5ub2RlTmFtZSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQoKICAgIHZhciBub2RlTmFtZSA9IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgIC8vIDxpbnB1dD4gc2hvdWxkIG9ubHkgZXhwb3NlIHNyYyBmb3IgdHlwZT0iaW1hZ2UiCiAgICBpZiAobm9kZU5hbWUgPT09ICdpbnB1dCcgJiYgbm9kZS50eXBlICE9PSAnaW1hZ2UnKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CgogICAgcmV0dXJuIFVSSS5kb21BdHRyaWJ1dGVzW25vZGVOYW1lXTsKICB9OwoKICBmdW5jdGlvbiBlc2NhcGVGb3JEdW1iRmlyZWZveDM2KHZhbHVlKSB7CiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWVkaWFsaXplL1VSSS5qcy9pc3N1ZXMvOTEKICAgIHJldHVybiBlc2NhcGUodmFsdWUpOwogIH0KCiAgLy8gZW5jb2RpbmcgLyBkZWNvZGluZyBhY2NvcmRpbmcgdG8gUkZDMzk4NgogIGZ1bmN0aW9uIHN0cmljdEVuY29kZVVSSUNvbXBvbmVudChzdHJpbmcpIHsKICAgIC8vIHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL2VuY29kZVVSSUNvbXBvbmVudAogICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmcpLnJlcGxhY2UoL1shJygpKl0vZywgZXNjYXBlRm9yRHVtYkZpcmVmb3gzNikucmVwbGFjZSgvXCovZywgJyUyQScpOwogIH0KICBVUkkuZW5jb2RlID0gc3RyaWN0RW5jb2RlVVJJQ29tcG9uZW50OwogIFVSSS5kZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQ7CiAgVVJJLmlzbzg4NTkgPSBmdW5jdGlvbiAoKSB7CiAgICBVUkkuZW5jb2RlID0gZXNjYXBlOwogICAgVVJJLmRlY29kZSA9IHVuZXNjYXBlOwogIH07CiAgVVJJLnVuaWNvZGUgPSBmdW5jdGlvbiAoKSB7CiAgICBVUkkuZW5jb2RlID0gc3RyaWN0RW5jb2RlVVJJQ29tcG9uZW50OwogICAgVVJJLmRlY29kZSA9IGRlY29kZVVSSUNvbXBvbmVudDsKICB9OwogIFVSSS5jaGFyYWN0ZXJzID0gewogICAgcGF0aG5hbWU6IHsKICAgICAgZW5jb2RlOiB7CiAgICAgICAgLy8gUkZDMzk4NiAyLjE6IEZvciBjb25zaXN0ZW5jeSwgVVJJIHByb2R1Y2VycyBhbmQgbm9ybWFsaXplcnMgc2hvdWxkCiAgICAgICAgLy8gdXNlIHVwcGVyY2FzZSBoZXhhZGVjaW1hbCBkaWdpdHMgZm9yIGFsbCBwZXJjZW50LWVuY29kaW5ncy4KICAgICAgICBleHByZXNzaW9uOiAvJSgyNHwyNnwyQnwyQ3wzQnwzRHwzQXw0MCkvaWcsCiAgICAgICAgbWFwOiB7CiAgICAgICAgICAvLyAtLl9+IScoKSoKICAgICAgICAgICclMjQnOiAnJCcsCiAgICAgICAgICAnJTI2JzogJyYnLAogICAgICAgICAgJyUyQic6ICcrJywKICAgICAgICAgICclMkMnOiAnLCcsCiAgICAgICAgICAnJTNCJzogJzsnLAogICAgICAgICAgJyUzRCc6ICc9JywKICAgICAgICAgICclM0EnOiAnOicsCiAgICAgICAgICAnJTQwJzogJ0AnCiAgICAgICAgfQogICAgICB9LAogICAgICBkZWNvZGU6IHsKICAgICAgICBleHByZXNzaW9uOiAvW1wvXD8jXS9nLAogICAgICAgIG1hcDogewogICAgICAgICAgJy8nOiAnJTJGJywKICAgICAgICAgICc/JzogJyUzRicsCiAgICAgICAgICAnIyc6ICclMjMnCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcmVzZXJ2ZWQ6IHsKICAgICAgZW5jb2RlOiB7CiAgICAgICAgLy8gUkZDMzk4NiAyLjE6IEZvciBjb25zaXN0ZW5jeSwgVVJJIHByb2R1Y2VycyBhbmQgbm9ybWFsaXplcnMgc2hvdWxkCiAgICAgICAgLy8gdXNlIHVwcGVyY2FzZSBoZXhhZGVjaW1hbCBkaWdpdHMgZm9yIGFsbCBwZXJjZW50LWVuY29kaW5ncy4KICAgICAgICBleHByZXNzaW9uOiAvJSgyMXwyM3wyNHwyNnwyN3wyOHwyOXwyQXwyQnwyQ3wyRnwzQXwzQnwzRHwzRnw0MHw1Qnw1RCkvaWcsCiAgICAgICAgbWFwOiB7CiAgICAgICAgICAvLyBnZW4tZGVsaW1zCiAgICAgICAgICAnJTNBJzogJzonLAogICAgICAgICAgJyUyRic6ICcvJywKICAgICAgICAgICclM0YnOiAnPycsCiAgICAgICAgICAnJTIzJzogJyMnLAogICAgICAgICAgJyU1Qic6ICdbJywKICAgICAgICAgICclNUQnOiAnXScsCiAgICAgICAgICAnJTQwJzogJ0AnLAogICAgICAgICAgLy8gc3ViLWRlbGltcwogICAgICAgICAgJyUyMSc6ICchJywKICAgICAgICAgICclMjQnOiAnJCcsCiAgICAgICAgICAnJTI2JzogJyYnLAogICAgICAgICAgJyUyNyc6ICdcJycsCiAgICAgICAgICAnJTI4JzogJygnLAogICAgICAgICAgJyUyOSc6ICcpJywKICAgICAgICAgICclMkEnOiAnKicsCiAgICAgICAgICAnJTJCJzogJysnLAogICAgICAgICAgJyUyQyc6ICcsJywKICAgICAgICAgICclM0InOiAnOycsCiAgICAgICAgICAnJTNEJzogJz0nCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgdXJucGF0aDogewogICAgICAvLyBUaGUgY2hhcmFjdGVycyB1bmRlciBgZW5jb2RlYCBhcmUgdGhlIGNoYXJhY3RlcnMgY2FsbGVkIG91dCBieSBSRkMgMjE0MSBhcyBiZWluZyBhY2NlcHRhYmxlCiAgICAgIC8vIGZvciB1c2FnZSBpbiBhIFVSTi4gUkZDMjE0MSBhbHNvIGNhbGxzIG91dCAiLSIsICIuIiwgYW5kICJfIiBhcyBhY2NlcHRhYmxlIGNoYXJhY3RlcnMsIGJ1dAogICAgICAvLyB0aGVzZSBhcmVuJ3QgZW5jb2RlZCBieSBlbmNvZGVVUklDb21wb25lbnQsIHNvIHdlIGRvbid0IGhhdmUgdG8gY2FsbCB0aGVtIG91dCBoZXJlLiBBbHNvCiAgICAgIC8vIG5vdGUgdGhhdCB0aGUgY29sb24gY2hhcmFjdGVyIGlzIG5vdCBmZWF0dXJlZCBpbiB0aGUgZW5jb2RpbmcgbWFwOyB0aGlzIGlzIGJlY2F1c2UgVVJJLmpzCiAgICAgIC8vIGdpdmVzIHRoZSBjb2xvbnMgaW4gVVJOcyBzZW1hbnRpYyBtZWFuaW5nIGFzIHRoZSBkZWxpbWl0ZXJzIG9mIHBhdGggc2VnZW1lbnRzLCBhbmQgc28gaXQKICAgICAgLy8gc2hvdWxkIG5vdCBhcHBlYXIgdW5lbmNvZGVkIGluIGEgc2VnbWVudCBpdHNlbGYuCiAgICAgIC8vIFNlZSBhbHNvIHRoZSBub3RlIGFib3ZlIGFib3V0IFJGQzM5ODYgYW5kIGNhcGl0YWxhbGl6ZWQgaGV4IGRpZ2l0cy4KICAgICAgZW5jb2RlOiB7CiAgICAgICAgZXhwcmVzc2lvbjogLyUoMjF8MjR8Mjd8Mjh8Mjl8MkF8MkJ8MkN8M0J8M0R8NDApL2lnLAogICAgICAgIG1hcDogewogICAgICAgICAgJyUyMSc6ICchJywKICAgICAgICAgICclMjQnOiAnJCcsCiAgICAgICAgICAnJTI3JzogJ1wnJywKICAgICAgICAgICclMjgnOiAnKCcsCiAgICAgICAgICAnJTI5JzogJyknLAogICAgICAgICAgJyUyQSc6ICcqJywKICAgICAgICAgICclMkInOiAnKycsCiAgICAgICAgICAnJTJDJzogJywnLAogICAgICAgICAgJyUzQic6ICc7JywKICAgICAgICAgICclM0QnOiAnPScsCiAgICAgICAgICAnJTQwJzogJ0AnCiAgICAgICAgfQogICAgICB9LAogICAgICAvLyBUaGVzZSBjaGFyYWN0ZXJzIGFyZSB0aGUgY2hhcmFjdGVycyBjYWxsZWQgb3V0IGJ5IFJGQzIxNDEgYXMgInJlc2VydmVkIiBjaGFyYWN0ZXJzIHRoYXQKICAgICAgLy8gc2hvdWxkIG5ldmVyIGFwcGVhciBpbiBhIFVSTiwgcGx1cyB0aGUgY29sb24gY2hhcmFjdGVyIChzZWUgbm90ZSBhYm92ZSkuCiAgICAgIGRlY29kZTogewogICAgICAgIGV4cHJlc3Npb246IC9bXC9cPyM6XS9nLAogICAgICAgIG1hcDogewogICAgICAgICAgJy8nOiAnJTJGJywKICAgICAgICAgICc/JzogJyUzRicsCiAgICAgICAgICAnIyc6ICclMjMnLAogICAgICAgICAgJzonOiAnJTNBJwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgVVJJLmVuY29kZVF1ZXJ5ID0gZnVuY3Rpb24gKHN0cmluZywgZXNjYXBlUXVlcnlTcGFjZSkgewogICAgdmFyIGVzY2FwZWQgPSBVUkkuZW5jb2RlKHN0cmluZyArICcnKTsKICAgIGlmIChlc2NhcGVRdWVyeVNwYWNlID09PSB1bmRlZmluZWQpIHsKICAgICAgZXNjYXBlUXVlcnlTcGFjZSA9IFVSSS5lc2NhcGVRdWVyeVNwYWNlOwogICAgfQoKICAgIHJldHVybiBlc2NhcGVRdWVyeVNwYWNlID8gZXNjYXBlZC5yZXBsYWNlKC8lMjAvZywgJysnKSA6IGVzY2FwZWQ7CiAgfTsKICBVUkkuZGVjb2RlUXVlcnkgPSBmdW5jdGlvbiAoc3RyaW5nLCBlc2NhcGVRdWVyeVNwYWNlKSB7CiAgICBzdHJpbmcgKz0gJyc7CiAgICBpZiAoZXNjYXBlUXVlcnlTcGFjZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGVzY2FwZVF1ZXJ5U3BhY2UgPSBVUkkuZXNjYXBlUXVlcnlTcGFjZTsKICAgIH0KCiAgICB0cnkgewogICAgICByZXR1cm4gVVJJLmRlY29kZShlc2NhcGVRdWVyeVNwYWNlID8gc3RyaW5nLnJlcGxhY2UoL1wrL2csICclMjAnKSA6IHN0cmluZyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIHdlJ3JlIG5vdCBnb2luZyB0byBtZXNzIHdpdGggd2VpcmQgZW5jb2RpbmdzLAogICAgICAvLyBnaXZlIHVwIGFuZCByZXR1cm4gdGhlIHVuZGVjb2RlZCBvcmlnaW5hbCBzdHJpbmcKICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tZWRpYWxpemUvVVJJLmpzL2lzc3Vlcy84NwogICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21lZGlhbGl6ZS9VUkkuanMvaXNzdWVzLzkyCiAgICAgIHJldHVybiBzdHJpbmc7CiAgICB9CiAgfTsKICAvLyBnZW5lcmF0ZSBlbmNvZGUvZGVjb2RlIHBhdGggZnVuY3Rpb25zCiAgdmFyIF9wYXJ0cyA9IHsgJ2VuY29kZSc6ICdlbmNvZGUnLCAnZGVjb2RlJzogJ2RlY29kZScgfTsKICB2YXIgX3BhcnQ7CiAgdmFyIGdlbmVyYXRlQWNjZXNzb3IgPSBmdW5jdGlvbiBnZW5lcmF0ZUFjY2Vzc29yKF9ncm91cCwgX3BhcnQpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIFVSSVtfcGFydF0oc3RyaW5nICsgJycpLnJlcGxhY2UoVVJJLmNoYXJhY3RlcnNbX2dyb3VwXVtfcGFydF0uZXhwcmVzc2lvbiwgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHJldHVybiBVUkkuY2hhcmFjdGVyc1tfZ3JvdXBdW19wYXJ0XS5tYXBbY107CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyB3ZSdyZSBub3QgZ29pbmcgdG8gbWVzcyB3aXRoIHdlaXJkIGVuY29kaW5ncywKICAgICAgICAvLyBnaXZlIHVwIGFuZCByZXR1cm4gdGhlIHVuZGVjb2RlZCBvcmlnaW5hbCBzdHJpbmcKICAgICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21lZGlhbGl6ZS9VUkkuanMvaXNzdWVzLzg3CiAgICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tZWRpYWxpemUvVVJJLmpzL2lzc3Vlcy85MgogICAgICAgIHJldHVybiBzdHJpbmc7CiAgICAgIH0KICAgIH07CiAgfTsKCiAgZm9yIChfcGFydCBpbiBfcGFydHMpIHsKICAgIFVSSVtfcGFydCArICdQYXRoU2VnbWVudCddID0gZ2VuZXJhdGVBY2Nlc3NvcigncGF0aG5hbWUnLCBfcGFydHNbX3BhcnRdKTsKICAgIFVSSVtfcGFydCArICdVcm5QYXRoU2VnbWVudCddID0gZ2VuZXJhdGVBY2Nlc3NvcigndXJucGF0aCcsIF9wYXJ0c1tfcGFydF0pOwogIH0KCiAgdmFyIGdlbmVyYXRlU2VnbWVudGVkUGF0aEZ1bmN0aW9uID0gZnVuY3Rpb24gZ2VuZXJhdGVTZWdtZW50ZWRQYXRoRnVuY3Rpb24oX3NlcCwgX2NvZGluZ0Z1bmNOYW1lLCBfaW5uZXJDb2RpbmdGdW5jTmFtZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgLy8gV2h5IHBhc3MgaW4gbmFtZXMgb2YgZnVuY3Rpb25zLCByYXRoZXIgdGhhbiB0aGUgZnVuY3Rpb24gb2JqZWN0cyB0aGVtc2VsdmVzPyBUaGUKICAgICAgLy8gZGVmaW5pdGlvbnMgb2Ygc29tZSBmdW5jdGlvbnMgKGJ1dCBpbiBwYXJ0aWN1bGFyLCBVUkkuZGVjb2RlKSB3aWxsIG9jY2FzaW9uYWxseSBjaGFuZ2UgZHVlCiAgICAgIC8vIHRvIFVSSS5qcyBoYXZpbmcgSVNPODg1OSBhbmQgVW5pY29kZSBtb2Rlcy4gUGFzc2luZyBpbiB0aGUgbmFtZSBhbmQgZ2V0dGluZyBpdCB3aWxsIGVuc3VyZQogICAgICAvLyB0aGF0IHRoZSBmdW5jdGlvbnMgd2UgdXNlIGhlcmUgYXJlICJmcmVzaCIuCiAgICAgIHZhciBhY3R1YWxDb2RpbmdGdW5jOwogICAgICBpZiAoIV9pbm5lckNvZGluZ0Z1bmNOYW1lKSB7CiAgICAgICAgYWN0dWFsQ29kaW5nRnVuYyA9IFVSSVtfY29kaW5nRnVuY05hbWVdOwogICAgICB9IGVsc2UgewogICAgICAgIGFjdHVhbENvZGluZ0Z1bmMgPSBmdW5jdGlvbiBhY3R1YWxDb2RpbmdGdW5jKHN0cmluZykgewogICAgICAgICAgcmV0dXJuIFVSSVtfY29kaW5nRnVuY05hbWVdKFVSSVtfaW5uZXJDb2RpbmdGdW5jTmFtZV0oc3RyaW5nKSk7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHNlZ21lbnRzID0gKHN0cmluZyArICcnKS5zcGxpdChfc2VwKTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBzZWdtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHNlZ21lbnRzW2ldID0gYWN0dWFsQ29kaW5nRnVuYyhzZWdtZW50c1tpXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWdtZW50cy5qb2luKF9zZXApOwogICAgfTsKICB9OwoKICAvLyBUaGlzIHRha2VzIHBsYWNlIG91dHNpZGUgdGhlIGFib3ZlIGxvb3AgYmVjYXVzZSB3ZSBkb24ndCB3YW50LCBlLmcuLCBlbmNvZGVVcm5QYXRoIGZ1bmN0aW9ucy4KICBVUkkuZGVjb2RlUGF0aCA9IGdlbmVyYXRlU2VnbWVudGVkUGF0aEZ1bmN0aW9uKCcvJywgJ2RlY29kZVBhdGhTZWdtZW50Jyk7CiAgVVJJLmRlY29kZVVyblBhdGggPSBnZW5lcmF0ZVNlZ21lbnRlZFBhdGhGdW5jdGlvbignOicsICdkZWNvZGVVcm5QYXRoU2VnbWVudCcpOwogIFVSSS5yZWNvZGVQYXRoID0gZ2VuZXJhdGVTZWdtZW50ZWRQYXRoRnVuY3Rpb24oJy8nLCAnZW5jb2RlUGF0aFNlZ21lbnQnLCAnZGVjb2RlJyk7CiAgVVJJLnJlY29kZVVyblBhdGggPSBnZW5lcmF0ZVNlZ21lbnRlZFBhdGhGdW5jdGlvbignOicsICdlbmNvZGVVcm5QYXRoU2VnbWVudCcsICdkZWNvZGUnKTsKCiAgVVJJLmVuY29kZVJlc2VydmVkID0gZ2VuZXJhdGVBY2Nlc3NvcigncmVzZXJ2ZWQnLCAnZW5jb2RlJyk7CgogIFVSSS5wYXJzZSA9IGZ1bmN0aW9uIChzdHJpbmcsIHBhcnRzKSB7CiAgICB2YXIgcG9zOwogICAgaWYgKCFwYXJ0cykgewogICAgICBwYXJ0cyA9IHt9OwogICAgfQogICAgLy8gW3Byb3RvY29sIjovLyJbdXNlcm5hbWVbIjoicGFzc3dvcmRdIkAiXWhvc3RuYW1lWyI6InBvcnRdIi8iP11bcGF0aF1bIj8icXVlcnlzdHJpbmddWyIjImZyYWdtZW50XQoKICAgIC8vIGV4dHJhY3QgZnJhZ21lbnQKICAgIHBvcyA9IHN0cmluZy5pbmRleE9mKCcjJyk7CiAgICBpZiAocG9zID4gLTEpIHsKICAgICAgLy8gZXNjYXBpbmc/CiAgICAgIHBhcnRzLmZyYWdtZW50ID0gc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAxKSB8fCBudWxsOwogICAgICBzdHJpbmcgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHBvcyk7CiAgICB9CgogICAgLy8gZXh0cmFjdCBxdWVyeQogICAgcG9zID0gc3RyaW5nLmluZGV4T2YoJz8nKTsKICAgIGlmIChwb3MgPiAtMSkgewogICAgICAvLyBlc2NhcGluZz8KICAgICAgcGFydHMucXVlcnkgPSBzdHJpbmcuc3Vic3RyaW5nKHBvcyArIDEpIHx8IG51bGw7CiAgICAgIHN0cmluZyA9IHN0cmluZy5zdWJzdHJpbmcoMCwgcG9zKTsKICAgIH0KCiAgICAvLyBleHRyYWN0IHByb3RvY29sCiAgICBpZiAoc3RyaW5nLnN1YnN0cmluZygwLCAyKSA9PT0gJy8vJykgewogICAgICAvLyByZWxhdGl2ZS1zY2hlbWUKICAgICAgcGFydHMucHJvdG9jb2wgPSBudWxsOwogICAgICBzdHJpbmcgPSBzdHJpbmcuc3Vic3RyaW5nKDIpOwogICAgICAvLyBleHRyYWN0ICJ1c2VyOnBhc3NAaG9zdDpwb3J0IgogICAgICBzdHJpbmcgPSBVUkkucGFyc2VBdXRob3JpdHkoc3RyaW5nLCBwYXJ0cyk7CiAgICB9IGVsc2UgewogICAgICBwb3MgPSBzdHJpbmcuaW5kZXhPZignOicpOwogICAgICBpZiAocG9zID4gLTEpIHsKICAgICAgICBwYXJ0cy5wcm90b2NvbCA9IHN0cmluZy5zdWJzdHJpbmcoMCwgcG9zKSB8fCBudWxsOwogICAgICAgIGlmIChwYXJ0cy5wcm90b2NvbCAmJiAhcGFydHMucHJvdG9jb2wubWF0Y2goVVJJLnByb3RvY29sX2V4cHJlc3Npb24pKSB7CiAgICAgICAgICAvLyA6IG1heSBiZSB3aXRoaW4gdGhlIHBhdGgKICAgICAgICAgIHBhcnRzLnByb3RvY29sID0gdW5kZWZpbmVkOwogICAgICAgIH0gZWxzZSBpZiAoc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAxLCBwb3MgKyAzKSA9PT0gJy8vJykgewogICAgICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAzKTsKCiAgICAgICAgICAvLyBleHRyYWN0ICJ1c2VyOnBhc3NAaG9zdDpwb3J0IgogICAgICAgICAgc3RyaW5nID0gVVJJLnBhcnNlQXV0aG9yaXR5KHN0cmluZywgcGFydHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcuc3Vic3RyaW5nKHBvcyArIDEpOwogICAgICAgICAgcGFydHMudXJuID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyB3aGF0J3MgbGVmdCBtdXN0IGJlIHRoZSBwYXRoCiAgICBwYXJ0cy5wYXRoID0gc3RyaW5nOwoKICAgIC8vIGFuZCB3ZSdyZSBkb25lCiAgICByZXR1cm4gcGFydHM7CiAgfTsKICBVUkkucGFyc2VIb3N0ID0gZnVuY3Rpb24gKHN0cmluZywgcGFydHMpIHsKICAgIC8vIENvcHkgY2hyb21lLCBJRSwgb3BlcmEgYmFja3NsYXNoLWhhbmRsaW5nIGJlaGF2aW9yLgogICAgLy8gQmFjayBzbGFzaGVzIGJlZm9yZSB0aGUgcXVlcnkgc3RyaW5nIGdldCBjb252ZXJ0ZWQgdG8gZm9yd2FyZCBzbGFzaGVzCiAgICAvLyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9qb3llbnQvbm9kZS9ibG9iLzM4NmZkMjRmNDliMGU5ZDFhOGEwNzY1OTJhNDA0MTY4ZmFlZWNjMzQvbGliL3VybC5qcyNMMTE1LUwxMjQKICAgIC8vIFNlZTogaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTI1OTE2CiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWVkaWFsaXplL1VSSS5qcy9wdWxsLzIzMwogICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xcL2csICcvJyk7CgogICAgLy8gZXh0cmFjdCBob3N0OnBvcnQKICAgIHZhciBwb3MgPSBzdHJpbmcuaW5kZXhPZignLycpOwogICAgdmFyIGJyYWNrZXRQb3M7CiAgICB2YXIgdDsKCiAgICBpZiAocG9zID09PSAtMSkgewogICAgICBwb3MgPSBzdHJpbmcubGVuZ3RoOwogICAgfQoKICAgIGlmIChzdHJpbmcuY2hhckF0KDApID09PSAnWycpIHsKICAgICAgLy8gSVB2NiBob3N0IC0gaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvZHJhZnQtaWV0Zi02bWFuLXRleHQtYWRkci1yZXByZXNlbnRhdGlvbi0wNCNzZWN0aW9uLTYKICAgICAgLy8gSSBjbGFpbSBtb3N0IGNsaWVudCBzb2Z0d2FyZSBicmVha3Mgb24gSVB2NiBhbnl3YXlzLiBUbyBzaW1wbGlmeSB0aGluZ3MsIFVSSSBvbmx5IGFjY2VwdHMKICAgICAgLy8gSVB2Nitwb3J0IGluIHRoZSBmb3JtYXQgWzIwMDE6ZGI4OjoxXTo4MCAoZm9yIHRoZSB0aW1lIGJlaW5nKQogICAgICBicmFja2V0UG9zID0gc3RyaW5nLmluZGV4T2YoJ10nKTsKICAgICAgcGFydHMuaG9zdG5hbWUgPSBzdHJpbmcuc3Vic3RyaW5nKDEsIGJyYWNrZXRQb3MpIHx8IG51bGw7CiAgICAgIHBhcnRzLnBvcnQgPSBzdHJpbmcuc3Vic3RyaW5nKGJyYWNrZXRQb3MgKyAyLCBwb3MpIHx8IG51bGw7CiAgICAgIGlmIChwYXJ0cy5wb3J0ID09PSAnLycpIHsKICAgICAgICBwYXJ0cy5wb3J0ID0gbnVsbDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGZpcnN0Q29sb24gPSBzdHJpbmcuaW5kZXhPZignOicpOwogICAgICB2YXIgZmlyc3RTbGFzaCA9IHN0cmluZy5pbmRleE9mKCcvJyk7CiAgICAgIHZhciBuZXh0Q29sb24gPSBzdHJpbmcuaW5kZXhPZignOicsIGZpcnN0Q29sb24gKyAxKTsKICAgICAgaWYgKG5leHRDb2xvbiAhPT0gLTEgJiYgKGZpcnN0U2xhc2ggPT09IC0xIHx8IG5leHRDb2xvbiA8IGZpcnN0U2xhc2gpKSB7CiAgICAgICAgLy8gSVB2NiBob3N0IGNvbnRhaW5zIG11bHRpcGxlIGNvbG9ucyAtIGJ1dCBubyBwb3J0CiAgICAgICAgLy8gdGhpcyBub3RhdGlvbiBpcyBhY3R1YWxseSBub3QgYWxsb3dlZCBieSBSRkMgMzk4NiwgYnV0IHdlJ3JlIGEgbGliZXJhbCBwYXJzZXIKICAgICAgICBwYXJ0cy5ob3N0bmFtZSA9IHN0cmluZy5zdWJzdHJpbmcoMCwgcG9zKSB8fCBudWxsOwogICAgICAgIHBhcnRzLnBvcnQgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHQgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHBvcykuc3BsaXQoJzonKTsKICAgICAgICBwYXJ0cy5ob3N0bmFtZSA9IHRbMF0gfHwgbnVsbDsKICAgICAgICBwYXJ0cy5wb3J0ID0gdFsxXSB8fCBudWxsOwogICAgICB9CiAgICB9CgogICAgaWYgKHBhcnRzLmhvc3RuYW1lICYmIHN0cmluZy5zdWJzdHJpbmcocG9zKS5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICBwb3MrKzsKICAgICAgc3RyaW5nID0gJy8nICsgc3RyaW5nOwogICAgfQoKICAgIHJldHVybiBzdHJpbmcuc3Vic3RyaW5nKHBvcykgfHwgJy8nOwogIH07CiAgVVJJLnBhcnNlQXV0aG9yaXR5ID0gZnVuY3Rpb24gKHN0cmluZywgcGFydHMpIHsKICAgIHN0cmluZyA9IFVSSS5wYXJzZVVzZXJpbmZvKHN0cmluZywgcGFydHMpOwogICAgcmV0dXJuIFVSSS5wYXJzZUhvc3Qoc3RyaW5nLCBwYXJ0cyk7CiAgfTsKICBVUkkucGFyc2VVc2VyaW5mbyA9IGZ1bmN0aW9uIChzdHJpbmcsIHBhcnRzKSB7CiAgICAvLyBleHRyYWN0IHVzZXJuYW1lOnBhc3N3b3JkCiAgICB2YXIgZmlyc3RTbGFzaCA9IHN0cmluZy5pbmRleE9mKCcvJyk7CiAgICB2YXIgcG9zID0gc3RyaW5nLmxhc3RJbmRleE9mKCdAJywgZmlyc3RTbGFzaCA+IC0xID8gZmlyc3RTbGFzaCA6IHN0cmluZy5sZW5ndGggLSAxKTsKICAgIHZhciB0OwoKICAgIC8vIGF1dGhvcml0eUAgbXVzdCBjb21lIGJlZm9yZSAvcGF0aAogICAgaWYgKHBvcyA+IC0xICYmIChmaXJzdFNsYXNoID09PSAtMSB8fCBwb3MgPCBmaXJzdFNsYXNoKSkgewogICAgICB0ID0gc3RyaW5nLnN1YnN0cmluZygwLCBwb3MpLnNwbGl0KCc6Jyk7CiAgICAgIHBhcnRzLnVzZXJuYW1lID0gdFswXSA/IFVSSS5kZWNvZGUodFswXSkgOiBudWxsOwogICAgICB0LnNoaWZ0KCk7CiAgICAgIHBhcnRzLnBhc3N3b3JkID0gdFswXSA/IFVSSS5kZWNvZGUodC5qb2luKCc6JykpIDogbnVsbDsKICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZyhwb3MgKyAxKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhcnRzLnVzZXJuYW1lID0gbnVsbDsKICAgICAgcGFydHMucGFzc3dvcmQgPSBudWxsOwogICAgfQoKICAgIHJldHVybiBzdHJpbmc7CiAgfTsKICBVUkkucGFyc2VRdWVyeSA9IGZ1bmN0aW9uIChzdHJpbmcsIGVzY2FwZVF1ZXJ5U3BhY2UpIHsKICAgIGlmICghc3RyaW5nKSB7CiAgICAgIHJldHVybiB7fTsKICAgIH0KCiAgICAvLyB0aHJvdyBvdXQgdGhlIGZ1bmt5IGJ1c2luZXNzIC0gIj8iW25hbWUiPSJ2YWx1ZSImIl0rCiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvJisvZywgJyYnKS5yZXBsYWNlKC9eXD8qJip8JiskL2csICcnKTsKCiAgICBpZiAoIXN0cmluZykgewogICAgICByZXR1cm4ge307CiAgICB9CgogICAgdmFyIGl0ZW1zID0ge307CiAgICB2YXIgc3BsaXRzID0gc3RyaW5nLnNwbGl0KCcmJyk7CiAgICB2YXIgbGVuZ3RoID0gc3BsaXRzLmxlbmd0aDsKICAgIHZhciB2LCBuYW1lLCB2YWx1ZTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHYgPSBzcGxpdHNbaV0uc3BsaXQoJz0nKTsKICAgICAgbmFtZSA9IFVSSS5kZWNvZGVRdWVyeSh2LnNoaWZ0KCksIGVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgICAvLyBubyAiPSIgaXMgbnVsbCBhY2NvcmRpbmcgdG8gaHR0cDovL2R2Y3MudzMub3JnL2hnL3VybC9yYXctZmlsZS90aXAvT3ZlcnZpZXcuaHRtbCNjb2xsZWN0LXVybC1wYXJhbWV0ZXJzCiAgICAgIHZhbHVlID0gdi5sZW5ndGggPyBVUkkuZGVjb2RlUXVlcnkodi5qb2luKCc9JyksIGVzY2FwZVF1ZXJ5U3BhY2UpIDogbnVsbDsKCiAgICAgIGlmIChoYXNPd24uY2FsbChpdGVtcywgbmFtZSkpIHsKICAgICAgICBpZiAodHlwZW9mIGl0ZW1zW25hbWVdID09PSAnc3RyaW5nJyB8fCBpdGVtc1tuYW1lXSA9PT0gbnVsbCkgewogICAgICAgICAgaXRlbXNbbmFtZV0gPSBbaXRlbXNbbmFtZV1dOwogICAgICAgIH0KCiAgICAgICAgaXRlbXNbbmFtZV0ucHVzaCh2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXRlbXNbbmFtZV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBpdGVtczsKICB9OwoKICBVUkkuYnVpbGQgPSBmdW5jdGlvbiAocGFydHMpIHsKICAgIHZhciB0ID0gJyc7CgogICAgaWYgKHBhcnRzLnByb3RvY29sKSB7CiAgICAgIHQgKz0gcGFydHMucHJvdG9jb2wgKyAnOic7CiAgICB9CgogICAgaWYgKCFwYXJ0cy51cm4gJiYgKHQgfHwgcGFydHMuaG9zdG5hbWUpKSB7CiAgICAgIHQgKz0gJy8vJzsKICAgIH0KCiAgICB0ICs9IFVSSS5idWlsZEF1dGhvcml0eShwYXJ0cykgfHwgJyc7CgogICAgaWYgKHR5cGVvZiBwYXJ0cy5wYXRoID09PSAnc3RyaW5nJykgewogICAgICBpZiAocGFydHMucGF0aC5jaGFyQXQoMCkgIT09ICcvJyAmJiB0eXBlb2YgcGFydHMuaG9zdG5hbWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdCArPSAnLyc7CiAgICAgIH0KCiAgICAgIHQgKz0gcGFydHMucGF0aDsKICAgIH0KCiAgICBpZiAodHlwZW9mIHBhcnRzLnF1ZXJ5ID09PSAnc3RyaW5nJyAmJiBwYXJ0cy5xdWVyeSkgewogICAgICB0ICs9ICc/JyArIHBhcnRzLnF1ZXJ5OwogICAgfQoKICAgIGlmICh0eXBlb2YgcGFydHMuZnJhZ21lbnQgPT09ICdzdHJpbmcnICYmIHBhcnRzLmZyYWdtZW50KSB7CiAgICAgIHQgKz0gJyMnICsgcGFydHMuZnJhZ21lbnQ7CiAgICB9CiAgICByZXR1cm4gdDsKICB9OwogIFVSSS5idWlsZEhvc3QgPSBmdW5jdGlvbiAocGFydHMpIHsKICAgIHZhciB0ID0gJyc7CgogICAgaWYgKCFwYXJ0cy5ob3N0bmFtZSkgewogICAgICByZXR1cm4gJyc7CiAgICB9IGVsc2UgaWYgKFVSSS5pcDZfZXhwcmVzc2lvbi50ZXN0KHBhcnRzLmhvc3RuYW1lKSkgewogICAgICB0ICs9ICdbJyArIHBhcnRzLmhvc3RuYW1lICsgJ10nOwogICAgfSBlbHNlIHsKICAgICAgdCArPSBwYXJ0cy5ob3N0bmFtZTsKICAgIH0KCiAgICBpZiAocGFydHMucG9ydCkgewogICAgICB0ICs9ICc6JyArIHBhcnRzLnBvcnQ7CiAgICB9CgogICAgcmV0dXJuIHQ7CiAgfTsKICBVUkkuYnVpbGRBdXRob3JpdHkgPSBmdW5jdGlvbiAocGFydHMpIHsKICAgIHJldHVybiBVUkkuYnVpbGRVc2VyaW5mbyhwYXJ0cykgKyBVUkkuYnVpbGRIb3N0KHBhcnRzKTsKICB9OwogIFVSSS5idWlsZFVzZXJpbmZvID0gZnVuY3Rpb24gKHBhcnRzKSB7CiAgICB2YXIgdCA9ICcnOwoKICAgIGlmIChwYXJ0cy51c2VybmFtZSkgewogICAgICB0ICs9IFVSSS5lbmNvZGUocGFydHMudXNlcm5hbWUpOwogICAgfQoKICAgIGlmIChwYXJ0cy5wYXNzd29yZCkgewogICAgICB0ICs9ICc6JyArIFVSSS5lbmNvZGUocGFydHMucGFzc3dvcmQpOwogICAgfQoKICAgIGlmICh0KSB7CiAgICAgIHQgKz0gJ0AnOwogICAgfQoKICAgIHJldHVybiB0OwogIH07CiAgVVJJLmJ1aWxkUXVlcnkgPSBmdW5jdGlvbiAoZGF0YSwgZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCBlc2NhcGVRdWVyeVNwYWNlKSB7CiAgICAvLyBhY2NvcmRpbmcgdG8gaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4NiBvciBodHRwOi8vbGFicy5hcGFjaGUub3JnL3dlYmFyY2gvdXJpL3JmYy9yZmMzOTg2Lmh0bWwKICAgIC8vIGJlaW5nIMK7LS5ffiEkJicoKSorLDs9OkAvP8KrICVIRVggYW5kIGFsbnVtIGFyZSBhbGxvd2VkCiAgICAvLyB0aGUgUkZDIGV4cGxpY2l0bHkgc3RhdGVzID8vZm9vIGJlaW5nIGEgdmFsaWQgdXNlIGNhc2UsIG5vIG1lbnRpb24gb2YgcGFyYW1ldGVyIHN5bnRheCEKICAgIC8vIFVSSS5qcyB0cmVhdHMgdGhlIHF1ZXJ5IHN0cmluZyBhcyBiZWluZyBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQKICAgIC8vIHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwL2ludGVyYWN0L2Zvcm1zLmh0bWwjZm9ybS1jb250ZW50LXR5cGUKCiAgICB2YXIgdCA9ICcnOwogICAgdmFyIHVuaXF1ZSwga2V5LCBpLCBsZW5ndGg7CiAgICBmb3IgKGtleSBpbiBkYXRhKSB7CiAgICAgIGlmIChoYXNPd24uY2FsbChkYXRhLCBrZXkpICYmIGtleSkgewogICAgICAgIGlmIChpc0FycmF5KGRhdGFba2V5XSkpIHsKICAgICAgICAgIHVuaXF1ZSA9IHt9OwogICAgICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gZGF0YVtrZXldLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkYXRhW2tleV1baV0gIT09IHVuZGVmaW5lZCAmJiB1bmlxdWVbZGF0YVtrZXldW2ldICsgJyddID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0ICs9ICcmJyArIFVSSS5idWlsZFF1ZXJ5UGFyYW1ldGVyKGtleSwgZGF0YVtrZXldW2ldLCBlc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgICAgICAgICBpZiAoZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzICE9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVbZGF0YVtrZXldW2ldICsgJyddID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGRhdGFba2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0ICs9ICcmJyArIFVSSS5idWlsZFF1ZXJ5UGFyYW1ldGVyKGtleSwgZGF0YVtrZXldLCBlc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdC5zdWJzdHJpbmcoMSk7CiAgfTsKICBVUkkuYnVpbGRRdWVyeVBhcmFtZXRlciA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgZXNjYXBlUXVlcnlTcGFjZSkgewogICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLWh0bWw0MC9pbnRlcmFjdC9mb3Jtcy5odG1sI2Zvcm0tY29udGVudC10eXBlIC0tIGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZAogICAgLy8gZG9uJ3QgYXBwZW5kICI9IiBmb3IgbnVsbCB2YWx1ZXMsIGFjY29yZGluZyB0byBodHRwOi8vZHZjcy53My5vcmcvaGcvdXJsL3Jhdy1maWxlL3RpcC9PdmVydmlldy5odG1sI3VybC1wYXJhbWV0ZXItc2VyaWFsaXphdGlvbgogICAgcmV0dXJuIFVSSS5lbmNvZGVRdWVyeShuYW1lLCBlc2NhcGVRdWVyeVNwYWNlKSArICh2YWx1ZSAhPT0gbnVsbCA/ICc9JyArIFVSSS5lbmNvZGVRdWVyeSh2YWx1ZSwgZXNjYXBlUXVlcnlTcGFjZSkgOiAnJyk7CiAgfTsKCiAgVVJJLmFkZFF1ZXJ5ID0gZnVuY3Rpb24gKGRhdGEsIG5hbWUsIHZhbHVlKSB7CiAgICBpZiAoKHR5cGVvZiBuYW1lID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihuYW1lKSkgPT09ICdvYmplY3QnKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBuYW1lKSB7CiAgICAgICAgaWYgKGhhc093bi5jYWxsKG5hbWUsIGtleSkpIHsKICAgICAgICAgIFVSSS5hZGRRdWVyeShkYXRhLCBrZXksIG5hbWVba2V5XSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBuYW1lID09PSAnc3RyaW5nJykgewogICAgICBpZiAoZGF0YVtuYW1lXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZGF0YVtuYW1lXSA9IHZhbHVlOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YVtuYW1lXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBkYXRhW25hbWVdID0gW2RhdGFbbmFtZV1dOwogICAgICB9CgogICAgICBpZiAoIWlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgdmFsdWUgPSBbdmFsdWVdOwogICAgICB9CgogICAgICBkYXRhW25hbWVdID0gKGRhdGFbbmFtZV0gfHwgW10pLmNvbmNhdCh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVUkkuYWRkUXVlcnkoKSBhY2NlcHRzIGFuIG9iamVjdCwgc3RyaW5nIGFzIHRoZSBuYW1lIHBhcmFtZXRlcicpOwogICAgfQogIH07CiAgVVJJLnJlbW92ZVF1ZXJ5ID0gZnVuY3Rpb24gKGRhdGEsIG5hbWUsIHZhbHVlKSB7CiAgICB2YXIgaSwgbGVuZ3RoLCBrZXk7CgogICAgaWYgKGlzQXJyYXkobmFtZSkpIHsKICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gbmFtZS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGRhdGFbbmFtZVtpXV0gPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZ2V0VHlwZShuYW1lKSA9PT0gJ1JlZ0V4cCcpIHsKICAgICAgZm9yIChrZXkgaW4gZGF0YSkgewogICAgICAgIGlmIChuYW1lLnRlc3Qoa2V5KSkgewogICAgICAgICAgZGF0YVtrZXldID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICgodHlwZW9mIG5hbWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG5hbWUpKSA9PT0gJ29iamVjdCcpIHsKICAgICAgZm9yIChrZXkgaW4gbmFtZSkgewogICAgICAgIGlmIChoYXNPd24uY2FsbChuYW1lLCBrZXkpKSB7CiAgICAgICAgICBVUkkucmVtb3ZlUXVlcnkoZGF0YSwga2V5LCBuYW1lW2tleV0pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoZ2V0VHlwZSh2YWx1ZSkgPT09ICdSZWdFeHAnKSB7CiAgICAgICAgICBpZiAoIWlzQXJyYXkoZGF0YVtuYW1lXSkgJiYgdmFsdWUudGVzdChkYXRhW25hbWVdKSkgewogICAgICAgICAgICBkYXRhW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YVtuYW1lXSA9IGZpbHRlckFycmF5VmFsdWVzKGRhdGFbbmFtZV0sIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGRhdGFbbmFtZV0gPT09IFN0cmluZyh2YWx1ZSkgJiYgKCFpc0FycmF5KHZhbHVlKSB8fCB2YWx1ZS5sZW5ndGggPT09IDEpKSB7CiAgICAgICAgICBkYXRhW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShkYXRhW25hbWVdKSkgewogICAgICAgICAgZGF0YVtuYW1lXSA9IGZpbHRlckFycmF5VmFsdWVzKGRhdGFbbmFtZV0sIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YVtuYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVVJJLnJlbW92ZVF1ZXJ5KCkgYWNjZXB0cyBhbiBvYmplY3QsIHN0cmluZywgUmVnRXhwIGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXInKTsKICAgIH0KICB9OwogIFVSSS5oYXNRdWVyeSA9IGZ1bmN0aW9uIChkYXRhLCBuYW1lLCB2YWx1ZSwgd2l0aGluQXJyYXkpIHsKICAgIHN3aXRjaCAoZ2V0VHlwZShuYW1lKSkgewogICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgIC8vIE5vdGhpbmcgdG8gZG8gaGVyZQogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnUmVnRXhwJzoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkgewogICAgICAgICAgaWYgKGhhc093bi5jYWxsKGRhdGEsIGtleSkpIHsKICAgICAgICAgICAgaWYgKG5hbWUudGVzdChrZXkpICYmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IFVSSS5oYXNRdWVyeShkYXRhLCBrZXksIHZhbHVlKSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgY2FzZSAnT2JqZWN0JzoKICAgICAgICBmb3IgKHZhciBfa2V5IGluIG5hbWUpIHsKICAgICAgICAgIGlmIChoYXNPd24uY2FsbChuYW1lLCBfa2V5KSkgewogICAgICAgICAgICBpZiAoIVVSSS5oYXNRdWVyeShkYXRhLCBfa2V5LCBuYW1lW19rZXldKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VSSS5oYXNRdWVyeSgpIGFjY2VwdHMgYSBzdHJpbmcsIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBvYmplY3QgYXMgdGhlIG5hbWUgcGFyYW1ldGVyJyk7CiAgICB9CgogICAgc3dpdGNoIChnZXRUeXBlKHZhbHVlKSkgewogICAgICBjYXNlICdVbmRlZmluZWQnOgogICAgICAgIC8vIHRydWUgaWYgZXhpc3RzIChidXQgbWF5IGJlIGVtcHR5KQogICAgICAgIHJldHVybiBuYW1lIGluIGRhdGE7IC8vIGRhdGFbbmFtZV0gIT09IHVuZGVmaW5lZDsKCiAgICAgIGNhc2UgJ0Jvb2xlYW4nOgogICAgICAgIC8vIHRydWUgaWYgZXhpc3RzIGFuZCBub24tZW1wdHkKICAgICAgICB2YXIgX2Jvb2x5ID0gQm9vbGVhbihpc0FycmF5KGRhdGFbbmFtZV0pID8gZGF0YVtuYW1lXS5sZW5ndGggOiBkYXRhW25hbWVdKTsKICAgICAgICByZXR1cm4gdmFsdWUgPT09IF9ib29seTsKCiAgICAgIGNhc2UgJ0Z1bmN0aW9uJzoKICAgICAgICAvLyBhbGxvdyBjb21wbGV4IGNvbXBhcmlzb24KICAgICAgICByZXR1cm4gISF2YWx1ZShkYXRhW25hbWVdLCBuYW1lLCBkYXRhKTsKCiAgICAgIGNhc2UgJ0FycmF5JzoKICAgICAgICBpZiAoIWlzQXJyYXkoZGF0YVtuYW1lXSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBvcCA9IHdpdGhpbkFycmF5ID8gYXJyYXlDb250YWlucyA6IGFycmF5c0VxdWFsOwogICAgICAgIHJldHVybiBvcChkYXRhW25hbWVdLCB2YWx1ZSk7CgogICAgICBjYXNlICdSZWdFeHAnOgogICAgICAgIGlmICghaXNBcnJheShkYXRhW25hbWVdKSkgewogICAgICAgICAgcmV0dXJuIEJvb2xlYW4oZGF0YVtuYW1lXSAmJiBkYXRhW25hbWVdLm1hdGNoKHZhbHVlKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXdpdGhpbkFycmF5KSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXlDb250YWlucyhkYXRhW25hbWVdLCB2YWx1ZSk7CgogICAgICBjYXNlICdOdW1iZXInOgogICAgICAgIHZhbHVlID0gU3RyaW5nKHZhbHVlKTsKICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgIGlmICghaXNBcnJheShkYXRhW25hbWVdKSkgewogICAgICAgICAgcmV0dXJuIGRhdGFbbmFtZV0gPT09IHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF3aXRoaW5BcnJheSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFycmF5Q29udGFpbnMoZGF0YVtuYW1lXSwgdmFsdWUpOwoKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVUkkuaGFzUXVlcnkoKSBhY2NlcHRzIHVuZGVmaW5lZCwgYm9vbGVhbiwgc3RyaW5nLCBudW1iZXIsIFJlZ0V4cCwgRnVuY3Rpb24gYXMgdGhlIHZhbHVlIHBhcmFtZXRlcicpOwogICAgfQogIH07CgogIFVSSS5qb2luUGF0aHMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaW5wdXQgPSBbXTsKICAgIHZhciBzZWdtZW50cyA9IFtdOwogICAgdmFyIG5vbkVtcHR5U2VnbWVudHMgPSAwOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB1cmwgPSBuZXcgVVJJKGFyZ3VtZW50c1tpXSk7CiAgICAgIGlucHV0LnB1c2godXJsKTsKICAgICAgdmFyIF9zZWdtZW50cyA9IHVybC5zZWdtZW50KCk7CiAgICAgIGZvciAodmFyIHMgPSAwOyBzIDwgX3NlZ21lbnRzLmxlbmd0aDsgcysrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBfc2VnbWVudHNbc10gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBzZWdtZW50cy5wdXNoKF9zZWdtZW50c1tzXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3NlZ21lbnRzW3NdKSB7CiAgICAgICAgICBub25FbXB0eVNlZ21lbnRzKys7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKCFzZWdtZW50cy5sZW5ndGggfHwgIW5vbkVtcHR5U2VnbWVudHMpIHsKICAgICAgcmV0dXJuIG5ldyBVUkkoJycpOwogICAgfQoKICAgIHZhciB1cmkgPSBuZXcgVVJJKCcnKS5zZWdtZW50KHNlZ21lbnRzKTsKCiAgICBpZiAoaW5wdXRbMF0ucGF0aCgpID09PSAnJyB8fCBpbnB1dFswXS5wYXRoKCkuc2xpY2UoMCwgMSkgPT09ICcvJykgewogICAgICB1cmkucGF0aCgnLycgKyB1cmkucGF0aCgpKTsKICAgIH0KCiAgICByZXR1cm4gdXJpLm5vcm1hbGl6ZSgpOwogIH07CgogIFVSSS5jb21tb25QYXRoID0gZnVuY3Rpb24gKG9uZSwgdHdvKSB7CiAgICB2YXIgbGVuZ3RoID0gTWF0aC5taW4ob25lLmxlbmd0aCwgdHdvLmxlbmd0aCk7CiAgICB2YXIgcG9zOwoKICAgIC8vIGZpbmQgZmlyc3Qgbm9uLW1hdGNoaW5nIGNoYXJhY3RlcgogICAgZm9yIChwb3MgPSAwOyBwb3MgPCBsZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmIChvbmUuY2hhckF0KHBvcykgIT09IHR3by5jaGFyQXQocG9zKSkgewogICAgICAgIHBvcy0tOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgaWYgKHBvcyA8IDEpIHsKICAgICAgcmV0dXJuIG9uZS5jaGFyQXQoMCkgPT09IHR3by5jaGFyQXQoMCkgJiYgb25lLmNoYXJBdCgwKSA9PT0gJy8nID8gJy8nIDogJyc7CiAgICB9CgogICAgLy8gcmV2ZXJ0IHRvIGxhc3QgLwogICAgaWYgKG9uZS5jaGFyQXQocG9zKSAhPT0gJy8nIHx8IHR3by5jaGFyQXQocG9zKSAhPT0gJy8nKSB7CiAgICAgIHBvcyA9IG9uZS5zdWJzdHJpbmcoMCwgcG9zKS5sYXN0SW5kZXhPZignLycpOwogICAgfQoKICAgIHJldHVybiBvbmUuc3Vic3RyaW5nKDAsIHBvcyArIDEpOwogIH07CgogIFVSSS53aXRoaW5TdHJpbmcgPSBmdW5jdGlvbiAoc3RyaW5nLCBjYWxsYmFjaywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBfc3RhcnQgPSBvcHRpb25zLnN0YXJ0IHx8IFVSSS5maW5kVXJpLnN0YXJ0OwogICAgdmFyIF9lbmQgPSBvcHRpb25zLmVuZCB8fCBVUkkuZmluZFVyaS5lbmQ7CiAgICB2YXIgX3RyaW0gPSBvcHRpb25zLnRyaW0gfHwgVVJJLmZpbmRVcmkudHJpbTsKICAgIHZhciBfYXR0cmlidXRlT3BlbiA9IC9bYS16MC05LV09WyInXT8kL2k7CgogICAgX3N0YXJ0Lmxhc3RJbmRleCA9IDA7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICB2YXIgbWF0Y2ggPSBfc3RhcnQuZXhlYyhzdHJpbmcpOwogICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHZhciBzdGFydCA9IG1hdGNoLmluZGV4OwogICAgICBpZiAob3B0aW9ucy5pZ25vcmVIdG1sKSB7CiAgICAgICAgLy8gYXR0cmlidXQoZT1bIiddPyQpCiAgICAgICAgdmFyIGF0dHJpYnV0ZU9wZW4gPSBzdHJpbmcuc2xpY2UoTWF0aC5tYXgoc3RhcnQgLSAzLCAwKSwgc3RhcnQpOwogICAgICAgIGlmIChhdHRyaWJ1dGVPcGVuICYmIF9hdHRyaWJ1dGVPcGVuLnRlc3QoYXR0cmlidXRlT3BlbikpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGVuZCA9IHN0YXJ0ICsgc3RyaW5nLnNsaWNlKHN0YXJ0KS5zZWFyY2goX2VuZCk7CiAgICAgIHZhciBzbGljZSA9IHN0cmluZy5zbGljZShzdGFydCwgZW5kKS5yZXBsYWNlKF90cmltLCAnJyk7CiAgICAgIGlmIChvcHRpb25zLmlnbm9yZSAmJiBvcHRpb25zLmlnbm9yZS50ZXN0KHNsaWNlKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBlbmQgPSBzdGFydCArIHNsaWNlLmxlbmd0aDsKICAgICAgdmFyIHJlc3VsdCA9IGNhbGxiYWNrKHNsaWNlLCBzdGFydCwgZW5kLCBzdHJpbmcpOwogICAgICBzdHJpbmcgPSBzdHJpbmcuc2xpY2UoMCwgc3RhcnQpICsgcmVzdWx0ICsgc3RyaW5nLnNsaWNlKGVuZCk7CiAgICAgIF9zdGFydC5sYXN0SW5kZXggPSBzdGFydCArIHJlc3VsdC5sZW5ndGg7CiAgICB9CgogICAgX3N0YXJ0Lmxhc3RJbmRleCA9IDA7CiAgICByZXR1cm4gc3RyaW5nOwogIH07CgogIFVSSS5lbnN1cmVWYWxpZEhvc3RuYW1lID0gZnVuY3Rpb24gKHYpIHsKICAgIC8vIFRoZW9yZXRpY2FsbHkgVVJJcyBhbGxvdyBwZXJjZW50LWVuY29kaW5nIGluIEhvc3RuYW1lcyAoYWNjb3JkaW5nIHRvIFJGQyAzOTg2KQogICAgLy8gdGhleSBhcmUgbm90IHBhcnQgb2YgRE5TIGFuZCB0aGVyZWZvcmUgaWdub3JlZCBieSBVUkkuanMKCiAgICBpZiAodi5tYXRjaChVUkkuaW52YWxpZF9ob3N0bmFtZV9jaGFyYWN0ZXJzKSkgewogICAgICAvLyB0ZXN0IHB1bnljb2RlCiAgICAgIGlmICghcHVueWNvZGUpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdIb3N0bmFtZSAiJyArIHYgKyAnIiBjb250YWlucyBjaGFyYWN0ZXJzIG90aGVyIHRoYW4gW0EtWjAtOS4tXSBhbmQgUHVueWNvZGUuanMgaXMgbm90IGF2YWlsYWJsZScpOwogICAgICB9CgogICAgICBpZiAocHVueWNvZGUudG9BU0NJSSh2KS5tYXRjaChVUkkuaW52YWxpZF9ob3N0bmFtZV9jaGFyYWN0ZXJzKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hvc3RuYW1lICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05Li1dJyk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBub0NvbmZsaWN0CiAgVVJJLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAocmVtb3ZlQWxsKSB7CiAgICBpZiAocmVtb3ZlQWxsKSB7CiAgICAgIHZhciB1bmNvbmZsaWN0ZWQgPSB7CiAgICAgICAgVVJJOiB0aGlzLm5vQ29uZmxpY3QoKQogICAgICB9OwoKICAgICAgaWYgKHJvb3QuVVJJVGVtcGxhdGUgJiYgdHlwZW9mIHJvb3QuVVJJVGVtcGxhdGUubm9Db25mbGljdCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHVuY29uZmxpY3RlZC5VUklUZW1wbGF0ZSA9IHJvb3QuVVJJVGVtcGxhdGUubm9Db25mbGljdCgpOwogICAgICB9CgogICAgICBpZiAocm9vdC5JUHY2ICYmIHR5cGVvZiByb290LklQdjYubm9Db25mbGljdCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHVuY29uZmxpY3RlZC5JUHY2ID0gcm9vdC5JUHY2Lm5vQ29uZmxpY3QoKTsKICAgICAgfQoKICAgICAgaWYgKHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zICYmIHR5cGVvZiByb290LlNlY29uZExldmVsRG9tYWlucy5ub0NvbmZsaWN0ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdW5jb25mbGljdGVkLlNlY29uZExldmVsRG9tYWlucyA9IHJvb3QuU2Vjb25kTGV2ZWxEb21haW5zLm5vQ29uZmxpY3QoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVuY29uZmxpY3RlZDsKICAgIH0gZWxzZSBpZiAocm9vdC5VUkkgPT09IHRoaXMpIHsKICAgICAgcm9vdC5VUkkgPSBfVVJJOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH07CgogIHAuYnVpbGQgPSBmdW5jdGlvbiAoZGVmZXJCdWlsZCkgewogICAgaWYgKGRlZmVyQnVpbGQgPT09IHRydWUpIHsKICAgICAgdGhpcy5fZGVmZXJyZWRfYnVpbGQgPSB0cnVlOwogICAgfSBlbHNlIGlmIChkZWZlckJ1aWxkID09PSB1bmRlZmluZWQgfHwgdGhpcy5fZGVmZXJyZWRfYnVpbGQpIHsKICAgICAgdGhpcy5fc3RyaW5nID0gVVJJLmJ1aWxkKHRoaXMuX3BhcnRzKTsKICAgICAgdGhpcy5fZGVmZXJyZWRfYnVpbGQgPSBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICBwLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIG5ldyBVUkkodGhpcyk7CiAgfTsKCiAgcC52YWx1ZU9mID0gcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmJ1aWxkKGZhbHNlKS5fc3RyaW5nOwogIH07CgogIGZ1bmN0aW9uIGdlbmVyYXRlU2ltcGxlQWNjZXNzb3IoX3BhcnQpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0c1tfcGFydF0gfHwgJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fcGFydHNbX3BhcnRdID0gdiB8fCBudWxsOwogICAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGdlbmVyYXRlUHJlZml4QWNjZXNzb3IoX3BhcnQsIF9rZXkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0c1tfcGFydF0gfHwgJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHYgIT09IG51bGwpIHsKICAgICAgICAgIHYgPSB2ICsgJyc7CiAgICAgICAgICBpZiAodi5jaGFyQXQoMCkgPT09IF9rZXkpIHsKICAgICAgICAgICAgdiA9IHYuc3Vic3RyaW5nKDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5fcGFydHNbX3BhcnRdID0gdjsKICAgICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH07CiAgfQoKICBwLnByb3RvY29sID0gZ2VuZXJhdGVTaW1wbGVBY2Nlc3NvcigncHJvdG9jb2wnKTsKICBwLnVzZXJuYW1lID0gZ2VuZXJhdGVTaW1wbGVBY2Nlc3NvcigndXNlcm5hbWUnKTsKICBwLnBhc3N3b3JkID0gZ2VuZXJhdGVTaW1wbGVBY2Nlc3NvcigncGFzc3dvcmQnKTsKICBwLmhvc3RuYW1lID0gZ2VuZXJhdGVTaW1wbGVBY2Nlc3NvcignaG9zdG5hbWUnKTsKICBwLnBvcnQgPSBnZW5lcmF0ZVNpbXBsZUFjY2Vzc29yKCdwb3J0Jyk7CiAgcC5xdWVyeSA9IGdlbmVyYXRlUHJlZml4QWNjZXNzb3IoJ3F1ZXJ5JywgJz8nKTsKICBwLmZyYWdtZW50ID0gZ2VuZXJhdGVQcmVmaXhBY2Nlc3NvcignZnJhZ21lbnQnLCAnIycpOwoKICBwLnNlYXJjaCA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgdmFyIHQgPSB0aGlzLnF1ZXJ5KHYsIGJ1aWxkKTsKICAgIHJldHVybiB0eXBlb2YgdCA9PT0gJ3N0cmluZycgJiYgdC5sZW5ndGggPyAnPycgKyB0IDogdDsKICB9OwogIHAuaGFzaCA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgdmFyIHQgPSB0aGlzLmZyYWdtZW50KHYsIGJ1aWxkKTsKICAgIHJldHVybiB0eXBlb2YgdCA9PT0gJ3N0cmluZycgJiYgdC5sZW5ndGggPyAnIycgKyB0IDogdDsKICB9OwoKICBwLnBhdGhuYW1lID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodiA9PT0gdW5kZWZpbmVkIHx8IHYgPT09IHRydWUpIHsKICAgICAgdmFyIHJlcyA9IHRoaXMuX3BhcnRzLnBhdGggfHwgKHRoaXMuX3BhcnRzLmhvc3RuYW1lID8gJy8nIDogJycpOwogICAgICByZXR1cm4gdiA/ICh0aGlzLl9wYXJ0cy51cm4gPyBVUkkuZGVjb2RlVXJuUGF0aCA6IFVSSS5kZWNvZGVQYXRoKShyZXMpIDogcmVzOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICAgIHRoaXMuX3BhcnRzLnBhdGggPSB2ID8gVVJJLnJlY29kZVVyblBhdGgodikgOiAnJzsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9wYXJ0cy5wYXRoID0gdiA/IFVSSS5yZWNvZGVQYXRoKHYpIDogJy8nOwogICAgICB9CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLnBhdGggPSBwLnBhdGhuYW1lOwogIHAuaHJlZiA9IGZ1bmN0aW9uIChocmVmLCBidWlsZCkgewogICAgdmFyIGtleTsKCiAgICBpZiAoaHJlZiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKCk7CiAgICB9CgogICAgdGhpcy5fc3RyaW5nID0gJyc7CiAgICB0aGlzLl9wYXJ0cyA9IFVSSS5fcGFydHMoKTsKCiAgICB2YXIgX1VSSSA9IGhyZWYgaW5zdGFuY2VvZiBVUkk7CiAgICB2YXIgX29iamVjdCA9ICh0eXBlb2YgaHJlZiA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoaHJlZikpID09PSAnb2JqZWN0JyAmJiAoaHJlZi5ob3N0bmFtZSB8fCBocmVmLnBhdGggfHwgaHJlZi5wYXRobmFtZSk7CiAgICBpZiAoaHJlZi5ub2RlTmFtZSkgewogICAgICB2YXIgYXR0cmlidXRlID0gVVJJLmdldERvbUF0dHJpYnV0ZShocmVmKTsKICAgICAgaHJlZiA9IGhyZWZbYXR0cmlidXRlXSB8fCAnJzsKICAgICAgX29iamVjdCA9IGZhbHNlOwogICAgfQoKICAgIC8vIHdpbmRvdy5sb2NhdGlvbiBpcyByZXBvcnRlZCB0byBiZSBhbiBvYmplY3QsIGJ1dCBpdCdzIG5vdCB0aGUgc29ydAogICAgLy8gb2Ygb2JqZWN0IHdlJ3JlIGxvb2tpbmcgZm9yOgogICAgLy8gKiBsb2NhdGlvbi5wcm90b2NvbCBlbmRzIHdpdGggYSBjb2xvbgogICAgLy8gKiBsb2NhdGlvbi5xdWVyeSAhPSBvYmplY3Quc2VhcmNoCiAgICAvLyAqIGxvY2F0aW9uLmhhc2ggIT0gb2JqZWN0LmZyYWdtZW50CiAgICAvLyBzaW1wbHkgc2VyaWFsaXppbmcgdGhlIHVua25vd24gb2JqZWN0IHNob3VsZCBkbyB0aGUgdHJpY2sKICAgIC8vIChmb3IgbG9jYXRpb24sIG5vdCBmb3IgZXZlcnl0aGluZy4uLikKICAgIGlmICghX1VSSSAmJiBfb2JqZWN0ICYmIGhyZWYucGF0aG5hbWUgIT09IHVuZGVmaW5lZCkgewogICAgICBocmVmID0gaHJlZi50b1N0cmluZygpOwogICAgfQoKICAgIGlmICh0eXBlb2YgaHJlZiA9PT0gJ3N0cmluZycgfHwgaHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICB0aGlzLl9wYXJ0cyA9IFVSSS5wYXJzZShTdHJpbmcoaHJlZiksIHRoaXMuX3BhcnRzKTsKICAgIH0gZWxzZSBpZiAoX1VSSSB8fCBfb2JqZWN0KSB7CiAgICAgIHZhciBzcmMgPSBfVVJJID8gaHJlZi5fcGFydHMgOiBocmVmOwogICAgICBmb3IgKGtleSBpbiBzcmMpIHsKICAgICAgICBpZiAoaGFzT3duLmNhbGwodGhpcy5fcGFydHMsIGtleSkpIHsKICAgICAgICAgIHRoaXMuX3BhcnRzW2tleV0gPSBzcmNba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2ludmFsaWQgaW5wdXQnKTsKICAgIH0KCiAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBpZGVudGlmaWNhdGlvbiBhY2Nlc3NvcnMKICBwLmlzID0gZnVuY3Rpb24gKHdoYXQpIHsKICAgIHZhciBpcCA9IGZhbHNlOwogICAgdmFyIGlwNCA9IGZhbHNlOwogICAgdmFyIGlwNiA9IGZhbHNlOwogICAgdmFyIG5hbWUgPSBmYWxzZTsKICAgIHZhciBzbGQgPSBmYWxzZTsKICAgIHZhciBpZG4gPSBmYWxzZTsKICAgIHZhciBwdW55Y29kZSA9IGZhbHNlOwogICAgdmFyIHJlbGF0aXZlID0gIXRoaXMuX3BhcnRzLnVybjsKCiAgICBpZiAodGhpcy5fcGFydHMuaG9zdG5hbWUpIHsKICAgICAgcmVsYXRpdmUgPSBmYWxzZTsKICAgICAgaXA0ID0gVVJJLmlwNF9leHByZXNzaW9uLnRlc3QodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICBpcDYgPSBVUkkuaXA2X2V4cHJlc3Npb24udGVzdCh0aGlzLl9wYXJ0cy5ob3N0bmFtZSk7CiAgICAgIGlwID0gaXA0IHx8IGlwNjsKICAgICAgbmFtZSA9ICFpcDsKICAgICAgc2xkID0gbmFtZSAmJiBTTEQgJiYgU0xELmhhcyh0aGlzLl9wYXJ0cy5ob3N0bmFtZSk7CiAgICAgIGlkbiA9IG5hbWUgJiYgVVJJLmlkbl9leHByZXNzaW9uLnRlc3QodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICBwdW55Y29kZSA9IG5hbWUgJiYgVVJJLnB1bnljb2RlX2V4cHJlc3Npb24udGVzdCh0aGlzLl9wYXJ0cy5ob3N0bmFtZSk7CiAgICB9CgogICAgc3dpdGNoICh3aGF0LnRvTG93ZXJDYXNlKCkpIHsKICAgICAgY2FzZSAncmVsYXRpdmUnOgogICAgICAgIHJldHVybiByZWxhdGl2ZTsKCiAgICAgIGNhc2UgJ2Fic29sdXRlJzoKICAgICAgICByZXR1cm4gIXJlbGF0aXZlOwoKICAgICAgLy8gaG9zdG5hbWUgaWRlbnRpZmljYXRpb24KICAgICAgY2FzZSAnZG9tYWluJzoKICAgICAgY2FzZSAnbmFtZSc6CiAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICBjYXNlICdzbGQnOgogICAgICAgIHJldHVybiBzbGQ7CgogICAgICBjYXNlICdpcCc6CiAgICAgICAgcmV0dXJuIGlwOwoKICAgICAgY2FzZSAnaXA0JzoKICAgICAgY2FzZSAnaXB2NCc6CiAgICAgIGNhc2UgJ2luZXQ0JzoKICAgICAgICByZXR1cm4gaXA0OwoKICAgICAgY2FzZSAnaXA2JzoKICAgICAgY2FzZSAnaXB2Nic6CiAgICAgIGNhc2UgJ2luZXQ2JzoKICAgICAgICByZXR1cm4gaXA2OwoKICAgICAgY2FzZSAnaWRuJzoKICAgICAgICByZXR1cm4gaWRuOwoKICAgICAgY2FzZSAndXJsJzoKICAgICAgICByZXR1cm4gIXRoaXMuX3BhcnRzLnVybjsKCiAgICAgIGNhc2UgJ3Vybic6CiAgICAgICAgcmV0dXJuICEhdGhpcy5fcGFydHMudXJuOwoKICAgICAgY2FzZSAncHVueWNvZGUnOgogICAgICAgIHJldHVybiBwdW55Y29kZTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9OwoKICAvLyBjb21wb25lbnQgc3BlY2lmaWMgaW5wdXQgdmFsaWRhdGlvbgogIHZhciBfcHJvdG9jb2wgPSBwLnByb3RvY29sOwogIHZhciBfcG9ydCA9IHAucG9ydDsKICB2YXIgX2hvc3RuYW1lID0gcC5ob3N0bmFtZTsKCiAgcC5wcm90b2NvbCA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodikgewogICAgICAgIC8vIGFjY2VwdCB0cmFpbGluZyA6Ly8KICAgICAgICB2ID0gdi5yZXBsYWNlKC86KFwvXC8pPyQvLCAnJyk7CgogICAgICAgIGlmICghdi5tYXRjaChVUkkucHJvdG9jb2xfZXhwcmVzc2lvbikpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Byb3RvY29sICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05ListXSBvciBkb2VzblwndCBzdGFydCB3aXRoIFtBLVpdJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gX3Byb3RvY29sLmNhbGwodGhpcywgdiwgYnVpbGQpOwogIH07CiAgcC5zY2hlbWUgPSBwLnByb3RvY29sOwogIHAucG9ydCA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKHYgPT09IDApIHsKICAgICAgICB2ID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKHYpIHsKICAgICAgICB2ICs9ICcnOwogICAgICAgIGlmICh2LmNoYXJBdCgwKSA9PT0gJzonKSB7CiAgICAgICAgICB2ID0gdi5zdWJzdHJpbmcoMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi5tYXRjaCgvW14wLTldLykpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1BvcnQgIicgKyB2ICsgJyIgY29udGFpbnMgY2hhcmFjdGVycyBvdGhlciB0aGFuIFswLTldJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gX3BvcnQuY2FsbCh0aGlzLCB2LCBidWlsZCk7CiAgfTsKICBwLmhvc3RuYW1lID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgeCA9IHt9OwogICAgICB2YXIgcmVzID0gVVJJLnBhcnNlSG9zdCh2LCB4KTsKICAgICAgaWYgKHJlcyAhPT0gJy8nKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSG9zdG5hbWUgIicgKyB2ICsgJyIgY29udGFpbnMgY2hhcmFjdGVycyBvdGhlciB0aGFuIFtBLVowLTkuLV0nKTsKICAgICAgfQoKICAgICAgdiA9IHguaG9zdG5hbWU7CiAgICB9CiAgICByZXR1cm4gX2hvc3RuYW1lLmNhbGwodGhpcywgdiwgYnVpbGQpOwogIH07CgogIC8vIGNvbXBvdW5kIGFjY2Vzc29ycwogIHAub3JpZ2luID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgcHJvdG9jb2wgPSB0aGlzLnByb3RvY29sKCk7CiAgICAgIHZhciBhdXRob3JpdHkgPSB0aGlzLmF1dGhvcml0eSgpOwogICAgICBpZiAoIWF1dGhvcml0eSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgcmV0dXJuIChwcm90b2NvbCA/IHByb3RvY29sICsgJzovLycgOiAnJykgKyB0aGlzLmF1dGhvcml0eSgpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIG9yaWdpbiA9IFVSSSh2KTsKICAgICAgdGhpcy5wcm90b2NvbChvcmlnaW4ucHJvdG9jb2woKSkuYXV0aG9yaXR5KG9yaWdpbi5hdXRob3JpdHkoKSkuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLmhvc3QgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA/IFVSSS5idWlsZEhvc3QodGhpcy5fcGFydHMpIDogJyc7CiAgICB9IGVsc2UgewogICAgICB2YXIgcmVzID0gVVJJLnBhcnNlSG9zdCh2LCB0aGlzLl9wYXJ0cyk7CiAgICAgIGlmIChyZXMgIT09ICcvJykgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hvc3RuYW1lICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05Li1dJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLmF1dGhvcml0eSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuX3BhcnRzLmhvc3RuYW1lID8gVVJJLmJ1aWxkQXV0aG9yaXR5KHRoaXMuX3BhcnRzKSA6ICcnOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJlcyA9IFVSSS5wYXJzZUF1dGhvcml0eSh2LCB0aGlzLl9wYXJ0cyk7CiAgICAgIGlmIChyZXMgIT09ICcvJykgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hvc3RuYW1lICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05Li1dJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLnVzZXJpbmZvID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgdCA9IFVSSS5idWlsZFVzZXJpbmZvKHRoaXMuX3BhcnRzKTsKICAgICAgcmV0dXJuIHQgPyB0LnN1YnN0cmluZygwLCB0Lmxlbmd0aCAtIDEpIDogdDsKICAgIH0gZWxzZSB7CiAgICAgIGlmICh2W3YubGVuZ3RoIC0gMV0gIT09ICdAJykgewogICAgICAgIHYgKz0gJ0AnOwogICAgICB9CgogICAgICBVUkkucGFyc2VVc2VyaW5mbyh2LCB0aGlzLl9wYXJ0cyk7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBwLnJlc291cmNlID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICB2YXIgcGFydHM7CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy5wYXRoKCkgKyB0aGlzLnNlYXJjaCgpICsgdGhpcy5oYXNoKCk7CiAgICB9CgogICAgcGFydHMgPSBVUkkucGFyc2Uodik7CiAgICB0aGlzLl9wYXJ0cy5wYXRoID0gcGFydHMucGF0aDsKICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gcGFydHMucXVlcnk7CiAgICB0aGlzLl9wYXJ0cy5mcmFnbWVudCA9IHBhcnRzLmZyYWdtZW50OwogICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gZnJhY3Rpb24gYWNjZXNzb3JzCiAgcC5zdWJkb21haW4gPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICAvLyBjb252ZW5pZW5jZSwgcmV0dXJuICJ3d3ciIGZyb20gInd3dy5leGFtcGxlLm9yZyIKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJ0cy5ob3N0bmFtZSB8fCB0aGlzLmlzKCdJUCcpKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICAvLyBncmFiIGRvbWFpbiBhbmQgYWRkIGFub3RoZXIgc2VnbWVudAogICAgICB2YXIgZW5kID0gdGhpcy5fcGFydHMuaG9zdG5hbWUubGVuZ3RoIC0gdGhpcy5kb21haW4oKS5sZW5ndGggLSAxOwogICAgICByZXR1cm4gdGhpcy5fcGFydHMuaG9zdG5hbWUuc3Vic3RyaW5nKDAsIGVuZCkgfHwgJyc7CiAgICB9IGVsc2UgewogICAgICB2YXIgZSA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLmxlbmd0aCAtIHRoaXMuZG9tYWluKCkubGVuZ3RoOwogICAgICB2YXIgc3ViID0gdGhpcy5fcGFydHMuaG9zdG5hbWUuc3Vic3RyaW5nKDAsIGUpOwogICAgICB2YXIgcmVwbGFjZSA9IG5ldyBSZWdFeHAoJ14nICsgZXNjYXBlUmVnRXgoc3ViKSk7CgogICAgICBpZiAodiAmJiB2LmNoYXJBdCh2Lmxlbmd0aCAtIDEpICE9PSAnLicpIHsKICAgICAgICB2ICs9ICcuJzsKICAgICAgfQoKICAgICAgaWYgKHYpIHsKICAgICAgICBVUkkuZW5zdXJlVmFsaWRIb3N0bmFtZSh2KTsKICAgICAgfQoKICAgICAgdGhpcy5fcGFydHMuaG9zdG5hbWUgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5yZXBsYWNlKHJlcGxhY2UsIHYpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5kb21haW4gPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodHlwZW9mIHYgPT09ICdib29sZWFuJykgewogICAgICBidWlsZCA9IHY7CiAgICAgIHYgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgLy8gY29udmVuaWVuY2UsIHJldHVybiAiZXhhbXBsZS5vcmciIGZyb20gInd3dy5leGFtcGxlLm9yZyIKICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJ0cy5ob3N0bmFtZSB8fCB0aGlzLmlzKCdJUCcpKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICAvLyBpZiBob3N0bmFtZSBjb25zaXN0cyBvZiAxIG9yIDIgc2VnbWVudHMsIGl0IG11c3QgYmUgdGhlIGRvbWFpbgogICAgICB2YXIgdCA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLm1hdGNoKC9cLi9nKTsKICAgICAgaWYgKHQgJiYgdC5sZW5ndGggPCAyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRzLmhvc3RuYW1lOwogICAgICB9CgogICAgICAvLyBncmFiIHRsZCBhbmQgYWRkIGFub3RoZXIgc2VnbWVudAogICAgICB2YXIgZW5kID0gdGhpcy5fcGFydHMuaG9zdG5hbWUubGVuZ3RoIC0gdGhpcy50bGQoYnVpbGQpLmxlbmd0aCAtIDE7CiAgICAgIGVuZCA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLmxhc3RJbmRleE9mKCcuJywgZW5kIC0gMSkgKyAxOwogICAgICByZXR1cm4gdGhpcy5fcGFydHMuaG9zdG5hbWUuc3Vic3RyaW5nKGVuZCkgfHwgJyc7CiAgICB9IGVsc2UgewogICAgICBpZiAoIXYpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdjYW5ub3Qgc2V0IGRvbWFpbiBlbXB0eScpOwogICAgICB9CgogICAgICBVUkkuZW5zdXJlVmFsaWRIb3N0bmFtZSh2KTsKCiAgICAgIGlmICghdGhpcy5fcGFydHMuaG9zdG5hbWUgfHwgdGhpcy5pcygnSVAnKSkgewogICAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gdjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmVwbGFjZSA9IG5ldyBSZWdFeHAoZXNjYXBlUmVnRXgodGhpcy5kb21haW4oKSkgKyAnJCcpOwogICAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gdGhpcy5fcGFydHMuaG9zdG5hbWUucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgfQoKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAudGxkID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHR5cGVvZiB2ID09PSAnYm9vbGVhbicpIHsKICAgICAgYnVpbGQgPSB2OwogICAgICB2ID0gdW5kZWZpbmVkOwogICAgfQoKICAgIC8vIHJldHVybiAib3JnIiBmcm9tICJ3d3cuZXhhbXBsZS5vcmciCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5fcGFydHMuaG9zdG5hbWUgfHwgdGhpcy5pcygnSVAnKSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgdmFyIHBvcyA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgIHZhciB0bGQgPSB0aGlzLl9wYXJ0cy5ob3N0bmFtZS5zdWJzdHJpbmcocG9zICsgMSk7CgogICAgICBpZiAoYnVpbGQgIT09IHRydWUgJiYgU0xEICYmIFNMRC5saXN0W3RsZC50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgIHJldHVybiBTTEQuZ2V0KHRoaXMuX3BhcnRzLmhvc3RuYW1lKSB8fCB0bGQ7CiAgICAgIH0KCiAgICAgIHJldHVybiB0bGQ7CiAgICB9IGVsc2UgewogICAgICB2YXIgcmVwbGFjZTsKCiAgICAgIGlmICghdikgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2Nhbm5vdCBzZXQgVExEIGVtcHR5Jyk7CiAgICAgIH0gZWxzZSBpZiAodi5tYXRjaCgvW15hLXpBLVowLTktXS8pKSB7CiAgICAgICAgaWYgKFNMRCAmJiBTTEQuaXModikpIHsKICAgICAgICAgIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KHRoaXMudGxkKCkpICsgJyQnKTsKICAgICAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gdGhpcy5fcGFydHMuaG9zdG5hbWUucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVExEICInICsgdiArICciIGNvbnRhaW5zIGNoYXJhY3RlcnMgb3RoZXIgdGhhbiBbQS1aMC05XScpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdGhpcy5fcGFydHMuaG9zdG5hbWUgfHwgdGhpcy5pcygnSVAnKSkgewogICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcignY2Fubm90IHNldCBUTEQgb24gbm9uLWRvbWFpbiBob3N0Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVwbGFjZSA9IG5ldyBSZWdFeHAoZXNjYXBlUmVnRXgodGhpcy50bGQoKSkgKyAnJCcpOwogICAgICAgIHRoaXMuX3BhcnRzLmhvc3RuYW1lID0gdGhpcy5fcGFydHMuaG9zdG5hbWUucmVwbGFjZShyZXBsYWNlLCB2KTsKICAgICAgfQoKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHAuZGlyZWN0b3J5ID0gZnVuY3Rpb24gKHYsIGJ1aWxkKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB2ID09PSB1bmRlZmluZWQgPyAnJyA6IHRoaXM7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSB0cnVlKSB7CiAgICAgIGlmICghdGhpcy5fcGFydHMucGF0aCAmJiAhdGhpcy5fcGFydHMuaG9zdG5hbWUpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9wYXJ0cy5wYXRoID09PSAnLycpIHsKICAgICAgICByZXR1cm4gJy8nOwogICAgICB9CgogICAgICB2YXIgZW5kID0gdGhpcy5fcGFydHMucGF0aC5sZW5ndGggLSB0aGlzLmZpbGVuYW1lKCkubGVuZ3RoIC0gMTsKICAgICAgdmFyIHJlcyA9IHRoaXMuX3BhcnRzLnBhdGguc3Vic3RyaW5nKDAsIGVuZCkgfHwgKHRoaXMuX3BhcnRzLmhvc3RuYW1lID8gJy8nIDogJycpOwoKICAgICAgcmV0dXJuIHYgPyBVUkkuZGVjb2RlUGF0aChyZXMpIDogcmVzOwogICAgfSBlbHNlIHsKICAgICAgdmFyIGUgPSB0aGlzLl9wYXJ0cy5wYXRoLmxlbmd0aCAtIHRoaXMuZmlsZW5hbWUoKS5sZW5ndGg7CiAgICAgIHZhciBkaXJlY3RvcnkgPSB0aGlzLl9wYXJ0cy5wYXRoLnN1YnN0cmluZygwLCBlKTsKICAgICAgdmFyIHJlcGxhY2UgPSBuZXcgUmVnRXhwKCdeJyArIGVzY2FwZVJlZ0V4KGRpcmVjdG9yeSkpOwoKICAgICAgLy8gZnVsbHkgcXVhbGlmaWVyIGRpcmVjdG9yaWVzIGJlZ2luIHdpdGggYSBzbGFzaAogICAgICBpZiAoIXRoaXMuaXMoJ3JlbGF0aXZlJykpIHsKICAgICAgICBpZiAoIXYpIHsKICAgICAgICAgIHYgPSAnLyc7CiAgICAgICAgfQoKICAgICAgICBpZiAodi5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICAgICAgdiA9ICcvJyArIHY7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBkaXJlY3RvcmllcyBhbHdheXMgZW5kIHdpdGggYSBzbGFzaAogICAgICBpZiAodiAmJiB2LmNoYXJBdCh2Lmxlbmd0aCAtIDEpICE9PSAnLycpIHsKICAgICAgICB2ICs9ICcvJzsKICAgICAgfQoKICAgICAgdiA9IFVSSS5yZWNvZGVQYXRoKHYpOwogICAgICB0aGlzLl9wYXJ0cy5wYXRoID0gdGhpcy5fcGFydHMucGF0aC5yZXBsYWNlKHJlcGxhY2UsIHYpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5maWxlbmFtZSA9IGZ1bmN0aW9uICh2LCBidWlsZCkgewogICAgaWYgKHRoaXMuX3BhcnRzLnVybikgewogICAgICByZXR1cm4gdiA9PT0gdW5kZWZpbmVkID8gJycgOiB0aGlzOwogICAgfQoKICAgIGlmICh2ID09PSB1bmRlZmluZWQgfHwgdiA9PT0gdHJ1ZSkgewogICAgICBpZiAoIXRoaXMuX3BhcnRzLnBhdGggfHwgdGhpcy5fcGFydHMucGF0aCA9PT0gJy8nKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICB2YXIgcG9zID0gdGhpcy5fcGFydHMucGF0aC5sYXN0SW5kZXhPZignLycpOwogICAgICB2YXIgcmVzID0gdGhpcy5fcGFydHMucGF0aC5zdWJzdHJpbmcocG9zICsgMSk7CgogICAgICByZXR1cm4gdiA/IFVSSS5kZWNvZGVQYXRoU2VnbWVudChyZXMpIDogcmVzOwogICAgfSBlbHNlIHsKICAgICAgdmFyIG11dGF0ZWREaXJlY3RvcnkgPSBmYWxzZTsKCiAgICAgIGlmICh2LmNoYXJBdCgwKSA9PT0gJy8nKSB7CiAgICAgICAgdiA9IHYuc3Vic3RyaW5nKDEpOwogICAgICB9CgogICAgICBpZiAodi5tYXRjaCgvXC4/XC8vKSkgewogICAgICAgIG11dGF0ZWREaXJlY3RvcnkgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIgcmVwbGFjZSA9IG5ldyBSZWdFeHAoZXNjYXBlUmVnRXgodGhpcy5maWxlbmFtZSgpKSArICckJyk7CiAgICAgIHYgPSBVUkkucmVjb2RlUGF0aCh2KTsKICAgICAgdGhpcy5fcGFydHMucGF0aCA9IHRoaXMuX3BhcnRzLnBhdGgucmVwbGFjZShyZXBsYWNlLCB2KTsKCiAgICAgIGlmIChtdXRhdGVkRGlyZWN0b3J5KSB7CiAgICAgICAgdGhpcy5ub3JtYWxpemVQYXRoKGJ1aWxkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5zdWZmaXggPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/ICcnIDogdGhpczsKICAgIH0KCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkIHx8IHYgPT09IHRydWUpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJ0cy5wYXRoIHx8IHRoaXMuX3BhcnRzLnBhdGggPT09ICcvJykgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgdmFyIGZpbGVuYW1lID0gdGhpcy5maWxlbmFtZSgpOwogICAgICB2YXIgcG9zID0gZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgdmFyIHMsIHJlczsKCiAgICAgIGlmIChwb3MgPT09IC0xKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICAvLyBzdWZmaXggbWF5IG9ubHkgY29udGFpbiBhbG51bSBjaGFyYWN0ZXJzICh5dXAsIEkgbWFkZSB0aGlzIHVwLikKICAgICAgcyA9IGZpbGVuYW1lLnN1YnN0cmluZyhwb3MgKyAxKTsKICAgICAgcmVzID0gL15bYS16MC05JV0rJC9pLnRlc3QocykgPyBzIDogJyc7CiAgICAgIHJldHVybiB2ID8gVVJJLmRlY29kZVBhdGhTZWdtZW50KHJlcykgOiByZXM7CiAgICB9IGVsc2UgewogICAgICBpZiAodi5jaGFyQXQoMCkgPT09ICcuJykgewogICAgICAgIHYgPSB2LnN1YnN0cmluZygxKTsKICAgICAgfQoKICAgICAgdmFyIHN1ZmZpeCA9IHRoaXMuc3VmZml4KCk7CiAgICAgIHZhciByZXBsYWNlOwoKICAgICAgaWYgKCFzdWZmaXgpIHsKICAgICAgICBpZiAoIXYpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fcGFydHMucGF0aCArPSAnLicgKyBVUkkucmVjb2RlUGF0aCh2KTsKICAgICAgfSBlbHNlIGlmICghdikgewogICAgICAgIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KCcuJyArIHN1ZmZpeCkgKyAnJCcpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlcGxhY2UgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4KHN1ZmZpeCkgKyAnJCcpOwogICAgICB9CgogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIHYgPSBVUkkucmVjb2RlUGF0aCh2KTsKICAgICAgICB0aGlzLl9wYXJ0cy5wYXRoID0gdGhpcy5fcGFydHMucGF0aC5yZXBsYWNlKHJlcGxhY2UsIHYpOwogICAgICB9CgogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgcC5zZWdtZW50ID0gZnVuY3Rpb24gKHNlZ21lbnQsIHYsIGJ1aWxkKSB7CiAgICB2YXIgc2VwYXJhdG9yID0gdGhpcy5fcGFydHMudXJuID8gJzonIDogJy8nOwogICAgdmFyIHBhdGggPSB0aGlzLnBhdGgoKTsKICAgIHZhciBhYnNvbHV0ZSA9IHBhdGguc3Vic3RyaW5nKDAsIDEpID09PSAnLyc7CiAgICB2YXIgc2VnbWVudHMgPSBwYXRoLnNwbGl0KHNlcGFyYXRvcik7CgogICAgaWYgKHNlZ21lbnQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2VnbWVudCAhPT0gJ251bWJlcicpIHsKICAgICAgYnVpbGQgPSB2OwogICAgICB2ID0gc2VnbWVudDsKICAgICAgc2VnbWVudCA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpZiAoc2VnbWVudCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBzZWdtZW50ICE9PSAnbnVtYmVyJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBzZWdtZW50ICInICsgc2VnbWVudCArICciLCBtdXN0IGJlIDAtYmFzZWQgaW50ZWdlcicpOwogICAgfQoKICAgIGlmIChhYnNvbHV0ZSkgewogICAgICBzZWdtZW50cy5zaGlmdCgpOwogICAgfQoKICAgIGlmIChzZWdtZW50IDwgMCkgewogICAgICAvLyBhbGxvdyBuZWdhdGl2ZSBpbmRleGVzIHRvIGFkZHJlc3MgZnJvbSB0aGUgZW5kCiAgICAgIHNlZ21lbnQgPSBNYXRoLm1heChzZWdtZW50cy5sZW5ndGggKyBzZWdtZW50LCAwKTsKICAgIH0KCiAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIC8qanNoaW50IGxheGJyZWFrOiB0cnVlICovCiAgICAgIHJldHVybiBzZWdtZW50ID09PSB1bmRlZmluZWQgPyBzZWdtZW50cyA6IHNlZ21lbnRzW3NlZ21lbnRdOwogICAgICAvKmpzaGludCBsYXhicmVhazogZmFsc2UgKi8KICAgIH0gZWxzZSBpZiAoc2VnbWVudCA9PT0gbnVsbCB8fCBzZWdtZW50c1tzZWdtZW50XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGlzQXJyYXkodikpIHsKICAgICAgICAgIHNlZ21lbnRzID0gW107CiAgICAgICAgICAvLyBjb2xsYXBzZSBlbXB0eSBlbGVtZW50cyB3aXRoaW4gYXJyYXkKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgaWYgKCF2W2ldLmxlbmd0aCAmJiAoIXNlZ21lbnRzLmxlbmd0aCB8fCAhc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV0ubGVuZ3RoKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VnbWVudHMubGVuZ3RoICYmICFzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXS5sZW5ndGgpIHsKICAgICAgICAgICAgICBzZWdtZW50cy5wb3AoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VnbWVudHMucHVzaCh0cmltU2xhc2hlcyh2W2ldKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh2IHx8IHR5cGVvZiB2ID09PSAnc3RyaW5nJykgewogICAgICAgICAgdiA9IHRyaW1TbGFzaGVzKHYpOwogICAgICAgICAgaWYgKHNlZ21lbnRzW3NlZ21lbnRzLmxlbmd0aCAtIDFdID09PSAnJykgewogICAgICAgICAgICAvLyBlbXB0eSB0cmFpbGluZyBlbGVtZW50cyBoYXZlIHRvIGJlIG92ZXJ3cml0dGVuCiAgICAgICAgICAgIC8vIHRvIHByZXZlbnQgcmVzdWx0cyBzdWNoIGFzIC9mb28vL2JhcgogICAgICAgICAgICBzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXSA9IHY7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWdtZW50cy5wdXNoKHYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodikgewogICAgICAgICAgc2VnbWVudHNbc2VnbWVudF0gPSB0cmltU2xhc2hlcyh2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VnbWVudHMuc3BsaWNlKHNlZ21lbnQsIDEpOwogICAgICAgIH0KICAgICAgfQoKICAgIGlmIChhYnNvbHV0ZSkgewogICAgICBzZWdtZW50cy51bnNoaWZ0KCcnKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5wYXRoKHNlZ21lbnRzLmpvaW4oc2VwYXJhdG9yKSwgYnVpbGQpOwogIH07CiAgcC5zZWdtZW50Q29kZWQgPSBmdW5jdGlvbiAoc2VnbWVudCwgdiwgYnVpbGQpIHsKICAgIHZhciBzZWdtZW50cywgaSwgbDsKCiAgICBpZiAodHlwZW9mIHNlZ21lbnQgIT09ICdudW1iZXInKSB7CiAgICAgIGJ1aWxkID0gdjsKICAgICAgdiA9IHNlZ21lbnQ7CiAgICAgIHNlZ21lbnQgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKHYgPT09IHVuZGVmaW5lZCkgewogICAgICBzZWdtZW50cyA9IHRoaXMuc2VnbWVudChzZWdtZW50LCB2LCBidWlsZCk7CiAgICAgIGlmICghaXNBcnJheShzZWdtZW50cykpIHsKICAgICAgICBzZWdtZW50cyA9IHNlZ21lbnRzICE9PSB1bmRlZmluZWQgPyBVUkkuZGVjb2RlKHNlZ21lbnRzKSA6IHVuZGVmaW5lZDsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBzZWdtZW50c1tpXSA9IFVSSS5kZWNvZGUoc2VnbWVudHNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNlZ21lbnRzOwogICAgfQoKICAgIGlmICghaXNBcnJheSh2KSkgewogICAgICB2ID0gdHlwZW9mIHYgPT09ICdzdHJpbmcnIHx8IHYgaW5zdGFuY2VvZiBTdHJpbmcgPyBVUkkuZW5jb2RlKHYpIDogdjsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoaSA9IDAsIGwgPSB2Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHZbaV0gPSBVUkkuZW5jb2RlKHZbaV0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXMuc2VnbWVudChzZWdtZW50LCB2LCBidWlsZCk7CiAgfTsKCiAgLy8gbXV0YXRpbmcgcXVlcnkgc3RyaW5nCiAgdmFyIHEgPSBwLnF1ZXJ5OwogIHAucXVlcnkgPSBmdW5jdGlvbiAodiwgYnVpbGQpIHsKICAgIGlmICh2ID09PSB0cnVlKSB7CiAgICAgIHJldHVybiBVUkkucGFyc2VRdWVyeSh0aGlzLl9wYXJ0cy5xdWVyeSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhciBkYXRhID0gVVJJLnBhcnNlUXVlcnkodGhpcy5fcGFydHMucXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgICB2YXIgcmVzdWx0ID0gdi5jYWxsKHRoaXMsIGRhdGEpOwogICAgICB0aGlzLl9wYXJ0cy5xdWVyeSA9IFVSSS5idWlsZFF1ZXJ5KHJlc3VsdCB8fCBkYXRhLCB0aGlzLl9wYXJ0cy5kdXBsaWNhdGVRdWVyeVBhcmFtZXRlcnMsIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSBlbHNlIGlmICh2ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHYgIT09ICdzdHJpbmcnKSB7CiAgICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gVVJJLmJ1aWxkUXVlcnkodiwgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBxLmNhbGwodGhpcywgdiwgYnVpbGQpOwogICAgfQogIH07CiAgcC5zZXRRdWVyeSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgYnVpbGQpIHsKICAgIHZhciBkYXRhID0gVVJJLnBhcnNlUXVlcnkodGhpcy5fcGFydHMucXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwoKICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycgfHwgbmFtZSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICBkYXRhW25hbWVdID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDogbnVsbDsKICAgIH0gZWxzZSBpZiAoKHR5cGVvZiBuYW1lID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihuYW1lKSkgPT09ICdvYmplY3QnKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBuYW1lKSB7CiAgICAgICAgaWYgKGhhc093bi5jYWxsKG5hbWUsIGtleSkpIHsKICAgICAgICAgIGRhdGFba2V5XSA9IG5hbWVba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VSSS5hZGRRdWVyeSgpIGFjY2VwdHMgYW4gb2JqZWN0LCBzdHJpbmcgYXMgdGhlIG5hbWUgcGFyYW1ldGVyJyk7CiAgICB9CgogICAgdGhpcy5fcGFydHMucXVlcnkgPSBVUkkuYnVpbGRRdWVyeShkYXRhLCB0aGlzLl9wYXJ0cy5kdXBsaWNhdGVRdWVyeVBhcmFtZXRlcnMsIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykgewogICAgICBidWlsZCA9IHZhbHVlOwogICAgfQoKICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIHJldHVybiB0aGlzOwogIH07CiAgcC5hZGRRdWVyeSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgYnVpbGQpIHsKICAgIHZhciBkYXRhID0gVVJJLnBhcnNlUXVlcnkodGhpcy5fcGFydHMucXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgVVJJLmFkZFF1ZXJ5KGRhdGEsIG5hbWUsIHZhbHVlID09PSB1bmRlZmluZWQgPyBudWxsIDogdmFsdWUpOwogICAgdGhpcy5fcGFydHMucXVlcnkgPSBVUkkuYnVpbGRRdWVyeShkYXRhLCB0aGlzLl9wYXJ0cy5kdXBsaWNhdGVRdWVyeVBhcmFtZXRlcnMsIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykgewogICAgICBidWlsZCA9IHZhbHVlOwogICAgfQoKICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIHJldHVybiB0aGlzOwogIH07CiAgcC5yZW1vdmVRdWVyeSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgYnVpbGQpIHsKICAgIHZhciBkYXRhID0gVVJJLnBhcnNlUXVlcnkodGhpcy5fcGFydHMucXVlcnksIHRoaXMuX3BhcnRzLmVzY2FwZVF1ZXJ5U3BhY2UpOwogICAgVVJJLnJlbW92ZVF1ZXJ5KGRhdGEsIG5hbWUsIHZhbHVlKTsKICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gVVJJLmJ1aWxkUXVlcnkoZGF0YSwgdGhpcy5fcGFydHMuZHVwbGljYXRlUXVlcnlQYXJhbWV0ZXJzLCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgYnVpbGQgPSB2YWx1ZTsKICAgIH0KCiAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHAuaGFzUXVlcnkgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIHdpdGhpbkFycmF5KSB7CiAgICB2YXIgZGF0YSA9IFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKICAgIHJldHVybiBVUkkuaGFzUXVlcnkoZGF0YSwgbmFtZSwgdmFsdWUsIHdpdGhpbkFycmF5KTsKICB9OwogIHAuc2V0U2VhcmNoID0gcC5zZXRRdWVyeTsKICBwLmFkZFNlYXJjaCA9IHAuYWRkUXVlcnk7CiAgcC5yZW1vdmVTZWFyY2ggPSBwLnJlbW92ZVF1ZXJ5OwogIHAuaGFzU2VhcmNoID0gcC5oYXNRdWVyeTsKCiAgLy8gc2FuaXRpemluZyBVUkxzCiAgcC5ub3JtYWxpemUgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHJldHVybiB0aGlzLm5vcm1hbGl6ZVByb3RvY29sKGZhbHNlKS5ub3JtYWxpemVQYXRoKGZhbHNlKS5ub3JtYWxpemVRdWVyeShmYWxzZSkubm9ybWFsaXplRnJhZ21lbnQoZmFsc2UpLmJ1aWxkKCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMubm9ybWFsaXplUHJvdG9jb2woZmFsc2UpLm5vcm1hbGl6ZUhvc3RuYW1lKGZhbHNlKS5ub3JtYWxpemVQb3J0KGZhbHNlKS5ub3JtYWxpemVQYXRoKGZhbHNlKS5ub3JtYWxpemVRdWVyeShmYWxzZSkubm9ybWFsaXplRnJhZ21lbnQoZmFsc2UpLmJ1aWxkKCk7CiAgfTsKICBwLm5vcm1hbGl6ZVByb3RvY29sID0gZnVuY3Rpb24gKGJ1aWxkKSB7CiAgICBpZiAodHlwZW9mIHRoaXMuX3BhcnRzLnByb3RvY29sID09PSAnc3RyaW5nJykgewogICAgICB0aGlzLl9wYXJ0cy5wcm90b2NvbCA9IHRoaXMuX3BhcnRzLnByb3RvY29sLnRvTG93ZXJDYXNlKCk7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwogIHAubm9ybWFsaXplSG9zdG5hbWUgPSBmdW5jdGlvbiAoYnVpbGQpIHsKICAgIGlmICh0aGlzLl9wYXJ0cy5ob3N0bmFtZSkgewogICAgICBpZiAodGhpcy5pcygnSUROJykgJiYgcHVueWNvZGUpIHsKICAgICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHB1bnljb2RlLnRvQVNDSUkodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXMoJ0lQdjYnKSAmJiBJUHY2KSB7CiAgICAgICAgdGhpcy5fcGFydHMuaG9zdG5hbWUgPSBJUHY2LmJlc3QodGhpcy5fcGFydHMuaG9zdG5hbWUpOwogICAgICB9CgogICAgICB0aGlzLl9wYXJ0cy5ob3N0bmFtZSA9IHRoaXMuX3BhcnRzLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwogIHAubm9ybWFsaXplUG9ydCA9IGZ1bmN0aW9uIChidWlsZCkgewogICAgLy8gcmVtb3ZlIHBvcnQgb2YgaXQncyB0aGUgcHJvdG9jb2wncyBkZWZhdWx0CiAgICBpZiAodHlwZW9mIHRoaXMuX3BhcnRzLnByb3RvY29sID09PSAnc3RyaW5nJyAmJiB0aGlzLl9wYXJ0cy5wb3J0ID09PSBVUkkuZGVmYXVsdFBvcnRzW3RoaXMuX3BhcnRzLnByb3RvY29sXSkgewogICAgICB0aGlzLl9wYXJ0cy5wb3J0ID0gbnVsbDsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH07CiAgcC5ub3JtYWxpemVQYXRoID0gZnVuY3Rpb24gKGJ1aWxkKSB7CiAgICB2YXIgX3BhdGggPSB0aGlzLl9wYXJ0cy5wYXRoOwogICAgaWYgKCFfcGF0aCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBpZiAodGhpcy5fcGFydHMudXJuKSB7CiAgICAgIHRoaXMuX3BhcnRzLnBhdGggPSBVUkkucmVjb2RlVXJuUGF0aCh0aGlzLl9wYXJ0cy5wYXRoKTsKICAgICAgdGhpcy5idWlsZCghYnVpbGQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBpZiAodGhpcy5fcGFydHMucGF0aCA9PT0gJy8nKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIF9wYXRoID0gVVJJLnJlY29kZVBhdGgoX3BhdGgpOwoKICAgIHZhciBfd2FzX3JlbGF0aXZlOwogICAgdmFyIF9sZWFkaW5nUGFyZW50cyA9ICcnOwogICAgdmFyIF9wYXJlbnQsIF9wb3M7CgogICAgLy8gaGFuZGxlIHJlbGF0aXZlIHBhdGhzCiAgICBpZiAoX3BhdGguY2hhckF0KDApICE9PSAnLycpIHsKICAgICAgX3dhc19yZWxhdGl2ZSA9IHRydWU7CiAgICAgIF9wYXRoID0gJy8nICsgX3BhdGg7CiAgICB9CgogICAgLy8gaGFuZGxlIHJlbGF0aXZlIGZpbGVzIChhcyBvcHBvc2VkIHRvIGRpcmVjdG9yaWVzKQogICAgaWYgKF9wYXRoLnNsaWNlKC0zKSA9PT0gJy8uLicgfHwgX3BhdGguc2xpY2UoLTIpID09PSAnLy4nKSB7CiAgICAgIF9wYXRoICs9ICcvJzsKICAgIH0KCiAgICAvLyByZXNvbHZlIHNpbXBsZXMKICAgIF9wYXRoID0gX3BhdGgucmVwbGFjZSgvKFwvKFwuXC8pKyl8KFwvXC4kKS9nLCAnLycpLnJlcGxhY2UoL1wvezIsfS9nLCAnLycpOwoKICAgIC8vIHJlbWVtYmVyIGxlYWRpbmcgcGFyZW50cwogICAgaWYgKF93YXNfcmVsYXRpdmUpIHsKICAgICAgX2xlYWRpbmdQYXJlbnRzID0gX3BhdGguc3Vic3RyaW5nKDEpLm1hdGNoKC9eKFwuXC5cLykrLykgfHwgJyc7CiAgICAgIGlmIChfbGVhZGluZ1BhcmVudHMpIHsKICAgICAgICBfbGVhZGluZ1BhcmVudHMgPSBfbGVhZGluZ1BhcmVudHNbMF07CiAgICAgIH0KICAgIH0KCiAgICAvLyByZXNvbHZlIHBhcmVudHMKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIF9wYXJlbnQgPSBfcGF0aC5zZWFyY2goL1wvXC5cLihcL3wkKS8pOwogICAgICBpZiAoX3BhcmVudCA9PT0gLTEpIHsKICAgICAgICAvLyBubyBtb3JlIC4uLyB0byByZXNvbHZlCiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoX3BhcmVudCA9PT0gMCkgewogICAgICAgIC8vIHRvcCBsZXZlbCBjYW5ub3QgYmUgcmVsYXRpdmUsIHNraXAgaXQKICAgICAgICBfcGF0aCA9IF9wYXRoLnN1YnN0cmluZygzKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgX3BvcyA9IF9wYXRoLnN1YnN0cmluZygwLCBfcGFyZW50KS5sYXN0SW5kZXhPZignLycpOwogICAgICBpZiAoX3BvcyA9PT0gLTEpIHsKICAgICAgICBfcG9zID0gX3BhcmVudDsKICAgICAgfQogICAgICBfcGF0aCA9IF9wYXRoLnN1YnN0cmluZygwLCBfcG9zKSArIF9wYXRoLnN1YnN0cmluZyhfcGFyZW50ICsgMyk7CiAgICB9CgogICAgLy8gcmV2ZXJ0IHRvIHJlbGF0aXZlCiAgICBpZiAoX3dhc19yZWxhdGl2ZSAmJiB0aGlzLmlzKCdyZWxhdGl2ZScpKSB7CiAgICAgIF9wYXRoID0gX2xlYWRpbmdQYXJlbnRzICsgX3BhdGguc3Vic3RyaW5nKDEpOwogICAgfQoKICAgIHRoaXMuX3BhcnRzLnBhdGggPSBfcGF0aDsKICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIHJldHVybiB0aGlzOwogIH07CiAgcC5ub3JtYWxpemVQYXRobmFtZSA9IHAubm9ybWFsaXplUGF0aDsKICBwLm5vcm1hbGl6ZVF1ZXJ5ID0gZnVuY3Rpb24gKGJ1aWxkKSB7CiAgICBpZiAodHlwZW9mIHRoaXMuX3BhcnRzLnF1ZXJ5ID09PSAnc3RyaW5nJykgewogICAgICBpZiAoIXRoaXMuX3BhcnRzLnF1ZXJ5Lmxlbmd0aCkgewogICAgICAgIHRoaXMuX3BhcnRzLnF1ZXJ5ID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnF1ZXJ5KFVSSS5wYXJzZVF1ZXJ5KHRoaXMuX3BhcnRzLnF1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuYnVpbGQoIWJ1aWxkKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwogIHAubm9ybWFsaXplRnJhZ21lbnQgPSBmdW5jdGlvbiAoYnVpbGQpIHsKICAgIGlmICghdGhpcy5fcGFydHMuZnJhZ21lbnQpIHsKICAgICAgdGhpcy5fcGFydHMuZnJhZ21lbnQgPSBudWxsOwogICAgICB0aGlzLmJ1aWxkKCFidWlsZCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBwLm5vcm1hbGl6ZVNlYXJjaCA9IHAubm9ybWFsaXplUXVlcnk7CiAgcC5ub3JtYWxpemVIYXNoID0gcC5ub3JtYWxpemVGcmFnbWVudDsKCiAgcC5pc284ODU5ID0gZnVuY3Rpb24gKCkgewogICAgLy8gZXhwZWN0IHVuaWNvZGUgaW5wdXQsIGlzbzg4NTkgb3V0cHV0CiAgICB2YXIgZSA9IFVSSS5lbmNvZGU7CiAgICB2YXIgZCA9IFVSSS5kZWNvZGU7CgogICAgVVJJLmVuY29kZSA9IGVzY2FwZTsKICAgIFVSSS5kZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQ7CiAgICB0cnkgewogICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgVVJJLmVuY29kZSA9IGU7CiAgICAgIFVSSS5kZWNvZGUgPSBkOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgcC51bmljb2RlID0gZnVuY3Rpb24gKCkgewogICAgLy8gZXhwZWN0IGlzbzg4NTkgaW5wdXQsIHVuaWNvZGUgb3V0cHV0CiAgICB2YXIgZSA9IFVSSS5lbmNvZGU7CiAgICB2YXIgZCA9IFVSSS5kZWNvZGU7CgogICAgVVJJLmVuY29kZSA9IHN0cmljdEVuY29kZVVSSUNvbXBvbmVudDsKICAgIFVSSS5kZWNvZGUgPSB1bmVzY2FwZTsKICAgIHRyeSB7CiAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBVUkkuZW5jb2RlID0gZTsKICAgICAgVVJJLmRlY29kZSA9IGQ7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBwLnJlYWRhYmxlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHVyaSA9IHRoaXMuY2xvbmUoKTsKICAgIC8vIHJlbW92aW5nIHVzZXJuYW1lLCBwYXNzd29yZCwgYmVjYXVzZSB0aGV5IHNob3VsZG4ndCBiZSBkaXNwbGF5ZWQgYWNjb3JkaW5nIHRvIFJGQyAzOTg2CiAgICB1cmkudXNlcm5hbWUoJycpLnBhc3N3b3JkKCcnKS5ub3JtYWxpemUoKTsKICAgIHZhciB0ID0gJyc7CiAgICBpZiAodXJpLl9wYXJ0cy5wcm90b2NvbCkgewogICAgICB0ICs9IHVyaS5fcGFydHMucHJvdG9jb2wgKyAnOi8vJzsKICAgIH0KCiAgICBpZiAodXJpLl9wYXJ0cy5ob3N0bmFtZSkgewogICAgICBpZiAodXJpLmlzKCdwdW55Y29kZScpICYmIHB1bnljb2RlKSB7CiAgICAgICAgdCArPSBwdW55Y29kZS50b1VuaWNvZGUodXJpLl9wYXJ0cy5ob3N0bmFtZSk7CiAgICAgICAgaWYgKHVyaS5fcGFydHMucG9ydCkgewogICAgICAgICAgdCArPSAnOicgKyB1cmkuX3BhcnRzLnBvcnQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHQgKz0gdXJpLmhvc3QoKTsKICAgICAgfQogICAgfQoKICAgIGlmICh1cmkuX3BhcnRzLmhvc3RuYW1lICYmIHVyaS5fcGFydHMucGF0aCAmJiB1cmkuX3BhcnRzLnBhdGguY2hhckF0KDApICE9PSAnLycpIHsKICAgICAgdCArPSAnLyc7CiAgICB9CgogICAgdCArPSB1cmkucGF0aCh0cnVlKTsKICAgIGlmICh1cmkuX3BhcnRzLnF1ZXJ5KSB7CiAgICAgIHZhciBxID0gJyc7CiAgICAgIGZvciAodmFyIGkgPSAwLCBxcCA9IHVyaS5fcGFydHMucXVlcnkuc3BsaXQoJyYnKSwgbCA9IHFwLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBrdiA9IChxcFtpXSB8fCAnJykuc3BsaXQoJz0nKTsKICAgICAgICBxICs9ICcmJyArIFVSSS5kZWNvZGVRdWVyeShrdlswXSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSkucmVwbGFjZSgvJi9nLCAnJTI2Jyk7CgogICAgICAgIGlmIChrdlsxXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBxICs9ICc9JyArIFVSSS5kZWNvZGVRdWVyeShrdlsxXSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSkucmVwbGFjZSgvJi9nLCAnJTI2Jyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHQgKz0gJz8nICsgcS5zdWJzdHJpbmcoMSk7CiAgICB9CgogICAgdCArPSBVUkkuZGVjb2RlUXVlcnkodXJpLmhhc2goKSwgdHJ1ZSk7CiAgICByZXR1cm4gdDsKICB9OwoKICAvLyByZXNvbHZpbmcgcmVsYXRpdmUgYW5kIGFic29sdXRlIFVSTHMKICBwLmFic29sdXRlVG8gPSBmdW5jdGlvbiAoYmFzZSkgewogICAgdmFyIHJlc29sdmVkID0gdGhpcy5jbG9uZSgpOwogICAgdmFyIHByb3BlcnRpZXMgPSBbJ3Byb3RvY29sJywgJ3VzZXJuYW1lJywgJ3Bhc3N3b3JkJywgJ2hvc3RuYW1lJywgJ3BvcnQnXTsKICAgIHZhciBiYXNlZGlyLCBpLCBwOwoKICAgIGlmICh0aGlzLl9wYXJ0cy51cm4pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdVUk5zIGRvIG5vdCBoYXZlIGFueSBnZW5lcmFsbHkgZGVmaW5lZCBoaWVyYXJjaGljYWwgY29tcG9uZW50cycpOwogICAgfQoKICAgIGlmICghKGJhc2UgaW5zdGFuY2VvZiBVUkkpKSB7CiAgICAgIGJhc2UgPSBuZXcgVVJJKGJhc2UpOwogICAgfQoKICAgIGlmICghcmVzb2x2ZWQuX3BhcnRzLnByb3RvY29sKSB7CiAgICAgIHJlc29sdmVkLl9wYXJ0cy5wcm90b2NvbCA9IGJhc2UuX3BhcnRzLnByb3RvY29sOwogICAgfQoKICAgIGlmICh0aGlzLl9wYXJ0cy5ob3N0bmFtZSkgewogICAgICByZXR1cm4gcmVzb2x2ZWQ7CiAgICB9CgogICAgZm9yIChpID0gMDsgcCA9IHByb3BlcnRpZXNbaV07IGkrKykgewogICAgICByZXNvbHZlZC5fcGFydHNbcF0gPSBiYXNlLl9wYXJ0c1twXTsKICAgIH0KCiAgICBpZiAoIXJlc29sdmVkLl9wYXJ0cy5wYXRoKSB7CiAgICAgIHJlc29sdmVkLl9wYXJ0cy5wYXRoID0gYmFzZS5fcGFydHMucGF0aDsKICAgICAgaWYgKCFyZXNvbHZlZC5fcGFydHMucXVlcnkpIHsKICAgICAgICByZXNvbHZlZC5fcGFydHMucXVlcnkgPSBiYXNlLl9wYXJ0cy5xdWVyeTsKICAgICAgfQogICAgfSBlbHNlIGlmIChyZXNvbHZlZC5fcGFydHMucGF0aC5zdWJzdHJpbmcoLTIpID09PSAnLi4nKSB7CiAgICAgIHJlc29sdmVkLl9wYXJ0cy5wYXRoICs9ICcvJzsKICAgIH0KCiAgICBpZiAocmVzb2x2ZWQucGF0aCgpLmNoYXJBdCgwKSAhPT0gJy8nKSB7CiAgICAgIGJhc2VkaXIgPSBiYXNlLmRpcmVjdG9yeSgpOwogICAgICBiYXNlZGlyID0gYmFzZWRpciA/IGJhc2VkaXIgOiBiYXNlLnBhdGgoKS5pbmRleE9mKCcvJykgPT09IDAgPyAnLycgOiAnJzsKICAgICAgcmVzb2x2ZWQuX3BhcnRzLnBhdGggPSAoYmFzZWRpciA/IGJhc2VkaXIgKyAnLycgOiAnJykgKyByZXNvbHZlZC5fcGFydHMucGF0aDsKICAgICAgcmVzb2x2ZWQubm9ybWFsaXplUGF0aCgpOwogICAgfQoKICAgIHJlc29sdmVkLmJ1aWxkKCk7CiAgICByZXR1cm4gcmVzb2x2ZWQ7CiAgfTsKICBwLnJlbGF0aXZlVG8gPSBmdW5jdGlvbiAoYmFzZSkgewogICAgdmFyIHJlbGF0aXZlID0gdGhpcy5jbG9uZSgpLm5vcm1hbGl6ZSgpOwogICAgdmFyIHJlbGF0aXZlUGFydHMsIGJhc2VQYXJ0cywgY29tbW9uLCByZWxhdGl2ZVBhdGgsIGJhc2VQYXRoOwoKICAgIGlmIChyZWxhdGl2ZS5fcGFydHMudXJuKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVVJOcyBkbyBub3QgaGF2ZSBhbnkgZ2VuZXJhbGx5IGRlZmluZWQgaGllcmFyY2hpY2FsIGNvbXBvbmVudHMnKTsKICAgIH0KCiAgICBiYXNlID0gbmV3IFVSSShiYXNlKS5ub3JtYWxpemUoKTsKICAgIHJlbGF0aXZlUGFydHMgPSByZWxhdGl2ZS5fcGFydHM7CiAgICBiYXNlUGFydHMgPSBiYXNlLl9wYXJ0czsKICAgIHJlbGF0aXZlUGF0aCA9IHJlbGF0aXZlLnBhdGgoKTsKICAgIGJhc2VQYXRoID0gYmFzZS5wYXRoKCk7CgogICAgaWYgKHJlbGF0aXZlUGF0aC5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VSSSBpcyBhbHJlYWR5IHJlbGF0aXZlJyk7CiAgICB9CgogICAgaWYgKGJhc2VQYXRoLmNoYXJBdCgwKSAhPT0gJy8nKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGN1bGF0ZSBhIFVSSSByZWxhdGl2ZSB0byBhbm90aGVyIHJlbGF0aXZlIFVSSScpOwogICAgfQoKICAgIGlmIChyZWxhdGl2ZVBhcnRzLnByb3RvY29sID09PSBiYXNlUGFydHMucHJvdG9jb2wpIHsKICAgICAgcmVsYXRpdmVQYXJ0cy5wcm90b2NvbCA9IG51bGw7CiAgICB9CgogICAgaWYgKHJlbGF0aXZlUGFydHMudXNlcm5hbWUgIT09IGJhc2VQYXJ0cy51c2VybmFtZSB8fCByZWxhdGl2ZVBhcnRzLnBhc3N3b3JkICE9PSBiYXNlUGFydHMucGFzc3dvcmQpIHsKICAgICAgcmV0dXJuIHJlbGF0aXZlLmJ1aWxkKCk7CiAgICB9CgogICAgaWYgKHJlbGF0aXZlUGFydHMucHJvdG9jb2wgIT09IG51bGwgfHwgcmVsYXRpdmVQYXJ0cy51c2VybmFtZSAhPT0gbnVsbCB8fCByZWxhdGl2ZVBhcnRzLnBhc3N3b3JkICE9PSBudWxsKSB7CiAgICAgIHJldHVybiByZWxhdGl2ZS5idWlsZCgpOwogICAgfQoKICAgIGlmIChyZWxhdGl2ZVBhcnRzLmhvc3RuYW1lID09PSBiYXNlUGFydHMuaG9zdG5hbWUgJiYgcmVsYXRpdmVQYXJ0cy5wb3J0ID09PSBiYXNlUGFydHMucG9ydCkgewogICAgICByZWxhdGl2ZVBhcnRzLmhvc3RuYW1lID0gbnVsbDsKICAgICAgcmVsYXRpdmVQYXJ0cy5wb3J0ID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiByZWxhdGl2ZS5idWlsZCgpOwogICAgfQoKICAgIGlmIChyZWxhdGl2ZVBhdGggPT09IGJhc2VQYXRoKSB7CiAgICAgIHJlbGF0aXZlUGFydHMucGF0aCA9ICcnOwogICAgICByZXR1cm4gcmVsYXRpdmUuYnVpbGQoKTsKICAgIH0KCiAgICAvLyBkZXRlcm1pbmUgY29tbW9uIHN1YiBwYXRoCiAgICBjb21tb24gPSBVUkkuY29tbW9uUGF0aChyZWxhdGl2ZVBhdGgsIGJhc2VQYXRoKTsKCiAgICAvLyBJZiB0aGUgcGF0aHMgaGF2ZSBub3RoaW5nIGluIGNvbW1vbiwgcmV0dXJuIGEgcmVsYXRpdmUgVVJMIHdpdGggdGhlIGFic29sdXRlIHBhdGguCiAgICBpZiAoIWNvbW1vbikgewogICAgICByZXR1cm4gcmVsYXRpdmUuYnVpbGQoKTsKICAgIH0KCiAgICB2YXIgcGFyZW50cyA9IGJhc2VQYXJ0cy5wYXRoLnN1YnN0cmluZyhjb21tb24ubGVuZ3RoKS5yZXBsYWNlKC9bXlwvXSokLywgJycpLnJlcGxhY2UoLy4qP1wvL2csICcuLi8nKTsKCiAgICByZWxhdGl2ZVBhcnRzLnBhdGggPSBwYXJlbnRzICsgcmVsYXRpdmVQYXJ0cy5wYXRoLnN1YnN0cmluZyhjb21tb24ubGVuZ3RoKSB8fCAnLi8nOwoKICAgIHJldHVybiByZWxhdGl2ZS5idWlsZCgpOwogIH07CgogIC8vIGNvbXBhcmluZyBVUklzCiAgcC5lcXVhbHMgPSBmdW5jdGlvbiAodXJpKSB7CiAgICB2YXIgb25lID0gdGhpcy5jbG9uZSgpOwogICAgdmFyIHR3byA9IG5ldyBVUkkodXJpKTsKICAgIHZhciBvbmVfbWFwID0ge307CiAgICB2YXIgdHdvX21hcCA9IHt9OwogICAgdmFyIGNoZWNrZWQgPSB7fTsKICAgIHZhciBvbmVfcXVlcnksIHR3b19xdWVyeSwga2V5OwoKICAgIG9uZS5ub3JtYWxpemUoKTsKICAgIHR3by5ub3JtYWxpemUoKTsKCiAgICAvLyBleGFjdCBtYXRjaAogICAgaWYgKG9uZS50b1N0cmluZygpID09PSB0d28udG9TdHJpbmcoKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBleHRyYWN0IHF1ZXJ5IHN0cmluZwogICAgb25lX3F1ZXJ5ID0gb25lLnF1ZXJ5KCk7CiAgICB0d29fcXVlcnkgPSB0d28ucXVlcnkoKTsKICAgIG9uZS5xdWVyeSgnJyk7CiAgICB0d28ucXVlcnkoJycpOwoKICAgIC8vIGRlZmluaXRlbHkgbm90IGVxdWFsIGlmIG5vdCBldmVuIG5vbi1xdWVyeSBwYXJ0cyBtYXRjaAogICAgaWYgKG9uZS50b1N0cmluZygpICE9PSB0d28udG9TdHJpbmcoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gcXVlcnkgcGFyYW1ldGVycyBoYXZlIHRoZSBzYW1lIGxlbmd0aCwgZXZlbiBpZiB0aGV5J3JlIHBlcm11dGVkCiAgICBpZiAob25lX3F1ZXJ5Lmxlbmd0aCAhPT0gdHdvX3F1ZXJ5Lmxlbmd0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgb25lX21hcCA9IFVSSS5wYXJzZVF1ZXJ5KG9uZV9xdWVyeSwgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSk7CiAgICB0d29fbWFwID0gVVJJLnBhcnNlUXVlcnkodHdvX3F1ZXJ5LCB0aGlzLl9wYXJ0cy5lc2NhcGVRdWVyeVNwYWNlKTsKCiAgICBmb3IgKGtleSBpbiBvbmVfbWFwKSB7CiAgICAgIGlmIChoYXNPd24uY2FsbChvbmVfbWFwLCBrZXkpKSB7CiAgICAgICAgaWYgKCFpc0FycmF5KG9uZV9tYXBba2V5XSkpIHsKICAgICAgICAgIGlmIChvbmVfbWFwW2tleV0gIT09IHR3b19tYXBba2V5XSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghYXJyYXlzRXF1YWwob25lX21hcFtrZXldLCB0d29fbWFwW2tleV0pKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjaGVja2VkW2tleV0gPSB0cnVlOwogICAgICB9CiAgICB9CgogICAgZm9yIChrZXkgaW4gdHdvX21hcCkgewogICAgICBpZiAoaGFzT3duLmNhbGwodHdvX21hcCwga2V5KSkgewogICAgICAgIGlmICghY2hlY2tlZFtrZXldKSB7CiAgICAgICAgICAvLyB0d28gY29udGFpbnMgYSBwYXJhbWV0ZXIgbm90IHByZXNlbnQgaW4gb25lCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gc3RhdGUKICBwLmR1cGxpY2F0ZVF1ZXJ5UGFyYW1ldGVycyA9IGZ1bmN0aW9uICh2KSB7CiAgICB0aGlzLl9wYXJ0cy5kdXBsaWNhdGVRdWVyeVBhcmFtZXRlcnMgPSAhIXY7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBwLmVzY2FwZVF1ZXJ5U3BhY2UgPSBmdW5jdGlvbiAodikgewogICAgdGhpcy5fcGFydHMuZXNjYXBlUXVlcnlTcGFjZSA9ICEhdjsKICAgIHJldHVybiB0aGlzOwogIH07CgogIHJldHVybiBVUkk7Cn0pOwoKfSx7Ii4vSVB2NiI6OSwiLi9TZWNvbmRMZXZlbERvbWFpbnMiOjEwLCIuL3B1bnljb2RlIjoxMn1dLDEyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpewondXNlIHN0cmljdCc7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07CgovKiEgaHR0cHM6Ly9tdGhzLmJlL3B1bnljb2RlIHYxLjQuMCBieSBAbWF0aGlhcyAqLwo7KGZ1bmN0aW9uIChyb290KSB7CgoJLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlcyAqLwoJdmFyIGZyZWVFeHBvcnRzID0gKHR5cGVvZiBleHBvcnRzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihleHBvcnRzKSkgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzOwoJdmFyIGZyZWVNb2R1bGUgPSAodHlwZW9mIG1vZHVsZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YobW9kdWxlKSkgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwoJdmFyIGZyZWVHbG9iYWwgPSAodHlwZW9mIGdsb2JhbCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZ2xvYmFsKSkgPT0gJ29iamVjdCcgJiYgZ2xvYmFsOwoJaWYgKGZyZWVHbG9iYWwuZ2xvYmFsID09PSBmcmVlR2xvYmFsIHx8IGZyZWVHbG9iYWwud2luZG93ID09PSBmcmVlR2xvYmFsIHx8IGZyZWVHbG9iYWwuc2VsZiA9PT0gZnJlZUdsb2JhbCkgewoJCXJvb3QgPSBmcmVlR2xvYmFsOwoJfQoKCS8qKgogICogVGhlIGBwdW55Y29kZWAgb2JqZWN0LgogICogQG5hbWUgcHVueWNvZGUKICAqIEB0eXBlIE9iamVjdAogICovCgl2YXIgcHVueWNvZGUsCgoKCS8qKiBIaWdoZXN0IHBvc2l0aXZlIHNpZ25lZCAzMi1iaXQgZmxvYXQgdmFsdWUgKi8KCW1heEludCA9IDIxNDc0ODM2NDcsCgkgICAgLy8gYWthLiAweDdGRkZGRkZGIG9yIDJeMzEtMQoKCS8qKiBCb290c3RyaW5nIHBhcmFtZXRlcnMgKi8KCWJhc2UgPSAzNiwKCSAgICB0TWluID0gMSwKCSAgICB0TWF4ID0gMjYsCgkgICAgc2tldyA9IDM4LAoJICAgIGRhbXAgPSA3MDAsCgkgICAgaW5pdGlhbEJpYXMgPSA3MiwKCSAgICBpbml0aWFsTiA9IDEyOCwKCSAgICAvLyAweDgwCglkZWxpbWl0ZXIgPSAnLScsCgkgICAgLy8gJ1x4MkQnCgoJLyoqIFJlZ3VsYXIgZXhwcmVzc2lvbnMgKi8KCXJlZ2V4UHVueWNvZGUgPSAvXnhuLS0vLAoJICAgIHJlZ2V4Tm9uQVNDSUkgPSAvW15ceDIwLVx4N0VdLywKCSAgICAvLyB1bnByaW50YWJsZSBBU0NJSSBjaGFycyArIG5vbi1BU0NJSSBjaGFycwoJcmVnZXhTZXBhcmF0b3JzID0gL1tceDJFXHUzMDAyXHVGRjBFXHVGRjYxXS9nLAoJICAgIC8vIFJGQyAzNDkwIHNlcGFyYXRvcnMKCgkvKiogRXJyb3IgbWVzc2FnZXMgKi8KCWVycm9ycyA9IHsKCQknb3ZlcmZsb3cnOiAnT3ZlcmZsb3c6IGlucHV0IG5lZWRzIHdpZGVyIGludGVnZXJzIHRvIHByb2Nlc3MnLAoJCSdub3QtYmFzaWMnOiAnSWxsZWdhbCBpbnB1dCA+PSAweDgwIChub3QgYSBiYXNpYyBjb2RlIHBvaW50KScsCgkJJ2ludmFsaWQtaW5wdXQnOiAnSW52YWxpZCBpbnB1dCcKCX0sCgoKCS8qKiBDb252ZW5pZW5jZSBzaG9ydGN1dHMgKi8KCWJhc2VNaW51c1RNaW4gPSBiYXNlIC0gdE1pbiwKCSAgICBmbG9vciA9IE1hdGguZmxvb3IsCgkgICAgc3RyaW5nRnJvbUNoYXJDb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZSwKCgoJLyoqIFRlbXBvcmFyeSB2YXJpYWJsZSAqLwoJa2V5OwoKCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKCS8qKgogICogQSBnZW5lcmljIGVycm9yIHV0aWxpdHkgZnVuY3Rpb24uCiAgKiBAcHJpdmF0ZQogICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGVycm9yIHR5cGUuCiAgKiBAcmV0dXJucyB7RXJyb3J9IFRocm93cyBhIGBSYW5nZUVycm9yYCB3aXRoIHRoZSBhcHBsaWNhYmxlIGVycm9yIG1lc3NhZ2UuCiAgKi8KCWZ1bmN0aW9uIGVycm9yKHR5cGUpIHsKCQl0aHJvdyBuZXcgUmFuZ2VFcnJvcihlcnJvcnNbdHlwZV0pOwoJfQoKCS8qKgogICogQSBnZW5lcmljIGBBcnJheSNtYXBgIHV0aWxpdHkgZnVuY3Rpb24uCiAgKiBAcHJpdmF0ZQogICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIGZvciBldmVyeSBhcnJheQogICogaXRlbS4KICAqIEByZXR1cm5zIHtBcnJheX0gQSBuZXcgYXJyYXkgb2YgdmFsdWVzIHJldHVybmVkIGJ5IHRoZSBjYWxsYmFjayBmdW5jdGlvbi4KICAqLwoJZnVuY3Rpb24gbWFwKGFycmF5LCBmbikgewoJCXZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgkJdmFyIHJlc3VsdCA9IFtdOwoJCXdoaWxlIChsZW5ndGgtLSkgewoJCQlyZXN1bHRbbGVuZ3RoXSA9IGZuKGFycmF5W2xlbmd0aF0pOwoJCX0KCQlyZXR1cm4gcmVzdWx0OwoJfQoKCS8qKgogICogQSBzaW1wbGUgYEFycmF5I21hcGAtbGlrZSB3cmFwcGVyIHRvIHdvcmsgd2l0aCBkb21haW4gbmFtZSBzdHJpbmdzIG9yIGVtYWlsCiAgKiBhZGRyZXNzZXMuCiAgKiBAcHJpdmF0ZQogICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcy4KICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIGZvciBldmVyeQogICogY2hhcmFjdGVyLgogICogQHJldHVybnMge0FycmF5fSBBIG5ldyBzdHJpbmcgb2YgY2hhcmFjdGVycyByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2sKICAqIGZ1bmN0aW9uLgogICovCglmdW5jdGlvbiBtYXBEb21haW4oc3RyaW5nLCBmbikgewoJCXZhciBwYXJ0cyA9IHN0cmluZy5zcGxpdCgnQCcpOwoJCXZhciByZXN1bHQgPSAnJzsKCQlpZiAocGFydHMubGVuZ3RoID4gMSkgewoJCQkvLyBJbiBlbWFpbCBhZGRyZXNzZXMsIG9ubHkgdGhlIGRvbWFpbiBuYW1lIHNob3VsZCBiZSBwdW55Y29kZWQuIExlYXZlCgkJCS8vIHRoZSBsb2NhbCBwYXJ0IChpLmUuIGV2ZXJ5dGhpbmcgdXAgdG8gYEBgKSBpbnRhY3QuCgkJCXJlc3VsdCA9IHBhcnRzWzBdICsgJ0AnOwoJCQlzdHJpbmcgPSBwYXJ0c1sxXTsKCQl9CgkJLy8gQXZvaWQgYHNwbGl0KHJlZ2V4KWAgZm9yIElFOCBjb21wYXRpYmlsaXR5LiBTZWUgIzE3LgoJCXN0cmluZyA9IHN0cmluZy5yZXBsYWNlKHJlZ2V4U2VwYXJhdG9ycywgJ1x4MkUnKTsKCQl2YXIgbGFiZWxzID0gc3RyaW5nLnNwbGl0KCcuJyk7CgkJdmFyIGVuY29kZWQgPSBtYXAobGFiZWxzLCBmbikuam9pbignLicpOwoJCXJldHVybiByZXN1bHQgKyBlbmNvZGVkOwoJfQoKCS8qKgogICogQ3JlYXRlcyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1lcmljIGNvZGUgcG9pbnRzIG9mIGVhY2ggVW5pY29kZQogICogY2hhcmFjdGVyIGluIHRoZSBzdHJpbmcuIFdoaWxlIEphdmFTY3JpcHQgdXNlcyBVQ1MtMiBpbnRlcm5hbGx5LAogICogdGhpcyBmdW5jdGlvbiB3aWxsIGNvbnZlcnQgYSBwYWlyIG9mIHN1cnJvZ2F0ZSBoYWx2ZXMgKGVhY2ggb2Ygd2hpY2gKICAqIFVDUy0yIGV4cG9zZXMgYXMgc2VwYXJhdGUgY2hhcmFjdGVycykgaW50byBhIHNpbmdsZSBjb2RlIHBvaW50LAogICogbWF0Y2hpbmcgVVRGLTE2LgogICogQHNlZSBgcHVueWNvZGUudWNzMi5lbmNvZGVgCiAgKiBAc2VlIDxodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZz4KICAqIEBtZW1iZXJPZiBwdW55Y29kZS51Y3MyCiAgKiBAbmFtZSBkZWNvZGUKICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIFVuaWNvZGUgaW5wdXQgc3RyaW5nIChVQ1MtMikuCiAgKiBAcmV0dXJucyB7QXJyYXl9IFRoZSBuZXcgYXJyYXkgb2YgY29kZSBwb2ludHMuCiAgKi8KCWZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7CgkJdmFyIG91dHB1dCA9IFtdLAoJCSAgICBjb3VudGVyID0gMCwKCQkgICAgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aCwKCQkgICAgdmFsdWUsCgkJICAgIGV4dHJhOwoJCXdoaWxlIChjb3VudGVyIDwgbGVuZ3RoKSB7CgkJCXZhbHVlID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKCQkJaWYgKHZhbHVlID49IDB4RDgwMCAmJiB2YWx1ZSA8PSAweERCRkYgJiYgY291bnRlciA8IGxlbmd0aCkgewoJCQkJLy8gaGlnaCBzdXJyb2dhdGUsIGFuZCB0aGVyZSBpcyBhIG5leHQgY2hhcmFjdGVyCgkJCQlleHRyYSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7CgkJCQlpZiAoKGV4dHJhICYgMHhGQzAwKSA9PSAweERDMDApIHsKCQkJCQkvLyBsb3cgc3Vycm9nYXRlCgkJCQkJb3V0cHV0LnB1c2goKCh2YWx1ZSAmIDB4M0ZGKSA8PCAxMCkgKyAoZXh0cmEgJiAweDNGRikgKyAweDEwMDAwKTsKCQkJCX0gZWxzZSB7CgkJCQkJLy8gdW5tYXRjaGVkIHN1cnJvZ2F0ZTsgb25seSBhcHBlbmQgdGhpcyBjb2RlIHVuaXQsIGluIGNhc2UgdGhlIG5leHQKCQkJCQkvLyBjb2RlIHVuaXQgaXMgdGhlIGhpZ2ggc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIKCQkJCQlvdXRwdXQucHVzaCh2YWx1ZSk7CgkJCQkJY291bnRlci0tOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCQl9CgkJfQoJCXJldHVybiBvdXRwdXQ7Cgl9CgoJLyoqCiAgKiBDcmVhdGVzIGEgc3RyaW5nIGJhc2VkIG9uIGFuIGFycmF5IG9mIG51bWVyaWMgY29kZSBwb2ludHMuCiAgKiBAc2VlIGBwdW55Y29kZS51Y3MyLmRlY29kZWAKICAqIEBtZW1iZXJPZiBwdW55Y29kZS51Y3MyCiAgKiBAbmFtZSBlbmNvZGUKICAqIEBwYXJhbSB7QXJyYXl9IGNvZGVQb2ludHMgVGhlIGFycmF5IG9mIG51bWVyaWMgY29kZSBwb2ludHMuCiAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgbmV3IFVuaWNvZGUgc3RyaW5nIChVQ1MtMikuCiAgKi8KCWZ1bmN0aW9uIHVjczJlbmNvZGUoYXJyYXkpIHsKCQlyZXR1cm4gbWFwKGFycmF5LCBmdW5jdGlvbiAodmFsdWUpIHsKCQkJdmFyIG91dHB1dCA9ICcnOwoJCQlpZiAodmFsdWUgPiAweEZGRkYpIHsKCQkJCXZhbHVlIC09IDB4MTAwMDA7CgkJCQlvdXRwdXQgKz0gc3RyaW5nRnJvbUNoYXJDb2RlKHZhbHVlID4+PiAxMCAmIDB4M0ZGIHwgMHhEODAwKTsKCQkJCXZhbHVlID0gMHhEQzAwIHwgdmFsdWUgJiAweDNGRjsKCQkJfQoJCQlvdXRwdXQgKz0gc3RyaW5nRnJvbUNoYXJDb2RlKHZhbHVlKTsKCQkJcmV0dXJuIG91dHB1dDsKCQl9KS5qb2luKCcnKTsKCX0KCgkvKioKICAqIENvbnZlcnRzIGEgYmFzaWMgY29kZSBwb2ludCBpbnRvIGEgZGlnaXQvaW50ZWdlci4KICAqIEBzZWUgYGRpZ2l0VG9CYXNpYygpYAogICogQHByaXZhdGUKICAqIEBwYXJhbSB7TnVtYmVyfSBjb2RlUG9pbnQgVGhlIGJhc2ljIG51bWVyaWMgY29kZSBwb2ludCB2YWx1ZS4KICAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBudW1lcmljIHZhbHVlIG9mIGEgYmFzaWMgY29kZSBwb2ludCAoZm9yIHVzZSBpbgogICogcmVwcmVzZW50aW5nIGludGVnZXJzKSBpbiB0aGUgcmFuZ2UgYDBgIHRvIGBiYXNlIC0gMWAsIG9yIGBiYXNlYCBpZgogICogdGhlIGNvZGUgcG9pbnQgZG9lcyBub3QgcmVwcmVzZW50IGEgdmFsdWUuCiAgKi8KCWZ1bmN0aW9uIGJhc2ljVG9EaWdpdChjb2RlUG9pbnQpIHsKCQlpZiAoY29kZVBvaW50IC0gNDggPCAxMCkgewoJCQlyZXR1cm4gY29kZVBvaW50IC0gMjI7CgkJfQoJCWlmIChjb2RlUG9pbnQgLSA2NSA8IDI2KSB7CgkJCXJldHVybiBjb2RlUG9pbnQgLSA2NTsKCQl9CgkJaWYgKGNvZGVQb2ludCAtIDk3IDwgMjYpIHsKCQkJcmV0dXJuIGNvZGVQb2ludCAtIDk3OwoJCX0KCQlyZXR1cm4gYmFzZTsKCX0KCgkvKioKICAqIENvbnZlcnRzIGEgZGlnaXQvaW50ZWdlciBpbnRvIGEgYmFzaWMgY29kZSBwb2ludC4KICAqIEBzZWUgYGJhc2ljVG9EaWdpdCgpYAogICogQHByaXZhdGUKICAqIEBwYXJhbSB7TnVtYmVyfSBkaWdpdCBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQuCiAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgYmFzaWMgY29kZSBwb2ludCB3aG9zZSB2YWx1ZSAod2hlbiB1c2VkIGZvcgogICogcmVwcmVzZW50aW5nIGludGVnZXJzKSBpcyBgZGlnaXRgLCB3aGljaCBuZWVkcyB0byBiZSBpbiB0aGUgcmFuZ2UKICAqIGAwYCB0byBgYmFzZSAtIDFgLiBJZiBgZmxhZ2AgaXMgbm9uLXplcm8sIHRoZSB1cHBlcmNhc2UgZm9ybSBpcwogICogdXNlZDsgZWxzZSwgdGhlIGxvd2VyY2FzZSBmb3JtIGlzIHVzZWQuIFRoZSBiZWhhdmlvciBpcyB1bmRlZmluZWQKICAqIGlmIGBmbGFnYCBpcyBub24temVybyBhbmQgYGRpZ2l0YCBoYXMgbm8gdXBwZXJjYXNlIGZvcm0uCiAgKi8KCWZ1bmN0aW9uIGRpZ2l0VG9CYXNpYyhkaWdpdCwgZmxhZykgewoJCS8vICAwLi4yNSBtYXAgdG8gQVNDSUkgYS4ueiBvciBBLi5aCgkJLy8gMjYuLjM1IG1hcCB0byBBU0NJSSAwLi45CgkJcmV0dXJuIGRpZ2l0ICsgMjIgKyA3NSAqIChkaWdpdCA8IDI2KSAtICgoZmxhZyAhPSAwKSA8PCA1KTsKCX0KCgkvKioKICAqIEJpYXMgYWRhcHRhdGlvbiBmdW5jdGlvbiBhcyBwZXIgc2VjdGlvbiAzLjQgb2YgUkZDIDM0OTIuCiAgKiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzQ5MiNzZWN0aW9uLTMuNAogICogQHByaXZhdGUKICAqLwoJZnVuY3Rpb24gYWRhcHQoZGVsdGEsIG51bVBvaW50cywgZmlyc3RUaW1lKSB7CgkJdmFyIGsgPSAwOwoJCWRlbHRhID0gZmlyc3RUaW1lID8gZmxvb3IoZGVsdGEgLyBkYW1wKSA6IGRlbHRhID4+IDE7CgkJZGVsdGEgKz0gZmxvb3IoZGVsdGEgLyBudW1Qb2ludHMpOwoJCWZvciAoOyAvKiBubyBpbml0aWFsaXphdGlvbiAqL2RlbHRhID4gYmFzZU1pbnVzVE1pbiAqIHRNYXggPj4gMTsgayArPSBiYXNlKSB7CgkJCWRlbHRhID0gZmxvb3IoZGVsdGEgLyBiYXNlTWludXNUTWluKTsKCQl9CgkJcmV0dXJuIGZsb29yKGsgKyAoYmFzZU1pbnVzVE1pbiArIDEpICogZGVsdGEgLyAoZGVsdGEgKyBza2V3KSk7Cgl9CgoJLyoqCiAgKiBDb252ZXJ0cyBhIFB1bnljb2RlIHN0cmluZyBvZiBBU0NJSS1vbmx5IHN5bWJvbHMgdG8gYSBzdHJpbmcgb2YgVW5pY29kZQogICogc3ltYm9scy4KICAqIEBtZW1iZXJPZiBwdW55Y29kZQogICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogICogQHJldHVybnMge1N0cmluZ30gVGhlIHJlc3VsdGluZyBzdHJpbmcgb2YgVW5pY29kZSBzeW1ib2xzLgogICovCglmdW5jdGlvbiBkZWNvZGUoaW5wdXQpIHsKCQkvLyBEb24ndCB1c2UgVUNTLTIKCQl2YXIgb3V0cHV0ID0gW10sCgkJICAgIGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoLAoJCSAgICBvdXQsCgkJICAgIGkgPSAwLAoJCSAgICBuID0gaW5pdGlhbE4sCgkJICAgIGJpYXMgPSBpbml0aWFsQmlhcywKCQkgICAgYmFzaWMsCgkJICAgIGosCgkJICAgIGluZGV4LAoJCSAgICBvbGRpLAoJCSAgICB3LAoJCSAgICBrLAoJCSAgICBkaWdpdCwKCQkgICAgdCwKCgkJLyoqIENhY2hlZCBjYWxjdWxhdGlvbiByZXN1bHRzICovCgkJYmFzZU1pbnVzVDsKCgkJLy8gSGFuZGxlIHRoZSBiYXNpYyBjb2RlIHBvaW50czogbGV0IGBiYXNpY2AgYmUgdGhlIG51bWJlciBvZiBpbnB1dCBjb2RlCgkJLy8gcG9pbnRzIGJlZm9yZSB0aGUgbGFzdCBkZWxpbWl0ZXIsIG9yIGAwYCBpZiB0aGVyZSBpcyBub25lLCB0aGVuIGNvcHkKCQkvLyB0aGUgZmlyc3QgYmFzaWMgY29kZSBwb2ludHMgdG8gdGhlIG91dHB1dC4KCgkJYmFzaWMgPSBpbnB1dC5sYXN0SW5kZXhPZihkZWxpbWl0ZXIpOwoJCWlmIChiYXNpYyA8IDApIHsKCQkJYmFzaWMgPSAwOwoJCX0KCgkJZm9yIChqID0gMDsgaiA8IGJhc2ljOyArK2opIHsKCQkJLy8gaWYgaXQncyBub3QgYSBiYXNpYyBjb2RlIHBvaW50CgkJCWlmIChpbnB1dC5jaGFyQ29kZUF0KGopID49IDB4ODApIHsKCQkJCWVycm9yKCdub3QtYmFzaWMnKTsKCQkJfQoJCQlvdXRwdXQucHVzaChpbnB1dC5jaGFyQ29kZUF0KGopKTsKCQl9CgoJCS8vIE1haW4gZGVjb2RpbmcgbG9vcDogc3RhcnQganVzdCBhZnRlciB0aGUgbGFzdCBkZWxpbWl0ZXIgaWYgYW55IGJhc2ljIGNvZGUKCQkvLyBwb2ludHMgd2VyZSBjb3BpZWQ7IHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcgb3RoZXJ3aXNlLgoKCQlmb3IgKGluZGV4ID0gYmFzaWMgPiAwID8gYmFzaWMgKyAxIDogMDsgaW5kZXggPCBpbnB1dExlbmd0aDspIC8qIG5vIGZpbmFsIGV4cHJlc3Npb24gKi97CgoJCQkvLyBgaW5kZXhgIGlzIHRoZSBpbmRleCBvZiB0aGUgbmV4dCBjaGFyYWN0ZXIgdG8gYmUgY29uc3VtZWQuCgkJCS8vIERlY29kZSBhIGdlbmVyYWxpemVkIHZhcmlhYmxlLWxlbmd0aCBpbnRlZ2VyIGludG8gYGRlbHRhYCwKCQkJLy8gd2hpY2ggZ2V0cyBhZGRlZCB0byBgaWAuIFRoZSBvdmVyZmxvdyBjaGVja2luZyBpcyBlYXNpZXIKCQkJLy8gaWYgd2UgaW5jcmVhc2UgYGlgIGFzIHdlIGdvLCB0aGVuIHN1YnRyYWN0IG9mZiBpdHMgc3RhcnRpbmcKCQkJLy8gdmFsdWUgYXQgdGhlIGVuZCB0byBvYnRhaW4gYGRlbHRhYC4KCQkJZm9yIChvbGRpID0gaSwgdyA9IDEsIGsgPSBiYXNlOzsgLyogbm8gY29uZGl0aW9uICovayArPSBiYXNlKSB7CgoJCQkJaWYgKGluZGV4ID49IGlucHV0TGVuZ3RoKSB7CgkJCQkJZXJyb3IoJ2ludmFsaWQtaW5wdXQnKTsKCQkJCX0KCgkJCQlkaWdpdCA9IGJhc2ljVG9EaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KyspKTsKCgkJCQlpZiAoZGlnaXQgPj0gYmFzZSB8fCBkaWdpdCA+IGZsb29yKChtYXhJbnQgLSBpKSAvIHcpKSB7CgkJCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJCQl9CgoJCQkJaSArPSBkaWdpdCAqIHc7CgkJCQl0ID0gayA8PSBiaWFzID8gdE1pbiA6IGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXM7CgoJCQkJaWYgKGRpZ2l0IDwgdCkgewoJCQkJCWJyZWFrOwoJCQkJfQoKCQkJCWJhc2VNaW51c1QgPSBiYXNlIC0gdDsKCQkJCWlmICh3ID4gZmxvb3IobWF4SW50IC8gYmFzZU1pbnVzVCkpIHsKCQkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJCX0KCgkJCQl3ICo9IGJhc2VNaW51c1Q7CgkJCX0KCgkJCW91dCA9IG91dHB1dC5sZW5ndGggKyAxOwoJCQliaWFzID0gYWRhcHQoaSAtIG9sZGksIG91dCwgb2xkaSA9PSAwKTsKCgkJCS8vIGBpYCB3YXMgc3VwcG9zZWQgdG8gd3JhcCBhcm91bmQgZnJvbSBgb3V0YCB0byBgMGAsCgkJCS8vIGluY3JlbWVudGluZyBgbmAgZWFjaCB0aW1lLCBzbyB3ZSdsbCBmaXggdGhhdCBub3c6CgkJCWlmIChmbG9vcihpIC8gb3V0KSA+IG1heEludCAtIG4pIHsKCQkJCWVycm9yKCdvdmVyZmxvdycpOwoJCQl9CgoJCQluICs9IGZsb29yKGkgLyBvdXQpOwoJCQlpICU9IG91dDsKCgkJCS8vIEluc2VydCBgbmAgYXQgcG9zaXRpb24gYGlgIG9mIHRoZSBvdXRwdXQKCQkJb3V0cHV0LnNwbGljZShpKyssIDAsIG4pOwoJCX0KCgkJcmV0dXJuIHVjczJlbmNvZGUob3V0cHV0KTsKCX0KCgkvKioKICAqIENvbnZlcnRzIGEgc3RyaW5nIG9mIFVuaWNvZGUgc3ltYm9scyAoZS5nLiBhIGRvbWFpbiBuYW1lIGxhYmVsKSB0byBhCiAgKiBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogICogQG1lbWJlck9mIHB1bnljb2RlCiAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIHN0cmluZyBvZiBVbmljb2RlIHN5bWJvbHMuCiAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgcmVzdWx0aW5nIFB1bnljb2RlIHN0cmluZyBvZiBBU0NJSS1vbmx5IHN5bWJvbHMuCiAgKi8KCWZ1bmN0aW9uIGVuY29kZShpbnB1dCkgewoJCXZhciBuLAoJCSAgICBkZWx0YSwKCQkgICAgaGFuZGxlZENQQ291bnQsCgkJICAgIGJhc2ljTGVuZ3RoLAoJCSAgICBiaWFzLAoJCSAgICBqLAoJCSAgICBtLAoJCSAgICBxLAoJCSAgICBrLAoJCSAgICB0LAoJCSAgICBjdXJyZW50VmFsdWUsCgkJICAgIG91dHB1dCA9IFtdLAoKCQkvKiogYGlucHV0TGVuZ3RoYCB3aWxsIGhvbGQgdGhlIG51bWJlciBvZiBjb2RlIHBvaW50cyBpbiBgaW5wdXRgLiAqLwoJCWlucHV0TGVuZ3RoLAoKCQkvKiogQ2FjaGVkIGNhbGN1bGF0aW9uIHJlc3VsdHMgKi8KCQloYW5kbGVkQ1BDb3VudFBsdXNPbmUsCgkJICAgIGJhc2VNaW51c1QsCgkJICAgIHFNaW51c1Q7CgoJCS8vIENvbnZlcnQgdGhlIGlucHV0IGluIFVDUy0yIHRvIFVuaWNvZGUKCQlpbnB1dCA9IHVjczJkZWNvZGUoaW5wdXQpOwoKCQkvLyBDYWNoZSB0aGUgbGVuZ3RoCgkJaW5wdXRMZW5ndGggPSBpbnB1dC5sZW5ndGg7CgoJCS8vIEluaXRpYWxpemUgdGhlIHN0YXRlCgkJbiA9IGluaXRpYWxOOwoJCWRlbHRhID0gMDsKCQliaWFzID0gaW5pdGlhbEJpYXM7CgoJCS8vIEhhbmRsZSB0aGUgYmFzaWMgY29kZSBwb2ludHMKCQlmb3IgKGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikgewoJCQljdXJyZW50VmFsdWUgPSBpbnB1dFtqXTsKCQkJaWYgKGN1cnJlbnRWYWx1ZSA8IDB4ODApIHsKCQkJCW91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShjdXJyZW50VmFsdWUpKTsKCQkJfQoJCX0KCgkJaGFuZGxlZENQQ291bnQgPSBiYXNpY0xlbmd0aCA9IG91dHB1dC5sZW5ndGg7CgoJCS8vIGBoYW5kbGVkQ1BDb3VudGAgaXMgdGhlIG51bWJlciBvZiBjb2RlIHBvaW50cyB0aGF0IGhhdmUgYmVlbiBoYW5kbGVkOwoJCS8vIGBiYXNpY0xlbmd0aGAgaXMgdGhlIG51bWJlciBvZiBiYXNpYyBjb2RlIHBvaW50cy4KCgkJLy8gRmluaXNoIHRoZSBiYXNpYyBzdHJpbmcgLSBpZiBpdCBpcyBub3QgZW1wdHkgLSB3aXRoIGEgZGVsaW1pdGVyCgkJaWYgKGJhc2ljTGVuZ3RoKSB7CgkJCW91dHB1dC5wdXNoKGRlbGltaXRlcik7CgkJfQoKCQkvLyBNYWluIGVuY29kaW5nIGxvb3A6CgkJd2hpbGUgKGhhbmRsZWRDUENvdW50IDwgaW5wdXRMZW5ndGgpIHsKCgkJCS8vIEFsbCBub24tYmFzaWMgY29kZSBwb2ludHMgPCBuIGhhdmUgYmVlbiBoYW5kbGVkIGFscmVhZHkuIEZpbmQgdGhlIG5leHQKCQkJLy8gbGFyZ2VyIG9uZToKCQkJZm9yIChtID0gbWF4SW50LCBqID0gMDsgaiA8IGlucHV0TGVuZ3RoOyArK2opIHsKCQkJCWN1cnJlbnRWYWx1ZSA9IGlucHV0W2pdOwoJCQkJaWYgKGN1cnJlbnRWYWx1ZSA+PSBuICYmIGN1cnJlbnRWYWx1ZSA8IG0pIHsKCQkJCQltID0gY3VycmVudFZhbHVlOwoJCQkJfQoJCQl9CgoJCQkvLyBJbmNyZWFzZSBgZGVsdGFgIGVub3VnaCB0byBhZHZhbmNlIHRoZSBkZWNvZGVyJ3MgPG4saT4gc3RhdGUgdG8gPG0sMD4sCgkJCS8vIGJ1dCBndWFyZCBhZ2FpbnN0IG92ZXJmbG93CgkJCWhhbmRsZWRDUENvdW50UGx1c09uZSA9IGhhbmRsZWRDUENvdW50ICsgMTsKCQkJaWYgKG0gLSBuID4gZmxvb3IoKG1heEludCAtIGRlbHRhKSAvIGhhbmRsZWRDUENvdW50UGx1c09uZSkpIHsKCQkJCWVycm9yKCdvdmVyZmxvdycpOwoJCQl9CgoJCQlkZWx0YSArPSAobSAtIG4pICogaGFuZGxlZENQQ291bnRQbHVzT25lOwoJCQluID0gbTsKCgkJCWZvciAoaiA9IDA7IGogPCBpbnB1dExlbmd0aDsgKytqKSB7CgkJCQljdXJyZW50VmFsdWUgPSBpbnB1dFtqXTsKCgkJCQlpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7CgkJCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJCQl9CgoJCQkJaWYgKGN1cnJlbnRWYWx1ZSA9PSBuKSB7CgkJCQkJLy8gUmVwcmVzZW50IGRlbHRhIGFzIGEgZ2VuZXJhbGl6ZWQgdmFyaWFibGUtbGVuZ3RoIGludGVnZXIKCQkJCQlmb3IgKHEgPSBkZWx0YSwgayA9IGJhc2U7OyAvKiBubyBjb25kaXRpb24gKi9rICs9IGJhc2UpIHsKCQkJCQkJdCA9IGsgPD0gYmlhcyA/IHRNaW4gOiBrID49IGJpYXMgKyB0TWF4ID8gdE1heCA6IGsgLSBiaWFzOwoJCQkJCQlpZiAocSA8IHQpIHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCXFNaW51c1QgPSBxIC0gdDsKCQkJCQkJYmFzZU1pbnVzVCA9IGJhc2UgLSB0OwoJCQkJCQlvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoZGlnaXRUb0Jhc2ljKHQgKyBxTWludXNUICUgYmFzZU1pbnVzVCwgMCkpKTsKCQkJCQkJcSA9IGZsb29yKHFNaW51c1QgLyBiYXNlTWludXNUKTsKCQkJCQl9CgoJCQkJCW91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWMocSwgMCkpKTsKCQkJCQliaWFzID0gYWRhcHQoZGVsdGEsIGhhbmRsZWRDUENvdW50UGx1c09uZSwgaGFuZGxlZENQQ291bnQgPT0gYmFzaWNMZW5ndGgpOwoJCQkJCWRlbHRhID0gMDsKCQkJCQkrK2hhbmRsZWRDUENvdW50OwoJCQkJfQoJCQl9CgoJCQkrK2RlbHRhOwoJCQkrK247CgkJfQoJCXJldHVybiBvdXRwdXQuam9pbignJyk7Cgl9CgoJLyoqCiAgKiBDb252ZXJ0cyBhIFB1bnljb2RlIHN0cmluZyByZXByZXNlbnRpbmcgYSBkb21haW4gbmFtZSBvciBhbiBlbWFpbCBhZGRyZXNzCiAgKiB0byBVbmljb2RlLiBPbmx5IHRoZSBQdW55Y29kZWQgcGFydHMgb2YgdGhlIGlucHV0IHdpbGwgYmUgY29udmVydGVkLCBpLmUuCiAgKiBpdCBkb2Vzbid0IG1hdHRlciBpZiB5b3UgY2FsbCBpdCBvbiBhIHN0cmluZyB0aGF0IGhhcyBhbHJlYWR5IGJlZW4KICAqIGNvbnZlcnRlZCB0byBVbmljb2RlLgogICogQG1lbWJlck9mIHB1bnljb2RlCiAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIFB1bnljb2RlZCBkb21haW4gbmFtZSBvciBlbWFpbCBhZGRyZXNzIHRvCiAgKiBjb252ZXJ0IHRvIFVuaWNvZGUuCiAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgVW5pY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gUHVueWNvZGUKICAqIHN0cmluZy4KICAqLwoJZnVuY3Rpb24gdG9Vbmljb2RlKGlucHV0KSB7CgkJcmV0dXJuIG1hcERvbWFpbihpbnB1dCwgZnVuY3Rpb24gKHN0cmluZykgewoJCQlyZXR1cm4gcmVnZXhQdW55Y29kZS50ZXN0KHN0cmluZykgPyBkZWNvZGUoc3RyaW5nLnNsaWNlKDQpLnRvTG93ZXJDYXNlKCkpIDogc3RyaW5nOwoJCX0pOwoJfQoKCS8qKgogICogQ29udmVydHMgYSBVbmljb2RlIHN0cmluZyByZXByZXNlbnRpbmcgYSBkb21haW4gbmFtZSBvciBhbiBlbWFpbCBhZGRyZXNzIHRvCiAgKiBQdW55Y29kZS4gT25seSB0aGUgbm9uLUFTQ0lJIHBhcnRzIG9mIHRoZSBkb21haW4gbmFtZSB3aWxsIGJlIGNvbnZlcnRlZCwKICAqIGkuZS4gaXQgZG9lc24ndCBtYXR0ZXIgaWYgeW91IGNhbGwgaXQgd2l0aCBhIGRvbWFpbiB0aGF0J3MgYWxyZWFkeSBpbgogICogQVNDSUkuCiAgKiBAbWVtYmVyT2YgcHVueWNvZGUKICAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcyB0byBjb252ZXJ0LCBhcyBhCiAgKiBVbmljb2RlIHN0cmluZy4KICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBQdW55Y29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gZG9tYWluIG5hbWUgb3IKICAqIGVtYWlsIGFkZHJlc3MuCiAgKi8KCWZ1bmN0aW9uIHRvQVNDSUkoaW5wdXQpIHsKCQlyZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbiAoc3RyaW5nKSB7CgkJCXJldHVybiByZWdleE5vbkFTQ0lJLnRlc3Qoc3RyaW5nKSA/ICd4bi0tJyArIGVuY29kZShzdHJpbmcpIDogc3RyaW5nOwoJCX0pOwoJfQoKCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKCS8qKiBEZWZpbmUgdGhlIHB1YmxpYyBBUEkgKi8KCXB1bnljb2RlID0gewoJCS8qKgogICAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBQdW55Y29kZS5qcyB2ZXJzaW9uIG51bWJlci4KICAgKiBAbWVtYmVyT2YgcHVueWNvZGUKICAgKiBAdHlwZSBTdHJpbmcKICAgKi8KCQkndmVyc2lvbic6ICcxLjMuMicsCgkJLyoqCiAgICogQW4gb2JqZWN0IG9mIG1ldGhvZHMgdG8gY29udmVydCBmcm9tIEphdmFTY3JpcHQncyBpbnRlcm5hbCBjaGFyYWN0ZXIKICAgKiByZXByZXNlbnRhdGlvbiAoVUNTLTIpIHRvIFVuaWNvZGUgY29kZSBwb2ludHMsIGFuZCBiYWNrLgogICAqIEBzZWUgPGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LWVuY29kaW5nPgogICAqIEBtZW1iZXJPZiBwdW55Y29kZQogICAqIEB0eXBlIE9iamVjdAogICAqLwoJCSd1Y3MyJzogewoJCQknZGVjb2RlJzogdWNzMmRlY29kZSwKCQkJJ2VuY29kZSc6IHVjczJlbmNvZGUKCQl9LAoJCSdkZWNvZGUnOiBkZWNvZGUsCgkJJ2VuY29kZSc6IGVuY29kZSwKCQkndG9BU0NJSSc6IHRvQVNDSUksCgkJJ3RvVW5pY29kZSc6IHRvVW5pY29kZQoJfTsKCgkvKiogRXhwb3NlIGBwdW55Y29kZWAgKi8KCS8vIFNvbWUgQU1EIGJ1aWxkIG9wdGltaXplcnMsIGxpa2Ugci5qcywgY2hlY2sgZm9yIHNwZWNpZmljIGNvbmRpdGlvbiBwYXR0ZXJucwoJLy8gbGlrZSB0aGUgZm9sbG93aW5nOgoJaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBfdHlwZW9mKGRlZmluZS5hbWQpID09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHsKCQlkZWZpbmUoJ3B1bnljb2RlJywgZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gcHVueWNvZGU7CgkJfSk7Cgl9IGVsc2UgaWYgKGZyZWVFeHBvcnRzICYmIGZyZWVNb2R1bGUpIHsKCQlpZiAobW9kdWxlLmV4cG9ydHMgPT0gZnJlZUV4cG9ydHMpIHsKCQkJLy8gaW4gTm9kZS5qcywgaW8uanMsIG9yIFJpbmdvSlMgdjAuOC4wKwoJCQlmcmVlTW9kdWxlLmV4cG9ydHMgPSBwdW55Y29kZTsKCQl9IGVsc2UgewoJCQkvLyBpbiBOYXJ3aGFsIG9yIFJpbmdvSlMgdjAuNy4wLQoJCQlmb3IgKGtleSBpbiBwdW55Y29kZSkgewoJCQkJcHVueWNvZGUuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAoZnJlZUV4cG9ydHNba2V5XSA9IHB1bnljb2RlW2tleV0pOwoJCQl9CgkJfQoJfSBlbHNlIHsKCQkvLyBpbiBSaGlubyBvciBhIHdlYiBicm93c2VyCgkJcm9vdC5wdW55Y29kZSA9IHB1bnljb2RlOwoJfQp9KSh1bmRlZmluZWQpOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dLDEzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZGVmYXVsdCA9IGFjdGl2YXRlOwoKdmFyIF9TeW5jaGVyID0gcmVxdWlyZSgnc2VydmljZS1mcmFtZXdvcmsvc3JjL3N5bmNoZXIvU3luY2hlcicpOwoKdmFyIF9TeW5jaGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1N5bmNoZXIpOwoKdmFyIF91cmlqcyA9IHJlcXVpcmUoJ3VyaWpzJyk7Cgp2YXIgX3VyaWpzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3VyaWpzKTsKCnZhciBfcG9zaXRpb24gPSByZXF1aXJlKCcuL3Bvc2l0aW9uJyk7Cgp2YXIgX3Bvc2l0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3Bvc2l0aW9uKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9Cgp2YXIgTG9jYXRpb25IeXBlcnR5ID0gewogICAgZ2V0Q3VycmVudFBvc2l0aW9uOiBmdW5jdGlvbiBnZXRDdXJyZW50UG9zaXRpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZnVuY3Rpb24gKHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShwb3NpdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSwKICAgIHN0YXJ0UG9zaXRpb25Ccm9hZGNhc3Q6IGZ1bmN0aW9uIHN0YXJ0UG9zaXRpb25Ccm9hZGNhc3Qoc3Vic2NyaWJlcnMpIHsKICAgICAgICB0aGlzLl9zeW5jaGVyLmNyZWF0ZSh0aGlzLl9vYmplY3REZXNjVVJMLCBzdWJzY3JpYmVycywgX3Bvc2l0aW9uMi5kZWZhdWx0KS50aGVuKGZ1bmN0aW9uIChyZXBvcnRlcikgewogICAgICAgICAgICByZXBvcnRlci5vblN1YnNjcmlwdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5hY2NlcHQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi53YXRjaFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikgewogICAgICAgICAgICAgICAgcmVwb3J0ZXIuZGF0YS52YWx1ZS5jb29yZHMgPSBwb3NpdGlvbi5jb29yZHM7CiAgICAgICAgICAgICAgICByZXBvcnRlci5kYXRhLnZhbHVlLnRpbWVzdGFtcCA9IHBvc2l0aW9uLnRpbWVzdGFtcDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9Cn07Cgp2YXIgTG9jYXRpb25IeXBlcnR5RmFjdG9yeSA9IGZ1bmN0aW9uIExvY2F0aW9uSHlwZXJ0eUZhY3RvcnkoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWcpIHsKICAgIHZhciB1cmkgPSBuZXcgX3VyaWpzMi5kZWZhdWx0KGh5cGVydHlVUkwpOwogICAgTG9jYXRpb25IeXBlcnR5Ll9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vJyArIHVyaS5ob3N0bmFtZSgpICsgJy8ud2VsbC1rbm93bi9kYXRhc2NoZW1hcy9Db250ZXh0RGF0YVNjaGVtYSc7CiAgICBMb2NhdGlvbkh5cGVydHkuX3N5bmNoZXIgPSBuZXcgX1N5bmNoZXIyLmRlZmF1bHQoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWcpOwoKICAgIHJldHVybiBMb2NhdGlvbkh5cGVydHk7Cn07CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZykgewogICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnTG9jYXRpb24gSHlwZXJ0eScsCiAgICAgICAgaW5zdGFuY2U6IExvY2F0aW9uSHlwZXJ0eUZhY3RvcnkoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWcpCiAgICB9Owp9Cgp9LHsiLi9wb3NpdGlvbiI6MTQsInNlcnZpY2UtZnJhbWV3b3JrL3NyYy9zeW5jaGVyL1N5bmNoZXIiOjcsInVyaWpzIjoxMX1dLDE0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZGVmYXVsdCA9IHsKICAgIGlkOiAiTG9jYXRpb25PYmplY3QiLAogICAgdHlwZTogIm9iamVjdCIsCiAgICB2YWx1ZTogewogICAgICAgIGNvb3JkczogewogICAgICAgICAgICBsYXRpdHVkZTogMCwKICAgICAgICAgICAgbG9uZ2l0dWRlOiAwLAogICAgICAgICAgICBhbHRpdHVkZTogMCwKICAgICAgICAgICAgYWNjdXJhY3k6IDAsCiAgICAgICAgICAgIGFsdGl0dWRlQWNjdXJhY3k6IDAsCiAgICAgICAgICAgIGhlYWRpbmc6IDAsCiAgICAgICAgICAgIHNwZWVkOiAwCiAgICAgICAgfSwKICAgICAgICB0aW1lc3RhbXA6IDAKICAgIH0KfTsKCn0se31dfSx7fSxbMTNdKSgxMykKfSk7",
      "sourceCodeClassname": "LocationHyperty",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of LocationHyperty",
    "objectName": "LocationHyperty",
    "configuration": {},
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "FakeLocationObserverHyperty": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX1N5bmNPYmplY3QgPSByZXF1aXJlKCcuL1N5bmNPYmplY3QnKTsKCnZhciBfU3luY09iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TeW5jT2JqZWN0KTsKCnZhciBfRGF0YU9iamVjdENoaWxkID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Q2hpbGQnKTsKCnZhciBfRGF0YU9iamVjdENoaWxkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3RDaGlsZCk7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCi8qKgogKiBNYWluIGV4dGVuc2lvbiBjbGFzcyBmb3Igb2JzZXJ2ZXJzIGFuZCByZXBvcnRlcnMsIHdpdGggY29tbW9uIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAqIENoaWxkcmVuIG1hbmFnZW1lbnQgaXMgY29tbW9uIGZvciBvYnNlcnZlcnMgYW5kIHJlcG9ydGVycy4KICovCgp2YXIgRGF0YU9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgX3ZlcnNpb246IG51bWJlcgogICBfb3duZXI6IEh5cGVydHlVUkwKICBfdXJsOiBPYmplY3RVUkwKICBfc2NoZW1hOiBTY2hlbWEKICBfYnVzOiBNaW5pQnVzCiAgX3N0YXR1czogb24gfCBwYXVzZWQKICBfc3luY09iajogU3luY0RhdGEKICAgX2NoaWxkcmVuOiB7IGlkOiBEYXRhT2JqZWN0Q2hpbGQgfQogIF9jaGlsZHJlbkxpc3RlbmVyczogW01zZ0xpc3RlbmVyXQogICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tCiAgX29uQWRkQ2hpbGRIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQKICAqLwoKICAvKioKICAgKiBAaWdub3JlCiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIgY3JlYXRlIG9yIHN1YnNjcmliZSBtZXRob2QncwogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0KHN5bmNoZXIsIHVybCwgc2NoZW1hLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW5zKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdCk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fc3luY2hlciA9IHN5bmNoZXI7CiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX3NjaGVtYSA9IHNjaGVtYTsKICAgIF90aGlzLl9zdGF0dXMgPSBpbml0aWFsU3RhdHVzOwogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyLmRlZmF1bHQoaW5pdGlhbERhdGEpOwogICAgX3RoaXMuX2NoaWxkcmVucyA9IGNoaWxkcmVuczsKCiAgICBfdGhpcy5fdmVyc2lvbiA9IDA7CiAgICBfdGhpcy5fY2hpbGRJZCA9IDA7CiAgICBfdGhpcy5fY2hpbGRyZW5PYmplY3RzID0ge307CiAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMgPSBbXTsKCiAgICBfdGhpcy5fb3duZXIgPSBzeW5jaGVyLl9vd25lcjsKICAgIF90aGlzLl9idXMgPSBzeW5jaGVyLl9idXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YU9iamVjdCwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgY2hpbGRCYXNlVVJMID0gX3RoaXMuX3VybCArICcvY2hpbGRyZW4vJzsKICAgICAgaWYgKF90aGlzLl9jaGlsZHJlbnMpIHsKICAgICAgICBfdGhpcy5fY2hpbGRyZW5zLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICB2YXIgY2hpbGRVUkwgPSBjaGlsZEJhc2VVUkwgKyBjaGlsZDsKICAgICAgICAgIHZhciBsaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoY2hpbGRVUkwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgLy9pZ25vcmUgbXNnIHNlbnQgYnkgaGltc2VsZgogICAgICAgICAgICBpZiAobXNnLmZyb20gIT09IF90aGlzMi5fb3duZXIpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdC1DaGlsZHJlbi1SQ1Y6ICcsIG1zZyk7CiAgICAgICAgICAgICAgc3dpdGNoIChtc2cudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgICAgICAgICAgX3RoaXMuX29uQ2hpbGRDcmVhdGUobXNnKTticmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7YnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBfdGhpcy5fY2hhbmdlQ2hpbGRyZW4obXNnKTticmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIGxpc3RlbmVyLnJlbW92ZSgpOwogICAgICB9KTsKCiAgICAgIE9iamVjdC5rZXlzKF90aGlzLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNba2V5XS5fcmVsZWFzZUxpc3RlbmVycygpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIE9iamVjdCBVUkwgb2YgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIKICAgICAqIEB0eXBlIHtPYmplY3RVUkx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAncGF1c2UnLAoKCiAgICAvKioKICAgICAqIEBpZ25vcmUKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAvL1RPRE86IHRoaXMgZmVhdHVyZSBuZWVkcyBtb3JlIGFuYWxpc2UKICAgICAgdGhyb3cgJ05vdCBpbXBsZW1lbnRlZCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAncmVzdW1lJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZQogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioKICAgICAqIEBpZ25vcmUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzdG9wJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAvL1RPRE86IHNob3VsZCByZW1vdmUgdGhlIHN1YnNjcmlwdGlvbiBhbmQgc2VuZCBtZXNzYWdlIHVuc3Vic2NyaWJlPwogICAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJzsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYWRkIGEgY2hpbGRyZW4gdG8gdGhlIHN1YnNjcmlwdGlvbiBncm91cC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSByZXNvdXJjZSAtIFJlc291cmNlIG5hbWUsIG9uZSBvZiB0aGUgaXRlbXMgaW4gdGhlIHNjaGVtYS5wcm9wZXJ0aWVzLnNjaGVtZSBvZiB0aGUgcGFyZW50IG9iamVjdC4KICAgICAqIEBwYXJhbSB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIGNoaWxkCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RDaGlsZD59IC0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgQ2hpbGRyZW4uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnYWRkQ2hpbGQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZENoaWxkKHJlc291cmNlLCBpbml0aWFsRGF0YSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9jcmVhdGUgbmV3IGNoaWxkIHVuaXF1ZSBJRCwgYmFzZWQgb24gaHlwZXJ0eVVSTAogICAgICBfdGhpcy5fY2hpbGRJZCsrOwogICAgICB2YXIgbXNnQ2hpbGRJZCA9IF90aGlzLl9vd25lciArICcjJyArIF90aGlzLl9jaGlsZElkOwogICAgICB2YXIgbXNnQ2hpbGRQYXRoID0gX3RoaXMuX3VybCArICcvY2hpbGRyZW4vJyArIHJlc291cmNlOwoKICAgICAgdmFyIHJlcXVlc3RNc2cgPSB7CiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IG1zZ0NoaWxkUGF0aCwKICAgICAgICBib2R5OiB7IHJlc291cmNlOiBtc2dDaGlsZElkLCB2YWx1ZTogaW5pdGlhbERhdGEgfQogICAgICB9OwoKICAgICAgLy9yZXR1cm5zIHByb21pc2UsIGluIHRoZSBmdXR1cmUsIHRoZSBBUEkgbWF5IGNoYW5nZSB0byBhc3luY2hyb25vdXMgY2FsbAogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgbXNnSWQgPSBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcXVlc3RNc2cpOwoKICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAnICsgX3RoaXMuX293bmVyICsgJyApOiAnLCByZXF1ZXN0TXNnKTsKICAgICAgICB2YXIgbmV3Q2hpbGQgPSBuZXcgX0RhdGFPYmplY3RDaGlsZDIuZGVmYXVsdChfdGhpcywgbXNnQ2hpbGRJZCwgaW5pdGlhbERhdGEsIF90aGlzLl9vd25lciwgbXNnSWQpOwogICAgICAgIG5ld0NoaWxkLm9uQ2hhbmdlKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX29uQ2hhbmdlKGV2ZW50LCB7IHBhdGg6IG1zZ0NoaWxkUGF0aCwgY2hpbGRJZDogbXNnQ2hpbGRJZCB9KTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1ttc2dDaGlsZElkXSA9IG5ld0NoaWxkOwoKICAgICAgICByZXNvbHZlKG5ld0NoaWxkKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyBjcmVhdGUgYW5kIGRlbGV0ZSBjaGlsZHJlbnMKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbkFkZENoaWxkJywKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkFkZENoaWxkKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQ2hpbGRDcmVhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNoaWxkQ3JlYXRlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgbXNnQ2hpbGRJZCA9IG1zZy5ib2R5LnJlc291cmNlOwoKICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZS1vYnNlcnZlci1jaGlsZCggJyArIF90aGlzLl9vd25lciArICcgKTogJywgbXNnKTsKICAgICAgdmFyIG5ld0NoaWxkID0gbmV3IF9EYXRhT2JqZWN0Q2hpbGQyLmRlZmF1bHQoX3RoaXMsIG1zZ0NoaWxkSWQsIG1zZy5ib2R5LnZhbHVlKTsKICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1ttc2dDaGlsZElkXSA9IG5ld0NoaWxkOwoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgIGJvZHk6IHsgY29kZTogMjAwLCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIGZyb206IG1zZy5mcm9tLAogICAgICAgIHVybDogbXNnLnRvLAogICAgICAgIHZhbHVlOiBtc2cuYm9keS52YWx1ZSwKICAgICAgICBjaGlsZElkOiBtc2dDaGlsZElkLAogICAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdBREQtQ0hJTERSRU4tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CgogICAgLy9zZW5kIGRlbHRhIG1lc3NhZ2VzIHRvIHN1YnNjcmlwdGlvbnMKCiAgfSwgewogICAga2V5OiAnX29uQ2hhbmdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2UoZXZlbnQsIGNoaWxkSW5mbykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuX3ZlcnNpb24rKzsKCiAgICAgIGlmIChfdGhpcy5fc3RhdHVzID09PSAnb24nKSB7CiAgICAgICAgdmFyIGNoYW5nZU1zZyA9IHsKICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogX3RoaXMuX3VybCArICcvY2hhbmdlcycsCiAgICAgICAgICBib2R5OiB7IHZlcnNpb246IF90aGlzLl92ZXJzaW9uLCBzb3VyY2U6IF90aGlzLl9vd25lciwgYXR0cmlidXRlOiBldmVudC5maWVsZCB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKGV2ZW50Lm9UeXBlID09PSBfU3luY09iamVjdC5PYmplY3RUeXBlLk9CSkVDVCkgewogICAgICAgICAgaWYgKGV2ZW50LmNUeXBlICE9PSBfU3luY09iamVjdC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICBjaGFuZ2VNc2cuYm9keS52YWx1ZSA9IGV2ZW50LmRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LmF0dHJpYnV0ZVR5cGUgPSBldmVudC5vVHlwZTsKICAgICAgICAgIGNoYW5nZU1zZy5ib2R5LnZhbHVlID0gZXZlbnQuZGF0YTsKICAgICAgICAgIGlmIChldmVudC5jVHlwZSAhPT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5VUERBVEUpIHsKICAgICAgICAgICAgY2hhbmdlTXNnLmJvZHkub3BlcmF0aW9uID0gZXZlbnQuY1R5cGU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL2NoaWxkSW5mbyBtdXN0IGhhdmUgKHBhdGgsIGNoaWxkSWQpCiAgICAgICAgaWYgKGNoaWxkSW5mbykgewogICAgICAgICAgY2hhbmdlTXNnLnRvID0gY2hpbGRJbmZvLnBhdGg7CiAgICAgICAgICBjaGFuZ2VNc2cuYm9keS5yZXNvdXJjZSA9IGNoaWxkSW5mby5jaGlsZElkOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShjaGFuZ2VNc2cpOwogICAgICB9CiAgICB9CgogICAgLy9yZWNlaXZlIGFuZCBwcm9jZXNzIGRlbHRhIG1lc3NhZ2VzCgogIH0sIHsKICAgIGtleTogJ19jaGFuZ2VPYmplY3QnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGFuZ2VPYmplY3Qoc3luY09iaiwgbXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHVwZGF0ZSB2ZXJzaW9uID8KICAgICAgLy9ob3cgdG8gaGFuZGxlIGFuIGluY29ycmVjdCB2ZXJzaW9uID8gRXhhbXBsZTogcmVjZWl2ZSBhIHZlcnNpb24gMyB3aGVuIHRoZSBvYnNlcnZlciBpcyBpbiB2ZXJzaW9uIDEsIHdoZXJlIGlzIHRoZSB2ZXJzaW9uIDIgPwogICAgICAvL3dpbGwgd2UgbmVlZCB0byBjb25maXJtIHRoZSByZWNlcHRpb24gPwogICAgICBpZiAoX3RoaXMuX3ZlcnNpb24gKyAxID09PSBtc2cuYm9keS52ZXJzaW9uKSB7CiAgICAgICAgX3RoaXMuX3ZlcnNpb24rKzsKICAgICAgICB2YXIgcGF0aCA9IG1zZy5ib2R5LmF0dHJpYnV0ZTsKICAgICAgICB2YXIgdmFsdWUgPSAoMCwgX3V0aWxzLmRlZXBDbG9uZSkobXNnLmJvZHkudmFsdWUpOwogICAgICAgIHZhciBmaW5kUmVzdWx0ID0gc3luY09iai5maW5kQmVmb3JlKHBhdGgpOwoKICAgICAgICBpZiAobXNnLmJvZHkuYXR0cmlidXRlVHlwZSA9PT0gX1N5bmNPYmplY3QuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgaWYgKG1zZy5ib2R5Lm9wZXJhdGlvbiA9PT0gX1N5bmNPYmplY3QuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgdmFyIGFyciA9IGZpbmRSZXN1bHQub2JqOwogICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoYXJyLCBbaW5kZXgsIDBdLmNvbmNhdCh2YWx1ZSkpOwogICAgICAgICAgfSBlbHNlIGlmIChtc2cuYm9keS5vcGVyYXRpb24gPT09IF9TeW5jT2JqZWN0LkNoYW5nZVR5cGUuUkVNT1ZFKSB7CiAgICAgICAgICAgIHZhciBfYXJyID0gZmluZFJlc3VsdC5vYmo7CiAgICAgICAgICAgIHZhciBfaW5kZXggPSBmaW5kUmVzdWx0Lmxhc3Q7CiAgICAgICAgICAgIF9hcnIuc3BsaWNlKF9pbmRleCwgdmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmluZFJlc3VsdC5vYmpbZmluZFJlc3VsdC5sYXN0XSA9IHZhbHVlOyAvLyBVUERBVEUKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobXNnLmJvZHkudmFsdWUpIHsKICAgICAgICAgICAgICBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdID0gdmFsdWU7IC8vIFVQREFURSBvciBBREQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdOyAvLyBSRU1PVkUKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL1RPRE86IGhvdyB0byBoYW5kbGUgdW5zeW5jaHJvbml6ZWQgdmVyc2lvbnM/CiAgICAgICAgICBjb25zb2xlLmxvZygnVU5TWU5DSFJPTklaRUQgVkVSU0lPTjogKGRhdGEgPT4gJyArIF90aGlzLl92ZXJzaW9uICsgJywgbXNnID0+ICcgKyBtc2cuYm9keS52ZXJzaW9uICsgJyknKTsKICAgICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2NoYW5nZUNoaWxkcmVuJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hhbmdlQ2hpbGRyZW4obXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGNvbnNvbGUubG9nKCdDaGFuZ2UgY2hpbGRyZW46ICcsIF90aGlzLl9vd25lciwgbXNnKTsKCiAgICAgIHZhciBjaGlsZElkID0gbXNnLmJvZHkucmVzb3VyY2U7CiAgICAgIHZhciBjaGlsZHJlbiA9IF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRJZF07CgogICAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgICBfdGhpcy5fY2hhbmdlT2JqZWN0KGNoaWxkcmVuLl9zeW5jT2JqLCBtc2cpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBjaGlsZHJlbiBmb3VuZCBmb3I6ICcsIGNoaWxkSWQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQoKICAgIC8qKgogICAgICogT2JqZWN0IHNjaGVtYSBVUkwgKHRoaXMgZmllbGQgaXMgbm90IHlldCBzdGFibGUsIGFuZCBpcyBzdWJzamVjdCB0byBjaGFuZ2UpCiAgICAgKiBAdHlwZSB7U2NoZW1hVVJMfQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3NjaGVtYScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXR1cyBvZiB0aGUgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIgY29ubmVjdGlvbiAodGhpcyBmaWVsZCBpcyBub3QgeWV0IHN0YWJsZSwgYW5kIGlzIHN1YnNqZWN0IHRvIGNoYW5nZSkKICAgICAqIEB0eXBlIHtTdGF0dXN9IC0gRW51bSBvZjogb24gfCBwYXVzZWQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzdGF0dXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBEYXRhIHN0cnVjdHVyZSB0byBiZSBzeW5jaHJvbml6ZWQuCiAgICAgKiBAdHlwZSB7SlNPTn0gLSBKU09OIHN0cnVjdHVyZSB0aGF0IHNob3VsZCBmb2xsb3cgdGhlIGRlZmluZWQgc2NoZW1hLCBpZiBhbnkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZGF0YScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBjcmVhdGVkIGNoaWxkcmVuJ3Mgc2luY2UgdGhlIHN1YnNjcmlwdGlvbiwgZG9lc24ndCBjb250YWluIGFsbCBjaGlsZHJlbidzIHNpbmNlIHJlcG9ydGVyIGNyZWF0aW9uLgogICAgICogQHR5cGUge09iamVjdDxDaGlsZElkLCBEYXRhT2JqZWN0Q2hpbGQ+fQogICAgICovCgogIH0sIHsKICAgIGtleTogJ2NoaWxkcmVucycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuT2JqZWN0czsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0Owp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBEYXRhT2JqZWN0OwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjo4LCIuL0RhdGFPYmplY3RDaGlsZCI6MiwiLi9TeW5jT2JqZWN0Ijo2fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOyAvKioKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqKi8KCnZhciBfU3luY09iamVjdCA9IHJlcXVpcmUoJy4vU3luY09iamVjdCcpOwoKdmFyIF9TeW5jT2JqZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1N5bmNPYmplY3QpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiAqIFRoZSBjbGFzcyByZXR1cm5lZCBmcm9tIHRoZSBEYXRhT2JqZWN0IGFkZENoaWxkcmVuIGNhbGwgb3IgZnJvbSBvbkFkZENoaWxkcmVuIGlmIHJlbW90ZWx5IGNyZWF0ZWQuCiAqIENoaWxkcmVuIG9iamVjdCBzeW5jaHJvbml6YXRpb24gaXMgYSBhIGZhc3QgZm9yd2FyZCBtZWNoYW5pc20sIG5vIG5lZWQgZm9yIGRpcmVjdCBzdWJzY3JpcHRpb25zLCBpdCB1c2VzIHRoZSBhbHJlYWR5IGF1dGhvcml6ZWQgc3Vic2NyaXB0aW9uIGZyb20gdGhlIHBhcmVudCBEYXRhT2JqZWN0LgogKi8KCnZhciBEYXRhT2JqZWN0Q2hpbGQgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkCiAgKi8KCiAgLyoqCiAgICogQGlnbm9yZQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBEYXRhT2JqZWN0LmFkZENoaWxkcmVuCiAgICovCgogIGZ1bmN0aW9uIERhdGFPYmplY3RDaGlsZChwYXJlbnQsIGNoaWxkSWQsIGluaXRpYWxEYXRhLCBvd25lciwgbXNnSWQpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXRhT2JqZWN0Q2hpbGQpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgIF90aGlzLl9jaGlsZElkID0gY2hpbGRJZDsKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX21zZ0lkID0gbXNnSWQ7CgogICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgX1N5bmNPYmplY3QyLmRlZmF1bHQoaW5pdGlhbERhdGEpOwoKICAgIF90aGlzLl9idXMgPSBwYXJlbnQuX2J1czsKICAgIF90aGlzLl9hbGxvY2F0ZUxpc3RlbmVycygpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RDaGlsZCwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy90aGlzIGlzIG9ubHkgbmVlZGVkIGZvciBjaGlsZHJlbiByZXBvcnRlcnMKICAgICAgaWYgKF90aGlzLl9vd25lcikgewogICAgICAgIF90aGlzLl9saXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoX3RoaXMuX293bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICBpZiAobXNnLnR5cGUgPT09ICdyZXNwb25zZScgJiYgbXNnLmlkID09PSBfdGhpcy5fbXNnSWQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RDaGlsZC5vblJlc3BvbnNlOicsIG1zZyk7CiAgICAgICAgICAgIF90aGlzLl9vblJlc3BvbnNlKG1zZyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfcmVsZWFzZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbGVhc2VMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuX2xpc3RlbmVyKSB7CiAgICAgICAgX3RoaXMuX2xpc3RlbmVyLnJlbW92ZSgpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuZCBkZWxldGUgb2JqZWN0IGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkZWxldGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBkZWxldGUgX3RoaXMuX3BhcmVudC5fY2hpbGRyZW5bX3RoaXMuX2NoaWxkSWRdOwoKICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKCiAgICAgIC8vVE9ETzogc2VuZCBkZWxldGUgbWVzc2FnZSA/CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGlsZHJlbiBJRCBnZW5lcmF0ZWQgb24gYWRkQ2hpbGRyZW4uIFVuaXF1ZSBpZGVudGlmaWVyCiAgICAgKiBAdHlwZSB7VVJMfSAtIFVSTCBvZiB0aGUgZm9ybWF0IDxIeXBlcnR5VVJMPiM8bnVtZXJpYy1zZXF1ZW5jZT4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbkNoYW5nZScsCgoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgdGhlIGNoYW5nZSBsaXN0ZW5lcnMgc2VudCBieSB0aGUgcmVwb3J0ZXIgY2hpbGQKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2hhbmdlKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBjYWxsYmFjayhldmVudCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgcmVzcG9uc2Ugbm90aWZpY2F0aW9ucyBvZiB0aGUgY3JlYXRlcwogICAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjawogICAgICovCgogIH0sIHsKICAgIGtleTogJ29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVzcG9uc2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVzcG9uc2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgdXJsOiBtc2cuYm9keS5zb3VyY2UsCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdjaGlsZElkJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgIH0KCiAgICAvKioKICAgICAqIERhdGEgU3RydWN0dXJlIHRvIGJlIHN5bmNocm9uaXplZC4KICAgICAqIEB0eXBlIHtKU09OfSAtIEpTT04gc3RydWN0dXJlIHRoYXQgc2hvdWxkIGZvbGxvdyB0aGUgZGVmaW5lZCBzY2hlbWEsIGlmIGFueS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkYXRhJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RDaGlsZDsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gRGF0YU9iamVjdENoaWxkOwoKfSx7Ii4vU3luY09iamVjdCI6Nn1dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KG9iamVjdCwgcHJvcGVydHksIHJlY2VpdmVyKSB7IGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH07Cgp2YXIgX0RhdGFPYmplY3QyID0gcmVxdWlyZSgnLi9EYXRhT2JqZWN0Jyk7Cgp2YXIgX0RhdGFPYmplY3QzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdDIpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RDaGlsZCcpOwoKdmFyIF9EYXRhT2JqZWN0Q2hpbGQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdENoaWxkKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0gLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgRmlsdGVyVHlwZSA9IHsgQU5ZOiAnYW55JywgU1RBUlQ6ICdzdGFydCcsIEVYQUNUOiAnZXhhY3QnIH07CgovKioKICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIFN5bmNoZXIgc3Vic2NyaWJlIGNhbGwuCiAqIFRvIGJlIHVzZWQgYXMgYW4gb2JzZXJ2YXRpb24gcG9pbnQgZnJvbSBhIERhdGFPYmplY3RSZXBvcnRlciBjaGFuZ2UuCiAqLwoKdmFyIERhdGFPYmplY3RPYnNlcnZlciA9IGZ1bmN0aW9uIChfRGF0YU9iamVjdCkgewogIF9pbmhlcml0cyhEYXRhT2JqZWN0T2JzZXJ2ZXIsIF9EYXRhT2JqZWN0KTsKCiAgLyogcHJpdmF0ZQogIF9jaGFuZ2VMaXN0ZW5lcjogTXNnTGlzdGVuZXIKICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9maWx0ZXJzOiB7PGZpbHRlcj46IHt0eXBlOiA8c3RhcnQsIGV4YWN0PiwgY2FsbGJhY2s6IDxmdW5jdGlvbj59IH0KICAqLwoKICAvKioKICAgKiBAaWdub3JlCiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIuc3Vic2NyaWJlIG1ldGhvZAogICAqLwoKICBmdW5jdGlvbiBEYXRhT2JqZWN0T2JzZXJ2ZXIoc3luY2hlciwgdXJsLCBzY2hlbWEsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbnMsIGluaXRpYWxWZXJzaW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdE9ic2VydmVyKTsKCiAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RPYnNlcnZlcikuY2FsbCh0aGlzLCBzeW5jaGVyLCB1cmwsIHNjaGVtYSwgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEuZGF0YSwgY2hpbGRyZW5zKSk7CgogICAgdmFyIF90aGlzID0gX3RoaXMyOwoKICAgIF90aGlzLl92ZXJzaW9uID0gaW5pdGlhbFZlcnNpb247CiAgICBfdGhpcy5fZmlsdGVycyA9IHt9OwoKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLl9vbkZpbHRlcihldmVudCk7CiAgICB9KTsKCiAgICAvL3NldHVwIGNoaWxkcmVucyBkYXRhIGZyb20gc3Vic2NyaXB0aW9uCiAgICBPYmplY3Qua2V5cyhpbml0aWFsRGF0YS5jaGlsZHJlbnMpLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkSWQpIHsKICAgICAgdmFyIGNoaWxkRGF0YSA9IGluaXRpYWxEYXRhLmNoaWxkcmVuc1tjaGlsZElkXTsKICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZElkXSA9IG5ldyBfRGF0YU9iamVjdENoaWxkMi5kZWZhdWx0KF90aGlzLCBjaGlsZElkLCBjaGlsZERhdGEpOwogICAgfSk7CgogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gX3RoaXMyOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RPYnNlcnZlciwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihEYXRhT2JqZWN0T2JzZXJ2ZXIucHJvdG90eXBlKSwgJ19hbGxvY2F0ZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl91cmwgKyAnL2NoYW5nZXMnLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgaWYgKG1zZy50eXBlID09PSAndXBkYXRlJykgewogICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci0nICsgX3RoaXMuX3VybCArICctUkNWOiAnLCBtc2cpOwogICAgICAgICAgX3RoaXMuX2NoYW5nZU9iamVjdChfdGhpcy5fc3luY09iaiwgbXNnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdE9ic2VydmVyLnByb3RvdHlwZSksICdfcmVsZWFzZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIucmVtb3ZlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuZCBkZWxldGUgb2JqZWN0IGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkZWxldGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpOwogICAgICBkZWxldGUgX3RoaXMuX3N5bmNoZXIuX29ic2VydmVyc1tfdGhpcy5fdXJsXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgYW5kIGRlbGV0ZSBvYmplY3QgZGF0YQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3Vuc3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciB1blN1YnNjcmliZU1zZyA9IHsKICAgICAgICB0eXBlOiAndW5zdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBfdGhpcy5fc3luY2hlci5fc3ViVVJMLAogICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IF90aGlzLl91cmwgfQogICAgICB9OwoKICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh1blN1YnNjcmliZU1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgY29uc29sZS5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci1VTlNVQlNDUklCRTogJywgcmVwbHkpOwogICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fb2JzZXJ2ZXJzW190aGlzLl91cmxdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWdpc3RlciB0aGUgY2hhbmdlIGxpc3RlbmVycyBzZW50IGJ5IHRoZSByZXBvcnRlcgogICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciAtIEZpbHRlciB0aGF0IGlkZW50aWZpZXMgdGhlIGZpZWxkIChzZXBhcmV0ZWQgZG90IHBhdGgpLiBBY2NlcHRzICogYXQgdGhlIGVuZCBmb3IgYSBtb3JlIHVucmVzdHJpY3RlZCBmaWx0ZXJpbmcuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnb25DaGFuZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2hhbmdlKGZpbHRlciwgY2FsbGJhY2spIHsKICAgICAgdmFyIGtleSA9IGZpbHRlcjsKICAgICAgdmFyIGZpbHRlck9iaiA9IHsKICAgICAgICB0eXBlOiBGaWx0ZXJUeXBlLkVYQUNULAogICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjawogICAgICB9OwoKICAgICAgdmFyIGlkeCA9IGZpbHRlci5pbmRleE9mKCcqJyk7CiAgICAgIGlmIChpZHggPT09IGZpbHRlci5sZW5ndGggLSAxKSB7CiAgICAgICAgaWYgKGlkeCA9PT0gMCkgewogICAgICAgICAgZmlsdGVyT2JqLnR5cGUgPSBGaWx0ZXJUeXBlLkFOWTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmlsdGVyT2JqLnR5cGUgPSBGaWx0ZXJUeXBlLlNUQVJUOwogICAgICAgICAga2V5ID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIubGVuZ3RoIC0gMSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9maWx0ZXJzW2tleV0gPSBmaWx0ZXJPYmo7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRmlsdGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25GaWx0ZXIoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIE9iamVjdC5rZXlzKF90aGlzLl9maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgZmlsdGVyID0gX3RoaXMuX2ZpbHRlcnNba2V5XTsKICAgICAgICBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuQU5ZKSB7CiAgICAgICAgICAvL21hdGNoIGFueXRoaW5nCiAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLnR5cGUgPT09IEZpbHRlclR5cGUuU1RBUlQpIHsKICAgICAgICAgIC8vaWYgc3RhcnRzIHdpdGggZmlsdGVyLi4uCiAgICAgICAgICBpZiAoZXZlbnQuZmllbGQuaW5kZXhPZihrZXkpID09PSAwKSB7CiAgICAgICAgICAgIGZpbHRlci5jYWxsYmFjayhldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5FWEFDVCkgewogICAgICAgICAgLy9leGFjdCBtYXRjaAogICAgICAgICAgaWYgKGV2ZW50LmZpZWxkID09PSBrZXkpIHsKICAgICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERhdGFPYmplY3RPYnNlcnZlcjsKfShfRGF0YU9iamVjdDMuZGVmYXVsdCAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8pOwoKZXhwb3J0cy5kZWZhdWx0ID0gRGF0YU9iamVjdE9ic2VydmVyOwoKfSx7Ii4vRGF0YU9iamVjdCI6MSwiLi9EYXRhT2JqZWN0Q2hpbGQiOjJ9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7Cgp2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgeyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9OwoKdmFyIF9EYXRhT2JqZWN0MiA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdCcpOwoKdmFyIF9EYXRhT2JqZWN0MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFPYmplY3QyKTsKCnZhciBfdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfSAvKioKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IEFwaXplZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqKi8KCi8qKgogKiBUaGUgY2xhc3MgcmV0dXJuZWQgZnJvbSB0aGUgU3luY2hlciBjcmVhdGUgY2FsbC4KICogVG8gYmUgdXNlZCBhcyBhIHJlcG9ydGVyIHBvaW50LCBjaGFuZ2VzIHdpbGwgYmUgc3VibWl0ZWQgdG8gRGF0YU9iamVjdE9ic2VydmVyIGluc3RhbmNlcy4KICovCgp2YXIgRGF0YU9iamVjdFJlcG9ydGVyID0gZnVuY3Rpb24gKF9EYXRhT2JqZWN0KSB7CiAgX2luaGVyaXRzKERhdGFPYmplY3RSZXBvcnRlciwgX0RhdGFPYmplY3QpOwoKICAvKiBwcml2YXRlCiAgX3N1YnNjcmlwdGlvbnM6IDxoeXBlcnR5VXJsOiB7IHN0YXR1czogc3RyaW5nIH0gfT4KICAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLQogIF9vblN1YnNjcmlwdGlvbkhhbmRsZXI6IChldmVudCkgPT4gdm9pZAogIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkCiAgKi8KCiAgLyoqCiAgICogQGlnbm9yZQogICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyLmNyZWF0ZSBtZXRob2QKICAgKi8KCiAgZnVuY3Rpb24gRGF0YU9iamVjdFJlcG9ydGVyKHN5bmNoZXIsIHVybCwgc2NoZW1hLCBpbml0aWFsU3RhdHVzLCBpbml0aWFsRGF0YSwgY2hpbGRyZW5zKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YU9iamVjdFJlcG9ydGVyKTsKCiAgICB2YXIgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFPYmplY3RSZXBvcnRlcikuY2FsbCh0aGlzLCBzeW5jaGVyLCB1cmwsIHNjaGVtYSwgaW5pdGlhbFN0YXR1cywgaW5pdGlhbERhdGEsIGNoaWxkcmVucykpOwoKICAgIHZhciBfdGhpcyA9IF90aGlzMjsKCiAgICBfdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9OwoKICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItJyArIHVybCArICctU0VORDogJywgZXZlbnQpOwogICAgICBfdGhpcy5fb25DaGFuZ2UoZXZlbnQpOwogICAgfSk7CgogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gX3RoaXMyOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFPYmplY3RSZXBvcnRlciwgW3sKICAgIGtleTogJ19hbGxvY2F0ZUxpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FsbG9jYXRlTGlzdGVuZXJzKCkgewogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihEYXRhT2JqZWN0UmVwb3J0ZXIucHJvdG90eXBlKSwgJ19hbGxvY2F0ZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVzcG9uc2VMaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3Jlc3BvbnNlJykgewogICAgICAgICAgX3RoaXMuX29uUmVzcG9uc2UobXNnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRGF0YU9iamVjdFJlcG9ydGVyLnByb3RvdHlwZSksICdfcmVsZWFzZUxpc3RlbmVycycsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fcmVzcG9uc2VMaXN0ZW5lci5yZW1vdmUoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdpbnZpdGVPYnNlcnZlcnMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGludml0ZU9ic2VydmVycyhvYnNlcnZlcnMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBpbnZpdGVNc2cgPSB7CiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9zeW5jaGVyLl9vd25lciwgdG86IF90aGlzLl9zeW5jaGVyLl9zdWJVUkwsCiAgICAgICAgYm9keTogeyByZXNvdXJjZTogX3RoaXMuX3VybCwgc2NoZW1hOiBfdGhpcy5fc2NoZW1hLCB2YWx1ZTogX3RoaXMuX3N5bmNPYmouZGF0YSwgYXV0aG9yaXNlOiBvYnNlcnZlcnMgfQogICAgICB9OwoKICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShpbnZpdGVNc2cpOwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbmQgZGVsZXRlIG9iamVjdCBkYXRhCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZGVsZXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVsZXRlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGRlbGV0ZU1zZyA9IHsKICAgICAgICB0eXBlOiAnZGVsZXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N5bmNoZXIuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsIH0KICAgICAgfTsKCiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoZGVsZXRlTXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLURFTEVURTogJywgcmVwbHkpOwogICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgX3RoaXMuX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fcmVwb3J0ZXJzW190aGlzLl91cmxdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdWJzY3JpcHRpb25zIHJlcXVlc3RlZCBhbmQgYWNjZXB0ZWQgdG8gdGhpcyByZXBvcnRlcgogICAgICogQHR5cGUge09iamVjdDxIeXBlcnR5VVJMLCBTeW5jU3Vic2NyaXB0aW9uPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvblN1YnNjcmlwdGlvbicsCgoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3Mgc3Vic2NyaWJlIGFuZCB1bnN1YnNjcmliZSBub3RpZmljYXRpb25zCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBvblN1YnNjcmlwdGlvbihjYWxsYmFjaykgewogICAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBjYWxsYmFjazsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIHJlc3BvbnNlIG5vdGlmaWNhdGlvbnMgb2YgdGhlIGNyZWF0ZSdzCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnb25SZXNwb25zZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXNwb25zZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGNhbGxiYWNrOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcndhcmQobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBjb25zb2xlLmxvZygnRGF0YU9iamVjdFJlcG9ydGVyLVJDVjogJywgbXNnKTsKICAgICAgc3dpdGNoIChtc2cuYm9keS50eXBlKSB7CiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblN1YnNjcmliZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICAgIF90aGlzLl9vblVuU3Vic2NyaWJlKG1zZyk7YnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25TdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy5ib2R5LnR5cGUsCiAgICAgICAgdXJsOiBoeXBlcnR5VXJsLAoKICAgICAgICBhY2NlcHQ6IGZ1bmN0aW9uIGFjY2VwdCgpIHsKICAgICAgICAgIC8vY3JlYXRlIG5ldyBzdWJzY3JpcHRpb24KICAgICAgICAgIHZhciBzdWIgPSB7IHVybDogaHlwZXJ0eVVybCwgc3RhdHVzOiAnb24nIH07CiAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXSA9IHN1YjsKCiAgICAgICAgICAvL3Byb2Nlc3MgYW5kIHNlbmQgY2hpbGRyZW5zIGRhdGEKICAgICAgICAgIHZhciBjaGlsZHJlblZhbHVlcyA9IHt9OwogICAgICAgICAgT2JqZWN0LmtleXMoX3RoaXMuX2NoaWxkcmVuT2JqZWN0cykuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGRJZCkgewogICAgICAgICAgICB2YXIgY2hpbGREYXRhID0gX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZElkXS5kYXRhOwogICAgICAgICAgICBjaGlsZHJlblZhbHVlc1tjaGlsZElkXSA9ICgwLCBfdXRpbHMuZGVlcENsb25lKShjaGlsZERhdGEpOwogICAgICAgICAgfSk7CgogICAgICAgICAgLy9zZW5kIG9rIHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogX3RoaXMuX3NjaGVtYSwgdmVyc2lvbjogX3RoaXMuX3ZlcnNpb24sIHZhbHVlOiB7IGRhdGE6ICgwLCBfdXRpbHMuZGVlcENsb25lKShfdGhpcy5kYXRhKSwgY2hpbGRyZW5zOiBjaGlsZHJlblZhbHVlcyB9IH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBzdWI7CiAgICAgICAgfSwKCiAgICAgICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocmVhc29uKSB7CiAgICAgICAgICAvL3NlbmQgcmVqZWN0IHJlc3BvbnNlIG1lc3NhZ2UKICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgYm9keTogeyBjb2RlOiA0MDMsIGRlc2M6IHJlYXNvbiB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAoX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdTVUJTQ1JJUFRJT04tRVZFTlQ6ICcsIGV2ZW50KTsKICAgICAgICBfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblVuU3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25VblN1YnNjcmliZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGh5cGVydHlVcmwgPSBtc2cuYm9keS5mcm9tOwoKICAgICAgdmFyIHN1YiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdOwogICAgICBkZWxldGUgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVybF07CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLmJvZHkudHlwZSwKICAgICAgICB1cmw6IGh5cGVydHlVcmwsCiAgICAgICAgb2JqZWN0OiBzdWIKICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1VOLVNVQlNDUklQVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVzcG9uc2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlc3BvbnNlKG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgIHR5cGU6IG1zZy50eXBlLAogICAgICAgIHVybDogbXNnLmZyb20sCiAgICAgICAgY29kZTogbXNnLmJvZHkuY29kZQogICAgICB9OwoKICAgICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikgewogICAgICAgIGNvbnNvbGUubG9nKCdSRVNQT05TRS1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdzdWJzY3JpcHRpb25zJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uczsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhT2JqZWN0UmVwb3J0ZXI7Cn0oX0RhdGFPYmplY3QzLmRlZmF1bHQgLyogaW1wbGVtZW50cyBTeW5jU3RhdHVzICovKTsKCmV4cG9ydHMuZGVmYXVsdCA9IERhdGFPYmplY3RSZXBvcnRlcjsKCn0seyIuLi91dGlscy91dGlscy5qcyI6OCwiLi9EYXRhT2JqZWN0IjoxfV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8qKgogKiBAYWNjZXNzIHByaXZhdGUKICovCgp2YXIgRGF0YVByb3Zpc2lvbmFsID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICBfY2hpbGRyZW5MaXN0ZW5lcnM6IFtNc2dMaXN0ZW5lcl0KICBfbGlzdGVuZXI6IE1zZ0xpc3RlbmVyCiAgIF9jaGFuZ2VzOiBbXQogICovCgogIGZ1bmN0aW9uIERhdGFQcm92aXNpb25hbChvd25lciwgdXJsLCBidXMsIGNoaWxkcmVuKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0YVByb3Zpc2lvbmFsKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX3VybCA9IHVybDsKICAgIF90aGlzLl9idXMgPSBidXM7CiAgICBfdGhpcy5fY2hpbGRyZW4gPSBjaGlsZHJlbjsKCiAgICBfdGhpcy5fY2hhbmdlcyA9IFtdOwogICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGF0YVByb3Zpc2lvbmFsLCBbewogICAga2V5OiAnX2FsbG9jYXRlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfYWxsb2NhdGVMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy5fbGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl91cmwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGF0YVByb3Zpc2lvbmFsLScgKyBfdGhpcy5fdXJsICsgJy1SQ1Y6ICcsIG1zZyk7CiAgICAgICAgX3RoaXMuX2NoYW5nZXMucHVzaChtc2cpOwogICAgICB9KTsKCiAgICAgIC8qCiAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycyA9IFtdOwogICAgICBpZiAoX3RoaXMuX2NoaWxkcmVuKSB7CiAgICAgICAgbGV0IGNoaWxkQmFzZVVSTCA9IHVybCArICcvY2hpbGRyZW4vJzsKICAgICAgICBfdGhpcy5fY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHsKICAgICAgICAgIGxldCBjaGlsZFVSTCA9IGNoaWxkQmFzZVVSTCArIGNoaWxkOwogICAgICAgICAgbGV0IGxpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgKG1zZykgPT4gewogICAgICAgICAgICAvL2lnbm9yZSBtc2cgc2VudCBieSBoaW1zZWxmCiAgICAgICAgICAgIGlmIChtc2cuZnJvbSAhPT0gb3duZXIpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICAgICAgfSk7CiAgICAgIH0qLwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZWxlYXNlTGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVsZWFzZUxpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl9saXN0ZW5lci5yZW1vdmUoKTsKCiAgICAgIC8qX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7CiAgICAgICAgbGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgIH0pOyovCiAgICB9CiAgfSwgewogICAga2V5OiAnYXBwbHknLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5KG9ic2VydmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgIG9ic2VydmVyLl9jaGFuZ2VPYmplY3Qob2JzZXJ2ZXIuX3N5bmNPYmosIGNoYW5nZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ2NoaWxkcmVuJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW47CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGF0YVByb3Zpc2lvbmFsOwp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBEYXRhUHJvdmlzaW9uYWw7Cgp9LHt9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLk9iamVjdFR5cGUgPSBleHBvcnRzLkNoYW5nZVR5cGUgPSB1bmRlZmluZWQ7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX3V0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKi8KCnZhciBTeW5jT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgIF9kYXRhOiBhbnk7CiAgICBfb2JzZXJ2ZXJzOiAoKGV2ZW50OiBDaGFuZ2VFdmVudCkgPT4gdm9pZClbXQogICovCgogIGZ1bmN0aW9uIFN5bmNPYmplY3QoaW5pdGlhbERhdGEpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jT2JqZWN0KTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vYnNlcnZlcnMgPSBbXTsKICAgIF90aGlzLl9maWx0ZXJzID0ge307CgogICAgaWYgKGluaXRpYWxEYXRhKSB7CiAgICAgIF90aGlzLl9kYXRhID0gKDAsIF91dGlscy5kZWVwQ2xvbmUpKGluaXRpYWxEYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIF90aGlzLl9kYXRhID0ge307CiAgICB9CgogICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShuZXcgUGF0aCgpLCBfdGhpcy5fZGF0YSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU3luY09iamVjdCwgW3sKICAgIGtleTogJ29ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9ic2VydmUoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmQocGF0aCkgewogICAgICB2YXIgbGlzdCA9IHBhdGguc3BsaXQoJy4nKTsKCiAgICAgIHJldHVybiB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZpbmRCZWZvcmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRCZWZvcmUocGF0aCkgewogICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgIHZhciBsaXN0ID0gcGF0aC5zcGxpdCgnLicpOwogICAgICByZXN1bHQubGFzdCA9IGxpc3QucG9wKCk7CiAgICAgIHJlc3VsdC5vYmogPSB0aGlzLl9maW5kV2l0aFNwbGl0KGxpc3QpOwoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmluZFdpdGhTcGxpdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRXaXRoU3BsaXQobGlzdCkgewogICAgICB2YXIgb2JqID0gdGhpcy5fZGF0YTsKICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG9iaiA9IG9ialt2YWx1ZV07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG9iajsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZmlyZUV2ZW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmlyZUV2ZW50KGV2ZW50KSB7CiAgICAgIHRoaXMuX29ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGV2ZW50KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2lzT2JzZXJ2YWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzT2JzZXJ2YWJsZShvYmopIHsKICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ19pbnRlcm5hbE9ic2VydmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pbnRlcm5hbE9ic2VydmUocGF0aCwgb2JqKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmopKSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKGNoYW5nZXMpIHsKICAgICAgICAgIF90aGlzLl9vbkNoYW5nZXMocGF0aCwgY2hhbmdlcyk7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICBPYmplY3Qub2JzZXJ2ZShvYmosIGhhbmRsZXIpOwogICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgICAgICAgaWYgKF90aGlzLl9pc09ic2VydmFibGUob2JqW3Byb3BdKSkgewogICAgICAgICAgICAgIF90aGlzLl9pbnRlcm5hbE9ic2VydmUocGF0aC5uZXcocHJvcCksIG9ialtwcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgIEFycmF5Lm9ic2VydmUob2JqLCBoYW5kbGVyKTsKICAgICAgICAgIGZvciAodmFyIF9wcm9wIGluIG9iaikgewogICAgICAgICAgICBpZiAoX3RoaXMuX2lzT2JzZXJ2YWJsZShvYmpbX3Byb3BdKSkgewogICAgICAgICAgICAgIHZhciBucCA9IHBhdGgubmV3KG5ldyBBcnJheUluZGV4KG9ialtfcHJvcF0sIF9wcm9wKSk7CiAgICAgICAgICAgICAgX3RoaXMuX2ludGVybmFsT2JzZXJ2ZShucCwgb2JqW19wcm9wXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25DaGFuZ2VzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2VzKHBhdGgsIGNoYW5nZXMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBmb3IgKHZhciBpIGluIGNoYW5nZXMpIHsKICAgICAgICB2YXIgb2JqID0gY2hhbmdlc1tpXS5vYmplY3Q7CiAgICAgICAgdmFyIG9ialR5cGUgPSB2b2lkIDA7CgogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgb2JqVHlwZSA9IE9iamVjdFR5cGUuT0JKRUNUOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKICAgICAgICAgIG9ialR5cGUgPSBPYmplY3RUeXBlLkFSUkFZOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNoYW5nZXNbaV0udHlwZSA9PT0gJ3NwbGljZScpIHsKICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpZHggPSBjaGFuZ2VzW2ldLmluZGV4OwogICAgICAgICAgICB2YXIgZmllbGQgPSBwYXRoLm5ldygnJyArIGlkeCk7CiAgICAgICAgICAgIHZhciBmaWVsZFN0cmluZyA9IGZpZWxkLnRvU3RyaW5nKCk7CgogICAgICAgICAgICB2YXIgcmVtb3ZlU2l6ZSA9IGNoYW5nZXNbaV0ucmVtb3ZlZC5sZW5ndGg7CiAgICAgICAgICAgIGlmIChyZW1vdmVTaXplICE9PSAwKSB7CiAgICAgICAgICAgICAgdmFyIHJlbW92ZVZhbHVlcyA9IGNoYW5nZXNbaV0ucmVtb3ZlZDsKICAgICAgICAgICAgICByZW1vdmVWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLl9pc09ic2VydmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHBhdGgucmVtb3ZlSW5kZXgoaWR4ICsgaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczIuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgICBjVHlwZTogQ2hhbmdlVHlwZS5SRU1PVkUsCiAgICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZFN0cmluZywKICAgICAgICAgICAgICAgIGRhdGE6IHJlbW92ZVNpemUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFkZFNpemUgPSBjaGFuZ2VzW2ldLmFkZGVkQ291bnQ7CiAgICAgICAgICAgIGlmIChhZGRTaXplICE9PSAwKSB7CiAgICAgICAgICAgICAgdmFyIGFkZFZhbHVlcyA9IG9iai5zbGljZShpZHgsIGlkeCArIGFkZFNpemUpOwogICAgICAgICAgICAgIGFkZFZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczIuX2lzT2JzZXJ2YWJsZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5wID0gcGF0aC5uZXcobmV3IEFycmF5SW5kZXgodmFsdWUsIGlkeCArIGluZGV4KSk7CiAgICAgICAgICAgICAgICAgIF90aGlzMi5faW50ZXJuYWxPYnNlcnZlKG5wLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMi5fZmlyZUV2ZW50KHsKICAgICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLkFERCwKICAgICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkU3RyaW5nLAogICAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKGFkZFZhbHVlcykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9yZS1kZWZpbmUgcGF0aHMuLi4KICAgICAgICAgICAgaWYgKGlkeCAhPT0gb2JqLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICBwYXRoLnJlSW5kZXhGcm9tKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBfZmllbGQgPSBwYXRoLm5ldyhjaGFuZ2VzW2ldLm5hbWUpOwogICAgICAgICAgdmFyIF9maWVsZFN0cmluZyA9IF9maWVsZC50b1N0cmluZygpOwoKICAgICAgICAgIGlmIChfZmllbGRTdHJpbmcuaW5kZXhPZignU3ltYm9sJykgIT09IC0xKSB7CiAgICAgICAgICAgIC8vaGFjayBmb3IgUGhhbnRvbUpTMgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdTWU1CT0w6ICcsIGNoYW5nZXNbaV0pOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2xldCBvbGRWYWx1ZSA9IGNoYW5nZXNbaV0ub2xkVmFsdWU7CiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBvYmpbY2hhbmdlc1tpXS5uYW1lXTsKICAgICAgICAgIGlmIChjaGFuZ2VzW2ldLnR5cGUgPT09ICd1cGRhdGUnKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuVVBEQVRFLAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBfZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnYWRkJykgewogICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9ic2VydmUoX2ZpZWxkLCBuZXdWYWx1ZSk7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCh7CiAgICAgICAgICAgICAgY1R5cGU6IENoYW5nZVR5cGUuQURELAogICAgICAgICAgICAgIG9UeXBlOiBvYmpUeXBlLAogICAgICAgICAgICAgIGZpZWxkOiBfZmllbGRTdHJpbmcsCiAgICAgICAgICAgICAgZGF0YTogKDAsIF91dGlscy5kZWVwQ2xvbmUpKG5ld1ZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhbmdlc1tpXS50eXBlID09PSAnZGVsZXRlJykgewogICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoewogICAgICAgICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlJFTU9WRSwKICAgICAgICAgICAgICBvVHlwZTogb2JqVHlwZSwKICAgICAgICAgICAgICBmaWVsZDogX2ZpZWxkU3RyaW5nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2RhdGEnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN5bmNPYmplY3Q7Cn0oKTsKCi8vZHluYW1pYyBwYXRoIGZvciBBcnJheSBpbmRleC4uLgoKCnZhciBQYXRoID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFBhdGgoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGF0aCk7CgogICAgdGhpcy5fcGF0aCA9IFtdOwogICAgdGhpcy5fb2JzZXJ2YWJsZXMgPSB7fTsgLy88aW5kZXg6QXJyYXlJbmRleD4KICB9CgogIF9jcmVhdGVDbGFzcyhQYXRoLCBbewogICAga2V5OiAncmVtb3ZlSW5kZXgnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUluZGV4KGlkeCkgewogICAgICAvL2NvbnNvbGUubG9nKCdSRU1PVkUtUEFUSCAnICsgaWR4KTsKICAgICAgZGVsZXRlIHRoaXMuX29ic2VydmFibGVzW2lkeF07CiAgICB9CiAgfSwgewogICAga2V5OiAncmVJbmRleEZyb20nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlSW5kZXhGcm9tKGFycmF5KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgT2JqZWN0LmtleXModGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBhcnJheUluZGV4ID0gX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgIHZhciBpZHggPSBhcnJheS5pbmRleE9mKGFycmF5SW5kZXgub2JqKTsKICAgICAgICBpZiAoYXJyYXlJbmRleC5pZHggIT0gaWR4KSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdSRS1JTkRFWDogJyArIGtleSArICctPicgKyBpZHgpOwogICAgICAgICAgYXJyYXlJbmRleC5pZHggPSBpZHg7CiAgICAgICAgICBkZWxldGUgX3RoaXMzLl9vYnNlcnZhYmxlc1trZXldOwogICAgICAgICAgX3RoaXMzLl9vYnNlcnZhYmxlc1tpZHhdID0gYXJyYXlJbmRleDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ25ldycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX25ldyhpZHgpIHsKICAgICAgaWYgKGlkeC5jb25zdHJ1Y3RvciA9PSBBcnJheUluZGV4KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnUEFUSC1PQlNFUlY6ICcsIGlkeCk7CiAgICAgICAgdGhpcy5fb2JzZXJ2YWJsZXNbaWR4LmlkeF0gPSBpZHg7CiAgICAgIH0KCiAgICAgIHZhciBuUGF0aCA9IHRoaXMuY2xvbmUoKTsKICAgICAgblBhdGguX3BhdGgucHVzaChpZHgpOwoKICAgICAgcmV0dXJuIG5QYXRoOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Nsb25lJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgdmFyIG5QYXRoID0gbmV3IFBhdGgoKTsKICAgICAgdGhpcy5fcGF0aC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIG5QYXRoLl9wYXRoLnB1c2godmFsdWUpOwogICAgICB9KTsKCiAgICAgIHJldHVybiBuUGF0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd0b1N0cmluZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIC8vVE9ETzogb3B0aW1pemUhIQogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICBzdHIgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHIgKz0gJy4nICsgdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICB9XSk7CgogIHJldHVybiBQYXRoOwp9KCk7Cgp2YXIgQXJyYXlJbmRleCA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBcnJheUluZGV4KG9iaiwgaWR4KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXJyYXlJbmRleCk7CgogICAgdGhpcy5vYmogPSBvYmo7CiAgICB0aGlzLmlkeCA9IGlkeDsKICB9CgogIF9jcmVhdGVDbGFzcyhBcnJheUluZGV4LCBbewogICAga2V5OiAndG9TdHJpbmcnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy5pZHgudG9TdHJpbmcoKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBBcnJheUluZGV4Owp9KCk7Cgp2YXIgQ2hhbmdlVHlwZSA9IGV4cG9ydHMuQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAndXBkYXRlJywgQUREOiAnYWRkJywgUkVNT1ZFOiAncmVtb3ZlJyB9Owp2YXIgT2JqZWN0VHlwZSA9IGV4cG9ydHMuT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAnb2JqZWN0JywgQVJSQVk6ICdhcnJheScgfTsKZXhwb3J0cy5kZWZhdWx0ID0gU3luY09iamVjdDsKCn0seyIuLi91dGlscy91dGlscy5qcyI6OH1dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsgLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlciA9IHJlcXVpcmUoJy4vRGF0YU9iamVjdFJlcG9ydGVyJyk7Cgp2YXIgX0RhdGFPYmplY3RSZXBvcnRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9EYXRhT2JqZWN0UmVwb3J0ZXIpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIgPSByZXF1aXJlKCcuL0RhdGFPYmplY3RPYnNlcnZlcicpOwoKdmFyIF9EYXRhT2JqZWN0T2JzZXJ2ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRGF0YU9iamVjdE9ic2VydmVyKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsID0gcmVxdWlyZSgnLi9EYXRhUHJvdmlzaW9uYWwnKTsKCnZhciBfRGF0YVByb3Zpc2lvbmFsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0RhdGFQcm92aXNpb25hbCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgovKioKICogVGhlIG1haW4gY2xhc3MgZm9yIHRoZSBzeW5jaGVyIHBhY2thZ2UuCiAqIFRoZSBTeW5jaGVyIGlzIGEgc2luZ2xldG9uIGNsYXNzIHBlciBIeXBlcnR5L1VSTCBhbmQgaXQgaXMgdGhlIG93bmVyIG9mIGFsbCBjcmVhdGVkIERhdGEgU3luYyBPYmplY3RzIGFjY29yZGluZyB0byB0aGUgUmVwb3J0ZXIgLSBPYnNlcnZlciBwYXR0ZXJuLgogKiBNYWluIGZ1bmN0aW9uYWxpdHkgaXMgdG8gY3JlYXRlIHJlcG9ydGVycyBhbmQgdG8gc3Vic2NyaWJlIHRvIGV4aXN0aW5nIG9uZXMuCiAqLwoKdmFyIFN5bmNoZXIgPSBmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQogIF9vd25lcjogVVJMCiAgX2J1czogTWluaUJ1cwogICBfc3ViVVJMOiBVUkwKICAgX3JlcG9ydGVyczogPHVybDogRGF0YU9iamVjdFJlcG9ydGVyPgogIF9vYnNlcnZlcnM6IDx1cmw6IERhdGFPYmplY3RPYnNlcnZlcj4KICBfcHJvdmlzaW9uYWxzOiA8dXJsOiBEYXRhUHJvdmlzaW9uYWw+CiAgIC0tLS1ldmVudCBoYW5kbGVycy0tLS0KICBfb25Ob3RpZmljYXRpb25IYW5kbGVyOiAoZXZlbnQpID0+IHZvaWQKICAqLwoKICAvKioKICAgKiBDb25zdHJ1Y3RvciB0aGF0IHNob3VsZCBiZSB1c2VkIGJ5IHRoZSBIeXBlcnR5IG93bmVyCiAgICogQHBhcmFtIHtIeXBlcnR5VVJMfSBvd25lciAtIEh5cGVydHkgVVJMIG93bmVyLiBBbiBVUkwgYWxsb2NhdGVkIGJ5IHRoZSBydW50aW1lIHRoYXQgdW5pcXVlbHkgaWRlbnRpZmllcyB0aGUgSHlwZXJ0eS4KICAgKiBAcGFyYW0ge01pbmlCdXN9IGJ1cyAtIEFuIGluc3RhbmNlIG9mIHRoZSBNaW5pQnVzIHByb3ZpZGVkIGluIHRoZSBzYW5kYm94LiBXaGVuIGFuIG9iamVjdCAoUmVwb3J0ZXIgb3IgT2JzZXJ2ZWQpIGlzIGNyZWF0ZWQsIHRoZSBTeW5jaGVyTWFuYWdlciB3aWxsIGFkZCBhIGxpc3RlbmVyIGluIHRoZSBNaW5pQnVzIHRvIHJlY2VpdmUvc2VuZCBNZXNzYWdlcyBvZiB0aGF0IG9iamVjdC4KICAgKiBAcGFyYW0ge0pTT059IGNvbmZpZyAtIENvbmZpZ3VyYXRpb24gZGF0YS4gVGhlIG9ubHkgcmVxdWlyZWQgZmllbGQgZm9yIG5vdyBpcyB0aGUgcnVudGltZVVSTC4KICAgKi8KCiAgZnVuY3Rpb24gU3luY2hlcihvd25lciwgYnVzLCBjb25maWcpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTeW5jaGVyKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9vd25lciA9IG93bmVyOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKCiAgICBfdGhpcy5fc3ViVVJMID0gY29uZmlnLnJ1bnRpbWVVUkwgKyAnL3NtJzsKCiAgICBfdGhpcy5fcmVwb3J0ZXJzID0ge307CiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0ge307CiAgICBfdGhpcy5fcHJvdmlzaW9uYWxzID0ge307CgogICAgYnVzLmFkZExpc3RlbmVyKG93bmVyLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIC8vaWdub3JlIG1zZyBzZW50IGJ5IGhpbXNlbGYKICAgICAgaWYgKG1zZy5mcm9tICE9PSBvd25lcikgewogICAgICAgIGNvbnNvbGUubG9nKCdTeW5jaGVyLVJDVjogJywgbXNnKTsKICAgICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CiAgICAgICAgICBjYXNlICdmb3J3YXJkJzoKICAgICAgICAgICAgX3RoaXMuX29uRm9yd2FyZChtc2cpO2JyZWFrOwogICAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgICAgX3RoaXMuX29uUmVtb3RlQ3JlYXRlKG1zZyk7YnJlYWs7CiAgICAgICAgICBjYXNlICdkZWxldGUnOgogICAgICAgICAgICBfdGhpcy5fb25SZW1vdGVEZWxldGUobXNnKTticmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogVGhlIG93bmVyIG9mIHRoZSBTeW5jaGVyIGFuZCBhbGwgY3JlYXRlZCByZXBvcnRlcnMuCiAgICogQHR5cGUge0h5cGVydHlVUkx9CiAgICovCgoKICBfY3JlYXRlQ2xhc3MoU3luY2hlciwgW3sKICAgIGtleTogJ2NyZWF0ZScsCgoKICAgIC8qKgogICAgICogUmVxdWVzdCBhIERhdGFPYmplY3RSZXBvcnRlciBjcmVhdGlvbi4gVGhlIFVSTCB3aWxsIGJlIGJlIHJlcXVlc3RlZCBieSB0aGUgYWxsb2NhdGlvbiBtZWNoYW5pc20uCiAgICAgKiBAcGFyYW0gIHtTY2hlbWFVUkx9IHNjaGVtYSAtIFVSTCBvZiB0aGUgb2JqZWN0IGRlc2NyaXB0b3IKICAgICAqIEBwYXJhbSAge0h5cGVydHlVUkxbXX0gb2JzZXJ2ZXJzIC0gTGlzdCBvZiBoeXBlcnRpZXMgdGhhdCBhcmUgcHJlLWF1dGhvcml6ZWQgZm9yIHN1YnNjcmlwdGlvbgogICAgICogQHBhcmFtICB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIHJlcG9ydGVyCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RSZXBvcnRlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IFJlcG9ydGVyLiBUaGUgcmVwb3J0ZXIgY2FuIGJlIGFjY2VwdGVkIG9yIHJlamVjdGVkIGJ5IHRoZSBQRVAKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZShzY2hlbWEsIG9ic2VydmVycywgaW5pdGlhbERhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGluaXRpYWxEYXRhLnJlcG9ydGVyID0gX3RoaXMuX293bmVyOwogICAgICBpbml0aWFsRGF0YS5zY2hlbWEgPSBzY2hlbWE7CgogICAgICB2YXIgcmVxdWVzdE1zZyA9IHsKICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwKICAgICAgICBib2R5OiB7IHNjaGVtYTogc2NoZW1hLCB2YWx1ZTogaW5pdGlhbERhdGEsIGF1dGhvcmlzZTogb2JzZXJ2ZXJzIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgLy9yZXF1ZXN0IGNyZWF0ZSB0byB0aGUgQWxsb2NhdGlvbiBzeXN0ZW0/IENhbiBiZSByZWplY3RlZCBieSB0aGUgUG9saWN5RW5naW5lLgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgdmFyIG9ialVSTCA9IHJlcGx5LmJvZHkucmVzb3VyY2U7CgogICAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIGFjY2VwdGVkCiAgICAgICAgICAgIHZhciBuZXdPYmogPSBuZXcgX0RhdGFPYmplY3RSZXBvcnRlcjIuZGVmYXVsdChfdGhpcywgb2JqVVJMLCBzY2hlbWEsICdvbicsIGluaXRpYWxEYXRhLCByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzKTsKICAgICAgICAgICAgX3RoaXMuX3JlcG9ydGVyc1tvYmpVUkxdID0gbmV3T2JqOwoKICAgICAgICAgICAgcmVzb2x2ZShuZXdPYmopOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiByZWplY3RlZAogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXF1ZXN0IGEgc3Vic2NyaXB0aW9uIHRvIGFuIGV4aXN0ZW50IG9iamVjdC4KICAgICAqIEBwYXJhbSB7U2NoZW1hVVJMfSBzY2hlbWEgLSBVUkwgb2YgdGhlIG9iamVjdCBkZXNjcmlwdG9yCiAgICAgKiBAcGFyYW0ge09iamVjdFVSTH0gb2JqVVJMIC0gQWRkcmVzcyBvZiB0aGUgZXhpc3RlbnQgcmVwb3J0ZXIgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IG9ic2VydmVyLgogICAgICovCgogIH0sIHsKICAgIGtleTogJ3N1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3Vic2NyaWJlKHNjaGVtYSwgb2JqVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHZhbGlkYXRlIGlmIHN1YnNjcmlwdGlvbiBhbHJlYWR5IGV4aXN0cyA/CiAgICAgIHZhciBzdWJzY3JpYmVNc2cgPSB7CiAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsCiAgICAgICAgYm9keTogeyBzY2hlbWE6IHNjaGVtYSwgcmVzb3VyY2U6IG9ialVSTCB9CiAgICAgIH07CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIC8vcmVxdWVzdCBzdWJzY3JpcHRpb24KICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHN1YnNjcmliZU1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnc3Vic2NyaWJlLXJlc3BvbnNlOiAnLCByZXBseSk7CiAgICAgICAgICB2YXIgbmV3UHJvdmlzaW9uYWwgPSBfdGhpcy5fcHJvdmlzaW9uYWxzW29ialVSTF07CiAgICAgICAgICBkZWxldGUgX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdOwogICAgICAgICAgaWYgKG5ld1Byb3Zpc2lvbmFsKSBuZXdQcm92aXNpb25hbC5fcmVsZWFzZUxpc3RlbmVycygpOwoKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAyMDApIHsKICAgICAgICAgICAgbmV3UHJvdmlzaW9uYWwgPSBuZXcgX0RhdGFQcm92aXNpb25hbDIuZGVmYXVsdChfdGhpcy5fb3duZXIsIG9ialVSTCwgX3RoaXMuX2J1cywgcmVwbHkuYm9keS5jaGlsZHJlblJlc291cmNlcyk7CiAgICAgICAgICAgIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXSA9IG5ld1Byb3Zpc2lvbmFsOwogICAgICAgICAgfSBlbHNlIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICB2YXIgbmV3T2JqID0gbmV3IF9EYXRhT2JqZWN0T2JzZXJ2ZXIyLmRlZmF1bHQoX3RoaXMsIG9ialVSTCwgc2NoZW1hLCAnb24nLCByZXBseS5ib2R5LnZhbHVlLCBuZXdQcm92aXNpb25hbC5jaGlsZHJlbiwgcmVwbHkuYm9keS52ZXJzaW9uKTsKICAgICAgICAgICAgX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdID0gbmV3T2JqOwoKICAgICAgICAgICAgcmVzb2x2ZShuZXdPYmopOwogICAgICAgICAgICBuZXdQcm92aXNpb25hbC5hcHBseShuZXdPYmopOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgY3JlYXRlIGFuZCBkZWxldGUgZXZlbnRzIG9mIHJlbW92ZSBSZXBvcnRlciBvYmplY3RzLgogICAgICogVGhpcyBpcyByZWxlYXRlZCB0byB0aGUgbWVzc2FnZW5zIHNlbnQgYnkgY3JlYXRlIHRvIHRoZSBvYnNlcnZlcnMgSHlwZXJ0eSBhcnJheS4KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2sKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvbk5vdGlmaWNhdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Ob3RpZmljYXRpb24oY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gY2FsbGJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRm9yd2FyZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9yd2FyZChtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciByZXBvcnRlciA9IF90aGlzLl9yZXBvcnRlcnNbbXNnLmJvZHkudG9dOwogICAgICByZXBvcnRlci5fb25Gb3J3YXJkKG1zZyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVtb3RlQ3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZW1vdGVDcmVhdGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL3JlbW92ZSAiL3N1YnNjcmlwdGlvbiIgZnJvbSB0aGUgVVJMCiAgICAgIHZhciByZXNvdXJjZSA9IG1zZy5mcm9tLnNsaWNlKDAsIC0xMyk7CgogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgZnJvbTogbXNnLmJvZHkuc291cmNlLAogICAgICAgIHVybDogcmVzb3VyY2UsCiAgICAgICAgc2NoZW1hOiBtc2cuYm9keS5zY2hlbWEsCiAgICAgICAgdmFsdWU6IG1zZy5ib2R5LnZhbHVlLAogICAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSwKCiAgICAgICAgYWNrOiBmdW5jdGlvbiBhY2sodHlwZSkgewogICAgICAgICAgdmFyIGxUeXBlID0gMjAwOwogICAgICAgICAgaWYgKHR5cGUpIHsKICAgICAgICAgICAgbFR5cGUgPSB0eXBlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ05PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpOwogICAgICAgIF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIoZXZlbnQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uUmVtb3RlRGVsZXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZW1vdGVEZWxldGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL3JlbW92ZSAiL3N1YnNjcmlwdGlvbiIgZnJvbSB0aGUgVVJMCiAgICAgIHZhciByZXNvdXJjZSA9IG1zZy5ib2R5LnJlc291cmNlOwoKICAgICAgdmFyIG9iamVjdCA9IF90aGlzLl9vYnNlcnZlcnNbcmVzb3VyY2VdOwogICAgICBpZiAob2JqZWN0KSB7CiAgICAgICAgdmFyIGV2ZW50ID0gewogICAgICAgICAgdHlwZTogbXNnLnR5cGUsCiAgICAgICAgICB1cmw6IHJlc291cmNlLAogICAgICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LAoKICAgICAgICAgIGFjazogZnVuY3Rpb24gYWNrKHR5cGUpIHsKICAgICAgICAgICAgdmFyIGxUeXBlID0gMjAwOwogICAgICAgICAgICBpZiAodHlwZSkgewogICAgICAgICAgICAgIGxUeXBlID0gdHlwZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9UT0RPOiBhbnkgb3RoZXIgZGlmZmVyZW50IG9wdGlvbnMgZm9yIHRoZSByZWxlYXNlIHByb2Nlc3MsIGxpa2UgYWNjZXB0IGJ1dCBub3IgcmVsZWFzZSBsb2NhbD8KICAgICAgICAgICAgaWYgKGxUeXBlID09PSAyMDApIHsKICAgICAgICAgICAgICBvYmplY3QuZGVsZXRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZQogICAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlLCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnTk9USUZJQ0FUSU9OLUVWRU5UOiAnLCBldmVudCk7CiAgICAgICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgIGJvZHk6IHsgY29kZTogNDA0LCBzb3VyY2U6IF90aGlzLl9vd25lciB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdvd25lcicsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogQWxsIG93bmVkIHJlcG9ydGVycywgdGhlIG9uZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgYSBjcmVhdGUKICAgICAqIEB0eXBlIHtPYmplY3Q8VVJMLCBEYXRhT2JqZWN0UmVwb3J0ZXI+fQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3JlcG9ydGVycycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBvd25lZCBvYnNlcnZlcnMsIHRoZSBvbmVzIHRoYXQgd2VyZSBjcmVhdGVkIGJ5IGEgbG9jYWwgc3Vic2NyaXB0aW9uCiAgICAgKiBAdHlwZSB7T2JqZWN0PFVSTCwgRGF0YU9iamVjdE9ic2VydmVyPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdvYnNlcnZlcnMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnM7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3luY2hlcjsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gU3luY2hlcjsKCn0seyIuL0RhdGFPYmplY3RPYnNlcnZlciI6MywiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiOjQsIi4vRGF0YVByb3Zpc2lvbmFsIjo1fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kaXZpZGVVUkwgPSBkaXZpZGVVUkw7CmV4cG9ydHMuZGVlcENsb25lID0gZGVlcENsb25lOwovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8qKgogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsCiAqIEBtb2R1bGUgdXRpbHMKICovCgovKioKICogQHR5cGVkZWYgZGl2aWRlVVJMCiAqIEB0eXBlIE9iamVjdAogKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkwKICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTAogKi8KCi8qKgogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkKICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3MKICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTAogKi8KZnVuY3Rpb24gZGl2aWRlVVJMKHVybCkgewoKICAvLyBsZXQgcmUgPSAvKFthLXpBLVotXSopPzpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKSooXC9bXC9cZFx3XC4tXSopKig/OltcP10pKiguKykqL2dpOwogIHZhciByZSA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpOwogIHZhciBzdWJzdCA9ICckMSwkMiwkMyc7CiAgdmFyIHBhcnRzID0gdXJsLnJlcGxhY2UocmUsIHN1YnN0KS5zcGxpdCgnLCcpOwoKICAvLyBJZiB0aGUgdXJsIGhhcyBubyBwcm90b2NvbCwgdGhlIGRlZmF1bHQgcHJvdG9jb2wgc2V0IGlzIGh0dHBzCiAgaWYgKHBhcnRzWzBdID09PSB1cmwpIHsKICAgIHBhcnRzWzBdID0gJ2h0dHBzJzsKICAgIHBhcnRzWzFdID0gdXJsOwogIH0KCiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YQogKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkCiAqIEByZXR1cm4ge09iamVjdH0KICovCmZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHsKICAvL1RPRE86IHNpbXBsZSBidXQgaW5lZmZpY2llbnQgSlNPTiBkZWVwIGNsb25lLi4uCiAgaWYgKG9iaikgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCn0se31dLDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gYWN0aXZhdGU7Cgp2YXIgX1N5bmNoZXIgPSByZXF1aXJlKCdzZXJ2aWNlLWZyYW1ld29yay9zcmMvc3luY2hlci9TeW5jaGVyJyk7Cgp2YXIgX1N5bmNoZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU3luY2hlcik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKdmFyIEZha2VMb2NhdGlvbk9ic2VydmVySHlwZXJ0eSA9IHsKICAgIHJlY2VpdmVkUG9zaXRpb246IGZhbHNlLAoKICAgIHBvc2l0aW9uOiB1bmRlZmluZWQKfTsKCnZhciBGYWtlTG9hY2F0aW9uRmFjdG9yeSA9IGZ1bmN0aW9uIEZha2VMb2FjYXRpb25GYWN0b3J5KGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikgewogICAgdmFyIG9iamVjdERlc2NVUkwgPSAnaHlwZXJ0eS1jYXRhbG9ndWU6Ly9sb2NhbGhvc3QvLndlbGwta25vd24vZGF0YXNjaGVtYXMvTG9jYXRpb25EYXRhU2NoZW1hJzsKICAgIHZhciBzeW5jaGVyID0gbmV3IF9TeW5jaGVyMi5kZWZhdWx0KGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CgogICAgc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBldmVudC5hY2soKTsKICAgICAgICBzeW5jaGVyLnN1YnNjcmliZShvYmplY3REZXNjVVJMLCBldmVudC51cmwpLnRoZW4oZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICAgICAgICAgIG9ic2VydmVyLm9uQ2hhbmdlKCcqJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBGYWtlTG9jYXRpb25PYnNlcnZlckh5cGVydHkucmVjZWl2ZWRQb3NpdGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBGYWtlTG9jYXRpb25PYnNlcnZlckh5cGVydHkucG9zaXRpb24gPSBldmVudC5kYXRhLmdlb3Bvc2l0aW9uOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgIHJldHVybiBGYWtlTG9jYXRpb25PYnNlcnZlckh5cGVydHk7Cn07CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogJ0Zha2UgbG9jYXRpb24gb2JzZXJ2ZXInLAogICAgICAgIGluc3RhbmNlOiBGYWtlTG9hY2F0aW9uRmFjdG9yeShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pCiAgICB9Owp9Cgp9LHsic2VydmljZS1mcmFtZXdvcmsvc3JjL3N5bmNoZXIvU3luY2hlciI6N31dfSx7fSxbOV0pKDkpCn0pOw==",
      "sourceCodeClassname": "FakeLocationObserverHyperty",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of FakeLocationObserverHyperty",
    "objectName": "FakeLocationObserverHyperty",
    "configuration": {},
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "default": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXIKCnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTsKdmFyIHF1ZXVlID0gW107CnZhciBkcmFpbmluZyA9IGZhbHNlOwp2YXIgY3VycmVudFF1ZXVlOwp2YXIgcXVldWVJbmRleCA9IC0xOwoKZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkgewogICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZHJhaW5pbmcgPSBmYWxzZTsKICAgIGlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7CiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgfQogICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIGRyYWluUXVldWUoKTsKICAgIH0KfQoKZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsKICAgIGlmIChkcmFpbmluZykgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChjbGVhblVwTmV4dFRpY2spOwogICAgZHJhaW5pbmcgPSB0cnVlOwoKICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7CiAgICB3aGlsZSAobGVuKSB7CiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7CiAgICAgICAgcXVldWUgPSBbXTsKICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgfQogICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7Cn0KCnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwogICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHsKICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApOwogICAgfQp9OwoKLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0cwpmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgIHRoaXMuZnVuID0gZnVuOwogICAgdGhpcy5hcnJheSA9IGFycmF5Owp9Ckl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOwp9Owpwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInOwpwcm9jZXNzLmJyb3dzZXIgPSB0cnVlOwpwcm9jZXNzLmVudiA9IHt9Owpwcm9jZXNzLmFyZ3YgPSBbXTsKcHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzCnByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCmZ1bmN0aW9uIG5vb3AoKSB7fQoKcHJvY2Vzcy5vbiA9IG5vb3A7CnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLm9uY2UgPSBub29wOwpwcm9jZXNzLm9mZiA9IG5vb3A7CnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CnByb2Nlc3MuZW1pdCA9IG5vb3A7Cgpwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwp9OwoKcHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJy8nOwp9Owpwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTsKfTsKcHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAwOwp9OwoKfSx7fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoZ2xvYmFsKXsKInVzZSBzdHJpY3QiOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyoqCiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgoqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQoqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgoqCiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoqCiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKKgoqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKiovCgovLyBEaXN0cmlidXRpb24gZmlsZSBmb3IgSHlwZXJ0eURpc2NvdmVyeS5qcwovLyB2ZXJzaW9uOiAwLjIuMAoKIWZ1bmN0aW9uIChlKSB7CiAgaWYgKCJvYmplY3QiID09ICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBtb2R1bGUpIG1vZHVsZS5leHBvcnRzID0gZSgpO2Vsc2UgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kKSBkZWZpbmUoW10sIGUpO2Vsc2UgewogICAgdmFyIHQ7dCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogdGhpcywgdC5IeXBlcnR5RGlzY292ZXJ5ID0gZSgpOwogIH0KfShmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIGUodCwgciwgbikgewogICAgZnVuY3Rpb24gbyhjLCBzKSB7CiAgICAgIGlmICghcltjXSkgewogICAgICAgIGlmICghdFtjXSkgewogICAgICAgICAgdmFyIHUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmU7aWYgKCFzICYmIHUpIHJldHVybiB1KGMsICEwKTtpZiAoaSkgcmV0dXJuIGkoYywgITApO3ZhciBhID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBjICsgIiciKTt0aHJvdyBhLmNvZGUgPSAiTU9EVUxFX05PVF9GT1VORCIsIGE7CiAgICAgICAgfXZhciBmID0gcltjXSA9IHsgZXhwb3J0czoge30gfTt0W2NdWzBdLmNhbGwoZi5leHBvcnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHIgPSB0W2NdWzFdW2VdO3JldHVybiBvKHIgPyByIDogZSk7CiAgICAgICAgfSwgZiwgZi5leHBvcnRzLCBlLCB0LCByLCBuKTsKICAgICAgfXJldHVybiByW2NdLmV4cG9ydHM7CiAgICB9Zm9yICh2YXIgaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZSwgYyA9IDA7IGMgPCBuLmxlbmd0aDsgYysrKSB7CiAgICAgIG8obltjXSk7CiAgICB9cmV0dXJuIG87CiAgfSh7IDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL2pzb24vc3RyaW5naWZ5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiOiA2IH1dLCAyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDcgfV0sIDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIjogOCB9XSwgNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgci5fX2VzTW9kdWxlID0gITAsIHJbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksCiAgICAgICAgICBpID0gbihvKTtyWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgdmFyIG4gPSB0W3JdO24uZW51bWVyYWJsZSA9IG4uZW51bWVyYWJsZSB8fCAhMSwgbi5jb25maWd1cmFibGUgPSAhMCwgInZhbHVlIiBpbiBuICYmIChuLndyaXRhYmxlID0gITApLCAoMCwgaVsiZGVmYXVsdCJdKShlLCBuLmtleSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfXJldHVybiBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgcmV0dXJuIHIgJiYgZSh0LnByb3RvdHlwZSwgciksIG4gJiYgZSh0LCBuKSwgdDsKICAgICAgICB9OwogICAgICB9KCk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDIgfV0sIDY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvX2NvcmUiKSwKICAgICAgICAgIG8gPSBuLkpTT04gfHwgKG4uSlNPTiA9IHsgc3RyaW5naWZ5OiBKU09OLnN0cmluZ2lmeSB9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBvLnN0cmluZ2lmeS5hcHBseShvLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2IH1dLCA3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSIpO3ZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy9fY29yZSIpLk9iamVjdDt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLmRlZmluZVByb3BlcnR5KGUsIHQsIHIpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2LCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSI6IDcxIH1dLCA4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyIpLCBlKCIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiKSwgZSgiLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIiksIGUoIi4uL21vZHVsZXMvZXM2LnByb21pc2UiKSwgdC5leHBvcnRzID0gZSgiLi4vbW9kdWxlcy9fY29yZSIpLlByb21pc2U7CiAgICB9LCB7ICIuLi9tb2R1bGVzL19jb3JlIjogMTYsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogNzIsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogNzMsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA3NCwgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDc1IH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhIGZ1bmN0aW9uISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHt9OwogICAgfSwge31dLCAxMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBuKSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpIHx8IHZvaWQgMCAhPT0gbiAmJiBuIGluIGUpIHRocm93IFR5cGVFcnJvcihyICsgIjogaW5jb3JyZWN0IGludm9jYXRpb24hIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDEyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1sZW5ndGgiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pbmRleCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByLCBjKSB7CiAgICAgICAgICB2YXIgcywKICAgICAgICAgICAgICB1ID0gbih0KSwKICAgICAgICAgICAgICBhID0gbyh1Lmxlbmd0aCksCiAgICAgICAgICAgICAgZiA9IGkoYywgYSk7aWYgKGUgJiYgciAhPSByKSB7CiAgICAgICAgICAgIGZvciAoOyBhID4gZjspIHsKICAgICAgICAgICAgICBpZiAocyA9IHVbZisrXSwgcyAhPSBzKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBmb3IgKDsgYSA+IGY7IGYrKykgewogICAgICAgICAgICBpZiAoKGUgfHwgZiBpbiB1KSAmJiB1W2ZdID09PSByKSByZXR1cm4gZSB8fCBmIHx8IDA7CiAgICAgICAgICB9cmV0dXJuICFlICYmIC0xOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbmRleCI6IDYxLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tbGVuZ3RoIjogNjQgfV0sIDE0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19jb2YiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgidG9TdHJpbmdUYWciKSwKICAgICAgICAgIGkgPSAiQXJndW1lbnRzIiA9PSBuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpLAogICAgICAgICAgYyA9IGZ1bmN0aW9uIGMoZSwgdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gZVt0XTsKICAgICAgICB9IGNhdGNoIChyKSB7fQogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsIHIsIHM7cmV0dXJuIHZvaWQgMCA9PT0gZSA/ICJVbmRlZmluZWQiIDogbnVsbCA9PT0gZSA/ICJOdWxsIiA6ICJzdHJpbmciID09IHR5cGVvZiAociA9IGModCA9IE9iamVjdChlKSwgbykpID8gciA6IGkgPyBuKHQpIDogIk9iamVjdCIgPT0gKHMgPSBuKHQpKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LmNhbGxlZSA/ICJBcmd1bWVudHMiIDogczsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fd2tzIjogNjggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAxNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMi40LjAiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDE3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19hLWZ1bmN0aW9uIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBpZiAobihlKSwgdm9pZCAwID09PSB0KSByZXR1cm4gZTtzd2l0Y2ggKHIpIHtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgcik7CiAgICAgICAgICAgIH07Y2FzZSAyOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIsIG4pIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIsIG4pOwogICAgICAgICAgICB9O2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuLCBvKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuLCBvKTsKICAgICAgICAgICAgfTt9cmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlLmFwcGx5KHQsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5IH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDE5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vX2ZhaWxzIikoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19mYWlscyI6IDIzIH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9fZ2xvYmFsIikuZG9jdW1lbnQsCiAgICAgICAgICBpID0gbihvKSAmJiBuKG8uY3JlYXRlRWxlbWVudCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaSA/IG8uY3JlYXRlRWxlbWVudChlKSA6IHt9OwogICAgICB9OwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAiY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mIi5zcGxpdCgiLCIpOwogICAgfSwge31dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYyA9IGUoIi4vX2hpZGUiKSwKICAgICAgICAgIHMgPSAicHJvdG90eXBlIiwKICAgICAgICAgIHUgPSBmdW5jdGlvbiB1KGUsIHQsIHIpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgICAgZiwKICAgICAgICAgICAgXywKICAgICAgICAgICAgbCA9IGUgJiB1LkYsCiAgICAgICAgICAgIGQgPSBlICYgdS5HLAogICAgICAgICAgICBwID0gZSAmIHUuUywKICAgICAgICAgICAgdiA9IGUgJiB1LlAsCiAgICAgICAgICAgIHkgPSBlICYgdS5CLAogICAgICAgICAgICBoID0gZSAmIHUuVywKICAgICAgICAgICAgYiA9IGQgPyBvIDogb1t0XSB8fCAob1t0XSA9IHt9KSwKICAgICAgICAgICAgbSA9IGJbc10sCiAgICAgICAgICAgIGcgPSBkID8gbiA6IHAgPyBuW3RdIDogKG5bdF0gfHwge30pW3NdO2QgJiYgKHIgPSB0KTtmb3IgKGEgaW4gcikgewogICAgICAgICAgZiA9ICFsICYmIGcgJiYgdm9pZCAwICE9PSBnW2FdLCBmICYmIGEgaW4gYiB8fCAoXyA9IGYgPyBnW2FdIDogclthXSwgYlthXSA9IGQgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZ1thXSA/IHJbYV0gOiB5ICYmIGYgPyBpKF8sIG4pIDogaCAmJiBnW2FdID09IF8gPyBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdCA9IGZ1bmN0aW9uIHQoX3QsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIGUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGUoKTtjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90KTtjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90LCByKTt9cmV0dXJuIG5ldyBlKF90LCByLCBuKTsKICAgICAgICAgICAgICB9cmV0dXJuIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfTtyZXR1cm4gdFtzXSA9IGVbc10sIHQ7CiAgICAgICAgICB9KF8pIDogdiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBfID8gaShGdW5jdGlvbi5jYWxsLCBfKSA6IF8sIHYgJiYgKChiLnZpcnR1YWwgfHwgKGIudmlydHVhbCA9IHt9KSlbYV0gPSBfLCBlICYgdS5SICYmIG0gJiYgIW1bYV0gJiYgYyhtLCBhLCBfKSkpOwogICAgICAgIH0KICAgICAgfTt1LkYgPSAxLCB1LkcgPSAyLCB1LlMgPSA0LCB1LlAgPSA4LCB1LkIgPSAxNiwgdS5XID0gMzIsIHUuVSA9IDY0LCB1LlIgPSAxMjgsIHQuZXhwb3J0cyA9IHU7CiAgICB9LCB7ICIuL19jb3JlIjogMTYsICIuL19jdHgiOiAxNywgIi4vX2dsb2JhbCI6IDI1LCAiLi9faGlkZSI6IDI3IH1dLCAyMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiAhIWUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gITA7CiAgICAgICAgfQogICAgICB9OwogICAgfSwge31dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBvID0gZSgiLi9faXRlci1jYWxsIiksCiAgICAgICAgICBpID0gZSgiLi9faXMtYXJyYXktaXRlciIpLAogICAgICAgICAgYyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGUoIi4vX3RvLWxlbmd0aCIpLAogICAgICAgICAgdSA9IGUoIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIiksCiAgICAgICAgICBhID0ge30sCiAgICAgICAgICBmID0ge30sCiAgICAgICAgICByID0gdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIF8sIGwpIHsKICAgICAgICB2YXIgZCwKICAgICAgICAgICAgcCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgeSwKICAgICAgICAgICAgaCA9IGwgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZTsKICAgICAgICB9IDogdShlKSwKICAgICAgICAgICAgYiA9IG4ociwgXywgdCA/IDIgOiAxKSwKICAgICAgICAgICAgbSA9IDA7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGgpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgaXRlcmFibGUhIik7aWYgKGkoaCkpIHsKICAgICAgICAgIGZvciAoZCA9IHMoZS5sZW5ndGgpOyBkID4gbTsgbSsrKSB7CiAgICAgICAgICAgIGlmICh5ID0gdCA/IGIoYyhwID0gZVttXSlbMF0sIHBbMV0pIDogYihlW21dKSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgZm9yICh2ID0gaC5jYWxsKGUpOyAhKHAgPSB2Lm5leHQoKSkuZG9uZTspIHsKICAgICAgICAgIGlmICh5ID0gbyh2LCBiLCBwLnZhbHVlLCB0KSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICB9CiAgICAgIH07ci5CUkVBSyA9IGEsIHIuUkVUVVJOID0gZjsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fY3R4IjogMTcsICIuL19pcy1hcnJheS1pdGVyIjogMzIsICIuL19pdGVyLWNhbGwiOiAzNCwgIi4vX3RvLWxlbmd0aCI6IDY0LCAiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiOiA2OSB9XSwgMjU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgd2luZG93Lk1hdGggPT0gTWF0aCA/IHdpbmRvdyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZiA6IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7Im51bWJlciIgPT0gdHlwZW9mIF9fZyAmJiAoX19nID0gbik7CiAgICB9LCB7fV0sIDI2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDI3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uZihlLCB0LCBvKDEsIHIpKTsKICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIGVbdF0gPSByLCBlOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwIH1dLCAyODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2dsb2JhbCIpLmRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgIH0sIHsgIi4vX2dsb2JhbCI6IDI1IH1dLCAyOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9ICFlKCIuL19kZXNjcmlwdG9ycyIpICYmICFlKCIuL19mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSgiLi9fZG9tLWNyZWF0ZSIpKCJkaXYiKSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZmFpbHMiOiAyMyB9XSwgMzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHZhciBuID0gdm9pZCAwID09PSByO3N3aXRjaCAodC5sZW5ndGgpIHtjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBuID8gZSgpIDogZS5jYWxsKHIpO2Nhc2UgMToKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0pIDogZS5jYWxsKHIsIHRbMF0pO2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0pO2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0pO2Nhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pO31yZXR1cm4gZS5hcHBseShyLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2NvZiIpO3QuZXhwb3J0cyA9IE9iamVjdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN0cmluZyIgPT0gbihlKSA/IGUuc3BsaXQoIiIpIDogT2JqZWN0KGUpOwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUgfV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pdGVyYXRvcnMiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGkgPSBBcnJheS5wcm90b3R5cGU7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlICYmIChuLkFycmF5ID09PSBlIHx8IGlbb10gPT09IGUpOwogICAgICB9OwogICAgfSwgeyAiLi9faXRlcmF0b3JzIjogMzksICIuL193a3MiOiA2OCB9XSwgMzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAib2JqZWN0IiA9PSAodHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpKSA/IG51bGwgIT09IGUgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBlOwogICAgICB9OwogICAgfSwge31dLCAzNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIG8gPyB0KG4ocilbMF0sIHJbMV0pIDogdChyKTsKICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICB2YXIgYyA9IGVbInJldHVybiJdO3Rocm93IHZvaWQgMCAhPT0gYyAmJiBuKGMuY2FsbChlKSksIGk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIgfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1jcmVhdGUiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi9fc2V0LXRvLXN0cmluZy10YWciKSwKICAgICAgICAgIGMgPSB7fTtlKCIuL19oaWRlIikoYywgZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuKGMsIHsgbmV4dDogbygxLCByKSB9KSwgaShlLCB0ICsgIiBJdGVyYXRvciIpOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3LCAiLi9fb2JqZWN0LWNyZWF0ZSI6IDQyLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fc2V0LXRvLXN0cmluZy10YWciOiA1NSwgIi4vX3drcyI6IDY4IH1dLCAzNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuL19saWJyYXJ5IiksCiAgICAgICAgICBvID0gZSgiLi9fZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi9fcmVkZWZpbmUiKSwKICAgICAgICAgIGMgPSBlKCIuL19oaWRlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faXRlcmF0b3JzIiksCiAgICAgICAgICBhID0gZSgiLi9faXRlci1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgXyA9IGUoIi4vX29iamVjdC1ncG8iKSwKICAgICAgICAgIGwgPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGQgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBwID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgdiA9ICJrZXlzIiwKICAgICAgICAgIHkgPSAidmFsdWVzIiwKICAgICAgICAgIGggPSBmdW5jdGlvbiBoKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBiLCBtLCBnLCBqKSB7CiAgICAgICAgYShyLCB0LCBiKTt2YXIgeCwKICAgICAgICAgICAgdywKICAgICAgICAgICAgaywKICAgICAgICAgICAgTyA9IGZ1bmN0aW9uIE8oZSkgewogICAgICAgICAgaWYgKCFkICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSB2OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHk6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIE0gPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIFAgPSBtID09IHksCiAgICAgICAgICAgIFMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBUID0gRVtsXSB8fCBFW3BdIHx8IG0gJiYgRVttXSwKICAgICAgICAgICAgQSA9IFQgfHwgTyhtKSwKICAgICAgICAgICAgVSA9IG0gPyBQID8gTygiZW50cmllcyIpIDogQSA6IHZvaWQgMCwKICAgICAgICAgICAgQyA9ICJBcnJheSIgPT0gdCA/IEUuZW50cmllcyB8fCBUIDogVDtpZiAoQyAmJiAoayA9IF8oQy5jYWxsKG5ldyBlKCkpKSwgayAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiAoZihrLCBNLCAhMCksIG4gfHwgcyhrLCBsKSB8fCBjKGssIGwsIGgpKSksIFAgJiYgVCAmJiBULm5hbWUgIT09IHkgJiYgKFMgPSAhMCwgQSA9IGZ1bmN0aW9uIEEoKSB7CiAgICAgICAgICByZXR1cm4gVC5jYWxsKHRoaXMpOwogICAgICAgIH0pLCBuICYmICFqIHx8ICFkICYmICFTICYmIEVbbF0gfHwgYyhFLCBsLCBBKSwgdVt0XSA9IEEsIHVbTV0gPSBoLCBtKSBpZiAoeCA9IHsgdmFsdWVzOiBQID8gQSA6IE8oeSksIGtleXM6IGcgPyBBIDogTyh2KSwgZW50cmllczogVSB9LCBqKSBmb3IgKHcgaW4geCkgewogICAgICAgICAgdyBpbiBFIHx8IGkoRSwgdywgeFt3XSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKGQgfHwgUyksIHQsIHgpO3JldHVybiB4OwogICAgICB9OwogICAgfSwgeyAiLi9fZXhwb3J0IjogMjIsICIuL19oYXMiOiAyNiwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXItY3JlYXRlIjogMzUsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX2xpYnJhcnkiOiA0MCwgIi4vX29iamVjdC1ncG8iOiA0NiwgIi4vX3JlZGVmaW5lIjogNTIsICIuL19zZXQtdG8tc3RyaW5nLXRhZyI6IDU1LCAiLi9fd2tzIjogNjggfV0sIDM3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChjKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgYyA9IGlbbl0oKTtjLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IHIgPSAhMCB9OwogICAgICAgICAgfSwgaVtuXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICB9LCBlKGkpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9cmV0dXJuIHI7CiAgICAgIH07CiAgICB9LCB7ICIuL193a3MiOiA2OCB9XSwgMzg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiB7IHZhbHVlOiB0LCBkb25lOiAhIWUgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7fTsKICAgIH0sIHt9XSwgNDA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBpID0gbi5NdXRhdGlvbk9ic2VydmVyIHx8IG4uV2ViS2l0TXV0YXRpb25PYnNlcnZlciwKICAgICAgICAgIGMgPSBuLnByb2Nlc3MsCiAgICAgICAgICBzID0gbi5Qcm9taXNlLAogICAgICAgICAgdSA9ICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShjKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHQsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGEgPSBmdW5jdGlvbiBhKCkgewogICAgICAgICAgdmFyIG4sIG87Zm9yICh1ICYmIChuID0gYy5kb21haW4pICYmIG4uZXhpdCgpOyBlOykgewogICAgICAgICAgICBvID0gZS5mbiwgZSA9IGUubmV4dDt0cnkgewogICAgICAgICAgICAgIG8oKTsKICAgICAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgICAgIHRocm93IGUgPyByKCkgOiB0ID0gdm9pZCAwLCBpOwogICAgICAgICAgICB9CiAgICAgICAgICB9dCA9IHZvaWQgMCwgbiAmJiBuLmVudGVyKCk7CiAgICAgICAgfTtpZiAodSkgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBjLm5leHRUaWNrKGEpOwogICAgICAgIH07ZWxzZSBpZiAoaSkgewogICAgICAgICAgdmFyIGYgPSAhMCwKICAgICAgICAgICAgICBfID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBpKGEpLm9ic2VydmUoXywgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIF8uZGF0YSA9IGYgPSAhZjsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChzICYmIHMucmVzb2x2ZSkgewogICAgICAgICAgdmFyIGwgPSBzLnJlc29sdmUoKTtyID0gZnVuY3Rpb24gcigpIHsKICAgICAgICAgICAgbC50aGVuKGEpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBvLmNhbGwobiwgYSk7CiAgICAgICAgfTtyZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBvID0geyBmbjogbiwgbmV4dDogdm9pZCAwIH07dCAmJiAodC5uZXh0ID0gbyksIGUgfHwgKGUgPSBvLCByKCkpLCB0ID0gbzsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUsICIuL19nbG9iYWwiOiAyNSwgIi4vX3Rhc2siOiA2MCB9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX29iamVjdC1kcHMiKSwKICAgICAgICAgIGkgPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIiksCiAgICAgICAgICBjID0gZSgiLi9fc2hhcmVkLWtleSIpKCJJRV9QUk9UTyIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoKSB7fSwKICAgICAgICAgIHUgPSAicHJvdG90eXBlIiwKICAgICAgICAgIF9hID0gZnVuY3Rpb24gYSgpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUoIi4vX2RvbS1jcmVhdGUiKSgiaWZyYW1lIiksCiAgICAgICAgICAgIG4gPSBpLmxlbmd0aCwKICAgICAgICAgICAgbyA9ICI+Ijtmb3IgKHIuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZSgiLi9faHRtbCIpLmFwcGVuZENoaWxkKHIpLCByLnNyYyA9ICJqYXZhc2NyaXB0OiIsIHQgPSByLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQsIHQub3BlbigpLCB0LndyaXRlKCI8c2NyaXB0PmRvY3VtZW50LkY9T2JqZWN0PC9zY3JpcHQiICsgbyksIHQuY2xvc2UoKSwgX2EgPSB0LkY7IG4tLTspIHsKICAgICAgICAgIGRlbGV0ZSBfYVt1XVtpW25dXTsKICAgICAgICB9cmV0dXJuIF9hKCk7CiAgICAgIH07dC5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciByO3JldHVybiBudWxsICE9PSBlID8gKHNbdV0gPSBuKGUpLCByID0gbmV3IHMoKSwgc1t1XSA9IG51bGwsIHJbY10gPSBlKSA6IHIgPSBfYSgpLCB2b2lkIDAgPT09IHQgPyByIDogbyhyLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZW51bS1idWcta2V5cyI6IDIxLCAiLi9faHRtbCI6IDI4LCAiLi9fb2JqZWN0LWRwcyI6IDQ0LCAiLi9fc2hhcmVkLWtleSI6IDU2IH1dLCA0MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1wcmltaXRpdmUiKSwKICAgICAgICAgIGMgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7ci5mID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHQgPSBpKHQsICEwKSwgbihyKSwgbykgdHJ5IHsKICAgICAgICAgIHJldHVybiBjKGUsIHQsIHIpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9aWYgKCJnZXQiIGluIHIgfHwgInNldCIgaW4gcikgdGhyb3cgVHlwZUVycm9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEiKTtyZXR1cm4gInZhbHVlIiBpbiByICYmIChlW3RdID0gci52YWx1ZSksIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2Rlc2NyaXB0b3JzIjogMTksICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19vYmplY3Qta2V5cyIpO3QuZXhwb3J0cyA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgbyhlKTtmb3IgKHZhciByLCBjID0gaSh0KSwgcyA9IGMubGVuZ3RoLCB1ID0gMDsgcyA+IHU7KSB7CiAgICAgICAgICBuLmYoZSwgciA9IGNbdSsrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL19vYmplY3Qta2V5cyI6IDQ4IH1dLCA0NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LXBpZSIpLAogICAgICAgICAgbyA9IGUoIi4vX3Byb3BlcnR5LWRlc2MiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pb2JqZWN0IiksCiAgICAgICAgICBjID0gZSgiLi9fdG8tcHJpbWl0aXZlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO3IuZiA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBhIDogZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoZSA9IGkoZSksIHQgPSBjKHQsICEwKSwgdSkgdHJ5IHsKICAgICAgICAgIHJldHVybiBhKGUsIHQpOwogICAgICAgIH0gY2F0Y2ggKHIpIHt9cmV0dXJuIHMoZSwgdCkgPyBvKCFuLmYuY2FsbChlLCB0KSwgZVt0XSkgOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9faGFzIjogMjYsICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fb2JqZWN0LXBpZSI6IDQ5LCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19oYXMiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIiksCiAgICAgICAgICBjID0gT2JqZWN0LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSA9IG8oZSksIG4oZSwgaSkgPyBlW2ldIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5jb25zdHJ1Y3RvciAmJiBlIGluc3RhbmNlb2YgZS5jb25zdHJ1Y3RvciA/IGUuY29uc3RydWN0b3IucHJvdG90eXBlIDogZSBpbnN0YW5jZW9mIE9iamVjdCA/IGMgOiBudWxsOwogICAgICB9OwogICAgfSwgeyAiLi9faGFzIjogMjYsICIuL19zaGFyZWQta2V5IjogNTYsICIuL190by1vYmplY3QiOiA2NSB9XSwgNDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19hcnJheS1pbmNsdWRlcyIpKCExKSwKICAgICAgICAgIGMgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG8oZSksCiAgICAgICAgICAgIHUgPSAwLAogICAgICAgICAgICBhID0gW107Zm9yIChyIGluIHMpIHsKICAgICAgICAgIHIgIT0gYyAmJiBuKHMsIHIpICYmIGEucHVzaChyKTsKICAgICAgICB9Zm9yICg7IHQubGVuZ3RoID4gdTspIHsKICAgICAgICAgIG4ocywgciA9IHRbdSsrXSkgJiYgKH5pKGEsIHIpIHx8IGEucHVzaChyKSk7CiAgICAgICAgfXJldHVybiBhOwogICAgICB9OwogICAgfSwgeyAiLi9fYXJyYXktaW5jbHVkZXMiOiAxMywgIi4vX2hhcyI6IDI2LCAiLi9fc2hhcmVkLWtleSI6IDU2LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA0ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LWtleXMtaW50ZXJuYWwiKSwKICAgICAgICAgIG8gPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIik7dC5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihlLCBvKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2VudW0tYnVnLWtleXMiOiAyMSwgIi4vX29iamVjdC1rZXlzLWludGVybmFsIjogNDcgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgci5mID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CiAgICB9LCB7fV0sIDUwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4geyBlbnVtZXJhYmxlOiAhKDEgJiBlKSwgY29uZmlndXJhYmxlOiAhKDIgJiBlKSwgd3JpdGFibGU6ICEoNCAmIGUpLCB2YWx1ZTogdCB9OwogICAgICB9OwogICAgfSwge31dLCA1MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faGlkZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyBpbiB0KSB7CiAgICAgICAgICByICYmIGVbb10gPyBlW29dID0gdFtvXSA6IG4oZSwgbywgdFtvXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3IH1dLCA1MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2hpZGUiKTsKICAgIH0sIHsgIi4vX2hpZGUiOiAyNyB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lzLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgaSA9IGZ1bmN0aW9uIGkoZSwgdCkgewogICAgICAgIGlmIChvKGUpLCAhbih0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbiA9IGUoIi4vX2N0eCIpKEZ1bmN0aW9uLmNhbGwsIGUoIi4vX29iamVjdC1nb3BkIikuZihPYmplY3QucHJvdG90eXBlLCAiX19wcm90b19fIikuc2V0LCAyKSwgbih0LCBbXSksIHIgPSAhKHQgaW5zdGFuY2VvZiBBcnJheSk7CiAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGkoZSwgdCksIHIgPyBlLl9fcHJvdG9fXyA9IHQgOiBuKGUsIHQpLCBlOwogICAgICAgICAgfTsKICAgICAgICB9KHt9LCAhMSkgOiB2b2lkIDApLCBjaGVjazogaSB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19jdHgiOiAxNywgIi4vX2lzLW9iamVjdCI6IDMzLCAiLi9fb2JqZWN0LWdvcGQiOiA0NSB9XSwgNTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX29iamVjdC1kcCIpLAogICAgICAgICAgYyA9IGUoIi4vX2Rlc2NyaXB0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi9fd2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2Ygb1tlXSA/IG9bZV0gOiBuW2VdO2MgJiYgdCAmJiAhdFtzXSAmJiBpLmYodCwgcywgeyBjb25maWd1cmFibGU6ICEwLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9IH0pOwogICAgICB9OwogICAgfSwgeyAiLi9fY29yZSI6IDE2LCAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2dsb2JhbCI6IDI1LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL193a3MiOiA2OCB9XSwgNTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1kcCIpLmYsCiAgICAgICAgICBvID0gZSgiLi9faGFzIiksCiAgICAgICAgICBpID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBlICYmICFvKGUgPSByID8gZSA6IGUucHJvdG90eXBlLCBpKSAmJiBuKGUsIGksIHsgY29uZmlndXJhYmxlOiAhMCwgdmFsdWU6IHQgfSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19oYXMiOiAyNiwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fd2tzIjogNjggfV0sIDU2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19zaGFyZWQiKSgia2V5cyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3NoYXJlZCI6IDU3LCAiLi9fdWlkIjogNjcgfV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIG8gPSAiX19jb3JlLWpzX3NoYXJlZF9fIiwKICAgICAgICAgIGkgPSBuW29dIHx8IChuW29dID0ge30pO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlbZV0gfHwgKGlbZV0gPSB7fSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2EtZnVuY3Rpb24iKSwKICAgICAgICAgIGkgPSBlKCIuL193a3MiKSgic3BlY2llcyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGMgPSBuKGUpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDAgPT09IGMgfHwgdm9pZCAwID09IChyID0gbihjKVtpXSkgPyB0IDogbyhyKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5LCAiLi9fYW4tb2JqZWN0IjogMTIsICIuL193a3MiOiA2OCB9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgcyA9IFN0cmluZyhvKHQpKSwKICAgICAgICAgICAgICB1ID0gbihyKSwKICAgICAgICAgICAgICBhID0gcy5sZW5ndGg7cmV0dXJuIDAgPiB1IHx8IHUgPj0gYSA/IGUgPyAiIiA6IHZvaWQgMCA6IChpID0gcy5jaGFyQ29kZUF0KHUpLCA1NTI5NiA+IGkgfHwgaSA+IDU2MzE5IHx8IHUgKyAxID09PSBhIHx8IChjID0gcy5jaGFyQ29kZUF0KHUgKyAxKSkgPCA1NjMyMCB8fCBjID4gNTczNDMgPyBlID8gcy5jaGFyQXQodSkgOiBpIDogZSA/IHMuc2xpY2UodSwgdSArIDIpIDogKGkgLSA1NTI5NiA8PCAxMCkgKyAoYyAtIDU2MzIwKSArIDY1NTM2KTsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9fdG8taW50ZWdlciI6IDYyIH1dLCA2MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBzID0gZSgiLi9faW52b2tlIiksCiAgICAgICAgICB1ID0gZSgiLi9faHRtbCIpLAogICAgICAgICAgYSA9IGUoIi4vX2RvbS1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIF8gPSBmLnByb2Nlc3MsCiAgICAgICAgICBsID0gZi5zZXRJbW1lZGlhdGUsCiAgICAgICAgICBkID0gZi5jbGVhckltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBmLk1lc3NhZ2VDaGFubmVsLAogICAgICAgICAgdiA9IDAsCiAgICAgICAgICB5ID0ge30sCiAgICAgICAgICBoID0gIm9ucmVhZHlzdGF0ZWNoYW5nZSIsCiAgICAgICAgICBiID0gZnVuY3Rpb24gYigpIHsKICAgICAgICB2YXIgZSA9ICt0aGlzO2lmICh5Lmhhc093blByb3BlcnR5KGUpKSB7CiAgICAgICAgICB2YXIgdCA9IHlbZV07ZGVsZXRlIHlbZV0sIHQoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBtID0gZnVuY3Rpb24gbShlKSB7CiAgICAgICAgYi5jYWxsKGUuZGF0YSk7CiAgICAgIH07bCAmJiBkIHx8IChsID0gZnVuY3Rpb24gbChlKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLCByID0gMTsgYXJndW1lbnRzLmxlbmd0aCA+IHI7KSB7CiAgICAgICAgICB0LnB1c2goYXJndW1lbnRzW3IrK10pOwogICAgICAgIH1yZXR1cm4geVsrK3ZdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcygiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZSA6IEZ1bmN0aW9uKGUpLCB0KTsKICAgICAgICB9LCBuKHYpLCB2OwogICAgICB9LCBkID0gZnVuY3Rpb24gZChlKSB7CiAgICAgICAgZGVsZXRlIHlbZV07CiAgICAgIH0sICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShfKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBfLm5leHRUaWNrKGMoYiwgZSwgMSkpOwogICAgICB9IDogcCA/IChvID0gbmV3IHAoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gbSwgbiA9IGMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogZi5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFmLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGYucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtLCAhMSkpIDogbiA9IGggaW4gYSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIHUuYXBwZW5kQ2hpbGQoYSgic2NyaXB0IikpW2hdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdS5yZW1vdmVDaGlsZCh0aGlzKSwgYi5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQoYyhiLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogbCwgY2xlYXI6IGQgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fY3R4IjogMTcsICIuL19kb20tY3JlYXRlIjogMjAsICIuL19nbG9iYWwiOiAyNSwgIi4vX2h0bWwiOiAyOCwgIi4vX2ludm9rZSI6IDMwIH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWF4LAogICAgICAgICAgaSA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgPSBuKGUpLCAwID4gZSA/IG8oZSArIHQsIDApIDogaShlLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3RvLWludGVnZXIiOiA2MiB9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IE1hdGguY2VpbCwKICAgICAgICAgIG8gPSBNYXRoLmZsb29yO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGUgPSArZSkgPyAwIDogKGUgPiAwID8gbyA6IG4pKGUpOwogICAgICB9OwogICAgfSwge31dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2RlZmluZWQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuKG8oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9faW9iamVjdCI6IDMxIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgPiAwID8gbyhuKGUpLCA5MDA3MTk5MjU0NzQwOTkxKSA6IDA7CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbnRlZ2VyIjogNjIgfV0sIDY1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4IH1dLCA2NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIW4oZSkpIHJldHVybiBlO3ZhciByLCBvO2lmICh0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIChyID0gZS50b1N0cmluZykgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudmFsdWVPZikgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICghdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudG9TdHJpbmcpICYmICFuKG8gPSByLmNhbGwoZSkpKSByZXR1cm4gbzt0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwogICAgICB9OwogICAgfSwgeyAiLi9faXMtb2JqZWN0IjogMzMgfV0sIDY3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSAwLAogICAgICAgICAgbyA9IE1hdGgucmFuZG9tKCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN5bWJvbCgiLmNvbmNhdCh2b2lkIDAgPT09IGUgPyAiIiA6IGUsICIpXyIsICgrK24gKyBvKS50b1N0cmluZygzNikpOwogICAgICB9OwogICAgfSwge31dLCA2ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpLAogICAgICAgICAgaSA9IGUoIi4vX2dsb2JhbCIpLlN5bWJvbCwKICAgICAgICAgIGMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBpLAogICAgICAgICAgcyA9IHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBjICYmIGlbZV0gfHwgKGMgPyBpIDogbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9O3Muc3RvcmUgPSBuOwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19zaGFyZWQiOiA1NywgIi4vX3VpZCI6IDY3IH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY2xhc3NvZiIpLAogICAgICAgICAgbyA9IGUoIi4vX3drcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vX2NvcmUiKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPSBlID8gZVtvXSB8fCBlWyJAQGl0ZXJhdG9yIl0gfHwgaVtuKGUpXSA6IHZvaWQgMDsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjggfV0sIDcwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX2FkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vX2l0ZXItc3RlcCIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLAogICAgICAgICAgYyA9IGUoIi4vX3RvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuL19pdGVyLWRlZmluZSIpKEFycmF5LCAiQXJyYXkiLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHRoaXMuX3QgPSBjKGUpLCB0aGlzLl9pID0gMCwgdGhpcy5fayA9IHQ7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuX3QsCiAgICAgICAgICAgIHQgPSB0aGlzLl9rLAogICAgICAgICAgICByID0gdGhpcy5faSsrO3JldHVybiAhZSB8fCByID49IGUubGVuZ3RoID8gKHRoaXMuX3QgPSB2b2lkIDAsIG8oMSkpIDogImtleXMiID09IHQgPyBvKDAsIHIpIDogInZhbHVlcyIgPT0gdCA/IG8oMCwgZVtyXSkgOiBvKDAsIFtyLCBlW3JdXSk7CiAgICAgIH0sICJ2YWx1ZXMiKSwgaS5Bcmd1bWVudHMgPSBpLkFycmF5LCBuKCJrZXlzIiksIG4oInZhbHVlcyIpLCBuKCJlbnRyaWVzIik7CiAgICB9LCB7ICIuL19hZGQtdG8tdW5zY29wYWJsZXMiOiAxMCwgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19pdGVyLXN0ZXAiOiAzOCwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZXhwb3J0Iik7bihuLlMgKyBuLkYgKiAhZSgiLi9fZGVzY3JpcHRvcnMiKSwgIk9iamVjdCIsIHsgZGVmaW5lUHJvcGVydHk6IGUoIi4vX29iamVjdC1kcCIpLmYgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZXhwb3J0IjogMjIsICIuL19vYmplY3QtZHAiOiA0MyB9XSwgNzI6IFtmdW5jdGlvbiAoZSwgdCwgcikge30sIHt9XSwgNzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fbGlicmFyeSIpLAogICAgICAgICAgcyA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgdSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYSA9IGUoIi4vX2NsYXNzb2YiKSwKICAgICAgICAgIGYgPSBlKCIuL19leHBvcnQiKSwKICAgICAgICAgIF8gPSBlKCIuL19pcy1vYmplY3QiKSwKICAgICAgICAgIGwgPSAoZSgiLi9fYW4tb2JqZWN0IiksIGUoIi4vX2EtZnVuY3Rpb24iKSksCiAgICAgICAgICBkID0gZSgiLi9fYW4taW5zdGFuY2UiKSwKICAgICAgICAgIHAgPSBlKCIuL19mb3Itb2YiKSwKICAgICAgICAgIHYgPSAoZSgiLi9fc2V0LXByb3RvIikuc2V0LCBlKCIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIikpLAogICAgICAgICAgeSA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBoID0gZSgiLi9fbWljcm90YXNrIikoKSwKICAgICAgICAgIGIgPSAiUHJvbWlzZSIsCiAgICAgICAgICBtID0gcy5UeXBlRXJyb3IsCiAgICAgICAgICBnID0gcy5wcm9jZXNzLAogICAgICAgICAgX2ogPSBzW2JdLAogICAgICAgICAgZyA9IHMucHJvY2VzcywKICAgICAgICAgIHggPSAicHJvY2VzcyIgPT0gYShnKSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KCkge30sCiAgICAgICAgICBrID0gISFmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciB0ID0gX2oucmVzb2x2ZSgxKSwKICAgICAgICAgICAgICByID0gKHQuY29uc3RydWN0b3IgPSB7fSlbZSgiLi9fd2tzIikoInNwZWNpZXMiKV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlKHcsIHcpOwogICAgICAgICAgfTtyZXR1cm4gKHggfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgUHJvbWlzZVJlamVjdGlvbkV2ZW50KSAmJiB0LnRoZW4odykgaW5zdGFuY2VvZiByOwogICAgICAgIH0gY2F0Y2ggKG4pIHt9CiAgICAgIH0oKSwKICAgICAgICAgIE8gPSBmdW5jdGlvbiBPKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSA9PT0gdCB8fCBlID09PSBfaiAmJiB0ID09PSBpOwogICAgICB9LAogICAgICAgICAgTSA9IGZ1bmN0aW9uIE0oZSkgewogICAgICAgIHZhciB0O3JldHVybiBfKGUpICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mICh0ID0gZS50aGVuKSA/IHQgOiAhMTsKICAgICAgfSwKICAgICAgICAgIFAgPSBmdW5jdGlvbiBQKGUpIHsKICAgICAgICByZXR1cm4gTyhfaiwgZSkgPyBuZXcgUyhlKSA6IG5ldyBvKGUpOwogICAgICB9LAogICAgICAgICAgUyA9IG8gPSBmdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCwgcjt0aGlzLnByb21pc2UgPSBuZXcgZShmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCB8fCB2b2lkIDAgIT09IHIpIHRocm93IG0oIkJhZCBQcm9taXNlIGNvbnN0cnVjdG9yIik7dCA9IGUsIHIgPSBuOwogICAgICAgIH0pLCB0aGlzLnJlc29sdmUgPSBsKHQpLCB0aGlzLnJlamVjdCA9IGwocik7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4geyBlcnJvcjogdCB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIFQgPSBmdW5jdGlvbiBUKGUsIHQpIHsKICAgICAgICBpZiAoIWUuX24pIHsKICAgICAgICAgIGUuX24gPSAhMDt2YXIgciA9IGUuX2M7aChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSBlLl92LCBvID0gMSA9PSBlLl9zLCBpID0gMCwgYyA9IGZ1bmN0aW9uIGModCkgewogICAgICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICBjID0gbyA/IHQub2sgOiB0LmZhaWwsCiAgICAgICAgICAgICAgICAgIHMgPSB0LnJlc29sdmUsCiAgICAgICAgICAgICAgICAgIHUgPSB0LnJlamVjdCwKICAgICAgICAgICAgICAgICAgYSA9IHQuZG9tYWluO3RyeSB7CiAgICAgICAgICAgICAgICBjID8gKG8gfHwgKDIgPT0gZS5faCAmJiBDKGUpLCBlLl9oID0gMSksIGMgPT09ICEwID8gciA9IG4gOiAoYSAmJiBhLmVudGVyKCksIHIgPSBjKG4pLCBhICYmIGEuZXhpdCgpKSwgciA9PT0gdC5wcm9taXNlID8gdShtKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBNKHIpKSA/IGkuY2FsbChyLCBzLCB1KSA6IHMocikpIDogdShuKTsKICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICB1KGYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGMocltpKytdKTsKICAgICAgICAgICAgfWUuX2MgPSBbXSwgZS5fbiA9ICExLCB0ICYmICFlLl9oICYmIEEoZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBBID0gZnVuY3Rpb24gQShlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0LAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICBvID0gZS5fdjtpZiAoVShlKSAmJiAodCA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB4ID8gZy5lbWl0KCJ1bmhhbmRsZWRSZWplY3Rpb24iLCBvLCBlKSA6IChyID0gcy5vbnVuaGFuZGxlZHJlamVjdGlvbikgPyByKHsgcHJvbWlzZTogZSwgcmVhc29uOiBvIH0pIDogKG4gPSBzLmNvbnNvbGUpICYmIG4uZXJyb3IgJiYgbi5lcnJvcigiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIiwgbyk7CiAgICAgICAgICB9KSwgZS5faCA9IHggfHwgVShlKSA/IDIgOiAxKSwgZS5fYSA9IHZvaWQgMCwgdCkgdGhyb3cgdC5lcnJvcjsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgICAgIFUgPSBmdW5jdGlvbiBVKGUpIHsKICAgICAgICBpZiAoMSA9PSBlLl9oKSByZXR1cm4gITE7Zm9yICh2YXIgdCwgciA9IGUuX2EgfHwgZS5fYywgbiA9IDA7IHIubGVuZ3RoID4gbjspIHsKICAgICAgICAgIGlmICh0ID0gcltuKytdLCB0LmZhaWwgfHwgIVUodC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBDID0gZnVuY3Rpb24gQyhlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0O3ggPyBnLmVtaXQoInJlamVjdGlvbkhhbmRsZWQiLCBlKSA6ICh0ID0gcy5vbnJlamVjdGlvbmhhbmRsZWQpICYmIHQoeyBwcm9taXNlOiBlLCByZWFzb246IGUuX3YgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuX2QgfHwgKHQuX2QgPSAhMCwgdCA9IHQuX3cgfHwgdCwgdC5fdiA9IGUsIHQuX3MgPSAyLCB0Ll9hIHx8ICh0Ll9hID0gdC5fYy5zbGljZSgpKSwgVCh0LCAhMCkpOwogICAgICB9LAogICAgICAgICAgTCA9IGZ1bmN0aW9uIEwoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICByID0gdGhpcztpZiAoIXIuX2QpIHsKICAgICAgICAgIHIuX2QgPSAhMCwgciA9IHIuX3cgfHwgcjt0cnkgewogICAgICAgICAgICBpZiAociA9PT0gZSkgdGhyb3cgbSgiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsodCA9IE0oZSkpID8gaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7IF93OiByLCBfZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIHUoTCwgbiwgMSksIHUoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIuX3YgPSBlLCByLl9zID0gMSwgVChyLCAhMSkpOwogICAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgICBSLmNhbGwoeyBfdzogciwgX2Q6ICExIH0sIG4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTtrIHx8IChfaiA9IGZ1bmN0aW9uIGooZSkgewogICAgICAgIGQodGhpcywgX2osIGIsICJfaCIpLCBsKGUpLCBuLmNhbGwodGhpcyk7dHJ5IHsKICAgICAgICAgIGUodShMLCB0aGlzLCAxKSwgdShSLCB0aGlzLCAxKSk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgUi5jYWxsKHRoaXMsIHQpOwogICAgICAgIH0KICAgICAgfSwgbiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHRoaXMuX2MgPSBbXSwgdGhpcy5fYSA9IHZvaWQgMCwgdGhpcy5fcyA9IDAsIHRoaXMuX2QgPSAhMSwgdGhpcy5fdiA9IHZvaWQgMCwgdGhpcy5faCA9IDAsIHRoaXMuX24gPSAhMTsKICAgICAgfSwgbi5wcm90b3R5cGUgPSBlKCIuL19yZWRlZmluZS1hbGwiKShfai5wcm90b3R5cGUsIHsgdGhlbjogZnVuY3Rpb24gdGhlbihlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IFAodih0aGlzLCBfaikpO3JldHVybiByLm9rID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IGUgOiAhMCwgci5mYWlsID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdCAmJiB0LCByLmRvbWFpbiA9IHggPyBnLmRvbWFpbiA6IHZvaWQgMCwgdGhpcy5fYy5wdXNoKHIpLCB0aGlzLl9hICYmIHRoaXMuX2EucHVzaChyKSwgdGhpcy5fcyAmJiBUKHRoaXMsICExKSwgci5wcm9taXNlOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSwgUyA9IGZ1bmN0aW9uIFMoKSB7CiAgICAgICAgdmFyIGUgPSBuZXcgbigpO3RoaXMucHJvbWlzZSA9IGUsIHRoaXMucmVzb2x2ZSA9IHUoTCwgZSwgMSksIHRoaXMucmVqZWN0ID0gdShSLCBlLCAxKTsKICAgICAgfSksIGYoZi5HICsgZi5XICsgZi5GICogIWssIHsgUHJvbWlzZTogX2ogfSksIGUoIi4vX3NldC10by1zdHJpbmctdGFnIikoX2osIGIpLCBlKCIuL19zZXQtc3BlY2llcyIpKGIpLCBpID0gZSgiLi9fY29yZSIpW2JdLCBmKGYuUyArIGYuRiAqICFrLCBiLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gUCh0aGlzKSwKICAgICAgICAgICAgICByID0gdC5yZWplY3Q7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqIChjIHx8ICFrKSwgYiwgeyByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKGUpIHsKICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX2ogJiYgTyhlLmNvbnN0cnVjdG9yLCB0aGlzKSkgcmV0dXJuIGU7dmFyIHQgPSBQKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqICEoayAmJiBlKCIuL19pdGVyLWRldGVjdCIpKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX2ouYWxsKGUpWyJjYXRjaCJdKHcpOwogICAgICB9KSksIGIsIHsgYWxsOiBmdW5jdGlvbiBhbGwoZSkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgIHIgPSBQKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgbyA9IHIucmVqZWN0LAogICAgICAgICAgICAgIGkgPSBFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHIgPSBbXSwKICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgYyA9IDE7cChlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgcyA9IGkrKywKICAgICAgICAgICAgICAgICAgdSA9ICExO3IucHVzaCh2b2lkIDApLCBjKyssIHQucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB1IHx8ICh1ID0gITAsIHJbc10gPSBlLCAtLWMgfHwgbihyKSk7CiAgICAgICAgICAgICAgfSwgbyk7CiAgICAgICAgICAgIH0pLCAtLWMgfHwgbihyKTsKICAgICAgICAgIH0pO3JldHVybiBpICYmIG8oaS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICByID0gUCh0KSwKICAgICAgICAgICAgICBuID0gci5yZWplY3QsCiAgICAgICAgICAgICAgbyA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBwKGUsICExLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQucmVzb2x2ZShlKS50aGVuKHIucmVzb2x2ZSwgbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7cmV0dXJuIG8gJiYgbihvLmVycm9yKSwgci5wcm9taXNlOwogICAgICAgIH0gfSk7CiAgICB9LCB7ICIuL19hLWZ1bmN0aW9uIjogOSwgIi4vX2FuLWluc3RhbmNlIjogMTEsICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2N0eCI6IDE3LCAiLi9fZXhwb3J0IjogMjIsICIuL19mb3Itb2YiOiAyNCwgIi4vX2dsb2JhbCI6IDI1LCAiLi9faXMtb2JqZWN0IjogMzMsICIuL19pdGVyLWRldGVjdCI6IDM3LCAiLi9fbGlicmFyeSI6IDQwLCAiLi9fbWljcm90YXNrIjogNDEsICIuL19yZWRlZmluZS1hbGwiOiA1MSwgIi4vX3NldC1wcm90byI6IDUzLCAiLi9fc2V0LXNwZWNpZXMiOiA1NCwgIi4vX3NldC10by1zdHJpbmctdGFnIjogNTUsICIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIjogNTgsICIuL190YXNrIjogNjAsICIuL193a3MiOiA2OCB9XSwgNzQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fc3RyaW5nLWF0IikoITApO2UoIi4vX2l0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19zdHJpbmctYXQiOiA1OSB9XSwgNzU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO2ZvciAodmFyIG4gPSBlKCIuL19nbG9iYWwiKSwgbyA9IGUoIi4vX2hpZGUiKSwgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLCBjID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIiksIHMgPSBbIk5vZGVMaXN0IiwgIkRPTVRva2VuTGlzdCIsICJNZWRpYUxpc3QiLCAiU3R5bGVTaGVldExpc3QiLCAiQ1NTUnVsZUxpc3QiXSwgdSA9IDA7IDUgPiB1OyB1KyspIHsKICAgICAgICB2YXIgYSA9IHNbdV0sCiAgICAgICAgICAgIGYgPSBuW2FdLAogICAgICAgICAgICBfID0gZiAmJiBmLnByb3RvdHlwZTtfICYmICFfW2NdICYmIG8oXywgYywgYSksIGlbYV0gPSBpLkFycmF5OwogICAgICB9CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjgsICIuL2VzNi5hcnJheS5pdGVyYXRvciI6IDcwIH1dLCA3NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoIi4vaHlwZXJ0eS1kaXNjb3ZlcnkvSHlwZXJ0eURpc2NvdmVyeSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gaVsiZGVmYXVsdCJdLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL2h5cGVydHktZGlzY292ZXJ5L0h5cGVydHlEaXNjb3ZlcnkiOiA3NyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBzID0gbihjKSwKICAgICAgICAgIHUgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHUpLAogICAgICAgICAgZiA9IGUoIi4uL3V0aWxzL3V0aWxzIiksCiAgICAgICAgICBfID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgcikgewogICAgICAgICAgKDAsIHNbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIG4gPSB0aGlzO24ubWVzc2FnZUJ1cyA9IHIsIG4uZG9tYWluID0gKDAsIGYuZGl2aWRlVVJMKSh0KS5kb21haW4sIG4uZGlzY292ZXJ5VVJMID0gdDsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImRpc2NvdmVyRGF0YU9iamVjdFBlck5hbWUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiAiZGF0YU9iamVjdDovLyIgKyBlIH0gfTtyZXR1cm4gbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShvLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgdmFyIG4gPSByLmJvZHkudmFsdWUudXJsO24gPyBlKG4pIDogdCgiRGF0YU9iamVjdCBuYW1lIGRvZXMgbm90IGV4aXN0Iik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImRpc2NvdmVySHlwZXJ0eVBlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2U6ICIsIGMsIG4sIG8pLCBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgci5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKGMsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibWVzc2FnZSByZXBseSIsIHIpO3ZhciBvID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAgIGkgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgYyA9IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBzID0gci5ib2R5LnZhbHVlO2ZvciAobyBpbiBzKSB7CiAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHNbb10ubGFzdE1vZGlmaWVkKSBpZiAodm9pZCAwID09PSBpKSBpID0gbmV3IERhdGUoc1tvXS5sYXN0TW9kaWZpZWQpLCBjID0gbztlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IG5ldyBEYXRlKHNbb10ubGFzdE1vZGlmaWVkKTtpLmdldFRpbWUoKSA8IHUuZ2V0VGltZSgpICYmIChpID0gdSwgYyA9IG8pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9Y29uc29sZS5sb2coIkxhc3QgSHlwZXJ0eTogIiwgYywgaSk7dmFyIGEgPSBjO2lmICh2b2lkIDAgPT09IGEpIHJldHVybiBuKCJVc2VyIEh5cGVydHkgbm90IGZvdW5kIik7dmFyIGYgPSB7IGlkOiBlLCBkZXNjcmlwdG9yOiBzW2FdLmRlc2NyaXB0b3IsIGh5cGVydHlVUkw6IGEgfTtjb25zb2xlLmxvZygiPT09PiBoeXBlcnR5RGlzY292ZXJ5IG1lc3NhZ2VCdW5kbGU6ICIsIGYpLCB0KGYpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkaXNjb3Zlckh5cGVydGllc1BlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2UgZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyOiAiLCBjLCBuLCBvKSwgbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShjLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlciByZXBseSIsIHIpO3ZhciBuID0gci5ib2R5LnZhbHVlO3JldHVybiBuID8gdm9pZCBlKG4pIDogdCgiVXNlciBIeXBlcnR5IG5vdCBmb3VuZCIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gXywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMiOiA3OCwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogMywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiA1IH1dLCA3ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1mdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpLAogICAgICAgICAgICByID0gIiQxLCQyLCQzIiwKICAgICAgICAgICAgbiA9IGUucmVwbGFjZSh0LCByKS5zcGxpdCgiLCIpO25bMF0gPT09IGUgJiYgKG5bMF0gPSAiaHR0cHMiLCBuWzFdID0gZSk7dmFyIG8gPSB7IHR5cGU6IG5bMF0sIGRvbWFpbjogblsxXSwgaWRlbnRpdHk6IG5bMl0gfTtyZXR1cm4gbzsKICAgICAgfWZ1bmN0aW9uIGkoZSkgewogICAgICAgIHJldHVybiBlID8gSlNPTi5wYXJzZSgoMCwgc1siZGVmYXVsdCJdKShlKSkgOiB2b2lkIDA7CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgYyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSIpLAogICAgICAgICAgcyA9IG4oYyk7ci5kaXZpZGVVUkwgPSBvLCByLmRlZXBDbG9uZSA9IGk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvanNvbi9zdHJpbmdpZnkiOiAxIH1dIH0sIHt9LCBbNzZdKSg3Nik7Cn0pOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CiJ1c2Ugc3RyaWN0IjsKCnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsKCi8qKgoqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQoqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KKgoqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioqLwoKLy8gRGlzdHJpYnV0aW9uIGZpbGUgZm9yIFN5bmNoZXIuanMKLy8gdmVyc2lvbjogMC4yLjAKCiFmdW5jdGlvbiAoZSkgewogIGlmICgib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbW9kdWxlKSBtb2R1bGUuZXhwb3J0cyA9IGUoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCBlKTtlbHNlIHsKICAgIHZhciB0O3QgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHRoaXMsIHQuU3luY2hlciA9IGUoKTsKICB9Cn0oZnVuY3Rpb24gKCkgewogIHJldHVybiBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgIGZ1bmN0aW9uIG8ocywgYSkgewogICAgICBpZiAoIXJbc10pIHsKICAgICAgICBpZiAoIXRbc10pIHsKICAgICAgICAgIHZhciBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlO2lmICghYSAmJiBjKSByZXR1cm4gYyhzLCAhMCk7aWYgKGkpIHJldHVybiBpKHMsICEwKTt2YXIgdSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgcyArICInIik7dGhyb3cgdS5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCB1OwogICAgICAgIH12YXIgbCA9IHJbc10gPSB7IGV4cG9ydHM6IHt9IH07dFtzXVswXS5jYWxsKGwuZXhwb3J0cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gdFtzXVsxXVtlXTtyZXR1cm4gbyhyID8gciA6IGUpOwogICAgICAgIH0sIGwsIGwuZXhwb3J0cywgZSwgdCwgciwgbik7CiAgICAgIH1yZXR1cm4gcltzXS5leHBvcnRzOwogICAgfWZvciAodmFyIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmUsIHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgewogICAgICBvKG5bc10pOwogICAgfXJldHVybiBvOwogIH0oeyAxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgJiYgIUFycmF5Lm9ic2VydmUgJiYgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHIgPSBlLmdldE5vdGlmaWVyLAogICAgICAgICAgICBuID0gInBlcmZvcm1DaGFuZ2UiLAogICAgICAgICAgICBvID0gIl9vcmlnaW5hbCIsCiAgICAgICAgICAgIGkgPSAic3BsaWNlIiwKICAgICAgICAgICAgcyA9IHsgcHVzaDogZnVuY3Rpb24gYyhlKSB7CiAgICAgICAgICAgIHZhciB0ID0gYXJndW1lbnRzLAogICAgICAgICAgICAgICAgcyA9IGNbb10uYXBwbHkodGhpcywgdCk7cmV0dXJuIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiBzIC0gdC5sZW5ndGgsIGFkZGVkQ291bnQ6IHQubGVuZ3RoLCByZW1vdmVkOiBbXSB9OwogICAgICAgICAgICB9KSwgczsKICAgICAgICAgIH0sIHVuc2hpZnQ6IGZ1bmN0aW9uIHUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIHMgPSB1W29dLmFwcGx5KHRoaXMsIHQpO3JldHVybiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogMCwgYWRkZWRDb3VudDogdC5sZW5ndGgsIHJlbW92ZWQ6IFtdIH07CiAgICAgICAgICAgIH0pLCBzOwogICAgICAgICAgfSwgcG9wOiBmdW5jdGlvbiBsKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgICAgICAgdCA9IGxbb10uY2FsbCh0aGlzKTtyZXR1cm4gdGhpcy5sZW5ndGggIT09IGUgJiYgcih0aGlzKVtuXShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IHRoaXMubGVuZ3RoLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzaGlmdDogZnVuY3Rpb24gZigpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHQgPSBmW29dLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMubGVuZ3RoICE9PSBlICYmIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiAwLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzcGxpY2U6IGZ1bmN0aW9uIGQoZSwgdCkgewogICAgICAgICAgICB2YXIgcyA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIGEgPSBkW29dLmFwcGx5KHRoaXMsIHMpO3JldHVybiAoYS5sZW5ndGggfHwgcy5sZW5ndGggPiAyKSAmJiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogZSwgYWRkZWRDb3VudDogcy5sZW5ndGggLSAyLCByZW1vdmVkOiBhIH07CiAgICAgICAgICAgIH0sIHRoaXMpLCBhOwogICAgICAgICAgfSB9O2ZvciAodmFyIGEgaW4gcykgewogICAgICAgICAgc1thXVtvXSA9IHQucHJvdG90eXBlW2FdLCB0LnByb3RvdHlwZVthXSA9IHNbYV07CiAgICAgICAgfXQub2JzZXJ2ZSA9IGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICByZXR1cm4gZS5vYnNlcnZlKHQsIHIsIFsiYWRkIiwgInVwZGF0ZSIsICJkZWxldGUiLCBpXSk7CiAgICAgICAgfSwgdC51bm9ic2VydmUgPSBlLnVub2JzZXJ2ZTsKICAgICAgfShPYmplY3QsIEFycmF5KTsKICAgIH0sIHt9XSwgMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9qc29uL3N0cmluZ2lmeSI6IDE3IH1dLCAzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2NyZWF0ZSI6IDE4IH1dLCA0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDE5IH1dLCA1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6IDIwIH1dLCA2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogMjEgfV0sIDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2tleXMiOiAyMiB9XSwgODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDIzIH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSI6IDI0IH1dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIjogMjUgfV0sIDExOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICByLl9fZXNNb2R1bGUgPSAhMCwgclsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgdCkpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9OwogICAgfSwge31dLCAxMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoIi4uL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtyXTtuLmVudW1lcmFibGUgPSBuLmVudW1lcmFibGUgfHwgITEsIG4uY29uZmlndXJhYmxlID0gITAsICJ2YWx1ZSIgaW4gbiAmJiAobi53cml0YWJsZSA9ICEwKSwgKDAsIGlbImRlZmF1bHQiXSkoZSwgbi5rZXksIG4pOwogICAgICAgICAgfQogICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKHQsIHIsIG4pIHsKICAgICAgICAgIHJldHVybiByICYmIGUodC5wcm90b3R5cGUsIHIpLCBuICYmIGUodCwgbiksIHQ7CiAgICAgICAgfTsKICAgICAgfSgpOwogICAgfSwgeyAiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjogNCB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKVsiZGVmYXVsdCJdO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyA9ICEwOyBvOykgewogICAgICAgICAgdmFyIGkgPSBlLAogICAgICAgICAgICAgIHMgPSB0LAogICAgICAgICAgICAgIGEgPSByO28gPSAhMSwgbnVsbCA9PT0gaSAmJiAoaSA9IEZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIGMgPSBuKGksIHMpO2lmICh2b2lkIDAgIT09IGMpIHsKICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gYykgcmV0dXJuIGMudmFsdWU7dmFyIHUgPSBjLmdldDtpZiAodm9pZCAwID09PSB1KSByZXR1cm47cmV0dXJuIHUuY2FsbChhKTsKICAgICAgICAgIH12YXIgbCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpKTtpZiAobnVsbCA9PT0gbCkgcmV0dXJuO2UgPSBsLCB0ID0gcywgciA9IGEsIG8gPSAhMCwgYyA9IGwgPSB2b2lkIDA7CiAgICAgICAgfQogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjogNSB9XSwgMTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9jcmVhdGUiKVsiZGVmYXVsdCJdLAogICAgICAgICAgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCAmJiBudWxsICE9PSB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSk7ZS5wcm90b3R5cGUgPSBuKHQgJiYgdC5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IGUsIGVudW1lcmFibGU6ICExLCB3cml0YWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAgfSB9KSwgdCAmJiAobyA/IG8oZSwgdCkgOiBlLl9fcHJvdG9fXyA9IHQpOwogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvY3JlYXRlIjogMywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfXIuX19lc01vZHVsZSA9ICEwO3ZhciBvID0gZSgiLi4vaGVscGVycy90eXBlb2YiKSwKICAgICAgICAgIGkgPSBuKG8pO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCFlKSB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiAhdCB8fCAib2JqZWN0IiAhPT0gKCJ1bmRlZmluZWQiID09IHR5cGVvZiB0ID8gInVuZGVmaW5lZCIgOiAoMCwgaVsiZGVmYXVsdCJdKSh0KSkgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCA/IGUgOiB0OwogICAgICB9OwogICAgfSwgeyAiLi4vaGVscGVycy90eXBlb2YiOiAxNiB9XSwgMTY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLmNvbnN0cnVjdG9yID09PSBuID8gInN5bWJvbCIgOiB0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSk7CiAgICAgIH0sIHIuX19lc01vZHVsZSA9ICEwOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCI6IDEwIH1dLCAxNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAobi5KU09OICYmIG4uSlNPTi5zdHJpbmdpZnkgfHwgSlNPTi5zdHJpbmdpZnkpLmFwcGx5KEpTT04sIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxIH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbi5jcmVhdGUoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiB9XSwgMTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uc2V0RGVzYyhlLCB0LCByKTsKICAgICAgfTsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJCI6IDU2IH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7ZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmdldERlc2MoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOiA4MSB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiI6IDgyIH1dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LmtleXM7CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmtleXMiOiA4MyB9XSwgMjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiI6IDg0IH1dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciKSwgZSgiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksIGUoIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSIpLCBlKCIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIiksIHQuZXhwb3J0cyA9IGUoIi4uL21vZHVsZXMvJC5jb3JlIikuUHJvbWlzZTsKICAgIH0sIHsgIi4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogODUsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogODYsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA4NywgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDg5IH1dLCAyNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCIpLCBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuU3ltYm9sOwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOiAzMSwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOiA4NSwgIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCI6IDg4IH1dLCAyNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYSBmdW5jdGlvbiEiKTtyZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHt9XSwgMjc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7fTsKICAgIH0sIHt9XSwgMjg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXMtb2JqZWN0IjogNDkgfV0sIDI5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpLAogICAgICAgICAgaSA9ICJBcmd1bWVudHMiID09IG4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICAgIH0oKSk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwgciwgcztyZXR1cm4gdm9pZCAwID09PSBlID8gIlVuZGVmaW5lZCIgOiBudWxsID09PSBlID8gIk51bGwiIDogInN0cmluZyIgPT0gdHlwZW9mIChyID0gKHQgPSBPYmplY3QoZSkpW29dKSA/IHIgOiBpID8gbih0KSA6ICJPYmplY3QiID09IChzID0gbih0KSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5jYWxsZWUgPyAiQXJndW1lbnRzIiA6IHM7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAsICIuLyQud2tzIjogNzggfV0sIDMwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAzMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMS4yLjYiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuYS1mdW5jdGlvbiIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHZvaWQgMCA9PT0gdCkgcmV0dXJuIGU7c3dpdGNoIChyKSB7Y2FzZSAxOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIpOwogICAgICAgICAgICB9O2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuKTsKICAgICAgICAgICAgfTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbiwgbykgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgciwgbiwgbyk7CiAgICAgICAgICAgIH07fXJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYS1mdW5jdGlvbiI6IDI2IH1dLCAzMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDM0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vJC5mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pLmE7CiAgICAgIH0pOwogICAgfSwgeyAiLi8kLmZhaWxzIjogMzggfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi8kLmdsb2JhbCIpLmRvY3VtZW50LAogICAgICAgICAgaSA9IG4obykgJiYgbihvLmNyZWF0ZUVsZW1lbnQpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGkgPyBvLmNyZWF0ZUVsZW1lbnQoZSkgOiB7fTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgMzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBuLmdldEtleXMoZSksCiAgICAgICAgICAgIHIgPSBuLmdldFN5bWJvbHM7aWYgKHIpIGZvciAodmFyIG8sIGkgPSByKGUpLCBzID0gbi5pc0VudW0sIGEgPSAwOyBpLmxlbmd0aCA+IGE7KSB7CiAgICAgICAgICBzLmNhbGwoZSwgbyA9IGlbYSsrXSkgJiYgdC5wdXNoKG8pOwogICAgICAgIH1yZXR1cm4gdDsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2IH1dLCAzNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5jb3JlIiksCiAgICAgICAgICBpID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgcyA9ICJwcm90b3R5cGUiLAogICAgICAgICAgYSA9IGZ1bmN0aW9uIGEoZSwgdCwgcikgewogICAgICAgIHZhciBjLAogICAgICAgICAgICB1LAogICAgICAgICAgICBsLAogICAgICAgICAgICBmID0gZSAmIGEuRiwKICAgICAgICAgICAgZCA9IGUgJiBhLkcsCiAgICAgICAgICAgIHAgPSBlICYgYS5TLAogICAgICAgICAgICBiID0gZSAmIGEuUCwKICAgICAgICAgICAgaCA9IGUgJiBhLkIsCiAgICAgICAgICAgIHYgPSBlICYgYS5XLAogICAgICAgICAgICB5ID0gZCA/IG8gOiBvW3RdIHx8IChvW3RdID0ge30pLAogICAgICAgICAgICBfID0gZCA/IG4gOiBwID8gblt0XSA6IChuW3RdIHx8IHt9KVtzXTtkICYmIChyID0gdCk7Zm9yIChjIGluIHIpIHsKICAgICAgICAgIHUgPSAhZiAmJiBfICYmIGMgaW4gXywgdSAmJiBjIGluIHkgfHwgKGwgPSB1ID8gX1tjXSA6IHJbY10sIHlbY10gPSBkICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIF9bY10gPyByW2NdIDogaCAmJiB1ID8gaShsLCBuKSA6IHYgJiYgX1tjXSA9PSBsID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBmdW5jdGlvbiB0KF90KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBlID8gbmV3IGUoX3QpIDogZShfdCk7CiAgICAgICAgICAgIH07cmV0dXJuIHRbc10gPSBlW3NdLCB0OwogICAgICAgICAgfShsKSA6IGIgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgbCA/IGkoRnVuY3Rpb24uY2FsbCwgbCkgOiBsLCBiICYmICgoeVtzXSB8fCAoeVtzXSA9IHt9KSlbY10gPSBsKSk7CiAgICAgICAgfQogICAgICB9O2EuRiA9IDEsIGEuRyA9IDIsIGEuUyA9IDQsIGEuUCA9IDgsIGEuQiA9IDE2LCBhLlcgPSAzMiwgdC5leHBvcnRzID0gYTsKICAgIH0sIHsgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZ2xvYmFsIjogNDEgfV0sIDM4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuICEhZSgpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7fV0sIDM5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY3R4IiksCiAgICAgICAgICBvID0gZSgiLi8kLml0ZXItY2FsbCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5pcy1hcnJheS1pdGVyIiksCiAgICAgICAgICBzID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgYSA9IGUoIi4vJC50by1sZW5ndGgiKSwKICAgICAgICAgIGMgPSBlKCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCB1KSB7CiAgICAgICAgdmFyIGwsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIHAgPSBjKGUpLAogICAgICAgICAgICBiID0gbihyLCB1LCB0ID8gMiA6IDEpLAogICAgICAgICAgICBoID0gMDtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcCkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBpdGVyYWJsZSEiKTtpZiAoaShwKSkgZm9yIChsID0gYShlLmxlbmd0aCk7IGwgPiBoOyBoKyspIHsKICAgICAgICAgIHQgPyBiKHMoZiA9IGVbaF0pWzBdLCBmWzFdKSA6IGIoZVtoXSk7CiAgICAgICAgfSBlbHNlIGZvciAoZCA9IHAuY2FsbChlKTsgIShmID0gZC5uZXh0KCkpLmRvbmU7KSB7CiAgICAgICAgICBvKGQsIGIsIGYudmFsdWUsIHQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1hcnJheS1pdGVyIjogNDcsICIuLyQuaXRlci1jYWxsIjogNTAsICIuLyQudG8tbGVuZ3RoIjogNzUsICIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCI6IDc5IH1dLCA0MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKS5nZXROYW1lcywKICAgICAgICAgIGkgPSB7fS50b1N0cmluZywKICAgICAgICAgIHMgPSAib2JqZWN0IiA9PSAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yod2luZG93KSkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW10sCiAgICAgICAgICBhID0gZnVuY3Rpb24gYShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBvKGUpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiBzLnNsaWNlKCk7CiAgICAgICAgfQogICAgICB9O3QuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBzICYmICJbb2JqZWN0IFdpbmRvd10iID09IGkuY2FsbChlKSA/IGEoZSkgOiBvKG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA0MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIDogRnVuY3Rpb24oInJldHVybiB0aGlzIikoKTsibnVtYmVyIiA9PSB0eXBlb2YgX19nICYmIChfX2cgPSBuKTsKICAgIH0sIHt9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHt9Lmhhc093blByb3BlcnR5O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIG4uY2FsbChlLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgNDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi8kLmRlc2NyaXB0b3JzIikgPyBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLnNldERlc2MoZSwgdCwgbygxLCByKSk7CiAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBlW3RdID0gciwgZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmRlc2NyaXB0b3JzIjogMzQsICIuLyQucHJvcGVydHktZGVzYyI6IDYxIH1dLCA0NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5nbG9iYWwiKS5kb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB9LCB7ICIuLyQuZ2xvYmFsIjogNDEgfV0sIDQ1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IHZvaWQgMCA9PT0gcjtzd2l0Y2ggKHQubGVuZ3RoKSB7Y2FzZSAwOgogICAgICAgICAgICByZXR1cm4gbiA/IGUoKSA6IGUuY2FsbChyKTtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdKSA6IGUuY2FsbChyLCB0WzBdKTtjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdKTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdKTtjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKTt9cmV0dXJuIGUuYXBwbHkociwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gT2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3RyaW5nIiA9PSBuKGUpID8gZS5zcGxpdCgiIikgOiBPYmplY3QoZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IEFycmF5LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUgJiYgKG4uQXJyYXkgPT09IGUgfHwgaVtvXSA9PT0gZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQud2tzIjogNzggfV0sIDQ4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiQXJyYXkiID09IG4oZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gKHR5cGVvZiBlID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihlKSkgPyBudWxsICE9PSBlIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5hbi1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgbykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbyA/IHQobihyKVswXSwgclsxXSkgOiB0KHIpOwogICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgIHZhciBzID0gZVsicmV0dXJuIl07dGhyb3cgdm9pZCAwICE9PSBzICYmIG4ocy5jYWxsKGUpKSwgaTsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYW4tb2JqZWN0IjogMjggfV0sIDUxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBzID0ge307ZSgiLi8kLmhpZGUiKShzLCBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuLmNyZWF0ZShzLCB7IG5leHQ6IG8oMSwgcikgfSksIGkoZSwgdCArICIgSXRlcmF0b3IiKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmhpZGUiOiA0MywgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi8kLnJlZGVmaW5lIiksCiAgICAgICAgICBzID0gZSgiLi8kLmhpZGUiKSwKICAgICAgICAgIGEgPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBjID0gZSgiLi8kLml0ZXJhdG9ycyIpLAogICAgICAgICAgdSA9IGUoIi4vJC5pdGVyLWNyZWF0ZSIpLAogICAgICAgICAgbCA9IGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgZiA9IGUoIi4vJCIpLmdldFByb3RvLAogICAgICAgICAgZCA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIHAgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBiID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgaCA9ICJrZXlzIiwKICAgICAgICAgIHYgPSAidmFsdWVzIiwKICAgICAgICAgIHkgPSBmdW5jdGlvbiB5KCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBfLCBnLCBtLCBqKSB7CiAgICAgICAgdShyLCB0LCBfKTt2YXIgJCwKICAgICAgICAgICAgTywKICAgICAgICAgICAgdyA9IGZ1bmN0aW9uIHcoZSkgewogICAgICAgICAgaWYgKCFwICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSBoOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHY6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIGsgPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIHggPSBnID09IHYsCiAgICAgICAgICAgIEMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBTID0gRVtkXSB8fCBFW2JdIHx8IGcgJiYgRVtnXSwKICAgICAgICAgICAgVCA9IFMgfHwgdyhnKTtpZiAoUykgewogICAgICAgICAgdmFyIE0gPSBmKFQuY2FsbChuZXcgZSgpKSk7bChNLCBrLCAhMCksICFuICYmIGEoRSwgYikgJiYgcyhNLCBkLCB5KSwgeCAmJiBTLm5hbWUgIT09IHYgJiYgKEMgPSAhMCwgVCA9IGZ1bmN0aW9uIFQoKSB7CiAgICAgICAgICAgIHJldHVybiBTLmNhbGwodGhpcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9aWYgKG4gJiYgIWogfHwgIXAgJiYgIUMgJiYgRVtkXSB8fCBzKEUsIGQsIFQpLCBjW3RdID0gVCwgY1trXSA9IHksIGcpIGlmICgkID0geyB2YWx1ZXM6IHggPyBUIDogdyh2KSwga2V5czogbSA/IFQgOiB3KGgpLCBlbnRyaWVzOiB4ID8gdygiZW50cmllcyIpIDogVCB9LCBqKSBmb3IgKE8gaW4gJCkgewogICAgICAgICAgTyBpbiBFIHx8IGkoRSwgTywgJFtPXSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKHAgfHwgQyksIHQsICQpO3JldHVybiAkOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuZXhwb3J0IjogMzcsICIuLyQuaGFzIjogNDIsICIuLyQuaGlkZSI6IDQzLCAiLi8kLml0ZXItY3JlYXRlIjogNTEsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQubGlicmFyeSI6IDU4LCAiLi8kLnJlZGVmaW5lIjogNjMsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChzKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgcyA9IGlbbl0oKTtzLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH0sIGlbbl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgfSwgZShpKTsKICAgICAgICB9IGNhdGNoIChhKSB7fXJldHVybiByOwogICAgICB9OwogICAgfSwgeyAiLi8kLndrcyI6IDc4IH1dLCA1NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEhZSB9OwogICAgICB9OwogICAgfSwge31dLCA1NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHt9OwogICAgfSwge31dLCA1NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gT2JqZWN0O3QuZXhwb3J0cyA9IHsgY3JlYXRlOiBuLmNyZWF0ZSwgZ2V0UHJvdG86IG4uZ2V0UHJvdG90eXBlT2YsIGlzRW51bToge30ucHJvcGVydHlJc0VudW1lcmFibGUsIGdldERlc2M6IG4uZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLCBzZXREZXNjOiBuLmRlZmluZVByb3BlcnR5LCBzZXREZXNjczogbi5kZWZpbmVQcm9wZXJ0aWVzLCBnZXRLZXlzOiBuLmtleXMsIGdldE5hbWVzOiBuLmdldE93blByb3BlcnR5TmFtZXMsIGdldFN5bWJvbHM6IG4uZ2V0T3duUHJvcGVydHlTeW1ib2xzLCBlYWNoOiBbXS5mb3JFYWNoIH07CiAgICB9LCB7fV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQudG8taW9iamVjdCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciwgaSA9IG8oZSksIHMgPSBuLmdldEtleXMoaSksIGEgPSBzLmxlbmd0aCwgYyA9IDA7IGEgPiBjOykgewogICAgICAgICAgaWYgKGlbciA9IHNbYysrXV0gPT09IHQpIHJldHVybiByOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgcyA9IGUoIi4vJC5nbG9iYWwiKSwKICAgICAgICAgIGEgPSBlKCIuLyQudGFzayIpLnNldCwKICAgICAgICAgIGMgPSBzLk11dGF0aW9uT2JzZXJ2ZXIgfHwgcy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLAogICAgICAgICAgdSA9IHMucHJvY2VzcywKICAgICAgICAgIGwgPSBzLlByb21pc2UsCiAgICAgICAgICBmID0gInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKSh1KSwKICAgICAgICAgIGQgPSBmdW5jdGlvbiBkKCkgewogICAgICAgIHZhciBlLCB0LCByO2ZvciAoZiAmJiAoZSA9IHUuZG9tYWluKSAmJiAodS5kb21haW4gPSBudWxsLCBlLmV4aXQoKSk7IG47KSB7CiAgICAgICAgICB0ID0gbi5kb21haW4sIHIgPSBuLmZuLCB0ICYmIHQuZW50ZXIoKSwgcigpLCB0ICYmIHQuZXhpdCgpLCBuID0gbi5uZXh0OwogICAgICAgIH1vID0gdm9pZCAwLCBlICYmIGUuZW50ZXIoKTsKICAgICAgfTtpZiAoZikgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgdS5uZXh0VGljayhkKTsKICAgICAgfTtlbHNlIGlmIChjKSB7CiAgICAgICAgdmFyIHAgPSAxLAogICAgICAgICAgICBiID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBjKGQpLm9ic2VydmUoYiwgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgICBiLmRhdGEgPSBwID0gLXA7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGkgPSBsICYmIGwucmVzb2x2ZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICBsLnJlc29sdmUoKS50aGVuKGQpOwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIGEuY2FsbChzLCBkKTsKICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0geyBmbjogZSwgbmV4dDogdm9pZCAwLCBkb21haW46IGYgJiYgdS5kb21haW4gfTtvICYmIChvLm5leHQgPSB0KSwgbiB8fCAobiA9IHQsIGkoKSksIG8gPSB0OwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwLCAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnRhc2siOiA3MiB9XSwgNjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vJC5mYWlscyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIgPSAoby5PYmplY3QgfHwge30pW2VdIHx8IE9iamVjdFtlXSwKICAgICAgICAgICAgcyA9IHt9O3NbZV0gPSB0KHIpLCBuKG4uUyArIG4uRiAqIGkoZnVuY3Rpb24gKCkgewogICAgICAgICAgcigxKTsKICAgICAgICB9KSwgIk9iamVjdCIsIHMpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvcmUiOiAzMSwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mYWlscyI6IDM4IH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZSksIGNvbmZpZ3VyYWJsZTogISgyICYgZSksIHdyaXRhYmxlOiAhKDQgJiBlKSwgdmFsdWU6IHQgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5yZWRlZmluZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciBpbiB0KSB7CiAgICAgICAgICBuKGUsIHIsIHRbcl0pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5yZWRlZmluZSI6IDYzIH1dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5oaWRlIik7CiAgICB9LCB7ICIuLyQuaGlkZSI6IDQzIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBlID09PSB0ID8gMCAhPT0gZSB8fCAxIC8gZSA9PT0gMSAvIHQgOiBlICE9IGUgJiYgdCAhPSB0OwogICAgICB9OwogICAgfSwge31dLCA2NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuZ2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoZSwgdCkgewogICAgICAgIGlmIChpKGUpLCAhbyh0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbyA9IGUoIi4vJC5jdHgiKShGdW5jdGlvbi5jYWxsLCBuKE9iamVjdC5wcm90b3R5cGUsICJfX3Byb3RvX18iKS5zZXQsIDIpLCBvKHQsIFtdKSwgciA9ICEodCBpbnN0YW5jZW9mIEFycmF5KTsKICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgciA9ICEwOwogICAgICAgICAgfXJldHVybiBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gcyhlLCB0KSwgciA/IGUuX19wcm90b19fID0gdCA6IG8oZSwgdCksIGU7CiAgICAgICAgICB9OwogICAgICAgIH0oe30sICExKSA6IHZvaWQgMCksIGNoZWNrOiBzIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgNjY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvcmUiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZGVzY3JpcHRvcnMiKSwKICAgICAgICAgIHMgPSBlKCIuLyQud2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gbltlXTtpICYmIHQgJiYgIXRbc10gJiYgby5zZXREZXNjKHQsIHMsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSB9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLndrcyI6IDc4IH1dLCA2NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuc2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZSAmJiAhbyhlID0gciA/IGUgOiBlLnByb3RvdHlwZSwgaSkgJiYgbihlLCBpLCB7IGNvbmZpZ3VyYWJsZTogITAsIHZhbHVlOiB0IH0pOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuaGFzIjogNDIsICIuLyQud2tzIjogNzggfV0sIDY4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBvID0gIl9fY29yZS1qc19zaGFyZWRfXyIsCiAgICAgICAgICBpID0gbltvXSB8fCAobltvXSA9IHt9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpW2VdIHx8IChpW2VdID0ge30pOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxIH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5hLWZ1bmN0aW9uIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG4oZSkuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMCA9PT0gcyB8fCB2b2lkIDAgPT0gKHIgPSBuKHMpW2ldKSA/IHQgOiBvKHIpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmEtZnVuY3Rpb24iOiAyNiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC53a3MiOiA3OCB9XSwgNzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSkgdGhyb3cgVHlwZUVycm9yKHIgKyAiOiB1c2UgdGhlICduZXcnIG9wZXJhdG9yISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGEgPSBTdHJpbmcobyh0KSksCiAgICAgICAgICAgICAgYyA9IG4ociksCiAgICAgICAgICAgICAgdSA9IGEubGVuZ3RoO3JldHVybiAwID4gYyB8fCBjID49IHUgPyBlID8gIiIgOiB2b2lkIDAgOiAoaSA9IGEuY2hhckNvZGVBdChjKSwgNTUyOTYgPiBpIHx8IGkgPiA1NjMxOSB8fCBjICsgMSA9PT0gdSB8fCAocyA9IGEuY2hhckNvZGVBdChjICsgMSkpIDwgNTYzMjAgfHwgcyA+IDU3MzQzID8gZSA/IGEuY2hhckF0KGMpIDogaSA6IGUgPyBhLnNsaWNlKGMsIGMgKyAyKSA6IChpIC0gNTUyOTYgPDwgMTApICsgKHMgLSA1NjMyMCkgKyA2NTUzNik7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQudG8taW50ZWdlciI6IDczIH1dLCA3MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBzID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYSA9IGUoIi4vJC5pbnZva2UiKSwKICAgICAgICAgIGMgPSBlKCIuLyQuaHRtbCIpLAogICAgICAgICAgdSA9IGUoIi4vJC5kb20tY3JlYXRlIiksCiAgICAgICAgICBsID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgZiA9IGwucHJvY2VzcywKICAgICAgICAgIGQgPSBsLnNldEltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBsLmNsZWFySW1tZWRpYXRlLAogICAgICAgICAgYiA9IGwuTWVzc2FnZUNoYW5uZWwsCiAgICAgICAgICBoID0gMCwKICAgICAgICAgIHYgPSB7fSwKICAgICAgICAgIHkgPSAib25yZWFkeXN0YXRlY2hhbmdlIiwKICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKCkgewogICAgICAgIHZhciBlID0gK3RoaXM7aWYgKHYuaGFzT3duUHJvcGVydHkoZSkpIHsKICAgICAgICAgIHZhciB0ID0gdltlXTtkZWxldGUgdltlXSwgdCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIGcgPSBmdW5jdGlvbiBnKGUpIHsKICAgICAgICBfLmNhbGwoZS5kYXRhKTsKICAgICAgfTtkICYmIHAgfHwgKGQgPSBmdW5jdGlvbiBkKGUpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIHIgPSAxOyBhcmd1bWVudHMubGVuZ3RoID4gcjspIHsKICAgICAgICAgIHQucHVzaChhcmd1bWVudHNbcisrXSk7CiAgICAgICAgfXJldHVybiB2WysraF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBhKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogRnVuY3Rpb24oZSksIHQpOwogICAgICAgIH0sIG4oaCksIGg7CiAgICAgIH0sIHAgPSBmdW5jdGlvbiBwKGUpIHsKICAgICAgICBkZWxldGUgdltlXTsKICAgICAgfSwgInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKShmKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBmLm5leHRUaWNrKHMoXywgZSwgMSkpOwogICAgICB9IDogYiA/IChvID0gbmV3IGIoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gZywgbiA9IHMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogbC5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFsLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGwucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBsLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBnLCAhMSkpIDogbiA9IHkgaW4gdSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIGMuYXBwZW5kQ2hpbGQodSgic2NyaXB0IikpW3ldID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgYy5yZW1vdmVDaGlsZCh0aGlzKSwgXy5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQocyhfLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogZCwgY2xlYXI6IHAgfTsKICAgIH0sIHsgIi4vJC5jb2YiOiAzMCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5kb20tY3JlYXRlIjogMzUsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaHRtbCI6IDQ0LCAiLi8kLmludm9rZSI6IDQ1IH1dLCA3MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gTWF0aC5jZWlsLAogICAgICAgICAgbyA9IE1hdGguZmxvb3I7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaXNOYU4oZSA9ICtlKSA/IDAgOiAoZSA+IDAgPyBvIDogbikoZSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQuaW9iamVjdCI6IDQ2IH1dLCA3NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBNYXRoLm1pbjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlID4gMCA/IG8obihlKSwgOTAwNzE5OTI1NDc0MDk5MSkgOiAwOwogICAgICB9OwogICAgfSwgeyAiLi8kLnRvLWludGVnZXIiOiA3MyB9XSwgNzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmRlZmluZWQiOiAzMyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IDAsCiAgICAgICAgICBvID0gTWF0aC5yYW5kb20oKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIuY29uY2F0KHZvaWQgMCA9PT0gZSA/ICIiIDogZSwgIilfIiwgKCsrbiArIG8pLnRvU3RyaW5nKDM2KSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC51aWQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZ2xvYmFsIikuU3ltYm9sO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBpICYmIGlbZV0gfHwgKGkgfHwgbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnVpZCI6IDc3IH1dLCA3OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNsYXNzb2YiKSwKICAgICAgICAgIG8gPSBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBpID0gZSgiLi8kLml0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vJC5jb3JlIikuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT0gZSA/IGVbb10gfHwgZVsiQEBpdGVyYXRvciJdIHx8IGlbbihlKV0gOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY2xhc3NvZiI6IDI5LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vJC53a3MiOiA3OCB9XSwgODA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmFkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC5pdGVyLXN0ZXAiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi8kLnRvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuLyQuaXRlci1kZWZpbmUiKShBcnJheSwgIkFycmF5IiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0aGlzLl90ID0gcyhlKSwgdGhpcy5faSA9IDAsIHRoaXMuX2sgPSB0OwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl90LAogICAgICAgICAgICB0ID0gdGhpcy5faywKICAgICAgICAgICAgciA9IHRoaXMuX2krKztyZXR1cm4gIWUgfHwgciA+PSBlLmxlbmd0aCA/ICh0aGlzLl90ID0gdm9pZCAwLCBvKDEpKSA6ICJrZXlzIiA9PSB0ID8gbygwLCByKSA6ICJ2YWx1ZXMiID09IHQgPyBvKDAsIGVbcl0pIDogbygwLCBbciwgZVtyXV0pOwogICAgICB9LCAidmFsdWVzIiksIGkuQXJndW1lbnRzID0gaS5BcnJheSwgbigia2V5cyIpLCBuKCJ2YWx1ZXMiKSwgbigiZW50cmllcyIpOwogICAgfSwgeyAiLi8kLmFkZC10by11bnNjb3BhYmxlcyI6IDI3LCAiLi8kLml0ZXItZGVmaW5lIjogNTIsICIuLyQuaXRlci1zdGVwIjogNTQsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA4MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgcmV0dXJuIGUobih0KSwgcik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQub2JqZWN0LXNhcCI6IDYwLCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgODI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1vYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRQcm90b3R5cGVPZiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDgzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQudG8tb2JqZWN0Iik7ZSgiLi8kLm9iamVjdC1zYXAiKSgia2V5cyIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDg0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZXhwb3J0Iik7bihuLlMsICJPYmplY3QiLCB7IHNldFByb3RvdHlwZU9mOiBlKCIuLyQuc2V0LXByb3RvIikuc2V0IH0pOwogICAgfSwgeyAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLnNldC1wcm90byI6IDY1IH1dLCA4NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7fSwge31dLCA4NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4sCiAgICAgICAgICBvID0gZSgiLi8kIiksCiAgICAgICAgICBpID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIHMgPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBhID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYyA9IGUoIi4vJC5jbGFzc29mIiksCiAgICAgICAgICB1ID0gZSgiLi8kLmV4cG9ydCIpLAogICAgICAgICAgbCA9IGUoIi4vJC5pcy1vYmplY3QiKSwKICAgICAgICAgIGYgPSBlKCIuLyQuYW4tb2JqZWN0IiksCiAgICAgICAgICBkID0gZSgiLi8kLmEtZnVuY3Rpb24iKSwKICAgICAgICAgIHAgPSBlKCIuLyQuc3RyaWN0LW5ldyIpLAogICAgICAgICAgYiA9IGUoIi4vJC5mb3Itb2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuc2V0LXByb3RvIikuc2V0LAogICAgICAgICAgdiA9IGUoIi4vJC5zYW1lLXZhbHVlIiksCiAgICAgICAgICB5ID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIiksCiAgICAgICAgICBfID0gZSgiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiKSwKICAgICAgICAgIGcgPSBlKCIuLyQubWljcm90YXNrIiksCiAgICAgICAgICBtID0gIlByb21pc2UiLAogICAgICAgICAgaiA9IHMucHJvY2VzcywKICAgICAgICAgICQgPSAicHJvY2VzcyIgPT0gYyhqKSwKICAgICAgICAgIF9PID0gc1ttXSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBfTyhmdW5jdGlvbiAoKSB7fSk7cmV0dXJuIGUgJiYgKHQuY29uc3RydWN0b3IgPSBPYmplY3QpLCBfTy5yZXNvbHZlKHQpID09PSB0OwogICAgICB9LAogICAgICAgICAgayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiB0KGUpIHsKICAgICAgICAgIHZhciByID0gbmV3IF9PKGUpO3JldHVybiBoKHIsIHQucHJvdG90eXBlKSwgcjsKICAgICAgICB9dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgaWYgKHIgPSBfTyAmJiBfTy5yZXNvbHZlICYmIHcoKSwgaCh0LCBfTyksIHQucHJvdG90eXBlID0gby5jcmVhdGUoX08ucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiB0IH0gfSksIHQucmVzb2x2ZSg1KS50aGVuKGZ1bmN0aW9uICgpIHt9KSBpbnN0YW5jZW9mIHQgfHwgKHIgPSAhMSksIHIgJiYgZSgiLi8kLmRlc2NyaXB0b3JzIikpIHsKICAgICAgICAgICAgdmFyIG4gPSAhMTtfTy5yZXNvbHZlKG8uc2V0RGVzYyh7fSwgInRoZW4iLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgbiA9ICEwOwogICAgICAgICAgICAgIH0gfSkpLCByID0gbjsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICByID0gITE7CiAgICAgICAgfXJldHVybiByOwogICAgICB9KCksCiAgICAgICAgICB4ID0gZnVuY3Rpb24geChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGkgJiYgZSA9PT0gX08gJiYgdCA9PT0gbiA/ICEwIDogdihlLCB0KTsKICAgICAgfSwKICAgICAgICAgIEMgPSBmdW5jdGlvbiBDKGUpIHsKICAgICAgICB2YXIgdCA9IGYoZSlbeV07cmV0dXJuIHZvaWQgMCAhPSB0ID8gdCA6IGU7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdmFyIHQ7cmV0dXJuIGwoZSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHQgPSBlLnRoZW4pID8gdCA6ICExOwogICAgICB9LAogICAgICAgICAgUyA9IGZ1bmN0aW9uIFMoZSkgewogICAgICAgIHZhciB0LCByO3RoaXMucHJvbWlzZSA9IG5ldyBlKGZ1bmN0aW9uIChlLCBuKSB7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSB0IHx8IHZvaWQgMCAhPT0gcikgdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO3QgPSBlLCByID0gbjsKICAgICAgICB9KSwgdGhpcy5yZXNvbHZlID0gZCh0KSwgdGhpcy5yZWplY3QgPSBkKHIpOwogICAgICB9LAogICAgICAgICAgVCA9IGZ1bmN0aW9uIFQoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBlKCk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHQgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBNID0gZnVuY3Rpb24gTShlLCB0KSB7CiAgICAgICAgaWYgKCFlLm4pIHsKICAgICAgICAgIGUubiA9ICEwO3ZhciByID0gZS5jO2coZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0gZS52LCBvID0gMSA9PSBlLnMsIGkgPSAwLCBhID0gZnVuY3Rpb24gYSh0KSB7CiAgICAgICAgICAgICAgdmFyIHIsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIHMgPSBvID8gdC5vayA6IHQuZmFpbCwKICAgICAgICAgICAgICAgICAgYSA9IHQucmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgYyA9IHQucmVqZWN0O3RyeSB7CiAgICAgICAgICAgICAgICBzID8gKG8gfHwgKGUuaCA9ICEwKSwgciA9IHMgPT09ICEwID8gbiA6IHMobiksIHIgPT09IHQucHJvbWlzZSA/IGMoVHlwZUVycm9yKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBFKHIpKSA/IGkuY2FsbChyLCBhLCBjKSA6IGEocikpIDogYyhuKTsKICAgICAgICAgICAgICB9IGNhdGNoICh1KSB7CiAgICAgICAgICAgICAgICBjKHUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGEocltpKytdKTsKICAgICAgICAgICAgfXIubGVuZ3RoID0gMCwgZS5uID0gITEsIHQgJiYgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQsCiAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgIG8gPSBlLnA7TihvKSAmJiAoJCA/IGouZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIiwgbiwgbykgOiAodCA9IHMub251bmhhbmRsZWRyZWplY3Rpb24pID8gdCh7IHByb21pc2U6IG8sIHJlYXNvbjogbiB9KSA6IChyID0gcy5jb25zb2xlKSAmJiByLmVycm9yICYmIHIuZXJyb3IoIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsIG4pKSwgZS5hID0gdm9pZCAwOwogICAgICAgICAgICB9LCAxKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIE4gPSBmdW5jdGlvbiBOKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUuX2QsCiAgICAgICAgICAgIG4gPSByLmEgfHwgci5jLAogICAgICAgICAgICBvID0gMDtpZiAoci5oKSByZXR1cm4gITE7Zm9yICg7IG4ubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGlmICh0ID0gbltvKytdLCB0LmZhaWwgfHwgIU4odC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuZCB8fCAodC5kID0gITAsIHQgPSB0LnIgfHwgdCwgdC52ID0gZSwgdC5zID0gMiwgdC5hID0gdC5jLnNsaWNlKCksIE0odCwgITApKTsKICAgICAgfSwKICAgICAgICAgIEQgPSBmdW5jdGlvbiBEKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IHRoaXM7aWYgKCFyLmQpIHsKICAgICAgICAgIHIuZCA9ICEwLCByID0gci5yIHx8IHI7dHJ5IHsKICAgICAgICAgICAgaWYgKHIucCA9PT0gZSkgdGhyb3cgVHlwZUVycm9yKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOyh0ID0gRShlKSkgPyBnKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgcjogciwgZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIGEoRCwgbiwgMSksIGEoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIudiA9IGUsIHIucyA9IDEsIE0ociwgITEpKTsKICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgUi5jYWxsKHsgcjogciwgZDogITEgfSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9O2sgfHwgKF9PID0gZnVuY3Rpb24gTyhlKSB7CiAgICAgICAgZChlKTt2YXIgdCA9IHRoaXMuX2QgPSB7IHA6IHAodGhpcywgX08sIG0pLCBjOiBbXSwgYTogdm9pZCAwLCBzOiAwLCBkOiAhMSwgdjogdm9pZCAwLCBoOiAhMSwgbjogITEgfTt0cnkgewogICAgICAgICAgZShhKEQsIHQsIDEpLCBhKFIsIHQsIDEpKTsKICAgICAgICB9IGNhdGNoIChyKSB7CiAgICAgICAgICBSLmNhbGwodCwgcik7CiAgICAgICAgfQogICAgICB9LCBlKCIuLyQucmVkZWZpbmUtYWxsIikoX08ucHJvdG90eXBlLCB7IHRoZW46IGZ1bmN0aW9uIHRoZW4oZSwgdCkgewogICAgICAgICAgdmFyIHIgPSBuZXcgUyhfKHRoaXMsIF9PKSksCiAgICAgICAgICAgICAgbiA9IHIucHJvbWlzZSwKICAgICAgICAgICAgICBvID0gdGhpcy5fZDtyZXR1cm4gci5vayA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogITAsIHIuZmFpbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdCwgby5jLnB1c2gociksIG8uYSAmJiBvLmEucHVzaChyKSwgby5zICYmIE0obywgITEpLCBuOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSksIHUodS5HICsgdS5XICsgdS5GICogIWssIHsgUHJvbWlzZTogX08gfSksIGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpKF9PLCBtKSwgZSgiLi8kLnNldC1zcGVjaWVzIikobSksIG4gPSBlKCIuLyQuY29yZSIpW21dLCB1KHUuUyArIHUuRiAqICFrLCBtLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gbmV3IFModGhpcyksCiAgICAgICAgICAgICAgciA9IHQucmVqZWN0O3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgdSh1LlMgKyB1LkYgKiAoIWsgfHwgdyghMCkpLCBtLCB7IHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoZSkgewogICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfTyAmJiB4KGUuY29uc3RydWN0b3IsIHRoaXMpKSByZXR1cm4gZTt2YXIgdCA9IG5ldyBTKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCB1KHUuUyArIHUuRiAqICEoayAmJiBlKCIuLyQuaXRlci1kZXRlY3QiKShmdW5jdGlvbiAoZSkgewogICAgICAgIF9PLmFsbChlKVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0pKSwgbSwgeyBhbGw6IGZ1bmN0aW9uIGFsbChlKSB7CiAgICAgICAgICB2YXIgdCA9IEModGhpcyksCiAgICAgICAgICAgICAgciA9IG5ldyBTKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgaSA9IHIucmVqZWN0LAogICAgICAgICAgICAgIHMgPSBbXSwKICAgICAgICAgICAgICBhID0gVChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGIoZSwgITEsIHMucHVzaCwgcyk7dmFyIHIgPSBzLmxlbmd0aCwKICAgICAgICAgICAgICAgIGEgPSBBcnJheShyKTtyID8gby5lYWNoLmNhbGwocywgZnVuY3Rpb24gKGUsIG8pIHsKICAgICAgICAgICAgICB2YXIgcyA9ICExO3QucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBzIHx8IChzID0gITAsIGFbb10gPSBlLCAtLXIgfHwgbihhKSk7CiAgICAgICAgICAgICAgfSwgaSk7CiAgICAgICAgICAgIH0pIDogbihhKTsKICAgICAgICAgIH0pO3JldHVybiBhICYmIGkoYS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gQyh0aGlzKSwKICAgICAgICAgICAgICByID0gbmV3IFModCksCiAgICAgICAgICAgICAgbiA9IHIucmVqZWN0LAogICAgICAgICAgICAgIG8gPSBUKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYihlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB0LnJlc29sdmUoZSkudGhlbihyLnJlc29sdmUsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pO3JldHVybiBvICYmIG4oby5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9IH0pOwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuYS1mdW5jdGlvbiI6IDI2LCAiLi8kLmFuLW9iamVjdCI6IDI4LCAiLi8kLmNsYXNzb2YiOiAyOSwgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZGVzY3JpcHRvcnMiOiAzNCwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mb3Itb2YiOiAzOSwgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSwgIi4vJC5pdGVyLWRldGVjdCI6IDUzLCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5taWNyb3Rhc2siOiA1OSwgIi4vJC5yZWRlZmluZS1hbGwiOiA2MiwgIi4vJC5zYW1lLXZhbHVlIjogNjQsICIuLyQuc2V0LXByb3RvIjogNjUsICIuLyQuc2V0LXNwZWNpZXMiOiA2NiwgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiOiA2OSwgIi4vJC5zdHJpY3QtbmV3IjogNzAsICIuLyQud2tzIjogNzggfV0sIDg3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5zdHJpbmctYXQiKSghMCk7ZSgiLi8kLml0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5pdGVyLWRlZmluZSI6IDUyLCAiLi8kLnN0cmluZy1hdCI6IDcxIH1dLCA4ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBpID0gZSgiLi8kLmhhcyIpLAogICAgICAgICAgcyA9IGUoIi4vJC5kZXNjcmlwdG9ycyIpLAogICAgICAgICAgYSA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIGMgPSBlKCIuLyQucmVkZWZpbmUiKSwKICAgICAgICAgIHUgPSBlKCIuLyQuZmFpbHMiKSwKICAgICAgICAgIGwgPSBlKCIuLyQuc2hhcmVkIiksCiAgICAgICAgICBmID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBkID0gZSgiLi8kLnVpZCIpLAogICAgICAgICAgcCA9IGUoIi4vJC53a3MiKSwKICAgICAgICAgIGIgPSBlKCIuLyQua2V5b2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuZ2V0LW5hbWVzIiksCiAgICAgICAgICB2ID0gZSgiLi8kLmVudW0ta2V5cyIpLAogICAgICAgICAgeSA9IGUoIi4vJC5pcy1hcnJheSIpLAogICAgICAgICAgXyA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIGcgPSBlKCIuLyQudG8taW9iamVjdCIpLAogICAgICAgICAgbSA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBqID0gbi5nZXREZXNjLAogICAgICAgICAgJCA9IG4uc2V0RGVzYywKICAgICAgICAgIE8gPSBuLmNyZWF0ZSwKICAgICAgICAgIHcgPSBoLmdldCwKICAgICAgICAgIGsgPSBvLlN5bWJvbCwKICAgICAgICAgIHggPSBvLkpTT04sCiAgICAgICAgICBDID0geCAmJiB4LnN0cmluZ2lmeSwKICAgICAgICAgIEUgPSAhMSwKICAgICAgICAgIFMgPSBwKCJfaGlkZGVuIiksCiAgICAgICAgICBUID0gbi5pc0VudW0sCiAgICAgICAgICBNID0gbCgic3ltYm9sLXJlZ2lzdHJ5IiksCiAgICAgICAgICBOID0gbCgic3ltYm9scyIpLAogICAgICAgICAgUiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGssCiAgICAgICAgICBEID0gT2JqZWN0LnByb3RvdHlwZSwKICAgICAgICAgIFAgPSBzICYmIHUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE8oJCh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gJCh0aGlzLCAiYSIsIHsgdmFsdWU6IDcgfSkuYTsKICAgICAgICAgIH0gfSkpLmE7CiAgICAgIH0pID8gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IGooRCwgdCk7biAmJiBkZWxldGUgRFt0XSwgJChlLCB0LCByKSwgbiAmJiBlICE9PSBEICYmICQoRCwgdCwgbik7CiAgICAgIH0gOiAkLAogICAgICAgICAgQSA9IGZ1bmN0aW9uIEEoZSkgewogICAgICAgIHZhciB0ID0gTltlXSA9IE8oay5wcm90b3R5cGUpO3JldHVybiB0Ll9rID0gZSwgcyAmJiBFICYmIFAoRCwgZSwgeyBjb25maWd1cmFibGU6ICEwLCBzZXQ6IGZ1bmN0aW9uIHNldCh0KSB7CiAgICAgICAgICAgIGkodGhpcywgUykgJiYgaSh0aGlzW1NdLCBlKSAmJiAodGhpc1tTXVtlXSA9ICExKSwgUCh0aGlzLCBlLCBtKDEsIHQpKTsKICAgICAgICAgIH0gfSksIHQ7CiAgICAgIH0sCiAgICAgICAgICBMID0gZnVuY3Rpb24gTChlKSB7CiAgICAgICAgcmV0dXJuICJzeW1ib2wiID09ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpOwogICAgICB9LAogICAgICAgICAgSSA9IGZ1bmN0aW9uIEkoZSwgdCwgcikgewogICAgICAgIHJldHVybiByICYmIGkoTiwgdCkgPyAoci5lbnVtZXJhYmxlID8gKGkoZSwgUykgJiYgZVtTXVt0XSAmJiAoZVtTXVt0XSA9ICExKSwgciA9IE8ociwgeyBlbnVtZXJhYmxlOiBtKDAsICExKSB9KSkgOiAoaShlLCBTKSB8fCAkKGUsIFMsIG0oMSwge30pKSwgZVtTXVt0XSA9ICEwKSwgUChlLCB0LCByKSkgOiAkKGUsIHQsIHIpOwogICAgICB9LAogICAgICAgICAgRiA9IGZ1bmN0aW9uIEYoZSwgdCkgewogICAgICAgIF8oZSk7Zm9yICh2YXIgciwgbiA9IHYodCA9IGcodCkpLCBvID0gMCwgaSA9IG4ubGVuZ3RoOyBpID4gbzspIHsKICAgICAgICAgIEkoZSwgciA9IG5bbysrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9LAogICAgICAgICAgViA9IGZ1bmN0aW9uIFYoZSwgdCkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IHQgPyBPKGUpIDogRihPKGUpLCB0KTsKICAgICAgfSwKICAgICAgICAgIHogPSBmdW5jdGlvbiB6KGUpIHsKICAgICAgICB2YXIgdCA9IFQuY2FsbCh0aGlzLCBlKTtyZXR1cm4gdCB8fCAhaSh0aGlzLCBlKSB8fCAhaShOLCBlKSB8fCBpKHRoaXMsIFMpICYmIHRoaXNbU11bZV0gPyB0IDogITA7CiAgICAgIH0sCiAgICAgICAgICBVID0gZnVuY3Rpb24gVShlLCB0KSB7CiAgICAgICAgdmFyIHIgPSBqKGUgPSBnKGUpLCB0KTtyZXR1cm4gIXIgfHwgIWkoTiwgdCkgfHwgaShlLCBTKSAmJiBlW1NdW3RdIHx8IChyLmVudW1lcmFibGUgPSAhMCksIHI7CiAgICAgIH0sCiAgICAgICAgICBIID0gZnVuY3Rpb24gSChlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgfHwgdCA9PSBTIHx8IG4ucHVzaCh0KTsKICAgICAgICB9cmV0dXJuIG47CiAgICAgIH0sCiAgICAgICAgICBCID0gZnVuY3Rpb24gQihlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgJiYgbi5wdXNoKE5bdF0pOwogICAgICAgIH1yZXR1cm4gbjsKICAgICAgfSwKICAgICAgICAgIEogPSBmdW5jdGlvbiBKKGUpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBlICYmICFMKGUpKSB7CiAgICAgICAgICBmb3IgKHZhciB0LCByLCBuID0gW2VdLCBvID0gMSwgaSA9IGFyZ3VtZW50czsgaS5sZW5ndGggPiBvOykgewogICAgICAgICAgICBuLnB1c2goaVtvKytdKTsKICAgICAgICAgIH1yZXR1cm4gdCA9IG5bMV0sICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgKHIgPSB0KSwgIXIgJiYgeSh0KSB8fCAodCA9IGZ1bmN0aW9uIHQoZSwgX3QyKSB7CiAgICAgICAgICAgIHJldHVybiByICYmIChfdDIgPSByLmNhbGwodGhpcywgZSwgX3QyKSksIEwoX3QyKSA/IHZvaWQgMCA6IF90MjsKICAgICAgICAgIH0pLCBuWzFdID0gdCwgQy5hcHBseSh4LCBuKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBXID0gdShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBrKCk7cmV0dXJuICJbbnVsbF0iICE9IEMoW2VdKSB8fCAie30iICE9IEMoeyBhOiBlIH0pIHx8ICJ7fSIgIT0gQyhPYmplY3QoZSkpOwogICAgICB9KTtSIHx8IChrID0gZnVuY3Rpb24gaygpIHsKICAgICAgICBpZiAoTCh0aGlzKSkgdGhyb3cgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKTtyZXR1cm4gQShkKGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdm9pZCAwKSk7CiAgICAgIH0sIGMoay5wcm90b3R5cGUsICJ0b1N0cmluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fazsKICAgICAgfSksIEwgPSBmdW5jdGlvbiBMKGUpIHsKICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIGs7CiAgICAgIH0sIG4uY3JlYXRlID0gViwgbi5pc0VudW0gPSB6LCBuLmdldERlc2MgPSBVLCBuLnNldERlc2MgPSBJLCBuLnNldERlc2NzID0gRiwgbi5nZXROYW1lcyA9IGguZ2V0ID0gSCwgbi5nZXRTeW1ib2xzID0gQiwgcyAmJiAhZSgiLi8kLmxpYnJhcnkiKSAmJiBjKEQsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsIHosICEwKSk7dmFyIFkgPSB7ICJmb3IiOiBmdW5jdGlvbiBfZm9yKGUpIHsKICAgICAgICAgIHJldHVybiBpKE0sIGUgKz0gIiIpID8gTVtlXSA6IE1bZV0gPSBrKGUpOwogICAgICAgIH0sIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKGUpIHsKICAgICAgICAgIHJldHVybiBiKE0sIGUpOwogICAgICAgIH0sIHVzZVNldHRlcjogZnVuY3Rpb24gdXNlU2V0dGVyKCkgewogICAgICAgICAgRSA9ICEwOwogICAgICAgIH0sIHVzZVNpbXBsZTogZnVuY3Rpb24gdXNlU2ltcGxlKCkgewogICAgICAgICAgRSA9ICExOwogICAgICAgIH0gfTtuLmVhY2guY2FsbCgiaGFzSW5zdGFuY2UsaXNDb25jYXRTcHJlYWRhYmxlLGl0ZXJhdG9yLG1hdGNoLHJlcGxhY2Usc2VhcmNoLHNwZWNpZXMsc3BsaXQsdG9QcmltaXRpdmUsdG9TdHJpbmdUYWcsdW5zY29wYWJsZXMiLnNwbGl0KCIsIiksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBwKGUpO1lbZV0gPSBSID8gdCA6IEEodCk7CiAgICAgIH0pLCBFID0gITAsIGEoYS5HICsgYS5XLCB7IFN5bWJvbDogayB9KSwgYShhLlMsICJTeW1ib2wiLCBZKSwgYShhLlMgKyBhLkYgKiAhUiwgIk9iamVjdCIsIHsgY3JlYXRlOiBWLCBkZWZpbmVQcm9wZXJ0eTogSSwgZGVmaW5lUHJvcGVydGllczogRiwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBVLCBnZXRPd25Qcm9wZXJ0eU5hbWVzOiBILCBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6IEIgfSksIHggJiYgYShhLlMgKyBhLkYgKiAoIVIgfHwgVyksICJKU09OIiwgeyBzdHJpbmdpZnk6IEogfSksIGYoaywgIlN5bWJvbCIpLCBmKE1hdGgsICJNYXRoIiwgITApLCBmKG8uSlNPTiwgIkpTT04iLCAhMCk7CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLmVudW0ta2V5cyI6IDM2LCAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLmZhaWxzIjogMzgsICIuLyQuZ2V0LW5hbWVzIjogNDAsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaGFzIjogNDIsICIuLyQuaXMtYXJyYXkiOiA0OCwgIi4vJC5rZXlvZiI6IDU3LCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQucmVkZWZpbmUiOiA2MywgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnRvLWlvYmplY3QiOiA3NCwgIi4vJC51aWQiOiA3NywgIi4vJC53a3MiOiA3OCB9XSwgODk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO3ZhciBuID0gZSgiLi8kLml0ZXJhdG9ycyIpO24uTm9kZUxpc3QgPSBuLkhUTUxDb2xsZWN0aW9uID0gbi5BcnJheTsKICAgIH0sIHsgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vZXM2LmFycmF5Lml0ZXJhdG9yIjogODAgfV0sIDkwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZ1bmN0aW9uIHQoZSkgewogICAgICAgICAgdGhpcy5nID0gW10sIHRoaXMuayA9IGU7CiAgICAgICAgfWZ1bmN0aW9uIHIoZSkgewogICAgICAgICAgIWZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIHZhciBuID0gZS50YWtlUmVjb3JkcygpO24ubGVuZ3RoICYmIGUuayhuLCBlKSwgZS5mID0gc2V0VGltZW91dChyLCB0Ll9wZXJpb2QpOwogICAgICAgICAgfSgpOwogICAgICAgIH1mdW5jdGlvbiBuKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4gPSB7IHR5cGU6IG51bGwsIHRhcmdldDogbnVsbCwgYWRkZWROb2RlczogW10sIHJlbW92ZWROb2RlczogW10sIHByZXZpb3VzU2libGluZzogbnVsbCwgbmV4dFNpYmxpbmc6IG51bGwsIGF0dHJpYnV0ZU5hbWU6IG51bGwsIGF0dHJpYnV0ZU5hbWVzcGFjZTogbnVsbCwgb2xkVmFsdWU6IG51bGwgfTtmb3IgKHIgaW4gdCkgewogICAgICAgICAgICBuW3JdICE9PSBlICYmIHRbcl0gIT09IGUgJiYgKG5bcl0gPSB0W3JdKTsKICAgICAgICAgIH1yZXR1cm4gbjsKICAgICAgICB9ZnVuY3Rpb24gbyhlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IGEoZSwgdCk7cmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgICAgYyA9IG4ubGVuZ3RoO3QuYSAmJiByLmEgJiYgaShuLCBlLCByLmEsIHQuZCksICh0LmIgfHwgdC5lKSAmJiAobyA9IHMobiwgZSwgciwgdCkpLCAobyB8fCBuLmxlbmd0aCAhPT0gYykgJiYgKHIgPSBhKGUsIHQpKTsKICAgICAgICAgIH07CiAgICAgICAgfWZ1bmN0aW9uIGkodCwgciwgbywgaSkgewogICAgICAgICAgZm9yICh2YXIgcywgYSwgYyA9IHt9LCB1ID0gci5hdHRyaWJ1dGVzLCBsID0gdS5sZW5ndGg7IGwtLTspIHsKICAgICAgICAgICAgcyA9IHVbbF0sIGEgPSBzLm5hbWUsIGkgJiYgaVthXSA9PT0gZSB8fCAocy52YWx1ZSAhPT0gb1thXSAmJiB0LnB1c2gobih7IHR5cGU6ICJhdHRyaWJ1dGVzIiwgdGFyZ2V0OiByLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSwgYXR0cmlidXRlTmFtZXNwYWNlOiBzLm5hbWVzcGFjZVVSSSB9KSksIGNbYV0gPSAhMCk7CiAgICAgICAgICB9Zm9yIChhIGluIG8pIHsKICAgICAgICAgICAgY1thXSB8fCB0LnB1c2gobih7IHRhcmdldDogciwgdHlwZTogImF0dHJpYnV0ZXMiLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfWZ1bmN0aW9uIHModCwgciwgbywgcykgewogICAgICAgICAgZnVuY3Rpb24gYShlLCByLCBvLCBhLCBjKSB7CiAgICAgICAgICAgIHZhciBsID0gZS5sZW5ndGggLSAxO2MgPSAtIH4oKGwgLSBjKSAvIDIpO2ZvciAodmFyIGYsIGQsIHA7IHAgPSBlLnBvcCgpOykgewogICAgICAgICAgICAgIGYgPSBvW3AuaF0sIGQgPSBhW3AuaV0sIHMuYiAmJiBjICYmIE1hdGguYWJzKHAuaCAtIHAuaSkgPj0gbCAmJiAodC5wdXNoKG4oeyB0eXBlOiAiY2hpbGRMaXN0IiwgdGFyZ2V0OiByLCBhZGRlZE5vZGVzOiBbZl0sIHJlbW92ZWROb2RlczogW2ZdLCBuZXh0U2libGluZzogZi5uZXh0U2libGluZywgcHJldmlvdXNTaWJsaW5nOiBmLnByZXZpb3VzU2libGluZyB9KSksIGMtLSksIHMuYSAmJiBkLmEgJiYgaSh0LCBmLCBkLmEsIHMuZCksIHMuYyAmJiAzID09PSBmLm5vZGVUeXBlICYmIGYubm9kZVZhbHVlICE9PSBkLmMgJiYgdC5wdXNoKG4oeyB0eXBlOiAiY2hhcmFjdGVyRGF0YSIsIHRhcmdldDogZiB9KSksIHMuZSAmJiB1KGYsIGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9ZnVuY3Rpb24gdShyLCBvKSB7CiAgICAgICAgICAgIGZvciAodmFyIGQsIHAsIGIsIGgsIHYsIHkgPSByLmNoaWxkTm9kZXMsIF8gPSBvLmIsIGcgPSB5Lmxlbmd0aCwgbSA9IF8gPyBfLmxlbmd0aCA6IDAsIGogPSAwLCAkID0gMCwgTyA9IDA7IGcgPiAkIHx8IG0gPiBPOykgewogICAgICAgICAgICAgIGggPSB5WyRdLCB2ID0gKGIgPSBfW09dKSAmJiBiLmosIGggPT09IHYgPyAocy5hICYmIGIuYSAmJiBpKHQsIGgsIGIuYSwgcy5kKSwgcy5jICYmIGIuYyAhPT0gZSAmJiBoLm5vZGVWYWx1ZSAhPT0gYi5jICYmIHQucHVzaChuKHsgdHlwZTogImNoYXJhY3RlckRhdGEiLCB0YXJnZXQ6IGggfSkpLCBwICYmIGEocCwgciwgeSwgXywgaiksIHMuZSAmJiAoaC5jaGlsZE5vZGVzLmxlbmd0aCB8fCBiLmIgJiYgYi5iLmxlbmd0aCkgJiYgdShoLCBiKSwgJCsrLCBPKyspIDogKGwgPSAhMCwgZCB8fCAoZCA9IHt9LCBwID0gW10pLCBoICYmIChkW2IgPSBjKGgpXSB8fCAoZFtiXSA9ICEwLCAtMSA9PT0gKGIgPSBmKF8sIGgsIE8sICJqIikpID8gcy5iICYmICh0LnB1c2gobih7IHR5cGU6ICJjaGlsZExpc3QiLCB0YXJnZXQ6IHIsIGFkZGVkTm9kZXM6IFtoXSwgbmV4dFNpYmxpbmc6IGgubmV4dFNpYmxpbmcsIHByZXZpb3VzU2libGluZzogaC5wcmV2aW91c1NpYmxpbmcgfSkpLCBqKyspIDogcC5wdXNoKHsgaDogJCwgaTogYiB9KSksICQrKyksIHYgJiYgdiAhPT0geVskXSAmJiAoZFtiID0gYyh2KV0gfHwgKGRbYl0gPSAhMCwgLTEgPT09IChiID0gZih5LCB2LCAkKSkgPyBzLmIgJiYgKHQucHVzaChuKHsgdHlwZTogImNoaWxkTGlzdCIsIHRhcmdldDogby5qLCByZW1vdmVkTm9kZXM6IFt2XSwgbmV4dFNpYmxpbmc6IF9bTyArIDFdLCBwcmV2aW91c1NpYmxpbmc6IF9bTyAtIDFdIH0pKSwgai0tKSA6IHAucHVzaCh7IGg6IGIsIGk6IE8gfSkpLCBPKyspKTsKICAgICAgICAgICAgfXAgJiYgYShwLCByLCB5LCBfLCBqKTsKICAgICAgICAgIH12YXIgbDtyZXR1cm4gdShyLCBvKSwgbDsKICAgICAgICB9ZnVuY3Rpb24gYShlLCB0KSB7CiAgICAgICAgICB2YXIgciA9ICEwO3JldHVybiBmdW5jdGlvbiBuKGUpIHsKICAgICAgICAgICAgdmFyIG8gPSB7IGo6IGUgfTtyZXR1cm4gIXQuYyB8fCAzICE9PSBlLm5vZGVUeXBlICYmIDggIT09IGUubm9kZVR5cGUgPyAodC5hICYmIHIgJiYgMSA9PT0gZS5ub2RlVHlwZSAmJiAoby5hID0gbChlLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQuZCAmJiAhdC5kW3IubmFtZV0gfHwgKGVbci5uYW1lXSA9IHIudmFsdWUpLCBlOwogICAgICAgICAgICB9KSksIHIgJiYgKHQuYiB8fCB0LmMgfHwgdC5hICYmIHQuZSkgJiYgKG8uYiA9IHUoZS5jaGlsZE5vZGVzLCBuKSksIHIgPSB0LmUpIDogby5jID0gZS5ub2RlVmFsdWUsIG87CiAgICAgICAgICB9KGUpOwogICAgICAgIH1mdW5jdGlvbiBjKGUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBlLmlkIHx8IChlLm1vX2lkID0gZS5tb19pZCB8fCBkKyspOwogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBjYXRjaCAocikgewogICAgICAgICAgICAgIHJldHVybiBkKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9ZnVuY3Rpb24gdShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByW25dID0gdChlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gbChlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0ge30sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByID0gdChyLCBlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gZihlLCB0LCByLCBuKSB7CiAgICAgICAgICBmb3IgKDsgciA8IGUubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgaWYgKChuID8gZVtyXVtuXSA6IGVbcl0pID09PSB0KSByZXR1cm4gcjsKICAgICAgICAgIH1yZXR1cm4gLTE7CiAgICAgICAgfXQuX3BlcmlvZCA9IDMwLCB0LnByb3RvdHlwZSA9IHsgb2JzZXJ2ZTogZnVuY3Rpb24gb2JzZXJ2ZShlLCB0KSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSB7IGE6ICEhKHQuYXR0cmlidXRlcyB8fCB0LmF0dHJpYnV0ZUZpbHRlciB8fCB0LmF0dHJpYnV0ZU9sZFZhbHVlKSwgYjogISF0LmNoaWxkTGlzdCwgZTogISF0LnN1YnRyZWUsIGM6ICEoIXQuY2hhcmFjdGVyRGF0YSAmJiAhdC5jaGFyYWN0ZXJEYXRhT2xkVmFsdWUpIH0sIGkgPSB0aGlzLmcsIHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgIGlbc10ubSA9PT0gZSAmJiBpLnNwbGljZShzLCAxKTsKICAgICAgICAgICAgfXQuYXR0cmlidXRlRmlsdGVyICYmIChuLmQgPSBsKHQuYXR0cmlidXRlRmlsdGVyLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHJldHVybiBlW3RdID0gITAsIGU7CiAgICAgICAgICAgIH0pKSwgaS5wdXNoKHsgbTogZSwgbDogbyhlLCBuKSB9KSwgdGhpcy5mIHx8IHIodGhpcyk7CiAgICAgICAgICB9LCB0YWtlUmVjb3JkczogZnVuY3Rpb24gdGFrZVJlY29yZHMoKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUgPSBbXSwgdCA9IHRoaXMuZywgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgICAgdFtyXS5sKGUpOwogICAgICAgICAgICB9cmV0dXJuIGU7CiAgICAgICAgICB9LCBkaXNjb25uZWN0OiBmdW5jdGlvbiBkaXNjb25uZWN0KCkgewogICAgICAgICAgICB0aGlzLmcgPSBbXSwgY2xlYXJUaW1lb3V0KHRoaXMuZiksIHRoaXMuZiA9IG51bGw7CiAgICAgICAgICB9IH07dmFyIGQgPSAxO3JldHVybiB0OwogICAgICB9KHZvaWQgMCk7CiAgICB9LCB7fV0sIDkxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgfHwgZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHMgPSBbImFkZCIsICJ1cGRhdGUiLCAiZGVsZXRlIiwgInJlY29uZmlndXJlIiwgInNldFByb3RvdHlwZSIsICJwcmV2ZW50RXh0ZW5zaW9ucyJdLAogICAgICAgICAgICBhID0gdC5pc0FycmF5IHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IGUuY2FsbCh0KTsKICAgICAgICAgIH07CiAgICAgICAgfShlLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIGMgPSB0LnByb3RvdHlwZS5pbmRleE9mID8gdC5pbmRleE9mIHx8IGZ1bmN0aW9uIChlLCByLCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsIHIsIG4pOwogICAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgICAgZm9yICh2YXIgbiA9IHIgfHwgMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgaWYgKGVbbl0gPT09IHQpIHJldHVybiBuOwogICAgICAgICAgfXJldHVybiAtMTsKICAgICAgICB9LAogICAgICAgICAgICB1ID0gci5NYXAgIT09IG4gJiYgTWFwLnByb3RvdHlwZS5mb3JFYWNoID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBNYXAoKTsKICAgICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGUgPSBbXSwKICAgICAgICAgICAgICB0ID0gW107cmV0dXJuIHsgc2l6ZTogMCwgaGFzOiBmdW5jdGlvbiBoYXModCkgewogICAgICAgICAgICAgIHJldHVybiBjKGUsIHQpID4gLTE7CiAgICAgICAgICAgIH0sIGdldDogZnVuY3Rpb24gZ2V0KHIpIHsKICAgICAgICAgICAgICByZXR1cm4gdFtjKGUsIHIpXTsKICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQociwgbikgewogICAgICAgICAgICAgIHZhciBvID0gYyhlLCByKTstMSA9PT0gbyA/IChlLnB1c2gociksIHQucHVzaChuKSwgdGhpcy5zaXplKyspIDogdFtvXSA9IG47CiAgICAgICAgICAgIH0sICJkZWxldGUiOiBmdW5jdGlvbiBfZGVsZXRlKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGMoZSwgcik7biA+IC0xICYmIChlLnNwbGljZShuLCAxKSwgdC5zcGxpY2UobiwgMSksIHRoaXMuc2l6ZS0tKTsKICAgICAgICAgICAgfSwgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChyKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICAgICAgICByLmNhbGwoYXJndW1lbnRzWzFdLCB0W25dLCBlW25dLCB0aGlzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gfTsKICAgICAgICB9LAogICAgICAgICAgICBsID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBlLmdldE93blByb3BlcnR5TmFtZXM7dHJ5IHsKICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZTsKICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgdmFyIG4gPSAodChjKS5qb2luKCIgIikgKyAiICIpLnJlcGxhY2UoL3Byb3RvdHlwZSB8bGVuZ3RoIHxuYW1lIC9nLCAiIikuc2xpY2UoMCwgLTEpLnNwbGl0KCIgIik7bi5sZW5ndGggJiYgKHQgPSBmdW5jdGlvbiB0KF90MykgewogICAgICAgICAgICAgIHZhciByID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzKF90Myk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIF90MykgZm9yICh2YXIgbywgaSA9IDA7IGkgPCBuLmxlbmd0aDspIHsKICAgICAgICAgICAgICAgIChvID0gYyhyLCBuW2krK10pKSA+IC0xICYmIHIuc3BsaWNlKG8sIDEpOwogICAgICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgfSgpIDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgbyA9IFtdO2lmICgiaGFzT3duUHJvcGVydHkiIGluIHQpIGZvciAociBpbiB0KSB7CiAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkocikgJiYgby5wdXNoKHIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbiA9IGUuaGFzT3duUHJvcGVydHk7Zm9yIChyIGluIHQpIHsKICAgICAgICAgICAgICBuLmNhbGwodCwgcikgJiYgby5wdXNoKHIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9cmV0dXJuIGEodCkgJiYgby5wdXNoKCJsZW5ndGgiKSwgbzsKICAgICAgICB9LAogICAgICAgICAgICBmID0gZS5nZXRQcm90b3R5cGVPZiwKICAgICAgICAgICAgZCA9IGUuZGVmaW5lUHJvcGVydGllcyAmJiBlLmdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICAgICAgICAgICAgcCA9IHIucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHIud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlID0gK25ldyBEYXRlKCksCiAgICAgICAgICAgICAgdCA9IGU7cmV0dXJuIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByKCh0ID0gK25ldyBEYXRlKCkpIC0gZSk7CiAgICAgICAgICAgIH0sIDE3KTsKICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICBiID0gZnVuY3Rpb24gYihlLCB0LCByKSB7CiAgICAgICAgICB2YXIgbiA9IG8uZ2V0KGUpO24gPyAodihuLCBlKSwgbShlLCBuLCB0LCByKSkgOiAobiA9IGgoZSksIG0oZSwgbiwgdCwgciksIDEgPT09IG8uc2l6ZSAmJiBwKHkpKTsKICAgICAgICB9LAogICAgICAgICAgICBoID0gZnVuY3Rpb24gaCh0LCByKSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICBpID0gbCh0KSwKICAgICAgICAgICAgICBzID0gW10sCiAgICAgICAgICAgICAgYSA9IDAsCiAgICAgICAgICAgICAgciA9IHsgaGFuZGxlcnM6IHUoKSwgZnJvemVuOiBlLmlzRnJvemVuID8gZS5pc0Zyb3plbih0KSA6ICExLCBleHRlbnNpYmxlOiBlLmlzRXh0ZW5zaWJsZSA/IGUuaXNFeHRlbnNpYmxlKHQpIDogITAsIHByb3RvOiBmICYmIGYodCksIHByb3BlcnRpZXM6IGksIHZhbHVlczogcywgbm90aWZpZXI6IGcodCwgcikgfTtpZiAoZCkgZm9yIChuID0gci5kZXNjcmlwdG9ycyA9IFtdOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIG5bYV0gPSBkKHQsIGlbYV0pLCBzW2FdID0gdFtpW2ErK11dOwogICAgICAgICAgfSBlbHNlIGZvciAoOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIHNbYV0gPSB0W2lbYSsrXV07CiAgICAgICAgICB9cmV0dXJuIG8uc2V0KHQsIHIpLCByOwogICAgICAgIH0sCiAgICAgICAgICAgIHYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IGQgPyBmdW5jdGlvbiAoZSwgdCwgciwgbiwgbykgewogICAgICAgICAgICB2YXIgaSA9IHQucHJvcGVydGllc1tyXSwKICAgICAgICAgICAgICAgIHMgPSBlW2ldLAogICAgICAgICAgICAgICAgYSA9IHQudmFsdWVzW3JdLAogICAgICAgICAgICAgICAgYyA9IHQuZGVzY3JpcHRvcnNbcl07InZhbHVlIiBpbiBvICYmIChhID09PSBzID8gMCA9PT0gYSAmJiAxIC8gYSAhPT0gMSAvIHMgOiBhID09PSBhIHx8IHMgPT09IHMpICYmIChqKGUsIHQsIHsgbmFtZTogaSwgdHlwZTogInVwZGF0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IGEgfSwgbiksIHQudmFsdWVzW3JdID0gcyksICFjLmNvbmZpZ3VyYWJsZSB8fCBvLmNvbmZpZ3VyYWJsZSAmJiBvLndyaXRhYmxlID09PSBjLndyaXRhYmxlICYmIG8uZW51bWVyYWJsZSA9PT0gYy5lbnVtZXJhYmxlICYmIG8uZ2V0ID09PSBjLmdldCAmJiBvLnNldCA9PT0gYy5zZXQgfHwgKGooZSwgdCwgeyBuYW1lOiBpLCB0eXBlOiAicmVjb25maWd1cmUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBhIH0sIG4pLCB0LmRlc2NyaXB0b3JzW3JdID0gbyk7CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgdmFyIG8gPSB0LnByb3BlcnRpZXNbcl0sCiAgICAgICAgICAgICAgICBpID0gZVtvXSwKICAgICAgICAgICAgICAgIHMgPSB0LnZhbHVlc1tyXTsocyA9PT0gaSA/IDAgPT09IHMgJiYgMSAvIHMgIT09IDEgLyBpIDogcyA9PT0gcyB8fCBpID09PSBpKSAmJiAoaihlLCB0LCB7IG5hbWU6IG8sIHR5cGU6ICJ1cGRhdGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBzIH0sIG4pLCB0LnZhbHVlc1tyXSA9IGkpOwogICAgICAgICAgfSwKICAgICAgICAgICAgICByID0gZCA/IGZ1bmN0aW9uIChlLCByLCBuLCBvLCBpKSB7CiAgICAgICAgICAgIGZvciAodmFyIHMsIGEgPSByLmxlbmd0aDsgbiAmJiBhLS07KSB7CiAgICAgICAgICAgICAgbnVsbCAhPT0gclthXSAmJiAocyA9IGQoZSwgclthXSksIG4tLSwgcyA/IHQoZSwgbywgYSwgaSwgcykgOiAoaihlLCBvLCB7IG5hbWU6IHJbYV0sIHR5cGU6ICJkZWxldGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBvLnZhbHVlc1thXSB9LCBpKSwgby5wcm9wZXJ0aWVzLnNwbGljZShhLCAxKSwgby52YWx1ZXMuc3BsaWNlKGEsIDEpLCBvLmRlc2NyaXB0b3JzLnNwbGljZShhLCAxKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4sIG8pIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHQubGVuZ3RoOyByICYmIGktLTspIHsKICAgICAgICAgICAgICBudWxsICE9PSB0W2ldICYmIChqKGUsIG4sIHsgbmFtZTogdFtpXSwgdHlwZTogImRlbGV0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IG4udmFsdWVzW2ldIH0sIG8pLCBuLnByb3BlcnRpZXMuc3BsaWNlKGksIDEpLCBuLnZhbHVlcy5zcGxpY2UoaSwgMSksIHItLSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07cmV0dXJuIGZ1bmN0aW9uIChuLCBvLCBpKSB7CiAgICAgICAgICAgIGlmIChuLmhhbmRsZXJzLnNpemUgJiYgIW4uZnJvemVuKSB7CiAgICAgICAgICAgICAgdmFyIHMsCiAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgICAgIHAsCiAgICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgICAgIHksCiAgICAgICAgICAgICAgICAgIF8gPSBuLnZhbHVlcywKICAgICAgICAgICAgICAgICAgZyA9IG4uZGVzY3JpcHRvcnMsCiAgICAgICAgICAgICAgICAgIG0gPSAwO2lmIChuLmV4dGVuc2libGUpIHsKICAgICAgICAgICAgICAgIGlmIChzID0gbi5wcm9wZXJ0aWVzLnNsaWNlKCksIGEgPSBzLmxlbmd0aCwgdSA9IGwobyksIGcpIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgeSA9IGQobywgYiksIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKG9bYl0pLCBnLnB1c2goeSkpIDogKHNbcF0gPSBudWxsLCBhLS0sIHQobywgbiwgcCwgaSwgeSkpOwogICAgICAgICAgICAgICAgICB9cihvLCBzLCBhLCBuLCBpKSwgZS5pc0V4dGVuc2libGUobykgfHwgKG4uZXh0ZW5zaWJsZSA9ICExLCBqKG8sIG4sIHsgdHlwZTogInByZXZlbnRFeHRlbnNpb25zIiwgb2JqZWN0OiBvIH0sIGkpLCBuLmZyb3plbiA9IGUuaXNGcm96ZW4obykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgaCA9IG9bYl0sIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKGgpKSA6IChzW3BdID0gbnVsbCwgYS0tLCB0KG8sIG4sIHAsIGkpKTsKICAgICAgICAgICAgICAgICAgfXIobywgcywgYSwgbiwgaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghbi5mcm96ZW4pIHsKICAgICAgICAgICAgICAgIGZvciAoOyBtIDwgcy5sZW5ndGg7IG0rKykgewogICAgICAgICAgICAgICAgICBiID0gc1ttXSwgdChvLCBuLCBtLCBpLCBkKG8sIGIpKTsKICAgICAgICAgICAgICAgIH1lLmlzRnJvemVuKG8pICYmIChuLmZyb3plbiA9ICEwKTsKICAgICAgICAgICAgICB9ZiAmJiAodiA9IGYobyksIHYgIT09IG4ucHJvdG8gJiYgKGoobywgbiwgeyB0eXBlOiAic2V0UHJvdG90eXBlIiwgbmFtZTogIl9fcHJvdG9fXyIsIG9iamVjdDogbywgb2xkVmFsdWU6IG4ucHJvdG8gfSksIG4ucHJvdG8gPSB2KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICB5ID0gZnVuY3Rpb24geSgpIHsKICAgICAgICAgIG8uc2l6ZSAmJiAoby5mb3JFYWNoKHYpLCBpLmZvckVhY2goXyksIHAoeSkpOwogICAgICAgIH0sCiAgICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKGUsIHQpIHsKICAgICAgICAgIHZhciByID0gZS5jaGFuZ2VSZWNvcmRzO3IubGVuZ3RoICYmIChlLmNoYW5nZVJlY29yZHMgPSBbXSwgdChyKSk7CiAgICAgICAgfSwKICAgICAgICAgICAgZyA9IGZ1bmN0aW9uIGcoZSwgdCkgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyICYmICh0ID0gby5nZXQoZSkpLCB0ICYmIHQubm90aWZpZXIgfHwgeyBub3RpZnk6IGZ1bmN0aW9uIG5vdGlmeSh0KSB7CiAgICAgICAgICAgICAgdC50eXBlO3ZhciByID0gby5nZXQoZSk7aWYgKHIpIHsKICAgICAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgICAgIGkgPSB7IG9iamVjdDogZSB9O2ZvciAobiBpbiB0KSB7CiAgICAgICAgICAgICAgICAgICJvYmplY3QiICE9PSBuICYmIChpW25dID0gdFtuXSk7CiAgICAgICAgICAgICAgICB9aihlLCByLCBpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHBlcmZvcm1DaGFuZ2U6IGZ1bmN0aW9uIHBlcmZvcm1DaGFuZ2UodCwgcikgewogICAgICAgICAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBub24tc3RyaW5nIGNoYW5nZVR5cGUiKTtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IHBlcmZvcm0gbm9uLWZ1bmN0aW9uIik7dmFyIGksCiAgICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICAgIGEgPSBvLmdldChlKSwKICAgICAgICAgICAgICAgICAgYyA9IGFyZ3VtZW50c1syXSwKICAgICAgICAgICAgICAgICAgdSA9IGMgPT09IG4gPyByKCkgOiByLmNhbGwoYyk7aWYgKGEgJiYgdihhLCBlLCB0KSwgYSAmJiB1ICYmICJvYmplY3QiID09ICh0eXBlb2YgdSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodSkpKSB7CiAgICAgICAgICAgICAgICBzID0geyBvYmplY3Q6IGUsIHR5cGU6IHQgfTtmb3IgKGkgaW4gdSkgewogICAgICAgICAgICAgICAgICAib2JqZWN0IiAhPT0gaSAmJiAidHlwZSIgIT09IGkgJiYgKHNbaV0gPSB1W2ldKTsKICAgICAgICAgICAgICAgIH1qKGUsIGEsIHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSB9OwogICAgICAgIH0sCiAgICAgICAgICAgIG0gPSBmdW5jdGlvbiBtKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHZhciBvID0gaS5nZXQocik7byB8fCBpLnNldChyLCBvID0geyBvYnNlcnZlZDogdSgpLCBjaGFuZ2VSZWNvcmRzOiBbXSB9KSwgby5vYnNlcnZlZC5zZXQoZSwgeyBhY2NlcHRMaXN0OiBuLnNsaWNlKCksIGRhdGE6IHQgfSksIHQuaGFuZGxlcnMuc2V0KHIsIG8pOwogICAgICAgIH0sCiAgICAgICAgICAgIGogPSBmdW5jdGlvbiBqKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHQuaGFuZGxlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbyA9IHQub2JzZXJ2ZWQuZ2V0KGUpLmFjY2VwdExpc3Q7KCJzdHJpbmciICE9IHR5cGVvZiBuIHx8IC0xID09PSBjKG8sIG4pKSAmJiBjKG8sIHIudHlwZSkgPiAtMSAmJiB0LmNoYW5nZVJlY29yZHMucHVzaChyKTsKICAgICAgICAgIH0pOwogICAgICAgIH07byA9IHUoKSwgaSA9IHUoKSwgZS5vYnNlcnZlID0gZnVuY3Rpb24gKHQsIHIsIG8pIHsKICAgICAgICAgIGlmICghdCB8fCAib2JqZWN0IiAhPSAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qub2JzZXJ2ZSBjYW5ub3Qgb2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIG5vbi1mdW5jdGlvbiIpO2lmIChlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4ocikpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIGEgZnJvemVuIGZ1bmN0aW9uIG9iamVjdCIpO2lmIChvID09PSBuKSBvID0gcztlbHNlIGlmICghbyB8fCAib2JqZWN0IiAhPSAodHlwZW9mIG8gPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG8pKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhpcmQgYXJndW1lbnQgdG8gT2JqZWN0Lm9ic2VydmUgbXVzdCBiZSBhbiBhcnJheSBvZiBzdHJpbmdzLiIpO3JldHVybiBiKHQsIHIsIG8pLCB0OwogICAgICAgIH0sIGUudW5vYnNlcnZlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSBlIHx8ICJvYmplY3QiICE9ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IHVub2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHIsCiAgICAgICAgICAgICAgbiA9IGkuZ2V0KHQpO3JldHVybiBuICYmIChyID0gbi5vYnNlcnZlZC5nZXQoZSkpICYmIChuLm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIHAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfKG4sIHQpOwogICAgICAgICAgfSksIDEgPT09IG4ub2JzZXJ2ZWQuc2l6ZSAmJiBuLm9ic2VydmVkLmhhcyhlKSA/IGlbImRlbGV0ZSJdKHQpIDogbi5vYnNlcnZlZFsiZGVsZXRlIl0oZSksIDEgPT09IHIuZGF0YS5oYW5kbGVycy5zaXplID8gb1siZGVsZXRlIl0oZSkgOiByLmRhdGEuaGFuZGxlcnNbImRlbGV0ZSJdKHQpKSwgZTsKICAgICAgICB9LCBlLmdldE5vdGlmaWVyID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSB0IHx8ICJvYmplY3QiICE9ICh0eXBlb2YgdCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodCkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5nZXROb3RpZmllciBjYW5ub3QgZ2V0Tm90aWZpZXIgbm9uLW9iamVjdCIpO3JldHVybiBlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4odCkgPyBudWxsIDogZyh0KTsKICAgICAgICB9LCBlLmRlbGl2ZXJDaGFuZ2VSZWNvcmRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QuZGVsaXZlckNoYW5nZVJlY29yZHMgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHQgPSBpLmdldChlKTt0ICYmICh0Lm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIF8odCwgZSkpOwogICAgICAgIH07CiAgICAgIH0oT2JqZWN0LCBBcnJheSwgdGhpcyk7CiAgICB9LCB7fV0sIDkyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pLCByLkRhdGFPYmplY3RPYnNlcnZlciA9IHIuRGF0YU9iamVjdFJlcG9ydGVyID0gci5TeW5jaGVyID0gdm9pZCAwLCBlKCJtdXRhdGlvbm9ic2VydmVyLXNoaW0iKSwgZSgib2JqZWN0Lm9ic2VydmUiKSwgZSgiYXJyYXkub2JzZXJ2ZSIpO3ZhciBvID0gZSgiLi9zeW5jaGVyL1N5bmNoZXIiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0UmVwb3J0ZXIiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiKSwKICAgICAgICAgIHUgPSBuKGMpO3IuU3luY2hlciA9IGlbImRlZmF1bHQiXSwgci5EYXRhT2JqZWN0UmVwb3J0ZXIgPSBhWyJkZWZhdWx0Il0sIHIuRGF0YU9iamVjdE9ic2VydmVyID0gdVsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9zeW5jaGVyL0RhdGFPYmplY3RPYnNlcnZlciI6IDk1LCAiLi9zeW5jaGVyL0RhdGFPYmplY3RSZXBvcnRlciI6IDk2LCAiLi9zeW5jaGVyL1N5bmNoZXIiOiA5OSwgImFycmF5Lm9ic2VydmUiOiAxLCAibXV0YXRpb25vYnNlcnZlci1zaGltIjogOTAsICJvYmplY3Qub2JzZXJ2ZSI6IDkxIH1dLCA5MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL1N5bmNPYmplY3QiKSwKICAgICAgICAgIHAgPSBuKGQpLAogICAgICAgICAgYiA9IGUoIi4vRGF0YU9iamVjdENoaWxkIiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCIuLi91dGlscy91dGlscy5qcyIpLAogICAgICAgICAgeSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBhID0gdGhpczthLl9zeW5jaGVyID0gdCwgYS5fdXJsID0gciwgYS5fc2NoZW1hID0gbiwgYS5fc3RhdHVzID0gbywgYS5fc3luY09iaiA9IG5ldyBwWyJkZWZhdWx0Il0oaSksIGEuX2NoaWxkcmVucyA9IHMsIGEuX3ZlcnNpb24gPSAwLCBhLl9jaGlsZElkID0gMCwgYS5fY2hpbGRyZW5PYmplY3RzID0ge30sIGEuX2NoaWxkcmVuTGlzdGVuZXJzID0gW10sIGEuX293bmVyID0gdC5fb3duZXIsIGEuX2J1cyA9IHQuX2J1czsKICAgICAgICB9cmV0dXJuICgwLCBmWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICAgICAgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gdC5fdXJsICsgIi9jaGlsZHJlbi8iO3QuX2NoaWxkcmVucyAmJiB0Ll9jaGlsZHJlbnMuZm9yRWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHZhciBvID0gciArIG4sCiAgICAgICAgICAgICAgICAgIGkgPSB0Ll9idXMuYWRkTGlzdGVuZXIobywgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgIGlmIChyLmZyb20gIT09IGUuX293bmVyKSBzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0LUNoaWxkcmVuLVJDVjogIiwgciksIHIudHlwZSkge2Nhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICAgICAgdC5fb25DaGlsZENyZWF0ZShyKTticmVhaztjYXNlICJkZWxldGUiOgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHIpO2JyZWFrO2RlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdC5fY2hhbmdlQ2hpbGRyZW4ocik7fQogICAgICAgICAgICAgIH0pO3QuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2goaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXM7ZS5fY2hpbGRyZW5MaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGUucmVtb3ZlKCk7CiAgICAgICAgICAgIH0pLCAoMCwgYVsiZGVmYXVsdCJdKShlLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGlsZHJlbk9iamVjdHNbdF0uX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAicGF1c2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHRocm93ICJOb3QgaW1wbGVtZW50ZWQiOwogICAgICAgICAgfSB9LCB7IGtleTogInJlc3VtZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3RvcCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAiYWRkQ2hpbGQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7ci5fY2hpbGRJZCsrO3ZhciBuID0gci5fb3duZXIgKyAiIyIgKyByLl9jaGlsZElkLAogICAgICAgICAgICAgICAgbyA9IHIuX3VybCArICIvY2hpbGRyZW4vIiArIGUsCiAgICAgICAgICAgICAgICBzID0geyB0eXBlOiAiY3JlYXRlIiwgZnJvbTogci5fb3duZXIsIHRvOiBvLCBib2R5OiB7IHJlc291cmNlOiBuLCB2YWx1ZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHIuX2J1cy5wb3N0TWVzc2FnZShzKTtjb25zb2xlLmxvZygiY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAiICsgci5fb3duZXIgKyAiICk6ICIsIHMpO3ZhciBhID0gbmV3IGhbImRlZmF1bHQiXShyLCBuLCB0LCByLl9vd25lciwgaSk7YS5vbkNoYW5nZShmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgci5fb25DaGFuZ2UoZSwgeyBwYXRoOiBvLCBjaGlsZElkOiBuIH0pOwogICAgICAgICAgICAgIH0pLCByLl9jaGlsZHJlbk9iamVjdHNbbl0gPSBhLCBlKGEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkFkZENoaWxkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoaWxkQ3JlYXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5yZXNvdXJjZTtjb25zb2xlLmxvZygiY3JlYXRlLW9ic2VydmVyLWNoaWxkKCAiICsgdC5fb3duZXIgKyAiICk6ICIsIGUpO3ZhciBuID0gbmV3IGhbImRlZmF1bHQiXSh0LCByLCBlLmJvZHkudmFsdWUpO3QuX2NoaWxkcmVuT2JqZWN0c1tyXSA9IG4sIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDIwMCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgICB9KTt2YXIgbyA9IHsgdHlwZTogZS50eXBlLCBmcm9tOiBlLmZyb20sIHVybDogZS50bywgdmFsdWU6IGUuYm9keS52YWx1ZSwgY2hpbGRJZDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSB9O3QuX29uQWRkQ2hpbGRyZW5IYW5kbGVyICYmIChjb25zb2xlLmxvZygiQURELUNISUxEUkVOLUVWRU5UOiAiLCBvKSwgdC5fb25BZGRDaGlsZHJlbkhhbmRsZXIobykpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbisrLCAib24iID09PSByLl9zdGF0dXMpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgdHlwZTogInVwZGF0ZSIsIGZyb206IHIuX3VybCwgdG86IHIuX3VybCArICIvY2hhbmdlcyIsIGJvZHk6IHsgdmVyc2lvbjogci5fdmVyc2lvbiwgc291cmNlOiByLl9vd25lciwgYXR0cmlidXRlOiBlLmZpZWxkIH0gfTtlLm9UeXBlID09PSBkLk9iamVjdFR5cGUuT0JKRUNUID8gZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSAmJiAobi5ib2R5LnZhbHVlID0gZS5kYXRhKSA6IChuLmJvZHkuYXR0cmlidXRlVHlwZSA9IGUub1R5cGUsIG4uYm9keS52YWx1ZSA9IGUuZGF0YSwgZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlVQREFURSAmJiAobi5ib2R5Lm9wZXJhdGlvbiA9IGUuY1R5cGUpKSwgdCAmJiAobi50byA9IHQucGF0aCwgbi5ib2R5LnJlc291cmNlID0gdC5jaGlsZElkKSwgci5fYnVzLnBvc3RNZXNzYWdlKG4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX2NoYW5nZU9iamVjdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbiArIDEgPT09IHQuYm9keS52ZXJzaW9uKSB7CiAgICAgICAgICAgICAgci5fdmVyc2lvbisrO3ZhciBuID0gdC5ib2R5LmF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgbyA9ICgwLCB2LmRlZXBDbG9uZSkodC5ib2R5LnZhbHVlKSwKICAgICAgICAgICAgICAgICAgaSA9IGUuZmluZEJlZm9yZShuKTtpZiAodC5ib2R5LmF0dHJpYnV0ZVR5cGUgPT09IGQuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgICAgICAgaWYgKHQuYm9keS5vcGVyYXRpb24gPT09IGQuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBpLm9iaiwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBpLmxhc3Q7QXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShzLCBbYSwgMF0uY29uY2F0KG8pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5ib2R5Lm9wZXJhdGlvbiA9PT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICAgICAgICB2YXIgYyA9IGkub2JqLAogICAgICAgICAgICAgICAgICAgICAgdSA9IGkubGFzdDtjLnNwbGljZSh1LCBvKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpLm9ialtpLmxhc3RdID0gbzsKICAgICAgICAgICAgICB9IGVsc2UgdC5ib2R5LnZhbHVlID8gaS5vYmpbaS5sYXN0XSA9IG8gOiBkZWxldGUgaS5vYmpbaS5sYXN0XTsKICAgICAgICAgICAgfSBlbHNlIGNvbnNvbGUubG9nKCJVTlNZTkNIUk9OSVpFRCBWRVJTSU9OOiAoZGF0YSA9PiAiICsgci5fdmVyc2lvbiArICIsIG1zZyA9PiAiICsgdC5ib2R5LnZlcnNpb24gKyAiKSIpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9jaGFuZ2VDaGlsZHJlbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztjb25zb2xlLmxvZygiQ2hhbmdlIGNoaWxkcmVuOiAiLCB0Ll9vd25lciwgZSk7dmFyIHIgPSBlLmJvZHkucmVzb3VyY2UsCiAgICAgICAgICAgICAgICBuID0gdC5fY2hpbGRyZW5PYmplY3RzW3JdO24gPyB0Ll9jaGFuZ2VPYmplY3Qobi5fc3luY09iaiwgZSkgOiBjb25zb2xlLmxvZygiTm8gY2hpbGRyZW4gZm91bmQgZm9yOiAiLCByKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cmwiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VybDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzY2hlbWEiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdGF0dXMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXR1czsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRyZW5zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbk9iamVjdHM7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IHksIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4uL3V0aWxzL3V0aWxzLmpzIjogMTAwLCAiLi9EYXRhT2JqZWN0Q2hpbGQiOiA5NCwgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogOSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vU3luY09iamVjdCIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgciwgbiwgbywgcykgewogICAgICAgICAgKDAsIGlbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIGEgPSB0aGlzO2EuX3BhcmVudCA9IHQsIGEuX2NoaWxkSWQgPSByLCBhLl9vd25lciA9IG8sIGEuX21zZ0lkID0gcywgYS5fc3luY09iaiA9IG5ldyB1WyJkZWZhdWx0Il0obiksIGEuX2J1cyA9IHQuX2J1cywgYS5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX293bmVyICYmIChlLl9saXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl9vd25lciwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAicmVzcG9uc2UiID09PSB0LnR5cGUgJiYgdC5pZCA9PT0gZS5fbXNnSWQgJiYgKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0Q2hpbGQub25SZXNwb25zZToiLCB0KSwgZS5fb25SZXNwb25zZSh0KSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyICYmIGUuX2xpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2RlbGV0ZSBlLl9wYXJlbnQuX2NoaWxkcmVuW2UuX2NoaWxkSWRdLCBlLl9yZWxlYXNlTGlzdGVuZXJzKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25DaGFuZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogZS50eXBlLCB1cmw6IGUuYm9keS5zb3VyY2UsIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgdC5fb25SZXNwb25zZUhhbmRsZXIocik7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRJZCIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IGwsIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICB1ID0gbihjKSwKICAgICAgICAgIGwgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGYgPSBuKGwpLAogICAgICAgICAgZCA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiksCiAgICAgICAgICBwID0gbihkKSwKICAgICAgICAgIGIgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKSwKICAgICAgICAgIHkgPSBuKHYpLAogICAgICAgICAgXyA9IGUoIi4vRGF0YU9iamVjdCIpLAogICAgICAgICAgZyA9IG4oXyksCiAgICAgICAgICBtID0gZSgiLi9EYXRhT2JqZWN0Q2hpbGQiKSwKICAgICAgICAgIGogPSBuKG0pLAogICAgICAgICAgJCA9IHsgQU5ZOiAiYW55IiwgU1RBUlQ6ICJzdGFydCIsIEVYQUNUOiAiZXhhY3QiIH0sCiAgICAgICAgICBPID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIHMsIGMsIGwpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBmID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBzLmRhdGEsIGMpKSwKICAgICAgICAgICAgICBkID0gZjtyZXR1cm4gZC5fdmVyc2lvbiA9IGwsIGQuX2ZpbHRlcnMgPSB7fSwgZC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGQuX29uRmlsdGVyKGUpOwogICAgICAgICAgfSksICgwLCBpWyJkZWZhdWx0Il0pKHMuY2hpbGRyZW5zKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0ID0gcy5jaGlsZHJlbnNbZV07ZC5fY2hpbGRyZW5PYmplY3RzW2VdID0gbmV3IGpbImRlZmF1bHQiXShkLCBlLCB0KTsKICAgICAgICAgIH0pLCBkLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBmOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fY2hhbmdlTGlzdGVuZXIgPSBlLl9idXMuYWRkTGlzdGVuZXIoZS5fdXJsICsgIi9jaGFuZ2VzIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAidXBkYXRlIiA9PT0gdC50eXBlICYmIChjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZU9iamVjdChlLl9zeW5jT2JqLCB0KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX2NoYW5nZUxpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX29ic2VydmVyc1tlLl91cmxdOwogICAgICAgICAgfSB9LCB7IGtleTogInVuc3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICB0ID0geyB0eXBlOiAidW5zdWJzY3JpYmUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLVVOU1VCU0NSSUJFOiAiLCB0KSwgMjAwID09PSB0LmJvZHkuY29kZSAmJiAoZS5fcmVsZWFzZUxpc3RlbmVycygpLCBkZWxldGUgZS5fc3luY2hlci5fb2JzZXJ2ZXJzW2UuX3VybF0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gZSwKICAgICAgICAgICAgICAgIG4gPSB7IHR5cGU6ICQuRVhBQ1QsIGNhbGxiYWNrOiB0IH0sCiAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKCIqIik7byA9PT0gZS5sZW5ndGggLSAxICYmICgwID09PSBvID8gbi50eXBlID0gJC5BTlkgOiAobi50eXBlID0gJC5TVEFSVCwgciA9IGUuc3Vic3RyKDAsIGUubGVuZ3RoIC0gMSkpKSwgdGhpcy5fZmlsdGVyc1tyXSA9IG47CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRmlsdGVyIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOygwLCBpWyJkZWZhdWx0Il0pKHQuX2ZpbHRlcnMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX2ZpbHRlcnNbcl07bi50eXBlID09PSAkLkFOWSA/IG4uY2FsbGJhY2soZSkgOiBuLnR5cGUgPT09ICQuU1RBUlQgPyAwID09PSBlLmZpZWxkLmluZGV4T2YocikgJiYgbi5jYWxsYmFjayhlKSA6IG4udHlwZSA9PT0gJC5FWEFDVCAmJiBlLmZpZWxkID09PSByICYmIG4uY2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBPLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL0RhdGFPYmplY3QiOiA5MywgIi4vRGF0YU9iamVjdENoaWxkIjogOTQsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOiA2LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjogMTMsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOiAxNCwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjogMTUgfV0sIDk2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpLAogICAgICAgICAgaCA9IG4oYiksCiAgICAgICAgICB2ID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIiksCiAgICAgICAgICB5ID0gbih2KSwKICAgICAgICAgIF8gPSBlKCIuL0RhdGFPYmplY3QiKSwKICAgICAgICAgIGcgPSBuKF8pLAogICAgICAgICAgbSA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBqID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBjID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBpLCBzKSksCiAgICAgICAgICAgICAgbCA9IGM7cmV0dXJuIGwuX3N1YnNjcmlwdGlvbnMgPSB7fSwgbC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItIiArIHIgKyAiLVNFTkQ6ICIsIGUpLCBsLl9vbkNoYW5nZShlKTsKICAgICAgICAgIH0pLCBsLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBjOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fcmVzcG9uc2VMaXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl91cmwsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgInJlc3BvbnNlIiA9PT0gdC50eXBlICYmIGUuX29uUmVzcG9uc2UodCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX3Jlc3BvbnNlTGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiaW52aXRlT2JzZXJ2ZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IHQuX3N5bmNoZXIuX293bmVyLCB0bzogdC5fc3luY2hlci5fc3ViVVJMLCBib2R5OiB7IHJlc291cmNlOiB0Ll91cmwsIHNjaGVtYTogdC5fc2NoZW1hLCB2YWx1ZTogdC5fc3luY09iai5kYXRhLCBhdXRob3Jpc2U6IGUgfSB9O3QuX2J1cy5wb3N0TWVzc2FnZShyKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgICAgICAgIHQgPSB7IHR5cGU6ICJkZWxldGUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLURFTEVURTogIiwgdCksIDIwMCA9PT0gdC5ib2R5LmNvZGUgJiYgKGUuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX3JlcG9ydGVyc1tlLl91cmxdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25TdWJzY3JpcHRpb24iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uUmVzcG9uc2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGU7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRm9yd2FyZCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItUkNWOiAiLCBlKSwgZS5ib2R5LnR5cGUpIHtjYXNlICJzdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25TdWJzY3JpYmUoZSk7YnJlYWs7Y2FzZSAidW5zdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25VblN1YnNjcmliZShlKTt9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uU3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5mcm9tLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgYWNjZXB0OiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHsgdXJsOiByLCBzdGF0dXM6ICJvbiIgfTt0Ll9zdWJzY3JpcHRpb25zW3JdID0gbjt2YXIgbyA9IHt9O3JldHVybiAoMCwgaVsiZGVmYXVsdCJdKSh0Ll9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0Ll9jaGlsZHJlbk9iamVjdHNbZV0uZGF0YTtvW2VdID0gKDAsIG0uZGVlcENsb25lKShyKTsKICAgICAgICAgICAgICAgIH0pLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogdC5fc2NoZW1hLCB2ZXJzaW9uOiB0Ll92ZXJzaW9uLCB2YWx1ZTogeyBkYXRhOiAoMCwgbS5kZWVwQ2xvbmUpKHQuZGF0YSksIGNoaWxkcmVuczogbyB9IH0gfSksIG47CiAgICAgICAgICAgICAgfSwgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICAgICAgICAgICAgdC5fYnVzLnBvc3RNZXNzYWdlKHsgaWQ6IGUuaWQsIHR5cGU6ICJyZXNwb25zZSIsIGZyb206IGUudG8sIHRvOiBlLmZyb20sIGJvZHk6IHsgY29kZTogNDAzLCBkZXNjOiByIH0gfSk7CiAgICAgICAgICAgICAgfSB9O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIlNVQlNDUklQVElPTi1FVkVOVDogIiwgbiksIHQuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihuKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uVW5TdWJzY3JpYmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LmZyb20sCiAgICAgICAgICAgICAgICBuID0gdC5fc3Vic2NyaXB0aW9uc1tyXTtkZWxldGUgdC5fc3Vic2NyaXB0aW9uc1tyXTt2YXIgbyA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgb2JqZWN0OiBuIH07dC5fb25TdWJzY3JpcHRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiVU4tU1VCU0NSSVBUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25TdWJzY3JpcHRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZXNwb25zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IHR5cGU6IGUudHlwZSwgdXJsOiBlLmZyb20sIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgKGNvbnNvbGUubG9nKCJSRVNQT05TRS1FVkVOVDogIiwgciksIHQuX29uUmVzcG9uc2VIYW5kbGVyKHIpKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpcHRpb25zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25zOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBqLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuLi91dGlscy91dGlscy5qcyI6IDEwMCwgIi4vRGF0YU9iamVjdCI6IDkzLCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogNiwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6IDcsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiAxMSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI6IDEyLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6IDEzLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjogMTQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI6IDE1IH1dLCA5NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByLCBuLCBvKSB7CiAgICAgICAgICAoMCwgaVsiZGVmYXVsdCJdKSh0aGlzLCBlKTt2YXIgcyA9IHRoaXM7cy5fb3duZXIgPSB0LCBzLl91cmwgPSByLCBzLl9idXMgPSBuLCBzLl9jaGlsZHJlbiA9IG8sIHMuX2NoYW5nZXMgPSBbXSwgcy5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyID0gZS5fYnVzLmFkZExpc3RlbmVyKGUuX3VybCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YVByb3Zpc2lvbmFsLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZXMucHVzaCh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9saXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJhcHBseSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpczt0Ll9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGFuZ2VPYmplY3QoZS5fc3luY09iaiwgdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImNoaWxkcmVuIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbjsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gYywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSksIHIuT2JqZWN0VHlwZSA9IHIuQ2hhbmdlVHlwZSA9IHZvaWQgMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBmID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgICAgKDAsIGFbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIHIgPSB0aGlzO3IuX29ic2VydmVycyA9IFtdLCByLl9maWx0ZXJzID0ge30sIHQgPyByLl9kYXRhID0gKDAsIGwuZGVlcENsb25lKSh0KSA6IHIuX2RhdGEgPSB7fSwgci5faW50ZXJuYWxPYnNlcnZlKG5ldyBkKCksIHIuX2RhdGEpOwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAib2JzZXJ2ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29ic2VydmVycy5wdXNoKGUpOwogICAgICAgICAgfSB9LCB7IGtleTogImZpbmQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGUuc3BsaXQoIi4iKTtyZXR1cm4gdGhpcy5fZmluZFdpdGhTcGxpdCh0KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJmaW5kQmVmb3JlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB7fSwKICAgICAgICAgICAgICAgIHIgPSBlLnNwbGl0KCIuIik7cmV0dXJuIHQubGFzdCA9IHIucG9wKCksIHQub2JqID0gdGhpcy5fZmluZFdpdGhTcGxpdChyKSwgdDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfZmluZFdpdGhTcGxpdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fZGF0YTtyZXR1cm4gZS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdCA9IHRbZV07CiAgICAgICAgICAgIH0pLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogIl9maXJlRXZlbnQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vYnNlcnZlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHQoZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9pc09ic2VydmFibGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICByZXR1cm4gZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IGUuY29uc3RydWN0b3IgPT09IEFycmF5OwogICAgICAgICAgfSB9LCB7IGtleTogIl9pbnRlcm5hbE9ic2VydmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7aWYgKHIuX2lzT2JzZXJ2YWJsZSh0KSkgewogICAgICAgICAgICAgIHZhciBuID0gZnVuY3Rpb24gbih0KSB7CiAgICAgICAgICAgICAgICByLl9vbkNoYW5nZXMoZSwgdCk7CiAgICAgICAgICAgICAgfTtpZiAodC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICAgICAgICBPYmplY3Qub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBvIGluIHQpIHsKICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHRbb10pICYmIHIuX2ludGVybmFsT2JzZXJ2ZShlWyJuZXciXShvKSwgdFtvXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgICAgICAgQXJyYXkub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBpIGluIHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHIuX2lzT2JzZXJ2YWJsZSh0W2ldKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0obmV3IHAodFtpXSwgaSkpO3IuX2ludGVybmFsT2JzZXJ2ZShzLCB0W2ldKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZXMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7Zm9yICh2YXIgbiBpbiB0KSB7CiAgICAgICAgICAgICAgdmFyIG8gPSB0W25dLm9iamVjdCwKICAgICAgICAgICAgICAgICAgaSA9IHZvaWQgMDtpZiAoby5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmIChpID0gaC5PQkpFQ1QpLCBvLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiAoaSA9IGguQVJSQVkpLCAic3BsaWNlIiA9PT0gdFtuXS50eXBlKSAhZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0W25dLmluZGV4LAogICAgICAgICAgICAgICAgICAgIGEgPSBlWyJuZXciXSgiIiArIHMpLAogICAgICAgICAgICAgICAgICAgIGMgPSBhLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgdSA9IHRbbl0ucmVtb3ZlZC5sZW5ndGg7aWYgKDAgIT09IHUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0W25dLnJlbW92ZWQ7Zi5mb3JFYWNoKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHQpICYmIGUucmVtb3ZlSW5kZXgocyArIG4pOwogICAgICAgICAgICAgICAgICB9KSwgci5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGMsIGRhdGE6IHUgfSk7CiAgICAgICAgICAgICAgICB9dmFyIGQgPSB0W25dLmFkZGVkQ291bnQ7aWYgKDAgIT09IGQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBvLnNsaWNlKHMsIHMgKyBkKTtoLmZvckVhY2goZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoci5faXNPYnNlcnZhYmxlKHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGVbIm5ldyJdKG5ldyBwKHQsIHMgKyBuKSk7ci5faW50ZXJuYWxPYnNlcnZlKG8sIHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksIHIuX2ZpcmVFdmVudCh7IGNUeXBlOiBiLkFERCwgb1R5cGU6IGksIGZpZWxkOiBjLCBkYXRhOiAoMCwgbC5kZWVwQ2xvbmUpKGgpIH0pOwogICAgICAgICAgICAgICAgfXMgIT09IG8ubGVuZ3RoIC0gMSAmJiBlLnJlSW5kZXhGcm9tKG8pOwogICAgICAgICAgICAgIH0oKTtlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0odFtuXS5uYW1lKSwKICAgICAgICAgICAgICAgICAgICBhID0gcy50b1N0cmluZygpO2lmICgtMSAhPT0gYS5pbmRleE9mKCJTeW1ib2wiKSkgY29udGludWU7dmFyIGMgPSBvW3Rbbl0ubmFtZV07InVwZGF0ZSIgPT09IHRbbl0udHlwZSAmJiB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5VUERBVEUsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSwgImFkZCIgPT09IHRbbl0udHlwZSAmJiAodGhpcy5faW50ZXJuYWxPYnNlcnZlKHMsIGMpLCB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5BREQsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSksICJkZWxldGUiID09PSB0W25dLnR5cGUgJiYgdGhpcy5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGEgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGF0YSIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCksCiAgICAgICAgICBkID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5fcGF0aCA9IFtdLCB0aGlzLl9vYnNlcnZhYmxlcyA9IHt9OwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAicmVtb3ZlSW5kZXgiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICBkZWxldGUgdGhpcy5fb2JzZXJ2YWJsZXNbZV07CiAgICAgICAgICB9IH0sIHsga2V5OiAicmVJbmRleEZyb20iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7KDAsIGlbImRlZmF1bHQiXSkodGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX29ic2VydmFibGVzW3JdLAogICAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKG4ub2JqKTtuLmlkeCAhPSBvICYmIChuLmlkeCA9IG8sIGRlbGV0ZSB0Ll9vYnNlcnZhYmxlc1tyXSwgdC5fb2JzZXJ2YWJsZXNbb10gPSBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAibmV3IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgZS5jb25zdHJ1Y3RvciA9PSBwICYmICh0aGlzLl9vYnNlcnZhYmxlc1tlLmlkeF0gPSBlKTt2YXIgdCA9IHRoaXMuY2xvbmUoKTtyZXR1cm4gdC5fcGF0aC5wdXNoKGUpLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogImNsb25lIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBlKCk7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQuX3BhdGgucHVzaChlKTsKICAgICAgICAgICAgfSksIHQ7CiAgICAgICAgICB9IH0sIHsga2V5OiAidG9TdHJpbmciLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gIiI7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgICAgIDAgPT09IHIgPyBlID0gdC50b1N0cmluZygpIDogZSArPSAiLiIgKyB0LnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0pLCBlOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKSwKICAgICAgICAgIHAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5vYmogPSB0LCB0aGlzLmlkeCA9IHI7CiAgICAgICAgfXJldHVybiAoMCwgdVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJ0b1N0cmluZyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWR4LnRvU3RyaW5nKCk7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpLAogICAgICAgICAgYiA9IHIuQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAidXBkYXRlIiwgQUREOiAiYWRkIiwgUkVNT1ZFOiAicmVtb3ZlIiB9LAogICAgICAgICAgaCA9IHIuT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAib2JqZWN0IiwgQVJSQVk6ICJhcnJheSIgfTtyWyJkZWZhdWx0Il0gPSBmOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMuanMiOiAxMDAsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOiA3LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4vRGF0YU9iamVjdFJlcG9ydGVyIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL0RhdGFPYmplY3RPYnNlcnZlciIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiLi9EYXRhUHJvdmlzaW9uYWwiKSwKICAgICAgICAgIGggPSBuKGIpLAogICAgICAgICAgdiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgICAgICAgICgwLCBhWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBvID0gdGhpcztvLl9vd25lciA9IHQsIG8uX2J1cyA9IHIsIG8uX3N1YlVSTCA9IG4ucnVudGltZVVSTCArICIvc20iLCBvLl9yZXBvcnRlcnMgPSB7fSwgby5fb2JzZXJ2ZXJzID0ge30sIG8uX3Byb3Zpc2lvbmFscyA9IHt9LCByLmFkZExpc3RlbmVyKHQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLmZyb20gIT09IHQpIHN3aXRjaCAoY29uc29sZS5sb2coIlN5bmNoZXItUkNWOiAiLCBlKSwgZS50eXBlKSB7Y2FzZSAiZm9yd2FyZCI6CiAgICAgICAgICAgICAgICBvLl9vbkZvcndhcmQoZSk7YnJlYWs7Y2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgIG8uX29uUmVtb3RlQ3JlYXRlKGUpO2JyZWFrO2Nhc2UgImRlbGV0ZSI6CiAgICAgICAgICAgICAgICBvLl9vblJlbW90ZURlbGV0ZShlKTt9CiAgICAgICAgICB9KTsKICAgICAgICB9cmV0dXJuICgwLCB1WyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImNyZWF0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0LCByKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcztyLnJlcG9ydGVyID0gbi5fb3duZXIsIHIuc2NoZW1hID0gZTt2YXIgbyA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IG4uX293bmVyLCB0bzogbi5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgdmFsdWU6IHIsIGF1dGhvcmlzZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKHQsIGkpIHsKICAgICAgICAgICAgICBuLl9idXMucG9zdE1lc3NhZ2UobywgZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgICAgIGlmIChjb25zb2xlLmxvZygiY3JlYXRlLXJlc3BvbnNlOiAiLCBvKSwgMjAwID09PSBvLmJvZHkuY29kZSkgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IG8uYm9keS5yZXNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBuZXcgZlsiZGVmYXVsdCJdKG4sIHMsIGUsICJvbiIsIHIsIG8uYm9keS5jaGlsZHJlblJlc291cmNlcyk7bi5fcmVwb3J0ZXJzW3NdID0gYSwgdChhKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpKG8uYm9keS5kZXNjKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogInN1YnNjcmliZSIsIGZyb206IHIuX293bmVyLCB0bzogci5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgcmVzb3VyY2U6IHQgfSB9O3JldHVybiBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uIChvLCBpKSB7CiAgICAgICAgICAgICAgci5fYnVzLnBvc3RNZXNzYWdlKG4sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic3Vic2NyaWJlLXJlc3BvbnNlOiAiLCBuKTt2YXIgcyA9IHIuX3Byb3Zpc2lvbmFsc1t0XTtpZiAoZGVsZXRlIHIuX3Byb3Zpc2lvbmFsc1t0XSwgcyAmJiBzLl9yZWxlYXNlTGlzdGVuZXJzKCksIG4uYm9keS5jb2RlIDwgMjAwKSBzID0gbmV3IGhbImRlZmF1bHQiXShyLl9vd25lciwgdCwgci5fYnVzLCBuLmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpLCByLl9wcm92aXNpb25hbHNbdF0gPSBzO2Vsc2UgaWYgKDIwMCA9PT0gbi5ib2R5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgcFsiZGVmYXVsdCJdKHIsIHQsIGUsICJvbiIsIG4uYm9keS52YWx1ZSwgcy5jaGlsZHJlbiwgbi5ib2R5LnZlcnNpb24pO3IuX29ic2VydmVyc1t0XSA9IGEsIG8oYSksIHMuYXBwbHkoYSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaShuLmJvZHkuZGVzYyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uTm90aWZpY2F0aW9uIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25Gb3J3YXJkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHQuX3JlcG9ydGVyc1tlLmJvZHkudG9dO3IuX29uRm9yd2FyZChlKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVDcmVhdGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5mcm9tLnNsaWNlKDAsIC0xMyksCiAgICAgICAgICAgICAgICBuID0geyB0eXBlOiBlLnR5cGUsIGZyb206IGUuYm9keS5zb3VyY2UsIHVybDogciwgc2NoZW1hOiBlLmJvZHkuc2NoZW1hLCB2YWx1ZTogZS5ib2R5LnZhbHVlLCBpZGVudGl0eTogZS5ib2R5LmlkZW50aXR5LCBhY2s6IGZ1bmN0aW9uIGFjayhyKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IDIwMDtyICYmIChuID0gciksIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IG4gfSB9KTsKICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBuKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG4pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVEZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LnJlc291cmNlLAogICAgICAgICAgICAgICAgbiA9IHQuX29ic2VydmVyc1tyXTtpZiAobikgewogICAgICAgICAgICAgIHZhciBvID0geyB0eXBlOiBlLnR5cGUsIHVybDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSwgYWNrOiBmdW5jdGlvbiBhY2socikgewogICAgICAgICAgICAgICAgICB2YXIgbyA9IDIwMDtyICYmIChvID0gciksIDIwMCA9PT0gbyAmJiBuWyJkZWxldGUiXSgpLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiBvLCBzb3VyY2U6IHQuX293bmVyIH0gfSk7CiAgICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgICAgfSBlbHNlIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDQwNCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm93bmVyIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vd25lcjsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZXBvcnRlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvYnNlcnZlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ic2VydmVyczsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gdiwgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiOiA5NSwgIi4vRGF0YU9iamVjdFJlcG9ydGVyIjogOTYsICIuL0RhdGFQcm92aXNpb25hbCI6IDk3LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOiA5LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgMTAwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfWZ1bmN0aW9uIG8oZSkgewogICAgICAgIHZhciB0ID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2ksCiAgICAgICAgICAgIHIgPSAiJDEsJDIsJDMiLAogICAgICAgICAgICBuID0gZS5yZXBsYWNlKHQsIHIpLnNwbGl0KCIsIik7blswXSA9PT0gZSAmJiAoblswXSA9ICJodHRwcyIsIG5bMV0gPSBlKTt2YXIgbyA9IHsgdHlwZTogblswXSwgZG9tYWluOiBuWzFdLCBpZGVudGl0eTogblsyXSB9O3JldHVybiBvOwogICAgICB9ZnVuY3Rpb24gaShlKSB7CiAgICAgICAgcmV0dXJuIGUgPyBKU09OLnBhcnNlKCgwLCBhWyJkZWZhdWx0Il0pKGUpKSA6IHZvaWQgMDsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBzID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL2pzb24vc3RyaW5naWZ5IiksCiAgICAgICAgICBhID0gbihzKTtyLmRpdmlkZVVSTCA9IG8sIHIuZGVlcENsb25lID0gaTsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSI6IDIgfV0gfSwge30sIFs5Ml0pKDkyKTsKfSk7Cgp9KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKfSx7fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gYWN0aXZhdGU7Cgp2YXIgX0h5cGVydHlEaXNjb3ZlcnkgPSByZXF1aXJlKCdzZXJ2aWNlLWZyYW1ld29yay9kaXN0L0h5cGVydHlEaXNjb3ZlcnknKTsKCnZhciBfSHlwZXJ0eURpc2NvdmVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9IeXBlcnR5RGlzY292ZXJ5KTsKCnZhciBfU3luY2hlciA9IHJlcXVpcmUoJ3NlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvU3luY2hlcicpOwoKdmFyIF9FdmVudEVtaXR0ZXIyID0gcmVxdWlyZSgnLi91dGlscy9FdmVudEVtaXR0ZXIuanMnKTsKCnZhciBfRXZlbnRFbWl0dGVyMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0V2ZW50RW1pdHRlcjIpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0gLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgovLyBTZXJ2aWNlIEZyYW1ld29yawoKCi8vIFV0aWxzCgoKdmFyIHN0YXR1cyA9IHsKICBuYW1lOiAnc3RhdHVzJywKICBzdGF0dXM6ICdkaXNjb25uZWN0ZWQnCn07CgovKioKKiBIeXBlcnR5IFByZXNlbmNlOwoqIEBhdXRob3IgQXBpemVlIFtkZXZAYXBpemVlLmNvbV0KKiBAdmVyc2lvbiAwLjEuMAoqLwoKdmFyIFVzZXJTdGF0dXMgPSBmdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhVc2VyU3RhdHVzLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gVXNlclN0YXR1cyhoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VyU3RhdHVzKTsKCiAgICBpZiAoIWh5cGVydHlVUkwpIHRocm93IG5ldyBFcnJvcignVGhlIGh5cGVydHlVUkwgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7CiAgICBpZiAoIWJ1cykgdGhyb3cgbmV3IEVycm9yKCdUaGUgTWluaUJ1cyBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKICAgIGlmICghY29uZmlndXJhdGlvbikgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29uZmlndXJhdGlvbiBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKCiAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoVXNlclN0YXR1cykuY2FsbCh0aGlzLCBoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pKTsKCiAgICB2YXIgZG9tYWluID0gKDAsIF91dGlscy5kaXZpZGVVUkwpKGh5cGVydHlVUkwpLmRvbWFpbjsKCiAgICBfdGhpcy5fc3luY2hlciA9IG5ldyBfU3luY2hlci5TeW5jaGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CgogICAgX3RoaXMuX2h5cGVydHlEaXNjb3ZlcnkgPSBuZXcgX0h5cGVydHlEaXNjb3ZlcnkyLmRlZmF1bHQoaHlwZXJ0eVVSTCwgYnVzKTsKCiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL1VzZXJTdGF0dXNEYXRhU2NoZW1hJzsKCiAgICBfdGhpcy5faHlwZXJ0eVVSTCA9IGh5cGVydHlVUkw7CiAgICBfdGhpcy5fZG9tYWluID0gZG9tYWluOwoKICAgIF90aGlzLl9oZWFydGJlYXQgPSBbXTsKCiAgICBfdGhpcy5fc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgX3RoaXMuX29uTm90aWZpY2F0aW9uKGV2ZW50KTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhVc2VyU3RhdHVzLCBbewogICAga2V5OiAnX29uTm90aWZpY2F0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ob3RpZmljYXRpb24oZXZlbnQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBjb25zb2xlLmluZm8oJ0V2ZW50IFJlY2VpdmVkOiAnLCBldmVudCk7CgogICAgICB0aGlzLnRyaWdnZXIoJ2ludml0YXRpb24nLCBldmVudC5pZGVudGl0eSk7CgogICAgICBldmVudC5hY2soKTsKCiAgICAgIC8vIFN1YnNjcmliZSBIZWxsbyBXb3JsZCBPYmplY3QKICAgICAgdGhpcy5fc3luY2hlci5zdWJzY3JpYmUodGhpcy5fb2JqZWN0RGVzY1VSTCwgZXZlbnQudXJsKS50aGVuKGZ1bmN0aW9uIChzdGF0dXNPYmplY3RPYnNlcnZlcikgewogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0gU3RhdHVzIE9ic2VydmVyIHJlY2VpdmVkIC0tLS0tLS0tLScsIHN0YXR1c09iamVjdE9ic2VydmVyKTsKCiAgICAgICAgX3RoaXMyLnRyaWdnZXIoJ3N0YXR1c0NoYW5nZScsIHsKICAgICAgICAgIGlkZW50aXR5OiBldmVudC5pZGVudGl0eSwKICAgICAgICAgIHN0YXR1czogc3RhdHVzT2JqZWN0T2JzZXJ2ZXIuZGF0YS5zdGF0dXMKICAgICAgICB9KTsKCiAgICAgICAgc3RhdHVzT2JqZWN0T2JzZXJ2ZXIub25DaGFuZ2UoJyonLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJ21lc3NhZ2UgcmVjZWl2ZWQ6JywgZXZlbnQpOwogICAgICAgICAgX3RoaXMyLnRyaWdnZXIoJ3N0YXR1c0NoYW5nZScsIHsKICAgICAgICAgICAgaWRlbnRpdHk6IGV2ZW50LmlkZW50aXR5LAogICAgICAgICAgICBzdGF0dXM6IHN0YXR1c09iamVjdE9ic2VydmVyLmRhdGEuc3RhdHVzCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChzdGF0dXNPYmplY3RPYnNlcnZlci5kYXRhLnN0YXR1cyAhPT0gJ2Rpc2Nvbm5lY3RlZCcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCBoZWFydGJlYXQgY29udHJvbCBvbicsIGV2ZW50LmlkZW50aXR5KTsKICAgICAgICAgICAgaWYgKGV2ZW50LmlkZW50aXR5IGluIF90aGlzMi5faGVhcnRiZWF0KSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzMi5faGVhcnRiZWF0W2V2ZW50LmlkZW50aXR5XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3RoaXMyLl9oZWFydGJlYXRbZXZlbnQuaWRlbnRpdHldID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQuaWRlbnRpdHksICdoYXMgZGlzY29ubmVjdCcpOwogICAgICAgICAgICAgIF90aGlzMi50cmlnZ2VyKCdzdGF0dXNDaGFuZ2UnLCB7CiAgICAgICAgICAgICAgICBpZGVudGl0eTogZXZlbnQuaWRlbnRpdHksCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdkaXNjb25uZWN0ZWQnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIDEwMDAwKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgY29uc29sZS5sb2coZXZlbnQuaWRlbnRpdHkuZW1haWwsICdoYXMgc3Vic2NyaWJlIHRvIG15IHN0YXR1cyBkYXRhIG9iamVjdCwgc2VuZCBpbnZpdGUgdG8gbGlzdGVuIG1pbmUnKTsKICAgICAgICBfdGhpczIuX3N0YXR1c09iamVjdFJlcG9ydGVyLmludml0ZU9ic2VydmVycyhbZXZlbnQuZnJvbV0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBjcmVhdGUgYSBuZXcgc3RhdHVzIG9iamVjdCBzeW5jaGVyCiAgICAgKiBAcGFyYW0gIHtVUkwuVXNlclVSTH0gcGFydGljaXBhbnRzIExpc3Qgb2YgVXNlciBhbGxvd2VkCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICovCgogIH0sIHsKICAgIGtleTogJ2NyZWF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKHBhcnRpY2lwYW50cykgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHN0YXR1cy5zdGF0dXMgPSAnY29ubmVjdGVkJzsKICAgICAgICBzdGF0dXMub3duZXIgPSBfdGhpczMuX2h5cGVydHlVUkw7CiAgICAgICAgc3RhdHVzLm5hbWUgPSAncHJlc2VuY2UnOwoKICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE1hcHBpbmcgUGFydGljcGFudHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTsKICAgICAgICBfdGhpczMuX21hcHBpbmdVc2VyKHBhcnRpY2lwYW50cykudGhlbihmdW5jdGlvbiAoaHlwZXJ0aWVzKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMzLmNyZWF0ZVN5bmNoZXIoaHlwZXJ0aWVzLCBzdGF0dXMpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHN0YXR1c09iamVjdFJlcG9ydGVyKSB7CiAgICAgICAgICBfdGhpczMuX3N0YXR1c09iamVjdFJlcG9ydGVyID0gc3RhdHVzT2JqZWN0UmVwb3J0ZXI7CiAgICAgICAgICBzdGF0dXNPYmplY3RSZXBvcnRlci5vblN1YnNjcmlwdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLSBTdGF0dXMgUmVwb3J0ZXIgcmVjZWl2ZWQgc3Vic2NyaXB0aW9uIHJlcXVlc3QgLS0tLS0tLS0tJywgZXZlbnQpOwogICAgICAgICAgICBldmVudC5hY2NlcHQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdjcmVhdGVTeW5jaGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTeW5jaGVyKGh5cGVydGllcywgc3RhdHVzKSB7CiAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgQ3JlYXRlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLCBoeXBlcnRpZXMsIHN0YXR1cyk7CiAgICAgIHJldHVybiB0aGlzLl9zeW5jaGVyLmNyZWF0ZSh0aGlzLl9vYmplY3REZXNjVVJMLCBoeXBlcnRpZXMsIHN0YXR1cyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnam9pbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gam9pbihyZXNvdXJjZSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgc3Vic2NyaWJlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTsKCiAgICAgICAgX3RoaXM0Ll9zeW5jaGVyLnN1YnNjcmliZShfdGhpczQuX29iamVjdERlc2NVUkwsIHJlc291cmNlKS50aGVuKGZ1bmN0aW9uIChkYXRhT2JqZWN0T2JzZXJ2ZXIpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnRGF0YSBPYmplY3QgT2JzZXJ2ZXI6ICcsIGRhdGFPYmplY3RPYnNlcnZlcik7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3NldFN0YXR1cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U3RhdHVzKG5ld1N0YXR1cykgewogICAgICBjb25zb2xlLmxvZygnY2hhbmdlIHN0YXR1cyB0bycsIG5ld1N0YXR1cyk7CiAgICAgIHRoaXMuX3N0YXR1c09iamVjdFJlcG9ydGVyLmRhdGEuc3RhdHVzID0gbmV3U3RhdHVzOwogICAgfQogIH0sIHsKICAgIGtleTogJ19tYXBwaW5nVXNlcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX21hcHBpbmdVc2VyKHVzZXJMaXN0KSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gX21hcHBpbmdVc2VyIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLCB1c2VyTGlzdCk7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBoeXBlcnRpZXMgPSBbXTsKICAgICAgICB2YXIgY291bnQgPSAwOwoKICAgICAgICBpZiAodXNlckxpc3QubGVuZ3RoID09PSAwKSByZWplY3QoaHlwZXJ0aWVzKTsKCiAgICAgICAgdmFyIHJlc3VsdFVzZXJzID0gZnVuY3Rpb24gcmVzdWx0VXNlcnMoKSB7CiAgICAgICAgICBpZiAoY291bnQgPT09IHVzZXJMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICBjb25zb2xlLmluZm8oJ0hhdmUgJyArIGh5cGVydGllcy5sZW5ndGggKyAndXNlcnMgZm91bmQ7Jyk7CiAgICAgICAgICAgIHJlc29sdmUoaHlwZXJ0aWVzKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgYWN0aXZlVXNlcnMgPSBmdW5jdGlvbiBhY3RpdmVVc2Vycyh1c2VyKSB7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgaHlwZXJ0aWVzLnB1c2godXNlci5oeXBlcnR5VVJMKTsKICAgICAgICAgIHJlc3VsdFVzZXJzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGluYWN0aXZlVXNlcnMgPSBmdW5jdGlvbiBpbmFjdGl2ZVVzZXJzKCkgewogICAgICAgICAgY291bnQrKzsKICAgICAgICAgIHJlc3VsdFVzZXJzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdXNlckxpc3QuZm9yRWFjaChmdW5jdGlvbiAodXNlcikgewogICAgICAgICAgY29uc29sZS5sb2codXNlcik7CiAgICAgICAgICBpZiAodXNlci5lbWFpbC5sZW5ndGgpIHsKICAgICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gX21hcHBpbmdVc2VyIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLCB1c2VyTGlzdCk7CiAgICAgICAgICAgIHJldHVybiBfdGhpczUuX2h5cGVydHlEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnR5UGVyVXNlcih1c2VyLmVtYWlsLCB1c2VyLmRvbWFpbikudGhlbihhY3RpdmVVc2VycykuY2F0Y2goaW5hY3RpdmVVc2Vycyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFVzZXJTdGF0dXM7Cn0oX0V2ZW50RW1pdHRlcjMuZGVmYXVsdCk7CgpmdW5jdGlvbiBhY3RpdmF0ZShoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKCiAgcmV0dXJuIHsKICAgIG5hbWU6ICdVc2VyU3RhdHVzJywKICAgIGluc3RhbmNlOiBuZXcgVXNlclN0YXR1cyhoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pCiAgfTsKfQoKfSx7Ii4vdXRpbHMvRXZlbnRFbWl0dGVyLmpzIjo1LCIuL3V0aWxzL3V0aWxzLmpzIjo2LCJzZXJ2aWNlLWZyYW1ld29yay9kaXN0L0h5cGVydHlEaXNjb3ZlcnkiOjIsInNlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvU3luY2hlciI6M31dLDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKLyoqCiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgoqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQoqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgoqCiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoqCiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKKgoqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKiovCgovKioKICogRXZlbnRFbWl0dGVyCiAqIEFsbCBjbGFzc2VzIHdoaWNoIGV4dGVuZHMgdGhpcywgY2FuIGhhdmUgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdHJpZ2dlciBldmVudHM7CiAqLwoKdmFyIEV2ZW50RW1pdHRlciA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXZlbnRFbWl0dGVyKTsKICB9CgogIF9jcmVhdGVDbGFzcyhFdmVudEVtaXR0ZXIsIFt7CiAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKCgogICAgLyoqCiAgICAgKiBhZGRFdmVudExpc3RlbmVyIGxpc3RlbiBmb3IgYW4gZXZlbnRUeXBlCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICAgICAgZXZlbnRUeXBlIC0gbGlzdGVuaW5nIGZvciB0aGlzIHR5cGUgb2YgZXZlbnQKICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgICAgICBjYiAgICAgICAgLSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IGl0IGlzIGludm9rZWQKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpc1tldmVudFR5cGVdID0gY2I7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGV2ZW50VHlwZQogICAgICogQHBhcmFtICB7c3RyaW5nfSBldmVudFR5cGUgLSBldmVudCB3aWxsIGJlIGludm9rZWQKICAgICAqIEBwYXJhbSAge29iamVjdH0gcGFyYW1zIC0gcGFyYW1ldGVycyB3aWxsIGJlIHBhc3NlZCB0byB0aGUgYWRkRXZlbnRMaXN0ZW5lcgogICAgICovCgogIH0sIHsKICAgIGtleTogInRyaWdnZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnRUeXBlLCBwYXJhbXMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpc1tldmVudFR5cGVdKSB7CiAgICAgICAgX3RoaXNbZXZlbnRUeXBlXShwYXJhbXMpOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRXZlbnRFbWl0dGVyOwp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBFdmVudEVtaXR0ZXI7Cgp9LHt9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChwcm9jZXNzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRpdmlkZVVSTCA9IGRpdmlkZVVSTDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CmV4cG9ydHMuZ2V0Q29uZmlnID0gZ2V0Q29uZmlnOwpleHBvcnRzLmdldFVzZXJNZWRpYSA9IGdldFVzZXJNZWRpYTsKZXhwb3J0cy5zZXJpYWxpemUgPSBzZXJpYWxpemU7CmV4cG9ydHMuZ2V0VGVtcGxhdGUgPSBnZXRUZW1wbGF0ZTsKLyoqCiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQogKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAogKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKiovCgovLyBqc2hpbnQgYnJvd3Nlcjp0cnVlLCBqcXVlcnk6IHRydWUKLy8ganNoaW50IHZhcnN0bXQ6IHRydWUKLyogZ2xvYmFsIEhhbmRsZWJhcnMgKi8KCi8qKgogKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsCiAqIEBtb2R1bGUgdXRpbHMKICovCgovKioKICogQHR5cGVkZWYgZGl2aWRlVVJMCiAqIEB0eXBlIE9iamVjdAogKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkwKICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTAogKi8KCi8qKgogKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHkKICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3MKICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTAogKi8KZnVuY3Rpb24gZGl2aWRlVVJMKHVybCkgewoKICAvLyBsZXQgcmUgPSAvKFthLXpBLVotXSopPzpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKSooXC9bXC9cZFx3XC4tXSopKig/OltcP10pKiguKykqL2dpOwogIHZhciByZSA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpOwogIHZhciBzdWJzdCA9ICckMSwkMiwkMyc7CiAgdmFyIHBhcnRzID0gdXJsLnJlcGxhY2UocmUsIHN1YnN0KS5zcGxpdCgnLCcpOwoKICAvLyBJZiB0aGUgdXJsIGhhcyBubyBwcm90b2NvbCwgdGhlIGRlZmF1bHQgcHJvdG9jb2wgc2V0IGlzIGh0dHBzCiAgaWYgKHBhcnRzWzBdID09PSB1cmwpIHsKICAgIHBhcnRzWzBdID0gJ2h0dHBzJzsKICAgIHBhcnRzWzFdID0gdXJsOwogIH0KCiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YQogKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkCiAqIEByZXR1cm4ge09iamVjdH0KICovCmZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHsKICAvL1RPRE86IHNpbXBsZSBidXQgaW5lZmZpY2llbnQgSlNPTiBkZWVwIGNsb25lLi4uCiAgaWYgKG9iaikgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCi8qKgogKiBHZXQgdGhlIGNvbmZpZ3VyYXRpb24gZnJvbSBhbiBqc29uIGZpbGU7CiAqIEBwYXJhbSAge0pTT05PYmplY3R9IGpzb25GaWxlCiAqIEByZXR1cm4ge29iamVjdH0KICovCmZ1bmN0aW9uIGdldENvbmZpZyhKU09OT2JqZWN0KSB7CiAgY29uc29sZS5sb2cocHJvY2Vzcy5lbnYuZW52aXJvbm1lbnQpOwogIHJldHVybiBKU09OT2JqZWN0W3Byb2Nlc3MuZW52LmVudmlyb25tZW50XTsKfQoKLyoqCiAqIEdldCBXZWJSVEMgQVBJIHJlc291cmNlcwogKiBAcGFyYW0gIHtPYmplY3R9ICAgICBvcHRpb25zIE9iamVjdCBjb250YWluaW5nIHRoZSBpbmZvcm1hdGlvbiB0aGF0IHJlc291cmNlcyB3aWxsIGJlIHVzZWQgKGNhbWVyYSwgbWljLCByZXNvbHV0aW9uLCBldGMpOwogKiBAcmV0dXJuIHtQcm9taXNlfQogKi8KZnVuY3Rpb24gZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKSB7CgogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpLnRoZW4oZnVuY3Rpb24gKG1lZGlhU3RyZWFtKSB7CiAgICAgIHJlc29sdmUobWVkaWFTdHJlYW0pOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICByZWplY3QocmVhc29uKTsKICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiBzZXJpYWxpemUoKSB7CgogICQuZm4uc2VyaWFsaXplT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG8gPSB7fTsKICAgIHZhciBhID0gdGhpcy5zZXJpYWxpemVBcnJheSgpOwogICAgJC5lYWNoKGEsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKG9bdGhpcy5uYW1lXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCFvW3RoaXMubmFtZV0ucHVzaCkgewogICAgICAgICAgb1t0aGlzLm5hbWVdID0gW29bdGhpcy5uYW1lXV07CiAgICAgICAgfQoKICAgICAgICBvW3RoaXMubmFtZV0ucHVzaCh0aGlzLnZhbHVlIHx8ICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvW3RoaXMubmFtZV0gPSB0aGlzLnZhbHVlIHx8ICcnOwogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gbzsKICB9OwoKICAkLmZuLnNlcmlhbGl6ZU9iamVjdEFycmF5ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG8gPSB7fTsKICAgIHZhciBhID0gdGhpcy5zZXJpYWxpemVBcnJheSgpOwogICAgJC5lYWNoKGEsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKG9bdGhpcy5uYW1lXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCFvW3RoaXMubmFtZV0ucHVzaCkgewogICAgICAgICAgb1t0aGlzLm5hbWVdID0gW29bdGhpcy5uYW1lXV07CiAgICAgICAgfQoKICAgICAgICBvW3RoaXMubmFtZV0ucHVzaCh0aGlzLnZhbHVlIHx8ICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIW9bdGhpcy5uYW1lXSkgb1t0aGlzLm5hbWVdID0gW107CiAgICAgICAgb1t0aGlzLm5hbWVdLnB1c2godGhpcy52YWx1ZSB8fCAnJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBvOwogIH07Cn0KCmZ1bmN0aW9uIGdldFRlbXBsYXRlKHBhdGgsIHNjcmlwdCkgewoKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgIGlmIChIYW5kbGViYXJzLnRlbXBsYXRlcyA9PT0gdW5kZWZpbmVkIHx8IEhhbmRsZWJhcnMudGVtcGxhdGVzW25hbWVdID09PSB1bmRlZmluZWQpIHsKICAgICAgSGFuZGxlYmFycy50ZW1wbGF0ZXMgPSB7fTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc29sdmUoSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0pOwogICAgfQoKICAgIHZhciB0ZW1wbGF0ZUZpbGUgPSAkLmFqYXgoewogICAgICB1cmw6IHBhdGggKyAnLmhicycsCiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkgewogICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzW25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKGRhdGEpOwogICAgICB9LAoKICAgICAgZmFpbDogZnVuY3Rpb24gZmFpbChyZWFzb24pIHsKICAgICAgICByZXR1cm4gcmVhc29uOwogICAgICB9CiAgICB9KTsKCiAgICB2YXIgc2NyaXB0RmlsZSA9ICQuZ2V0U2NyaXB0KHNjcmlwdCk7CgogICAgdmFyIHJlcXVlc3RzID0gW107CiAgICBpZiAocGF0aCkgcmVxdWVzdHMucHVzaCh0ZW1wbGF0ZUZpbGUpOwogICAgaWYgKHNjcmlwdCkgcmVxdWVzdHMucHVzaChzY3JpcHRGaWxlKTsKCiAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgIHJlc29sdmUoSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0pOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICByZWplY3QocmVhc29uKTsKICAgIH0pOwogIH0pOwp9Cgp9KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSkKfSx7Il9wcm9jZXNzIjoxfV19LHt9LFs0XSkoNCkKfSk7",
      "sourceCodeClassname": "UserStatusHyperty",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of UserStatusHyperty",
    "objectName": "UserStatusHyperty",
    "configuration": {
      "url": "wss://msg-node.localhost:9090/ws"
    },
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  },
  "UserStatusHyperty": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCkuZGVmYXVsdH19KShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXIKCnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTsKdmFyIHF1ZXVlID0gW107CnZhciBkcmFpbmluZyA9IGZhbHNlOwp2YXIgY3VycmVudFF1ZXVlOwp2YXIgcXVldWVJbmRleCA9IC0xOwoKZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkgewogICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZHJhaW5pbmcgPSBmYWxzZTsKICAgIGlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7CiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgfQogICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIGRyYWluUXVldWUoKTsKICAgIH0KfQoKZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsKICAgIGlmIChkcmFpbmluZykgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChjbGVhblVwTmV4dFRpY2spOwogICAgZHJhaW5pbmcgPSB0cnVlOwoKICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7CiAgICB3aGlsZSAobGVuKSB7CiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7CiAgICAgICAgcXVldWUgPSBbXTsKICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgfQogICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7Cn0KCnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwogICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHsKICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApOwogICAgfQp9OwoKLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0cwpmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgIHRoaXMuZnVuID0gZnVuOwogICAgdGhpcy5hcnJheSA9IGFycmF5Owp9Ckl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOwp9Owpwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInOwpwcm9jZXNzLmJyb3dzZXIgPSB0cnVlOwpwcm9jZXNzLmVudiA9IHt9Owpwcm9jZXNzLmFyZ3YgPSBbXTsKcHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzCnByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCmZ1bmN0aW9uIG5vb3AoKSB7fQoKcHJvY2Vzcy5vbiA9IG5vb3A7CnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLm9uY2UgPSBub29wOwpwcm9jZXNzLm9mZiA9IG5vb3A7CnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CnByb2Nlc3MuZW1pdCA9IG5vb3A7Cgpwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwp9OwoKcHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJy8nOwp9Owpwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTsKfTsKcHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAwOwp9OwoKfSx7fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoZ2xvYmFsKXsKInVzZSBzdHJpY3QiOwoKdmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKLyoqCiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgoqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQoqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgoqCiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoqCiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKKgoqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKiovCgovLyBEaXN0cmlidXRpb24gZmlsZSBmb3IgSHlwZXJ0eURpc2NvdmVyeS5qcwovLyB2ZXJzaW9uOiAwLjIuMAoKIWZ1bmN0aW9uIChlKSB7CiAgaWYgKCJvYmplY3QiID09ICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBtb2R1bGUpIG1vZHVsZS5leHBvcnRzID0gZSgpO2Vsc2UgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kKSBkZWZpbmUoW10sIGUpO2Vsc2UgewogICAgdmFyIHQ7dCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogdGhpcywgdC5IeXBlcnR5RGlzY292ZXJ5ID0gZSgpOwogIH0KfShmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIGUodCwgciwgbikgewogICAgZnVuY3Rpb24gbyhjLCBzKSB7CiAgICAgIGlmICghcltjXSkgewogICAgICAgIGlmICghdFtjXSkgewogICAgICAgICAgdmFyIHUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmU7aWYgKCFzICYmIHUpIHJldHVybiB1KGMsICEwKTtpZiAoaSkgcmV0dXJuIGkoYywgITApO3ZhciBhID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBjICsgIiciKTt0aHJvdyBhLmNvZGUgPSAiTU9EVUxFX05PVF9GT1VORCIsIGE7CiAgICAgICAgfXZhciBmID0gcltjXSA9IHsgZXhwb3J0czoge30gfTt0W2NdWzBdLmNhbGwoZi5leHBvcnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHIgPSB0W2NdWzFdW2VdO3JldHVybiBvKHIgPyByIDogZSk7CiAgICAgICAgfSwgZiwgZi5leHBvcnRzLCBlLCB0LCByLCBuKTsKICAgICAgfXJldHVybiByW2NdLmV4cG9ydHM7CiAgICB9Zm9yICh2YXIgaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZSwgYyA9IDA7IGMgPCBuLmxlbmd0aDsgYysrKSB7CiAgICAgIG8obltjXSk7CiAgICB9cmV0dXJuIG87CiAgfSh7IDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL2pzb24vc3RyaW5naWZ5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiOiA2IH1dLCAyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDcgfV0sIDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3Byb21pc2UiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIjogOCB9XSwgNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgci5fX2VzTW9kdWxlID0gITAsIHJbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksCiAgICAgICAgICBpID0gbihvKTtyWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgdmFyIG4gPSB0W3JdO24uZW51bWVyYWJsZSA9IG4uZW51bWVyYWJsZSB8fCAhMSwgbi5jb25maWd1cmFibGUgPSAhMCwgInZhbHVlIiBpbiBuICYmIChuLndyaXRhYmxlID0gITApLCAoMCwgaVsiZGVmYXVsdCJdKShlLCBuLmtleSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfXJldHVybiBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgcmV0dXJuIHIgJiYgZSh0LnByb3RvdHlwZSwgciksIG4gJiYgZSh0LCBuKSwgdDsKICAgICAgICB9OwogICAgICB9KCk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDIgfV0sIDY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvX2NvcmUiKSwKICAgICAgICAgIG8gPSBuLkpTT04gfHwgKG4uSlNPTiA9IHsgc3RyaW5naWZ5OiBKU09OLnN0cmluZ2lmeSB9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBvLnN0cmluZ2lmeS5hcHBseShvLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2IH1dLCA3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSIpO3ZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy9fY29yZSIpLk9iamVjdDt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLmRlZmluZVByb3BlcnR5KGUsIHQsIHIpOwogICAgICB9OwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy9fY29yZSI6IDE2LCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eSI6IDcxIH1dLCA4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgZSgiLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyIpLCBlKCIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiKSwgZSgiLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIiksIGUoIi4uL21vZHVsZXMvZXM2LnByb21pc2UiKSwgdC5leHBvcnRzID0gZSgiLi4vbW9kdWxlcy9fY29yZSIpLlByb21pc2U7CiAgICB9LCB7ICIuLi9tb2R1bGVzL19jb3JlIjogMTYsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogNzIsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogNzMsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA3NCwgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDc1IH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhIGZ1bmN0aW9uISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHt9OwogICAgfSwge31dLCAxMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBuKSB7CiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpIHx8IHZvaWQgMCAhPT0gbiAmJiBuIGluIGUpIHRocm93IFR5cGVFcnJvcihyICsgIjogaW5jb3JyZWN0IGludm9jYXRpb24hIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDEyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1sZW5ndGgiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pbmRleCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByLCBjKSB7CiAgICAgICAgICB2YXIgcywKICAgICAgICAgICAgICB1ID0gbih0KSwKICAgICAgICAgICAgICBhID0gbyh1Lmxlbmd0aCksCiAgICAgICAgICAgICAgZiA9IGkoYywgYSk7aWYgKGUgJiYgciAhPSByKSB7CiAgICAgICAgICAgIGZvciAoOyBhID4gZjspIHsKICAgICAgICAgICAgICBpZiAocyA9IHVbZisrXSwgcyAhPSBzKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBmb3IgKDsgYSA+IGY7IGYrKykgewogICAgICAgICAgICBpZiAoKGUgfHwgZiBpbiB1KSAmJiB1W2ZdID09PSByKSByZXR1cm4gZSB8fCBmIHx8IDA7CiAgICAgICAgICB9cmV0dXJuICFlICYmIC0xOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbmRleCI6IDYxLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tbGVuZ3RoIjogNjQgfV0sIDE0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19jb2YiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgidG9TdHJpbmdUYWciKSwKICAgICAgICAgIGkgPSAiQXJndW1lbnRzIiA9PSBuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpLAogICAgICAgICAgYyA9IGZ1bmN0aW9uIGMoZSwgdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gZVt0XTsKICAgICAgICB9IGNhdGNoIChyKSB7fQogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsIHIsIHM7cmV0dXJuIHZvaWQgMCA9PT0gZSA/ICJVbmRlZmluZWQiIDogbnVsbCA9PT0gZSA/ICJOdWxsIiA6ICJzdHJpbmciID09IHR5cGVvZiAociA9IGModCA9IE9iamVjdChlKSwgbykpID8gciA6IGkgPyBuKHQpIDogIk9iamVjdCIgPT0gKHMgPSBuKHQpKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LmNhbGxlZSA/ICJBcmd1bWVudHMiIDogczsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fd2tzIjogNjggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAxNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMi40LjAiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDE3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19hLWZ1bmN0aW9uIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBpZiAobihlKSwgdm9pZCAwID09PSB0KSByZXR1cm4gZTtzd2l0Y2ggKHIpIHtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgcik7CiAgICAgICAgICAgIH07Y2FzZSAyOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIsIG4pIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIsIG4pOwogICAgICAgICAgICB9O2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuLCBvKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuLCBvKTsKICAgICAgICAgICAgfTt9cmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlLmFwcGx5KHQsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5IH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDE5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vX2ZhaWxzIikoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19mYWlscyI6IDIzIH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9fZ2xvYmFsIikuZG9jdW1lbnQsCiAgICAgICAgICBpID0gbihvKSAmJiBuKG8uY3JlYXRlRWxlbWVudCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaSA/IG8uY3JlYXRlRWxlbWVudChlKSA6IHt9OwogICAgICB9OwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19pcy1vYmplY3QiOiAzMyB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAiY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mIi5zcGxpdCgiLCIpOwogICAgfSwge31dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYyA9IGUoIi4vX2hpZGUiKSwKICAgICAgICAgIHMgPSAicHJvdG90eXBlIiwKICAgICAgICAgIHUgPSBmdW5jdGlvbiB1KGUsIHQsIHIpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgICAgZiwKICAgICAgICAgICAgXywKICAgICAgICAgICAgbCA9IGUgJiB1LkYsCiAgICAgICAgICAgIGQgPSBlICYgdS5HLAogICAgICAgICAgICBwID0gZSAmIHUuUywKICAgICAgICAgICAgdiA9IGUgJiB1LlAsCiAgICAgICAgICAgIHkgPSBlICYgdS5CLAogICAgICAgICAgICBoID0gZSAmIHUuVywKICAgICAgICAgICAgYiA9IGQgPyBvIDogb1t0XSB8fCAob1t0XSA9IHt9KSwKICAgICAgICAgICAgbSA9IGJbc10sCiAgICAgICAgICAgIGcgPSBkID8gbiA6IHAgPyBuW3RdIDogKG5bdF0gfHwge30pW3NdO2QgJiYgKHIgPSB0KTtmb3IgKGEgaW4gcikgewogICAgICAgICAgZiA9ICFsICYmIGcgJiYgdm9pZCAwICE9PSBnW2FdLCBmICYmIGEgaW4gYiB8fCAoXyA9IGYgPyBnW2FdIDogclthXSwgYlthXSA9IGQgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZ1thXSA/IHJbYV0gOiB5ICYmIGYgPyBpKF8sIG4pIDogaCAmJiBnW2FdID09IF8gPyBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdCA9IGZ1bmN0aW9uIHQoX3QsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIGUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGUoKTtjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90KTtjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBlKF90LCByKTt9cmV0dXJuIG5ldyBlKF90LCByLCBuKTsKICAgICAgICAgICAgICB9cmV0dXJuIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfTtyZXR1cm4gdFtzXSA9IGVbc10sIHQ7CiAgICAgICAgICB9KF8pIDogdiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBfID8gaShGdW5jdGlvbi5jYWxsLCBfKSA6IF8sIHYgJiYgKChiLnZpcnR1YWwgfHwgKGIudmlydHVhbCA9IHt9KSlbYV0gPSBfLCBlICYgdS5SICYmIG0gJiYgIW1bYV0gJiYgYyhtLCBhLCBfKSkpOwogICAgICAgIH0KICAgICAgfTt1LkYgPSAxLCB1LkcgPSAyLCB1LlMgPSA0LCB1LlAgPSA4LCB1LkIgPSAxNiwgdS5XID0gMzIsIHUuVSA9IDY0LCB1LlIgPSAxMjgsIHQuZXhwb3J0cyA9IHU7CiAgICB9LCB7ICIuL19jb3JlIjogMTYsICIuL19jdHgiOiAxNywgIi4vX2dsb2JhbCI6IDI1LCAiLi9faGlkZSI6IDI3IH1dLCAyMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiAhIWUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gITA7CiAgICAgICAgfQogICAgICB9OwogICAgfSwge31dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBvID0gZSgiLi9faXRlci1jYWxsIiksCiAgICAgICAgICBpID0gZSgiLi9faXMtYXJyYXktaXRlciIpLAogICAgICAgICAgYyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGUoIi4vX3RvLWxlbmd0aCIpLAogICAgICAgICAgdSA9IGUoIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIiksCiAgICAgICAgICBhID0ge30sCiAgICAgICAgICBmID0ge30sCiAgICAgICAgICByID0gdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIF8sIGwpIHsKICAgICAgICB2YXIgZCwKICAgICAgICAgICAgcCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgeSwKICAgICAgICAgICAgaCA9IGwgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZTsKICAgICAgICB9IDogdShlKSwKICAgICAgICAgICAgYiA9IG4ociwgXywgdCA/IDIgOiAxKSwKICAgICAgICAgICAgbSA9IDA7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGgpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgaXRlcmFibGUhIik7aWYgKGkoaCkpIHsKICAgICAgICAgIGZvciAoZCA9IHMoZS5sZW5ndGgpOyBkID4gbTsgbSsrKSB7CiAgICAgICAgICAgIGlmICh5ID0gdCA/IGIoYyhwID0gZVttXSlbMF0sIHBbMV0pIDogYihlW21dKSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgZm9yICh2ID0gaC5jYWxsKGUpOyAhKHAgPSB2Lm5leHQoKSkuZG9uZTspIHsKICAgICAgICAgIGlmICh5ID0gbyh2LCBiLCBwLnZhbHVlLCB0KSwgeSA9PT0gYSB8fCB5ID09PSBmKSByZXR1cm4geTsKICAgICAgICB9CiAgICAgIH07ci5CUkVBSyA9IGEsIHIuUkVUVVJOID0gZjsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fY3R4IjogMTcsICIuL19pcy1hcnJheS1pdGVyIjogMzIsICIuL19pdGVyLWNhbGwiOiAzNCwgIi4vX3RvLWxlbmd0aCI6IDY0LCAiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiOiA2OSB9XSwgMjU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHQuZXhwb3J0cyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgd2luZG93Lk1hdGggPT0gTWF0aCA/IHdpbmRvdyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZiA6IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7Im51bWJlciIgPT0gdHlwZW9mIF9fZyAmJiAoX19nID0gbik7CiAgICB9LCB7fV0sIDI2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDI3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uZihlLCB0LCBvKDEsIHIpKTsKICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIGVbdF0gPSByLCBlOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwIH1dLCAyODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2dsb2JhbCIpLmRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgIH0sIHsgIi4vX2dsb2JhbCI6IDI1IH1dLCAyOTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9ICFlKCIuL19kZXNjcmlwdG9ycyIpICYmICFlKCIuL19mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSgiLi9fZG9tLWNyZWF0ZSIpKCJkaXYiKSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYTsKICAgICAgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZmFpbHMiOiAyMyB9XSwgMzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHZhciBuID0gdm9pZCAwID09PSByO3N3aXRjaCAodC5sZW5ndGgpIHtjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBuID8gZSgpIDogZS5jYWxsKHIpO2Nhc2UgMToKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0pIDogZS5jYWxsKHIsIHRbMF0pO2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0pO2Nhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0pO2Nhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIG4gPyBlKHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pIDogZS5jYWxsKHIsIHRbMF0sIHRbMV0sIHRbMl0sIHRbM10pO31yZXR1cm4gZS5hcHBseShyLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2NvZiIpO3QuZXhwb3J0cyA9IE9iamVjdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN0cmluZyIgPT0gbihlKSA/IGUuc3BsaXQoIiIpIDogT2JqZWN0KGUpOwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUgfV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19pdGVyYXRvcnMiKSwKICAgICAgICAgIG8gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGkgPSBBcnJheS5wcm90b3R5cGU7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlICYmIChuLkFycmF5ID09PSBlIHx8IGlbb10gPT09IGUpOwogICAgICB9OwogICAgfSwgeyAiLi9faXRlcmF0b3JzIjogMzksICIuL193a3MiOiA2OCB9XSwgMzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAib2JqZWN0IiA9PSAodHlwZW9mIGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGUpKSA/IG51bGwgIT09IGUgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBlOwogICAgICB9OwogICAgfSwge31dLCAzNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIG8gPyB0KG4ocilbMF0sIHJbMV0pIDogdChyKTsKICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICB2YXIgYyA9IGVbInJldHVybiJdO3Rocm93IHZvaWQgMCAhPT0gYyAmJiBuKGMuY2FsbChlKSksIGk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIgfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1jcmVhdGUiKSwKICAgICAgICAgIG8gPSBlKCIuL19wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi9fc2V0LXRvLXN0cmluZy10YWciKSwKICAgICAgICAgIGMgPSB7fTtlKCIuL19oaWRlIikoYywgZSgiLi9fd2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuKGMsIHsgbmV4dDogbygxLCByKSB9KSwgaShlLCB0ICsgIiBJdGVyYXRvciIpOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3LCAiLi9fb2JqZWN0LWNyZWF0ZSI6IDQyLCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fc2V0LXRvLXN0cmluZy10YWciOiA1NSwgIi4vX3drcyI6IDY4IH1dLCAzNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuL19saWJyYXJ5IiksCiAgICAgICAgICBvID0gZSgiLi9fZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi9fcmVkZWZpbmUiKSwKICAgICAgICAgIGMgPSBlKCIuL19oaWRlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faXRlcmF0b3JzIiksCiAgICAgICAgICBhID0gZSgiLi9faXRlci1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgXyA9IGUoIi4vX29iamVjdC1ncG8iKSwKICAgICAgICAgIGwgPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIGQgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBwID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgdiA9ICJrZXlzIiwKICAgICAgICAgIHkgPSAidmFsdWVzIiwKICAgICAgICAgIGggPSBmdW5jdGlvbiBoKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBiLCBtLCBnLCBqKSB7CiAgICAgICAgYShyLCB0LCBiKTt2YXIgeCwKICAgICAgICAgICAgdywKICAgICAgICAgICAgaywKICAgICAgICAgICAgTyA9IGZ1bmN0aW9uIE8oZSkgewogICAgICAgICAgaWYgKCFkICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSB2OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHk6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIE0gPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIFAgPSBtID09IHksCiAgICAgICAgICAgIFMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBUID0gRVtsXSB8fCBFW3BdIHx8IG0gJiYgRVttXSwKICAgICAgICAgICAgQSA9IFQgfHwgTyhtKSwKICAgICAgICAgICAgVSA9IG0gPyBQID8gTygiZW50cmllcyIpIDogQSA6IHZvaWQgMCwKICAgICAgICAgICAgQyA9ICJBcnJheSIgPT0gdCA/IEUuZW50cmllcyB8fCBUIDogVDtpZiAoQyAmJiAoayA9IF8oQy5jYWxsKG5ldyBlKCkpKSwgayAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiAoZihrLCBNLCAhMCksIG4gfHwgcyhrLCBsKSB8fCBjKGssIGwsIGgpKSksIFAgJiYgVCAmJiBULm5hbWUgIT09IHkgJiYgKFMgPSAhMCwgQSA9IGZ1bmN0aW9uIEEoKSB7CiAgICAgICAgICByZXR1cm4gVC5jYWxsKHRoaXMpOwogICAgICAgIH0pLCBuICYmICFqIHx8ICFkICYmICFTICYmIEVbbF0gfHwgYyhFLCBsLCBBKSwgdVt0XSA9IEEsIHVbTV0gPSBoLCBtKSBpZiAoeCA9IHsgdmFsdWVzOiBQID8gQSA6IE8oeSksIGtleXM6IGcgPyBBIDogTyh2KSwgZW50cmllczogVSB9LCBqKSBmb3IgKHcgaW4geCkgewogICAgICAgICAgdyBpbiBFIHx8IGkoRSwgdywgeFt3XSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKGQgfHwgUyksIHQsIHgpO3JldHVybiB4OwogICAgICB9OwogICAgfSwgeyAiLi9fZXhwb3J0IjogMjIsICIuL19oYXMiOiAyNiwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXItY3JlYXRlIjogMzUsICIuL19pdGVyYXRvcnMiOiAzOSwgIi4vX2xpYnJhcnkiOiA0MCwgIi4vX29iamVjdC1ncG8iOiA0NiwgIi4vX3JlZGVmaW5lIjogNTIsICIuL19zZXQtdG8tc3RyaW5nLXRhZyI6IDU1LCAiLi9fd2tzIjogNjggfV0sIDM3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL193a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChjKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgYyA9IGlbbl0oKTtjLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IHIgPSAhMCB9OwogICAgICAgICAgfSwgaVtuXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICB9LCBlKGkpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9cmV0dXJuIHI7CiAgICAgIH07CiAgICB9LCB7ICIuL193a3MiOiA2OCB9XSwgMzg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiB7IHZhbHVlOiB0LCBkb25lOiAhIWUgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgMzk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7fTsKICAgIH0sIHt9XSwgNDA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNDE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBpID0gbi5NdXRhdGlvbk9ic2VydmVyIHx8IG4uV2ViS2l0TXV0YXRpb25PYnNlcnZlciwKICAgICAgICAgIGMgPSBuLnByb2Nlc3MsCiAgICAgICAgICBzID0gbi5Qcm9taXNlLAogICAgICAgICAgdSA9ICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShjKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHQsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGEgPSBmdW5jdGlvbiBhKCkgewogICAgICAgICAgdmFyIG4sIG87Zm9yICh1ICYmIChuID0gYy5kb21haW4pICYmIG4uZXhpdCgpOyBlOykgewogICAgICAgICAgICBvID0gZS5mbiwgZSA9IGUubmV4dDt0cnkgewogICAgICAgICAgICAgIG8oKTsKICAgICAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgICAgIHRocm93IGUgPyByKCkgOiB0ID0gdm9pZCAwLCBpOwogICAgICAgICAgICB9CiAgICAgICAgICB9dCA9IHZvaWQgMCwgbiAmJiBuLmVudGVyKCk7CiAgICAgICAgfTtpZiAodSkgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBjLm5leHRUaWNrKGEpOwogICAgICAgIH07ZWxzZSBpZiAoaSkgewogICAgICAgICAgdmFyIGYgPSAhMCwKICAgICAgICAgICAgICBfID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBpKGEpLm9ic2VydmUoXywgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIF8uZGF0YSA9IGYgPSAhZjsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChzICYmIHMucmVzb2x2ZSkgewogICAgICAgICAgdmFyIGwgPSBzLnJlc29sdmUoKTtyID0gZnVuY3Rpb24gcigpIHsKICAgICAgICAgICAgbC50aGVuKGEpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICBvLmNhbGwobiwgYSk7CiAgICAgICAgfTtyZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBvID0geyBmbjogbiwgbmV4dDogdm9pZCAwIH07dCAmJiAodC5uZXh0ID0gbyksIGUgfHwgKGUgPSBvLCByKCkpLCB0ID0gbzsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fY29mIjogMTUsICIuL19nbG9iYWwiOiAyNSwgIi4vX3Rhc2siOiA2MCB9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX29iamVjdC1kcHMiKSwKICAgICAgICAgIGkgPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIiksCiAgICAgICAgICBjID0gZSgiLi9fc2hhcmVkLWtleSIpKCJJRV9QUk9UTyIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoKSB7fSwKICAgICAgICAgIHUgPSAicHJvdG90eXBlIiwKICAgICAgICAgIF9hID0gZnVuY3Rpb24gYSgpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUoIi4vX2RvbS1jcmVhdGUiKSgiaWZyYW1lIiksCiAgICAgICAgICAgIG4gPSBpLmxlbmd0aCwKICAgICAgICAgICAgbyA9ICI+Ijtmb3IgKHIuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZSgiLi9faHRtbCIpLmFwcGVuZENoaWxkKHIpLCByLnNyYyA9ICJqYXZhc2NyaXB0OiIsIHQgPSByLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQsIHQub3BlbigpLCB0LndyaXRlKCI8c2NyaXB0PmRvY3VtZW50LkY9T2JqZWN0PC9zY3JpcHQiICsgbyksIHQuY2xvc2UoKSwgX2EgPSB0LkY7IG4tLTspIHsKICAgICAgICAgIGRlbGV0ZSBfYVt1XVtpW25dXTsKICAgICAgICB9cmV0dXJuIF9hKCk7CiAgICAgIH07dC5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciByO3JldHVybiBudWxsICE9PSBlID8gKHNbdV0gPSBuKGUpLCByID0gbmV3IHMoKSwgc1t1XSA9IG51bGwsIHJbY10gPSBlKSA6IHIgPSBfYSgpLCB2b2lkIDAgPT09IHQgPyByIDogbyhyLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2FuLW9iamVjdCI6IDEyLCAiLi9fZG9tLWNyZWF0ZSI6IDIwLCAiLi9fZW51bS1idWcta2V5cyI6IDIxLCAiLi9faHRtbCI6IDI4LCAiLi9fb2JqZWN0LWRwcyI6IDQ0LCAiLi9fc2hhcmVkLWtleSI6IDU2IH1dLCA0MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fYW4tb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1wcmltaXRpdmUiKSwKICAgICAgICAgIGMgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7ci5mID0gZSgiLi9fZGVzY3JpcHRvcnMiKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHQgPSBpKHQsICEwKSwgbihyKSwgbykgdHJ5IHsKICAgICAgICAgIHJldHVybiBjKGUsIHQsIHIpOwogICAgICAgIH0gY2F0Y2ggKHMpIHt9aWYgKCJnZXQiIGluIHIgfHwgInNldCIgaW4gcikgdGhyb3cgVHlwZUVycm9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEiKTtyZXR1cm4gInZhbHVlIiBpbiByICYmIChlW3RdID0gci52YWx1ZSksIGU7CiAgICAgIH07CiAgICB9LCB7ICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2Rlc2NyaXB0b3JzIjogMTksICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19vYmplY3QtZHAiKSwKICAgICAgICAgIG8gPSBlKCIuL19hbi1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19vYmplY3Qta2V5cyIpO3QuZXhwb3J0cyA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgbyhlKTtmb3IgKHZhciByLCBjID0gaSh0KSwgcyA9IGMubGVuZ3RoLCB1ID0gMDsgcyA+IHU7KSB7CiAgICAgICAgICBuLmYoZSwgciA9IGNbdSsrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL19vYmplY3Qta2V5cyI6IDQ4IH1dLCA0NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LXBpZSIpLAogICAgICAgICAgbyA9IGUoIi4vX3Byb3BlcnR5LWRlc2MiKSwKICAgICAgICAgIGkgPSBlKCIuL190by1pb2JqZWN0IiksCiAgICAgICAgICBjID0gZSgiLi9fdG8tcHJpbWl0aXZlIiksCiAgICAgICAgICBzID0gZSgiLi9faGFzIiksCiAgICAgICAgICB1ID0gZSgiLi9faWU4LWRvbS1kZWZpbmUiKSwKICAgICAgICAgIGEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO3IuZiA9IGUoIi4vX2Rlc2NyaXB0b3JzIikgPyBhIDogZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoZSA9IGkoZSksIHQgPSBjKHQsICEwKSwgdSkgdHJ5IHsKICAgICAgICAgIHJldHVybiBhKGUsIHQpOwogICAgICAgIH0gY2F0Y2ggKHIpIHt9cmV0dXJuIHMoZSwgdCkgPyBvKCFuLmYuY2FsbChlLCB0KSwgZVt0XSkgOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9faGFzIjogMjYsICIuL19pZTgtZG9tLWRlZmluZSI6IDI5LCAiLi9fb2JqZWN0LXBpZSI6IDQ5LCAiLi9fcHJvcGVydHktZGVzYyI6IDUwLCAiLi9fdG8taW9iamVjdCI6IDYzLCAiLi9fdG8tcHJpbWl0aXZlIjogNjYgfV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19oYXMiKSwKICAgICAgICAgIG8gPSBlKCIuL190by1vYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIiksCiAgICAgICAgICBjID0gT2JqZWN0LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSA9IG8oZSksIG4oZSwgaSkgPyBlW2ldIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5jb25zdHJ1Y3RvciAmJiBlIGluc3RhbmNlb2YgZS5jb25zdHJ1Y3RvciA/IGUuY29uc3RydWN0b3IucHJvdG90eXBlIDogZSBpbnN0YW5jZW9mIE9iamVjdCA/IGMgOiBudWxsOwogICAgICB9OwogICAgfSwgeyAiLi9faGFzIjogMjYsICIuL19zaGFyZWQta2V5IjogNTYsICIuL190by1vYmplY3QiOiA2NSB9XSwgNDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2hhcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3RvLWlvYmplY3QiKSwKICAgICAgICAgIGkgPSBlKCIuL19hcnJheS1pbmNsdWRlcyIpKCExKSwKICAgICAgICAgIGMgPSBlKCIuL19zaGFyZWQta2V5IikoIklFX1BST1RPIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG8oZSksCiAgICAgICAgICAgIHUgPSAwLAogICAgICAgICAgICBhID0gW107Zm9yIChyIGluIHMpIHsKICAgICAgICAgIHIgIT0gYyAmJiBuKHMsIHIpICYmIGEucHVzaChyKTsKICAgICAgICB9Zm9yICg7IHQubGVuZ3RoID4gdTspIHsKICAgICAgICAgIG4ocywgciA9IHRbdSsrXSkgJiYgKH5pKGEsIHIpIHx8IGEucHVzaChyKSk7CiAgICAgICAgfXJldHVybiBhOwogICAgICB9OwogICAgfSwgeyAiLi9fYXJyYXktaW5jbHVkZXMiOiAxMywgIi4vX2hhcyI6IDI2LCAiLi9fc2hhcmVkLWtleSI6IDU2LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA0ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fb2JqZWN0LWtleXMtaW50ZXJuYWwiKSwKICAgICAgICAgIG8gPSBlKCIuL19lbnVtLWJ1Zy1rZXlzIik7dC5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihlLCBvKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2VudW0tYnVnLWtleXMiOiAyMSwgIi4vX29iamVjdC1rZXlzLWludGVybmFsIjogNDcgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgci5mID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CiAgICB9LCB7fV0sIDUwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4geyBlbnVtZXJhYmxlOiAhKDEgJiBlKSwgY29uZmlndXJhYmxlOiAhKDIgJiBlKSwgd3JpdGFibGU6ICEoNCAmIGUpLCB2YWx1ZTogdCB9OwogICAgICB9OwogICAgfSwge31dLCA1MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faGlkZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyBpbiB0KSB7CiAgICAgICAgICByICYmIGVbb10gPyBlW29dID0gdFtvXSA6IG4oZSwgbywgdFtvXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwgeyAiLi9faGlkZSI6IDI3IH1dLCA1MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vX2hpZGUiKTsKICAgIH0sIHsgIi4vX2hpZGUiOiAyNyB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2lzLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgaSA9IGZ1bmN0aW9uIGkoZSwgdCkgewogICAgICAgIGlmIChvKGUpLCAhbih0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbiA9IGUoIi4vX2N0eCIpKEZ1bmN0aW9uLmNhbGwsIGUoIi4vX29iamVjdC1nb3BkIikuZihPYmplY3QucHJvdG90eXBlLCAiX19wcm90b19fIikuc2V0LCAyKSwgbih0LCBbXSksIHIgPSAhKHQgaW5zdGFuY2VvZiBBcnJheSk7CiAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGkoZSwgdCksIHIgPyBlLl9fcHJvdG9fXyA9IHQgOiBuKGUsIHQpLCBlOwogICAgICAgICAgfTsKICAgICAgICB9KHt9LCAhMSkgOiB2b2lkIDApLCBjaGVjazogaSB9OwogICAgfSwgeyAiLi9fYW4tb2JqZWN0IjogMTIsICIuL19jdHgiOiAxNywgIi4vX2lzLW9iamVjdCI6IDMzLCAiLi9fb2JqZWN0LWdvcGQiOiA0NSB9XSwgNTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fZ2xvYmFsIiksCiAgICAgICAgICBvID0gZSgiLi9fY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vX29iamVjdC1kcCIpLAogICAgICAgICAgYyA9IGUoIi4vX2Rlc2NyaXB0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi9fd2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2Ygb1tlXSA/IG9bZV0gOiBuW2VdO2MgJiYgdCAmJiAhdFtzXSAmJiBpLmYodCwgcywgeyBjb25maWd1cmFibGU6ICEwLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9IH0pOwogICAgICB9OwogICAgfSwgeyAiLi9fY29yZSI6IDE2LCAiLi9fZGVzY3JpcHRvcnMiOiAxOSwgIi4vX2dsb2JhbCI6IDI1LCAiLi9fb2JqZWN0LWRwIjogNDMsICIuL193a3MiOiA2OCB9XSwgNTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX29iamVjdC1kcCIpLmYsCiAgICAgICAgICBvID0gZSgiLi9faGFzIiksCiAgICAgICAgICBpID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICBlICYmICFvKGUgPSByID8gZSA6IGUucHJvdG90eXBlLCBpKSAmJiBuKGUsIGksIHsgY29uZmlndXJhYmxlOiAhMCwgdmFsdWU6IHQgfSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19oYXMiOiAyNiwgIi4vX29iamVjdC1kcCI6IDQzLCAiLi9fd2tzIjogNjggfV0sIDU2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19zaGFyZWQiKSgia2V5cyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3NoYXJlZCI6IDU3LCAiLi9fdWlkIjogNjcgfV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIG8gPSAiX19jb3JlLWpzX3NoYXJlZF9fIiwKICAgICAgICAgIGkgPSBuW29dIHx8IChuW29dID0ge30pO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlbZV0gfHwgKGlbZV0gPSB7fSk7CiAgICAgIH07CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX2FuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2EtZnVuY3Rpb24iKSwKICAgICAgICAgIGkgPSBlKCIuL193a3MiKSgic3BlY2llcyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGMgPSBuKGUpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDAgPT09IGMgfHwgdm9pZCAwID09IChyID0gbihjKVtpXSkgPyB0IDogbyhyKTsKICAgICAgfTsKICAgIH0sIHsgIi4vX2EtZnVuY3Rpb24iOiA5LCAiLi9fYW4tb2JqZWN0IjogMTIsICIuL193a3MiOiA2OCB9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vX3RvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgcyA9IFN0cmluZyhvKHQpKSwKICAgICAgICAgICAgICB1ID0gbihyKSwKICAgICAgICAgICAgICBhID0gcy5sZW5ndGg7cmV0dXJuIDAgPiB1IHx8IHUgPj0gYSA/IGUgPyAiIiA6IHZvaWQgMCA6IChpID0gcy5jaGFyQ29kZUF0KHUpLCA1NTI5NiA+IGkgfHwgaSA+IDU2MzE5IHx8IHUgKyAxID09PSBhIHx8IChjID0gcy5jaGFyQ29kZUF0KHUgKyAxKSkgPCA1NjMyMCB8fCBjID4gNTczNDMgPyBlID8gcy5jaGFyQXQodSkgOiBpIDogZSA/IHMuc2xpY2UodSwgdSArIDIpIDogKGkgLSA1NTI5NiA8PCAxMCkgKyAoYyAtIDU2MzIwKSArIDY1NTM2KTsKICAgICAgICB9OwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9fdG8taW50ZWdlciI6IDYyIH1dLCA2MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fY3R4IiksCiAgICAgICAgICBzID0gZSgiLi9faW52b2tlIiksCiAgICAgICAgICB1ID0gZSgiLi9faHRtbCIpLAogICAgICAgICAgYSA9IGUoIi4vX2RvbS1jcmVhdGUiKSwKICAgICAgICAgIGYgPSBlKCIuL19nbG9iYWwiKSwKICAgICAgICAgIF8gPSBmLnByb2Nlc3MsCiAgICAgICAgICBsID0gZi5zZXRJbW1lZGlhdGUsCiAgICAgICAgICBkID0gZi5jbGVhckltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBmLk1lc3NhZ2VDaGFubmVsLAogICAgICAgICAgdiA9IDAsCiAgICAgICAgICB5ID0ge30sCiAgICAgICAgICBoID0gIm9ucmVhZHlzdGF0ZWNoYW5nZSIsCiAgICAgICAgICBiID0gZnVuY3Rpb24gYigpIHsKICAgICAgICB2YXIgZSA9ICt0aGlzO2lmICh5Lmhhc093blByb3BlcnR5KGUpKSB7CiAgICAgICAgICB2YXIgdCA9IHlbZV07ZGVsZXRlIHlbZV0sIHQoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBtID0gZnVuY3Rpb24gbShlKSB7CiAgICAgICAgYi5jYWxsKGUuZGF0YSk7CiAgICAgIH07bCAmJiBkIHx8IChsID0gZnVuY3Rpb24gbChlKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLCByID0gMTsgYXJndW1lbnRzLmxlbmd0aCA+IHI7KSB7CiAgICAgICAgICB0LnB1c2goYXJndW1lbnRzW3IrK10pOwogICAgICAgIH1yZXR1cm4geVsrK3ZdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcygiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZSA6IEZ1bmN0aW9uKGUpLCB0KTsKICAgICAgICB9LCBuKHYpLCB2OwogICAgICB9LCBkID0gZnVuY3Rpb24gZChlKSB7CiAgICAgICAgZGVsZXRlIHlbZV07CiAgICAgIH0sICJwcm9jZXNzIiA9PSBlKCIuL19jb2YiKShfKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBfLm5leHRUaWNrKGMoYiwgZSwgMSkpOwogICAgICB9IDogcCA/IChvID0gbmV3IHAoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gbSwgbiA9IGMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogZi5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFmLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGYucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtLCAhMSkpIDogbiA9IGggaW4gYSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIHUuYXBwZW5kQ2hpbGQoYSgic2NyaXB0IikpW2hdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdS5yZW1vdmVDaGlsZCh0aGlzKSwgYi5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQoYyhiLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogbCwgY2xlYXI6IGQgfTsKICAgIH0sIHsgIi4vX2NvZiI6IDE1LCAiLi9fY3R4IjogMTcsICIuL19kb20tY3JlYXRlIjogMjAsICIuL19nbG9iYWwiOiAyNSwgIi4vX2h0bWwiOiAyOCwgIi4vX2ludm9rZSI6IDMwIH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWF4LAogICAgICAgICAgaSA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgPSBuKGUpLCAwID4gZSA/IG8oZSArIHQsIDApIDogaShlLCB0KTsKICAgICAgfTsKICAgIH0sIHsgIi4vX3RvLWludGVnZXIiOiA2MiB9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IE1hdGguY2VpbCwKICAgICAgICAgIG8gPSBNYXRoLmZsb29yO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGUgPSArZSkgPyAwIDogKGUgPiAwID8gbyA6IG4pKGUpOwogICAgICB9OwogICAgfSwge31dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vX2RlZmluZWQiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuKG8oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4LCAiLi9faW9iamVjdCI6IDMxIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fdG8taW50ZWdlciIpLAogICAgICAgICAgbyA9IE1hdGgubWluO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgPiAwID8gbyhuKGUpLCA5MDA3MTk5MjU0NzQwOTkxKSA6IDA7CiAgICAgIH07CiAgICB9LCB7ICIuL190by1pbnRlZ2VyIjogNjIgfV0sIDY1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuL19kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi9fZGVmaW5lZCI6IDE4IH1dLCA2NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9faXMtb2JqZWN0Iik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIW4oZSkpIHJldHVybiBlO3ZhciByLCBvO2lmICh0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIChyID0gZS50b1N0cmluZykgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudmFsdWVPZikgJiYgIW4obyA9IHIuY2FsbChlKSkpIHJldHVybiBvO2lmICghdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAociA9IGUudG9TdHJpbmcpICYmICFuKG8gPSByLmNhbGwoZSkpKSByZXR1cm4gbzt0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwogICAgICB9OwogICAgfSwgeyAiLi9faXMtb2JqZWN0IjogMzMgfV0sIDY3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSAwLAogICAgICAgICAgbyA9IE1hdGgucmFuZG9tKCk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIlN5bWJvbCgiLmNvbmNhdCh2b2lkIDAgPT09IGUgPyAiIiA6IGUsICIpXyIsICgrK24gKyBvKS50b1N0cmluZygzNikpOwogICAgICB9OwogICAgfSwge31dLCA2ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vX3VpZCIpLAogICAgICAgICAgaSA9IGUoIi4vX2dsb2JhbCIpLlN5bWJvbCwKICAgICAgICAgIGMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBpLAogICAgICAgICAgcyA9IHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBjICYmIGlbZV0gfHwgKGMgPyBpIDogbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9O3Muc3RvcmUgPSBuOwogICAgfSwgeyAiLi9fZ2xvYmFsIjogMjUsICIuL19zaGFyZWQiOiA1NywgIi4vX3VpZCI6IDY3IH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fY2xhc3NvZiIpLAogICAgICAgICAgbyA9IGUoIi4vX3drcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vX2NvcmUiKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPSBlID8gZVtvXSB8fCBlWyJAQGl0ZXJhdG9yIl0gfHwgaVtuKGUpXSA6IHZvaWQgMDsKICAgICAgfTsKICAgIH0sIHsgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjggfV0sIDcwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vX2FkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vX2l0ZXItc3RlcCIpLAogICAgICAgICAgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLAogICAgICAgICAgYyA9IGUoIi4vX3RvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuL19pdGVyLWRlZmluZSIpKEFycmF5LCAiQXJyYXkiLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHRoaXMuX3QgPSBjKGUpLCB0aGlzLl9pID0gMCwgdGhpcy5fayA9IHQ7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuX3QsCiAgICAgICAgICAgIHQgPSB0aGlzLl9rLAogICAgICAgICAgICByID0gdGhpcy5faSsrO3JldHVybiAhZSB8fCByID49IGUubGVuZ3RoID8gKHRoaXMuX3QgPSB2b2lkIDAsIG8oMSkpIDogImtleXMiID09IHQgPyBvKDAsIHIpIDogInZhbHVlcyIgPT0gdCA/IG8oMCwgZVtyXSkgOiBvKDAsIFtyLCBlW3JdXSk7CiAgICAgIH0sICJ2YWx1ZXMiKSwgaS5Bcmd1bWVudHMgPSBpLkFycmF5LCBuKCJrZXlzIiksIG4oInZhbHVlcyIpLCBuKCJlbnRyaWVzIik7CiAgICB9LCB7ICIuL19hZGQtdG8tdW5zY29wYWJsZXMiOiAxMCwgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19pdGVyLXN0ZXAiOiAzOCwgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fdG8taW9iamVjdCI6IDYzIH1dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi9fZXhwb3J0Iik7bihuLlMgKyBuLkYgKiAhZSgiLi9fZGVzY3JpcHRvcnMiKSwgIk9iamVjdCIsIHsgZGVmaW5lUHJvcGVydHk6IGUoIi4vX29iamVjdC1kcCIpLmYgfSk7CiAgICB9LCB7ICIuL19kZXNjcmlwdG9ycyI6IDE5LCAiLi9fZXhwb3J0IjogMjIsICIuL19vYmplY3QtZHAiOiA0MyB9XSwgNzI6IFtmdW5jdGlvbiAoZSwgdCwgcikge30sIHt9XSwgNzM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBjID0gZSgiLi9fbGlicmFyeSIpLAogICAgICAgICAgcyA9IGUoIi4vX2dsb2JhbCIpLAogICAgICAgICAgdSA9IGUoIi4vX2N0eCIpLAogICAgICAgICAgYSA9IGUoIi4vX2NsYXNzb2YiKSwKICAgICAgICAgIGYgPSBlKCIuL19leHBvcnQiKSwKICAgICAgICAgIF8gPSBlKCIuL19pcy1vYmplY3QiKSwKICAgICAgICAgIGwgPSAoZSgiLi9fYW4tb2JqZWN0IiksIGUoIi4vX2EtZnVuY3Rpb24iKSksCiAgICAgICAgICBkID0gZSgiLi9fYW4taW5zdGFuY2UiKSwKICAgICAgICAgIHAgPSBlKCIuL19mb3Itb2YiKSwKICAgICAgICAgIHYgPSAoZSgiLi9fc2V0LXByb3RvIikuc2V0LCBlKCIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIikpLAogICAgICAgICAgeSA9IGUoIi4vX3Rhc2siKS5zZXQsCiAgICAgICAgICBoID0gZSgiLi9fbWljcm90YXNrIikoKSwKICAgICAgICAgIGIgPSAiUHJvbWlzZSIsCiAgICAgICAgICBtID0gcy5UeXBlRXJyb3IsCiAgICAgICAgICBnID0gcy5wcm9jZXNzLAogICAgICAgICAgX2ogPSBzW2JdLAogICAgICAgICAgZyA9IHMucHJvY2VzcywKICAgICAgICAgIHggPSAicHJvY2VzcyIgPT0gYShnKSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KCkge30sCiAgICAgICAgICBrID0gISFmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciB0ID0gX2oucmVzb2x2ZSgxKSwKICAgICAgICAgICAgICByID0gKHQuY29uc3RydWN0b3IgPSB7fSlbZSgiLi9fd2tzIikoInNwZWNpZXMiKV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlKHcsIHcpOwogICAgICAgICAgfTtyZXR1cm4gKHggfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgUHJvbWlzZVJlamVjdGlvbkV2ZW50KSAmJiB0LnRoZW4odykgaW5zdGFuY2VvZiByOwogICAgICAgIH0gY2F0Y2ggKG4pIHt9CiAgICAgIH0oKSwKICAgICAgICAgIE8gPSBmdW5jdGlvbiBPKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSA9PT0gdCB8fCBlID09PSBfaiAmJiB0ID09PSBpOwogICAgICB9LAogICAgICAgICAgTSA9IGZ1bmN0aW9uIE0oZSkgewogICAgICAgIHZhciB0O3JldHVybiBfKGUpICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mICh0ID0gZS50aGVuKSA/IHQgOiAhMTsKICAgICAgfSwKICAgICAgICAgIFAgPSBmdW5jdGlvbiBQKGUpIHsKICAgICAgICByZXR1cm4gTyhfaiwgZSkgPyBuZXcgUyhlKSA6IG5ldyBvKGUpOwogICAgICB9LAogICAgICAgICAgUyA9IG8gPSBmdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCwgcjt0aGlzLnByb21pc2UgPSBuZXcgZShmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCB8fCB2b2lkIDAgIT09IHIpIHRocm93IG0oIkJhZCBQcm9taXNlIGNvbnN0cnVjdG9yIik7dCA9IGUsIHIgPSBuOwogICAgICAgIH0pLCB0aGlzLnJlc29sdmUgPSBsKHQpLCB0aGlzLnJlamVjdCA9IGwocik7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGUoKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4geyBlcnJvcjogdCB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIFQgPSBmdW5jdGlvbiBUKGUsIHQpIHsKICAgICAgICBpZiAoIWUuX24pIHsKICAgICAgICAgIGUuX24gPSAhMDt2YXIgciA9IGUuX2M7aChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSBlLl92LCBvID0gMSA9PSBlLl9zLCBpID0gMCwgYyA9IGZ1bmN0aW9uIGModCkgewogICAgICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICBjID0gbyA/IHQub2sgOiB0LmZhaWwsCiAgICAgICAgICAgICAgICAgIHMgPSB0LnJlc29sdmUsCiAgICAgICAgICAgICAgICAgIHUgPSB0LnJlamVjdCwKICAgICAgICAgICAgICAgICAgYSA9IHQuZG9tYWluO3RyeSB7CiAgICAgICAgICAgICAgICBjID8gKG8gfHwgKDIgPT0gZS5faCAmJiBDKGUpLCBlLl9oID0gMSksIGMgPT09ICEwID8gciA9IG4gOiAoYSAmJiBhLmVudGVyKCksIHIgPSBjKG4pLCBhICYmIGEuZXhpdCgpKSwgciA9PT0gdC5wcm9taXNlID8gdShtKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBNKHIpKSA/IGkuY2FsbChyLCBzLCB1KSA6IHMocikpIDogdShuKTsKICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICB1KGYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGMocltpKytdKTsKICAgICAgICAgICAgfWUuX2MgPSBbXSwgZS5fbiA9ICExLCB0ICYmICFlLl9oICYmIEEoZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBBID0gZnVuY3Rpb24gQShlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0LAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICBvID0gZS5fdjtpZiAoVShlKSAmJiAodCA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB4ID8gZy5lbWl0KCJ1bmhhbmRsZWRSZWplY3Rpb24iLCBvLCBlKSA6IChyID0gcy5vbnVuaGFuZGxlZHJlamVjdGlvbikgPyByKHsgcHJvbWlzZTogZSwgcmVhc29uOiBvIH0pIDogKG4gPSBzLmNvbnNvbGUpICYmIG4uZXJyb3IgJiYgbi5lcnJvcigiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIiwgbyk7CiAgICAgICAgICB9KSwgZS5faCA9IHggfHwgVShlKSA/IDIgOiAxKSwgZS5fYSA9IHZvaWQgMCwgdCkgdGhyb3cgdC5lcnJvcjsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgICAgIFUgPSBmdW5jdGlvbiBVKGUpIHsKICAgICAgICBpZiAoMSA9PSBlLl9oKSByZXR1cm4gITE7Zm9yICh2YXIgdCwgciA9IGUuX2EgfHwgZS5fYywgbiA9IDA7IHIubGVuZ3RoID4gbjspIHsKICAgICAgICAgIGlmICh0ID0gcltuKytdLCB0LmZhaWwgfHwgIVUodC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBDID0gZnVuY3Rpb24gQyhlKSB7CiAgICAgICAgeS5jYWxsKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0O3ggPyBnLmVtaXQoInJlamVjdGlvbkhhbmRsZWQiLCBlKSA6ICh0ID0gcy5vbnJlamVjdGlvbmhhbmRsZWQpICYmIHQoeyBwcm9taXNlOiBlLCByZWFzb246IGUuX3YgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuX2QgfHwgKHQuX2QgPSAhMCwgdCA9IHQuX3cgfHwgdCwgdC5fdiA9IGUsIHQuX3MgPSAyLCB0Ll9hIHx8ICh0Ll9hID0gdC5fYy5zbGljZSgpKSwgVCh0LCAhMCkpOwogICAgICB9LAogICAgICAgICAgTCA9IGZ1bmN0aW9uIEwoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICByID0gdGhpcztpZiAoIXIuX2QpIHsKICAgICAgICAgIHIuX2QgPSAhMCwgciA9IHIuX3cgfHwgcjt0cnkgewogICAgICAgICAgICBpZiAociA9PT0gZSkgdGhyb3cgbSgiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsodCA9IE0oZSkpID8gaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7IF93OiByLCBfZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIHUoTCwgbiwgMSksIHUoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIuX3YgPSBlLCByLl9zID0gMSwgVChyLCAhMSkpOwogICAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgICBSLmNhbGwoeyBfdzogciwgX2Q6ICExIH0sIG4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTtrIHx8IChfaiA9IGZ1bmN0aW9uIGooZSkgewogICAgICAgIGQodGhpcywgX2osIGIsICJfaCIpLCBsKGUpLCBuLmNhbGwodGhpcyk7dHJ5IHsKICAgICAgICAgIGUodShMLCB0aGlzLCAxKSwgdShSLCB0aGlzLCAxKSk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgUi5jYWxsKHRoaXMsIHQpOwogICAgICAgIH0KICAgICAgfSwgbiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHRoaXMuX2MgPSBbXSwgdGhpcy5fYSA9IHZvaWQgMCwgdGhpcy5fcyA9IDAsIHRoaXMuX2QgPSAhMSwgdGhpcy5fdiA9IHZvaWQgMCwgdGhpcy5faCA9IDAsIHRoaXMuX24gPSAhMTsKICAgICAgfSwgbi5wcm90b3R5cGUgPSBlKCIuL19yZWRlZmluZS1hbGwiKShfai5wcm90b3R5cGUsIHsgdGhlbjogZnVuY3Rpb24gdGhlbihlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IFAodih0aGlzLCBfaikpO3JldHVybiByLm9rID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IGUgOiAhMCwgci5mYWlsID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdCAmJiB0LCByLmRvbWFpbiA9IHggPyBnLmRvbWFpbiA6IHZvaWQgMCwgdGhpcy5fYy5wdXNoKHIpLCB0aGlzLl9hICYmIHRoaXMuX2EucHVzaChyKSwgdGhpcy5fcyAmJiBUKHRoaXMsICExKSwgci5wcm9taXNlOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSwgUyA9IGZ1bmN0aW9uIFMoKSB7CiAgICAgICAgdmFyIGUgPSBuZXcgbigpO3RoaXMucHJvbWlzZSA9IGUsIHRoaXMucmVzb2x2ZSA9IHUoTCwgZSwgMSksIHRoaXMucmVqZWN0ID0gdShSLCBlLCAxKTsKICAgICAgfSksIGYoZi5HICsgZi5XICsgZi5GICogIWssIHsgUHJvbWlzZTogX2ogfSksIGUoIi4vX3NldC10by1zdHJpbmctdGFnIikoX2osIGIpLCBlKCIuL19zZXQtc3BlY2llcyIpKGIpLCBpID0gZSgiLi9fY29yZSIpW2JdLCBmKGYuUyArIGYuRiAqICFrLCBiLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gUCh0aGlzKSwKICAgICAgICAgICAgICByID0gdC5yZWplY3Q7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqIChjIHx8ICFrKSwgYiwgeyByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKGUpIHsKICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX2ogJiYgTyhlLmNvbnN0cnVjdG9yLCB0aGlzKSkgcmV0dXJuIGU7dmFyIHQgPSBQKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCBmKGYuUyArIGYuRiAqICEoayAmJiBlKCIuL19pdGVyLWRldGVjdCIpKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX2ouYWxsKGUpWyJjYXRjaCJdKHcpOwogICAgICB9KSksIGIsIHsgYWxsOiBmdW5jdGlvbiBhbGwoZSkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgIHIgPSBQKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgbyA9IHIucmVqZWN0LAogICAgICAgICAgICAgIGkgPSBFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHIgPSBbXSwKICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgYyA9IDE7cChlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgcyA9IGkrKywKICAgICAgICAgICAgICAgICAgdSA9ICExO3IucHVzaCh2b2lkIDApLCBjKyssIHQucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB1IHx8ICh1ID0gITAsIHJbc10gPSBlLCAtLWMgfHwgbihyKSk7CiAgICAgICAgICAgICAgfSwgbyk7CiAgICAgICAgICAgIH0pLCAtLWMgfHwgbihyKTsKICAgICAgICAgIH0pO3JldHVybiBpICYmIG8oaS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICByID0gUCh0KSwKICAgICAgICAgICAgICBuID0gci5yZWplY3QsCiAgICAgICAgICAgICAgbyA9IEUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBwKGUsICExLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQucmVzb2x2ZShlKS50aGVuKHIucmVzb2x2ZSwgbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7cmV0dXJuIG8gJiYgbihvLmVycm9yKSwgci5wcm9taXNlOwogICAgICAgIH0gfSk7CiAgICB9LCB7ICIuL19hLWZ1bmN0aW9uIjogOSwgIi4vX2FuLWluc3RhbmNlIjogMTEsICIuL19hbi1vYmplY3QiOiAxMiwgIi4vX2NsYXNzb2YiOiAxNCwgIi4vX2NvcmUiOiAxNiwgIi4vX2N0eCI6IDE3LCAiLi9fZXhwb3J0IjogMjIsICIuL19mb3Itb2YiOiAyNCwgIi4vX2dsb2JhbCI6IDI1LCAiLi9faXMtb2JqZWN0IjogMzMsICIuL19pdGVyLWRldGVjdCI6IDM3LCAiLi9fbGlicmFyeSI6IDQwLCAiLi9fbWljcm90YXNrIjogNDEsICIuL19yZWRlZmluZS1hbGwiOiA1MSwgIi4vX3NldC1wcm90byI6IDUzLCAiLi9fc2V0LXNwZWNpZXMiOiA1NCwgIi4vX3NldC10by1zdHJpbmctdGFnIjogNTUsICIuL19zcGVjaWVzLWNvbnN0cnVjdG9yIjogNTgsICIuL190YXNrIjogNjAsICIuL193a3MiOiA2OCB9XSwgNzQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi9fc3RyaW5nLWF0IikoITApO2UoIi4vX2l0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vX2l0ZXItZGVmaW5lIjogMzYsICIuL19zdHJpbmctYXQiOiA1OSB9XSwgNzU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO2ZvciAodmFyIG4gPSBlKCIuL19nbG9iYWwiKSwgbyA9IGUoIi4vX2hpZGUiKSwgaSA9IGUoIi4vX2l0ZXJhdG9ycyIpLCBjID0gZSgiLi9fd2tzIikoInRvU3RyaW5nVGFnIiksIHMgPSBbIk5vZGVMaXN0IiwgIkRPTVRva2VuTGlzdCIsICJNZWRpYUxpc3QiLCAiU3R5bGVTaGVldExpc3QiLCAiQ1NTUnVsZUxpc3QiXSwgdSA9IDA7IDUgPiB1OyB1KyspIHsKICAgICAgICB2YXIgYSA9IHNbdV0sCiAgICAgICAgICAgIGYgPSBuW2FdLAogICAgICAgICAgICBfID0gZiAmJiBmLnByb3RvdHlwZTtfICYmICFfW2NdICYmIG8oXywgYywgYSksIGlbYV0gPSBpLkFycmF5OwogICAgICB9CiAgICB9LCB7ICIuL19nbG9iYWwiOiAyNSwgIi4vX2hpZGUiOiAyNywgIi4vX2l0ZXJhdG9ycyI6IDM5LCAiLi9fd2tzIjogNjgsICIuL2VzNi5hcnJheS5pdGVyYXRvciI6IDcwIH1dLCA3NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoIi4vaHlwZXJ0eS1kaXNjb3ZlcnkvSHlwZXJ0eURpc2NvdmVyeSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gaVsiZGVmYXVsdCJdLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL2h5cGVydHktZGlzY292ZXJ5L0h5cGVydHlEaXNjb3ZlcnkiOiA3NyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBzID0gbihjKSwKICAgICAgICAgIHUgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHUpLAogICAgICAgICAgZiA9IGUoIi4uL3V0aWxzL3V0aWxzIiksCiAgICAgICAgICBfID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgcikgewogICAgICAgICAgKDAsIHNbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIG4gPSB0aGlzO24ubWVzc2FnZUJ1cyA9IHIsIG4uZG9tYWluID0gKDAsIGYuZGl2aWRlVVJMKSh0KS5kb21haW4sIG4uZGlzY292ZXJ5VVJMID0gdDsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImRpc2NvdmVyRGF0YU9iamVjdFBlck5hbWUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiAiZGF0YU9iamVjdDovLyIgKyBlIH0gfTtyZXR1cm4gbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShvLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgdmFyIG4gPSByLmJvZHkudmFsdWUudXJsO24gPyBlKG4pIDogdCgiRGF0YU9iamVjdCBuYW1lIGRvZXMgbm90IGV4aXN0Iik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImRpc2NvdmVySHlwZXJ0eVBlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2U6ICIsIGMsIG4sIG8pLCBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgci5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKGMsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibWVzc2FnZSByZXBseSIsIHIpO3ZhciBvID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAgIGkgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgYyA9IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBzID0gci5ib2R5LnZhbHVlO2ZvciAobyBpbiBzKSB7CiAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHNbb10ubGFzdE1vZGlmaWVkKSBpZiAodm9pZCAwID09PSBpKSBpID0gbmV3IERhdGUoc1tvXS5sYXN0TW9kaWZpZWQpLCBjID0gbztlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IG5ldyBEYXRlKHNbb10ubGFzdE1vZGlmaWVkKTtpLmdldFRpbWUoKSA8IHUuZ2V0VGltZSgpICYmIChpID0gdSwgYyA9IG8pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9Y29uc29sZS5sb2coIkxhc3QgSHlwZXJ0eTogIiwgYywgaSk7dmFyIGEgPSBjO2lmICh2b2lkIDAgPT09IGEpIHJldHVybiBuKCJVc2VyIEh5cGVydHkgbm90IGZvdW5kIik7dmFyIGYgPSB7IGlkOiBlLCBkZXNjcmlwdG9yOiBzW2FdLmRlc2NyaXB0b3IsIGh5cGVydHlVUkw6IGEgfTtjb25zb2xlLmxvZygiPT09PiBoeXBlcnR5RGlzY292ZXJ5IG1lc3NhZ2VCdW5kbGU6ICIsIGYpLCB0KGYpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkaXNjb3Zlckh5cGVydGllc1BlclVzZXIiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICBuID0gdm9pZCAwO24gPSB0ID8gdCA6IHIuZG9tYWluO3ZhciBvID0gInVzZXI6Ly8iICsgZS5zdWJzdHJpbmcoZS5pbmRleE9mKCJAIikgKyAxLCBlLmxlbmd0aCkgKyAiLyIgKyBlLnN1YnN0cmluZygwLCBlLmluZGV4T2YoIkAiKSksCiAgICAgICAgICAgICAgICBjID0geyB0eXBlOiAicmVhZCIsIGZyb206IHIuZGlzY292ZXJ5VVJMLCB0bzogImRvbWFpbjovL3JlZ2lzdHJ5LiIgKyBuICsgIi8iLCBib2R5OiB7IHJlc291cmNlOiBvIH0gfTtyZXR1cm4gY29uc29sZS5sb2coIk1lc3NhZ2UgZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyOiAiLCBjLCBuLCBvKSwgbmV3IGlbImRlZmF1bHQiXShmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHIubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShjLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlciByZXBseSIsIHIpO3ZhciBuID0gci5ib2R5LnZhbHVlO3JldHVybiBuID8gdm9pZCBlKG4pIDogdCgiVXNlciBIeXBlcnR5IG5vdCBmb3VuZCIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gXywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMiOiA3OCwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogMywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiA1IH1dLCA3ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1mdW5jdGlvbiBvKGUpIHsKICAgICAgICB2YXIgdCA9IC8oW2EtekEtWi1dKik6XC9cLyg/OlwuKT8oWy1hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn0pKFstYS16QS1aMC05QDolLl9cK34jPVwvXSopL2dpLAogICAgICAgICAgICByID0gIiQxLCQyLCQzIiwKICAgICAgICAgICAgbiA9IGUucmVwbGFjZSh0LCByKS5zcGxpdCgiLCIpO25bMF0gPT09IGUgJiYgKG5bMF0gPSAiaHR0cHMiLCBuWzFdID0gZSk7dmFyIG8gPSB7IHR5cGU6IG5bMF0sIGRvbWFpbjogblsxXSwgaWRlbnRpdHk6IG5bMl0gfTtyZXR1cm4gbzsKICAgICAgfWZ1bmN0aW9uIGkoZSkgewogICAgICAgIHJldHVybiBlID8gSlNPTi5wYXJzZSgoMCwgc1siZGVmYXVsdCJdKShlKSkgOiB2b2lkIDA7CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgYyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSIpLAogICAgICAgICAgcyA9IG4oYyk7ci5kaXZpZGVVUkwgPSBvLCByLmRlZXBDbG9uZSA9IGk7CiAgICB9LCB7ICJiYWJlbC1ydW50aW1lL2NvcmUtanMvanNvbi9zdHJpbmdpZnkiOiAxIH1dIH0sIHt9LCBbNzZdKSg3Nik7Cn0pOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CiJ1c2Ugc3RyaWN0IjsKCnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsKCi8qKgoqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQQoqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMCiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlYKKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHCiogQ29weXJpZ2h0IDIwMTYgQXBpemVlCiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KKgoqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioqLwoKLy8gRGlzdHJpYnV0aW9uIGZpbGUgZm9yIFN5bmNoZXIuanMKLy8gdmVyc2lvbjogMC4yLjAKCiFmdW5jdGlvbiAoZSkgewogIGlmICgib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbW9kdWxlKSBtb2R1bGUuZXhwb3J0cyA9IGUoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCBlKTtlbHNlIHsKICAgIHZhciB0O3QgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHRoaXMsIHQuU3luY2hlciA9IGUoKTsKICB9Cn0oZnVuY3Rpb24gKCkgewogIHJldHVybiBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgIGZ1bmN0aW9uIG8ocywgYSkgewogICAgICBpZiAoIXJbc10pIHsKICAgICAgICBpZiAoIXRbc10pIHsKICAgICAgICAgIHZhciBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlO2lmICghYSAmJiBjKSByZXR1cm4gYyhzLCAhMCk7aWYgKGkpIHJldHVybiBpKHMsICEwKTt2YXIgdSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgcyArICInIik7dGhyb3cgdS5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCB1OwogICAgICAgIH12YXIgbCA9IHJbc10gPSB7IGV4cG9ydHM6IHt9IH07dFtzXVswXS5jYWxsKGwuZXhwb3J0cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gdFtzXVsxXVtlXTtyZXR1cm4gbyhyID8gciA6IGUpOwogICAgICAgIH0sIGwsIGwuZXhwb3J0cywgZSwgdCwgciwgbik7CiAgICAgIH1yZXR1cm4gcltzXS5leHBvcnRzOwogICAgfWZvciAodmFyIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmUsIHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgewogICAgICBvKG5bc10pOwogICAgfXJldHVybiBvOwogIH0oeyAxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgJiYgIUFycmF5Lm9ic2VydmUgJiYgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHIgPSBlLmdldE5vdGlmaWVyLAogICAgICAgICAgICBuID0gInBlcmZvcm1DaGFuZ2UiLAogICAgICAgICAgICBvID0gIl9vcmlnaW5hbCIsCiAgICAgICAgICAgIGkgPSAic3BsaWNlIiwKICAgICAgICAgICAgcyA9IHsgcHVzaDogZnVuY3Rpb24gYyhlKSB7CiAgICAgICAgICAgIHZhciB0ID0gYXJndW1lbnRzLAogICAgICAgICAgICAgICAgcyA9IGNbb10uYXBwbHkodGhpcywgdCk7cmV0dXJuIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiBzIC0gdC5sZW5ndGgsIGFkZGVkQ291bnQ6IHQubGVuZ3RoLCByZW1vdmVkOiBbXSB9OwogICAgICAgICAgICB9KSwgczsKICAgICAgICAgIH0sIHVuc2hpZnQ6IGZ1bmN0aW9uIHUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIHMgPSB1W29dLmFwcGx5KHRoaXMsIHQpO3JldHVybiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogMCwgYWRkZWRDb3VudDogdC5sZW5ndGgsIHJlbW92ZWQ6IFtdIH07CiAgICAgICAgICAgIH0pLCBzOwogICAgICAgICAgfSwgcG9wOiBmdW5jdGlvbiBsKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgICAgICAgdCA9IGxbb10uY2FsbCh0aGlzKTtyZXR1cm4gdGhpcy5sZW5ndGggIT09IGUgJiYgcih0aGlzKVtuXShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IHRoaXMubGVuZ3RoLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzaGlmdDogZnVuY3Rpb24gZigpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHQgPSBmW29dLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMubGVuZ3RoICE9PSBlICYmIHIodGhpcylbbl0oaSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB7IGluZGV4OiAwLCBhZGRlZENvdW50OiAwLCByZW1vdmVkOiBbdF0gfTsKICAgICAgICAgICAgfSwgdGhpcyksIHQ7CiAgICAgICAgICB9LCBzcGxpY2U6IGZ1bmN0aW9uIGQoZSwgdCkgewogICAgICAgICAgICB2YXIgcyA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgIGEgPSBkW29dLmFwcGx5KHRoaXMsIHMpO3JldHVybiAoYS5sZW5ndGggfHwgcy5sZW5ndGggPiAyKSAmJiByKHRoaXMpW25dKGksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBpbmRleDogZSwgYWRkZWRDb3VudDogcy5sZW5ndGggLSAyLCByZW1vdmVkOiBhIH07CiAgICAgICAgICAgIH0sIHRoaXMpLCBhOwogICAgICAgICAgfSB9O2ZvciAodmFyIGEgaW4gcykgewogICAgICAgICAgc1thXVtvXSA9IHQucHJvdG90eXBlW2FdLCB0LnByb3RvdHlwZVthXSA9IHNbYV07CiAgICAgICAgfXQub2JzZXJ2ZSA9IGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICByZXR1cm4gZS5vYnNlcnZlKHQsIHIsIFsiYWRkIiwgInVwZGF0ZSIsICJkZWxldGUiLCBpXSk7CiAgICAgICAgfSwgdC51bm9ic2VydmUgPSBlLnVub2JzZXJ2ZTsKICAgICAgfShPYmplY3QsIEFycmF5KTsKICAgIH0sIHt9XSwgMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vanNvbi9zdHJpbmdpZnkiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9qc29uL3N0cmluZ2lmeSI6IDE3IH1dLCAzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2NyZWF0ZSI6IDE4IH1dLCA0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6IDE5IH1dLCA1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6IDIwIH1dLCA2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLCBfX2VzTW9kdWxlOiAhMCB9OwogICAgfSwgeyAiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogMjEgfV0sIDc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9rZXlzIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2tleXMiOiAyMiB9XSwgODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiKSwgX19lc01vZHVsZTogITAgfTsKICAgIH0sIHsgImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDIzIH1dLCA5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0geyAiZGVmYXVsdCI6IGUoImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSI6IDI0IH1dLCAxMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiBlKCJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIiksIF9fZXNNb2R1bGU6ICEwIH07CiAgICB9LCB7ICJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIjogMjUgfV0sIDExOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICByLl9fZXNNb2R1bGUgPSAhMCwgclsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgdCkpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9OwogICAgfSwge31dLCAxMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1yLl9fZXNNb2R1bGUgPSAhMDt2YXIgbyA9IGUoIi4uL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLAogICAgICAgICAgaSA9IG4obyk7clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtyXTtuLmVudW1lcmFibGUgPSBuLmVudW1lcmFibGUgfHwgITEsIG4uY29uZmlndXJhYmxlID0gITAsICJ2YWx1ZSIgaW4gbiAmJiAobi53cml0YWJsZSA9ICEwKSwgKDAsIGlbImRlZmF1bHQiXSkoZSwgbi5rZXksIG4pOwogICAgICAgICAgfQogICAgICAgIH1yZXR1cm4gZnVuY3Rpb24gKHQsIHIsIG4pIHsKICAgICAgICAgIHJldHVybiByICYmIGUodC5wcm90b3R5cGUsIHIpLCBuICYmIGUodCwgbiksIHQ7CiAgICAgICAgfTsKICAgICAgfSgpOwogICAgfSwgeyAiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjogNCB9XSwgMTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKVsiZGVmYXVsdCJdO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZm9yICh2YXIgbyA9ICEwOyBvOykgewogICAgICAgICAgdmFyIGkgPSBlLAogICAgICAgICAgICAgIHMgPSB0LAogICAgICAgICAgICAgIGEgPSByO28gPSAhMSwgbnVsbCA9PT0gaSAmJiAoaSA9IEZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIGMgPSBuKGksIHMpO2lmICh2b2lkIDAgIT09IGMpIHsKICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gYykgcmV0dXJuIGMudmFsdWU7dmFyIHUgPSBjLmdldDtpZiAodm9pZCAwID09PSB1KSByZXR1cm47cmV0dXJuIHUuY2FsbChhKTsKICAgICAgICAgIH12YXIgbCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpKTtpZiAobnVsbCA9PT0gbCkgcmV0dXJuO2UgPSBsLCB0ID0gcywgciA9IGEsIG8gPSAhMCwgYyA9IGwgPSB2b2lkIDA7CiAgICAgICAgfQogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjogNSB9XSwgMTQ6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9jcmVhdGUiKVsiZGVmYXVsdCJdLAogICAgICAgICAgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCAmJiBudWxsICE9PSB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSk7ZS5wcm90b3R5cGUgPSBuKHQgJiYgdC5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IGUsIGVudW1lcmFibGU6ICExLCB3cml0YWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAgfSB9KSwgdCAmJiAobyA/IG8oZSwgdCkgOiBlLl9fcHJvdG9fXyA9IHQpOwogICAgICB9LCByLl9fZXNNb2R1bGUgPSAhMDsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvY3JlYXRlIjogMywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6IDggfV0sIDE1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfXIuX19lc01vZHVsZSA9ICEwO3ZhciBvID0gZSgiLi4vaGVscGVycy90eXBlb2YiKSwKICAgICAgICAgIGkgPSBuKG8pO3JbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCFlKSB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiAhdCB8fCAib2JqZWN0IiAhPT0gKCJ1bmRlZmluZWQiID09IHR5cGVvZiB0ID8gInVuZGVmaW5lZCIgOiAoMCwgaVsiZGVmYXVsdCJdKSh0KSkgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCA/IGUgOiB0OwogICAgICB9OwogICAgfSwgeyAiLi4vaGVscGVycy90eXBlb2YiOiAxNiB9XSwgMTY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCIpWyJkZWZhdWx0Il07clsiZGVmYXVsdCJdID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLmNvbnN0cnVjdG9yID09PSBuID8gInN5bWJvbCIgOiB0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSk7CiAgICAgIH0sIHIuX19lc01vZHVsZSA9ICEwOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3N5bWJvbCI6IDEwIH1dLCAxNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAobi5KU09OICYmIG4uSlNPTi5zdHJpbmdpZnkgfHwgSlNPTi5zdHJpbmdpZnkpLmFwcGx5KEpTT04sIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxIH1dLCAxODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbi5jcmVhdGUoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiB9XSwgMTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4uLy4uL21vZHVsZXMvJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgcmV0dXJuIG4uc2V0RGVzYyhlLCB0LCByKTsKICAgICAgfTsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJCI6IDU2IH1dLCAyMDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi4vLi4vbW9kdWxlcy8kIik7ZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLCB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBuLmdldERlc2MoZSwgdCk7CiAgICAgIH07CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQiOiA1NiwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOiA4MSB9XSwgMjE6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiI6IDgyIH1dLCAyMjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LmtleXM7CiAgICB9LCB7ICIuLi8uLi9tb2R1bGVzLyQuY29yZSI6IDMxLCAiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmtleXMiOiA4MyB9XSwgMjM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiIpLCB0LmV4cG9ydHMgPSBlKCIuLi8uLi9tb2R1bGVzLyQuY29yZSIpLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKICAgIH0sIHsgIi4uLy4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiI6IDg0IH1dLCAyNDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciKSwgZSgiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksIGUoIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSIpLCBlKCIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIiksIHQuZXhwb3J0cyA9IGUoIi4uL21vZHVsZXMvJC5jb3JlIikuUHJvbWlzZTsKICAgIH0sIHsgIi4uL21vZHVsZXMvJC5jb3JlIjogMzEsICIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjogODUsICIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjogODYsICIuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IiOiA4NywgIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6IDg5IH1dLCAyNTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIGUoIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCIpLCBlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIiksIHQuZXhwb3J0cyA9IGUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuU3ltYm9sOwogICAgfSwgeyAiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOiAzMSwgIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOiA4NSwgIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCI6IDg4IH1dLCAyNjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IFR5cGVFcnJvcihlICsgIiBpcyBub3QgYSBmdW5jdGlvbiEiKTtyZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHt9XSwgMjc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7fTsKICAgIH0sIHt9XSwgMjg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5pcy1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghbihlKSkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBhbiBvYmplY3QhIik7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXMtb2JqZWN0IjogNDkgfV0sIDI5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpLAogICAgICAgICAgaSA9ICJBcmd1bWVudHMiID09IG4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICAgIH0oKSk7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwgciwgcztyZXR1cm4gdm9pZCAwID09PSBlID8gIlVuZGVmaW5lZCIgOiBudWxsID09PSBlID8gIk51bGwiIDogInN0cmluZyIgPT0gdHlwZW9mIChyID0gKHQgPSBPYmplY3QoZSkpW29dKSA/IHIgOiBpID8gbih0KSA6ICJPYmplY3QiID09IChzID0gbih0KSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5jYWxsZWUgPyAiQXJndW1lbnRzIiA6IHM7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAsICIuLyQud2tzIjogNzggfV0sIDMwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSB7fS50b1N0cmluZzt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfSwge31dLCAzMTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0geyB2ZXJzaW9uOiAiMS4yLjYiIH07Im51bWJlciIgPT0gdHlwZW9mIF9fZSAmJiAoX19lID0gbik7CiAgICB9LCB7fV0sIDMyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuYS1mdW5jdGlvbiIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgaWYgKG4oZSksIHZvaWQgMCA9PT0gdCkgcmV0dXJuIGU7c3dpdGNoIChyKSB7Y2FzZSAxOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHQsIHIpOwogICAgICAgICAgICB9O2Nhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCByLCBuKTsKICAgICAgICAgICAgfTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbiwgbykgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodCwgciwgbiwgbyk7CiAgICAgICAgICAgIH07fXJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYS1mdW5jdGlvbiI6IDI2IH1dLCAzMzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PSBlKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgZSk7cmV0dXJuIGU7CiAgICAgIH07CiAgICB9LCB7fV0sIDM0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gIWUoIi4vJC5mYWlscyIpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gNyAhPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICJhIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pLmE7CiAgICAgIH0pOwogICAgfSwgeyAiLi8kLmZhaWxzIjogMzggfV0sIDM1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBvID0gZSgiLi8kLmdsb2JhbCIpLmRvY3VtZW50LAogICAgICAgICAgaSA9IG4obykgJiYgbihvLmNyZWF0ZUVsZW1lbnQpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGkgPyBvLmNyZWF0ZUVsZW1lbnQoZSkgOiB7fTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgMzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBuLmdldEtleXMoZSksCiAgICAgICAgICAgIHIgPSBuLmdldFN5bWJvbHM7aWYgKHIpIGZvciAodmFyIG8sIGkgPSByKGUpLCBzID0gbi5pc0VudW0sIGEgPSAwOyBpLmxlbmd0aCA+IGE7KSB7CiAgICAgICAgICBzLmNhbGwoZSwgbyA9IGlbYSsrXSkgJiYgdC5wdXNoKG8pOwogICAgICAgIH1yZXR1cm4gdDsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2IH1dLCAzNzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5jb3JlIiksCiAgICAgICAgICBpID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgcyA9ICJwcm90b3R5cGUiLAogICAgICAgICAgYSA9IGZ1bmN0aW9uIGEoZSwgdCwgcikgewogICAgICAgIHZhciBjLAogICAgICAgICAgICB1LAogICAgICAgICAgICBsLAogICAgICAgICAgICBmID0gZSAmIGEuRiwKICAgICAgICAgICAgZCA9IGUgJiBhLkcsCiAgICAgICAgICAgIHAgPSBlICYgYS5TLAogICAgICAgICAgICBiID0gZSAmIGEuUCwKICAgICAgICAgICAgaCA9IGUgJiBhLkIsCiAgICAgICAgICAgIHYgPSBlICYgYS5XLAogICAgICAgICAgICB5ID0gZCA/IG8gOiBvW3RdIHx8IChvW3RdID0ge30pLAogICAgICAgICAgICBfID0gZCA/IG4gOiBwID8gblt0XSA6IChuW3RdIHx8IHt9KVtzXTtkICYmIChyID0gdCk7Zm9yIChjIGluIHIpIHsKICAgICAgICAgIHUgPSAhZiAmJiBfICYmIGMgaW4gXywgdSAmJiBjIGluIHkgfHwgKGwgPSB1ID8gX1tjXSA6IHJbY10sIHlbY10gPSBkICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIF9bY10gPyByW2NdIDogaCAmJiB1ID8gaShsLCBuKSA6IHYgJiYgX1tjXSA9PSBsID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBmdW5jdGlvbiB0KF90KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBlID8gbmV3IGUoX3QpIDogZShfdCk7CiAgICAgICAgICAgIH07cmV0dXJuIHRbc10gPSBlW3NdLCB0OwogICAgICAgICAgfShsKSA6IGIgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgbCA/IGkoRnVuY3Rpb24uY2FsbCwgbCkgOiBsLCBiICYmICgoeVtzXSB8fCAoeVtzXSA9IHt9KSlbY10gPSBsKSk7CiAgICAgICAgfQogICAgICB9O2EuRiA9IDEsIGEuRyA9IDIsIGEuUyA9IDQsIGEuUCA9IDgsIGEuQiA9IDE2LCBhLlcgPSAzMiwgdC5leHBvcnRzID0gYTsKICAgIH0sIHsgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZ2xvYmFsIjogNDEgfV0sIDM4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuICEhZSgpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7fV0sIDM5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY3R4IiksCiAgICAgICAgICBvID0gZSgiLi8kLml0ZXItY2FsbCIpLAogICAgICAgICAgaSA9IGUoIi4vJC5pcy1hcnJheS1pdGVyIiksCiAgICAgICAgICBzID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgYSA9IGUoIi4vJC50by1sZW5ndGgiKSwKICAgICAgICAgIGMgPSBlKCIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCB1KSB7CiAgICAgICAgdmFyIGwsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIHAgPSBjKGUpLAogICAgICAgICAgICBiID0gbihyLCB1LCB0ID8gMiA6IDEpLAogICAgICAgICAgICBoID0gMDtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcCkgdGhyb3cgVHlwZUVycm9yKGUgKyAiIGlzIG5vdCBpdGVyYWJsZSEiKTtpZiAoaShwKSkgZm9yIChsID0gYShlLmxlbmd0aCk7IGwgPiBoOyBoKyspIHsKICAgICAgICAgIHQgPyBiKHMoZiA9IGVbaF0pWzBdLCBmWzFdKSA6IGIoZVtoXSk7CiAgICAgICAgfSBlbHNlIGZvciAoZCA9IHAuY2FsbChlKTsgIShmID0gZC5uZXh0KCkpLmRvbmU7KSB7CiAgICAgICAgICBvKGQsIGIsIGYudmFsdWUsIHQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1hcnJheS1pdGVyIjogNDcsICIuLyQuaXRlci1jYWxsIjogNTAsICIuLyQudG8tbGVuZ3RoIjogNzUsICIuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCI6IDc5IH1dLCA0MDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKS5nZXROYW1lcywKICAgICAgICAgIGkgPSB7fS50b1N0cmluZywKICAgICAgICAgIHMgPSAib2JqZWN0IiA9PSAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yod2luZG93KSkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW10sCiAgICAgICAgICBhID0gZnVuY3Rpb24gYShlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBvKGUpOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIHJldHVybiBzLnNsaWNlKCk7CiAgICAgICAgfQogICAgICB9O3QuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBzICYmICJbb2JqZWN0IFdpbmRvd10iID09IGkuY2FsbChlKSA/IGEoZSkgOiBvKG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA0MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gdC5leHBvcnRzID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIDogRnVuY3Rpb24oInJldHVybiB0aGlzIikoKTsibnVtYmVyIiA9PSB0eXBlb2YgX19nICYmIChfX2cgPSBuKTsKICAgIH0sIHt9XSwgNDI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IHt9Lmhhc093blByb3BlcnR5O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIG4uY2FsbChlLCB0KTsKICAgICAgfTsKICAgIH0sIHt9XSwgNDM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzID0gZSgiLi8kLmRlc2NyaXB0b3JzIikgPyBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBuLnNldERlc2MoZSwgdCwgbygxLCByKSk7CiAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIHJldHVybiBlW3RdID0gciwgZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmRlc2NyaXB0b3JzIjogMzQsICIuLyQucHJvcGVydHktZGVzYyI6IDYxIH1dLCA0NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5nbG9iYWwiKS5kb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB9LCB7ICIuLyQuZ2xvYmFsIjogNDEgfV0sIDQ1OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IHZvaWQgMCA9PT0gcjtzd2l0Y2ggKHQubGVuZ3RoKSB7Y2FzZSAwOgogICAgICAgICAgICByZXR1cm4gbiA/IGUoKSA6IGUuY2FsbChyKTtjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdKSA6IGUuY2FsbChyLCB0WzBdKTtjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdKTtjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdKTtjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiBuID8gZSh0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKSA6IGUuY2FsbChyLCB0WzBdLCB0WzFdLCB0WzJdLCB0WzNdKTt9cmV0dXJuIGUuYXBwbHkociwgdCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDQ2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gT2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3RyaW5nIiA9PSBuKGUpID8gZS5zcGxpdCgiIikgOiBPYmplY3QoZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBvID0gZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLAogICAgICAgICAgaSA9IEFycmF5LnByb3RvdHlwZTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUgJiYgKG4uQXJyYXkgPT09IGUgfHwgaVtvXSA9PT0gZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQud2tzIjogNzggfV0sIDQ4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuY29mIik7dC5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiQXJyYXkiID09IG4oZSk7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY29mIjogMzAgfV0sIDQ5OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gKHR5cGVvZiBlID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihlKSkgPyBudWxsICE9PSBlIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTsKICAgICAgfTsKICAgIH0sIHt9XSwgNTA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5hbi1vYmplY3QiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgciwgbykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbyA/IHQobihyKVswXSwgclsxXSkgOiB0KHIpOwogICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgIHZhciBzID0gZVsicmV0dXJuIl07dGhyb3cgdm9pZCAwICE9PSBzICYmIG4ocy5jYWxsKGUpKSwgaTsKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB7ICIuLyQuYW4tb2JqZWN0IjogMjggfV0sIDUxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBpID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBzID0ge307ZSgiLi8kLmhpZGUiKShzLCBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSksIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZS5wcm90b3R5cGUgPSBuLmNyZWF0ZShzLCB7IG5leHQ6IG8oMSwgcikgfSksIGkoZSwgdCArICIgSXRlcmF0b3IiKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmhpZGUiOiA0MywgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZXhwb3J0IiksCiAgICAgICAgICBpID0gZSgiLi8kLnJlZGVmaW5lIiksCiAgICAgICAgICBzID0gZSgiLi8kLmhpZGUiKSwKICAgICAgICAgIGEgPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBjID0gZSgiLi8kLml0ZXJhdG9ycyIpLAogICAgICAgICAgdSA9IGUoIi4vJC5pdGVyLWNyZWF0ZSIpLAogICAgICAgICAgbCA9IGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpLAogICAgICAgICAgZiA9IGUoIi4vJCIpLmdldFByb3RvLAogICAgICAgICAgZCA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIHAgPSAhKFtdLmtleXMgJiYgIm5leHQiIGluIFtdLmtleXMoKSksCiAgICAgICAgICBiID0gIkBAaXRlcmF0b3IiLAogICAgICAgICAgaCA9ICJrZXlzIiwKICAgICAgICAgIHYgPSAidmFsdWVzIiwKICAgICAgICAgIHkgPSBmdW5jdGlvbiB5KCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9O3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByLCBfLCBnLCBtLCBqKSB7CiAgICAgICAgdShyLCB0LCBfKTt2YXIgJCwKICAgICAgICAgICAgTywKICAgICAgICAgICAgdyA9IGZ1bmN0aW9uIHcoZSkgewogICAgICAgICAgaWYgKCFwICYmIGUgaW4gRSkgcmV0dXJuIEVbZV07c3dpdGNoIChlKSB7Y2FzZSBoOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICAgICAgfTtjYXNlIHY6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcih0aGlzLCBlKTsKICAgICAgICAgICAgICB9O31yZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHIodGhpcywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIGsgPSB0ICsgIiBJdGVyYXRvciIsCiAgICAgICAgICAgIHggPSBnID09IHYsCiAgICAgICAgICAgIEMgPSAhMSwKICAgICAgICAgICAgRSA9IGUucHJvdG90eXBlLAogICAgICAgICAgICBTID0gRVtkXSB8fCBFW2JdIHx8IGcgJiYgRVtnXSwKICAgICAgICAgICAgVCA9IFMgfHwgdyhnKTtpZiAoUykgewogICAgICAgICAgdmFyIE0gPSBmKFQuY2FsbChuZXcgZSgpKSk7bChNLCBrLCAhMCksICFuICYmIGEoRSwgYikgJiYgcyhNLCBkLCB5KSwgeCAmJiBTLm5hbWUgIT09IHYgJiYgKEMgPSAhMCwgVCA9IGZ1bmN0aW9uIFQoKSB7CiAgICAgICAgICAgIHJldHVybiBTLmNhbGwodGhpcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9aWYgKG4gJiYgIWogfHwgIXAgJiYgIUMgJiYgRVtkXSB8fCBzKEUsIGQsIFQpLCBjW3RdID0gVCwgY1trXSA9IHksIGcpIGlmICgkID0geyB2YWx1ZXM6IHggPyBUIDogdyh2KSwga2V5czogbSA/IFQgOiB3KGgpLCBlbnRyaWVzOiB4ID8gdygiZW50cmllcyIpIDogVCB9LCBqKSBmb3IgKE8gaW4gJCkgewogICAgICAgICAgTyBpbiBFIHx8IGkoRSwgTywgJFtPXSk7CiAgICAgICAgfSBlbHNlIG8oby5QICsgby5GICogKHAgfHwgQyksIHQsICQpO3JldHVybiAkOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuZXhwb3J0IjogMzcsICIuLyQuaGFzIjogNDIsICIuLyQuaGlkZSI6IDQzLCAiLi8kLml0ZXItY3JlYXRlIjogNTEsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQubGlicmFyeSI6IDU4LCAiLi8kLnJlZGVmaW5lIjogNjMsICIuLyQuc2V0LXRvLXN0cmluZy10YWciOiA2NywgIi4vJC53a3MiOiA3OCB9XSwgNTM6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSwKICAgICAgICAgIG8gPSAhMTt0cnkgewogICAgICAgIHZhciBpID0gWzddW25dKCk7aVsicmV0dXJuIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvID0gITA7CiAgICAgICAgfSwgQXJyYXkuZnJvbShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChzKSB7fXQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKCF0ICYmICFvKSByZXR1cm4gITE7dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgdmFyIGkgPSBbN10sCiAgICAgICAgICAgICAgcyA9IGlbbl0oKTtzLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgIH0sIGlbbl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgfSwgZShpKTsKICAgICAgICB9IGNhdGNoIChhKSB7fXJldHVybiByOwogICAgICB9OwogICAgfSwgeyAiLi8kLndrcyI6IDc4IH1dLCA1NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEhZSB9OwogICAgICB9OwogICAgfSwge31dLCA1NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IHt9OwogICAgfSwge31dLCA1NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gT2JqZWN0O3QuZXhwb3J0cyA9IHsgY3JlYXRlOiBuLmNyZWF0ZSwgZ2V0UHJvdG86IG4uZ2V0UHJvdG90eXBlT2YsIGlzRW51bToge30ucHJvcGVydHlJc0VudW1lcmFibGUsIGdldERlc2M6IG4uZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLCBzZXREZXNjOiBuLmRlZmluZVByb3BlcnR5LCBzZXREZXNjczogbi5kZWZpbmVQcm9wZXJ0aWVzLCBnZXRLZXlzOiBuLmtleXMsIGdldE5hbWVzOiBuLmdldE93blByb3BlcnR5TmFtZXMsIGdldFN5bWJvbHM6IG4uZ2V0T3duUHJvcGVydHlTeW1ib2xzLCBlYWNoOiBbXS5mb3JFYWNoIH07CiAgICB9LCB7fV0sIDU3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQudG8taW9iamVjdCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciwgaSA9IG8oZSksIHMgPSBuLmdldEtleXMoaSksIGEgPSBzLmxlbmd0aCwgYyA9IDA7IGEgPiBjOykgewogICAgICAgICAgaWYgKGlbciA9IHNbYysrXV0gPT09IHQpIHJldHVybiByOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgNTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSAhMDsKICAgIH0sIHt9XSwgNTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgcyA9IGUoIi4vJC5nbG9iYWwiKSwKICAgICAgICAgIGEgPSBlKCIuLyQudGFzayIpLnNldCwKICAgICAgICAgIGMgPSBzLk11dGF0aW9uT2JzZXJ2ZXIgfHwgcy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLAogICAgICAgICAgdSA9IHMucHJvY2VzcywKICAgICAgICAgIGwgPSBzLlByb21pc2UsCiAgICAgICAgICBmID0gInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKSh1KSwKICAgICAgICAgIGQgPSBmdW5jdGlvbiBkKCkgewogICAgICAgIHZhciBlLCB0LCByO2ZvciAoZiAmJiAoZSA9IHUuZG9tYWluKSAmJiAodS5kb21haW4gPSBudWxsLCBlLmV4aXQoKSk7IG47KSB7CiAgICAgICAgICB0ID0gbi5kb21haW4sIHIgPSBuLmZuLCB0ICYmIHQuZW50ZXIoKSwgcigpLCB0ICYmIHQuZXhpdCgpLCBuID0gbi5uZXh0OwogICAgICAgIH1vID0gdm9pZCAwLCBlICYmIGUuZW50ZXIoKTsKICAgICAgfTtpZiAoZikgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgdS5uZXh0VGljayhkKTsKICAgICAgfTtlbHNlIGlmIChjKSB7CiAgICAgICAgdmFyIHAgPSAxLAogICAgICAgICAgICBiID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyBjKGQpLm9ic2VydmUoYiwgeyBjaGFyYWN0ZXJEYXRhOiAhMCB9KSwgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgICBiLmRhdGEgPSBwID0gLXA7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGkgPSBsICYmIGwucmVzb2x2ZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICBsLnJlc29sdmUoKS50aGVuKGQpOwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIGEuY2FsbChzLCBkKTsKICAgICAgfTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0geyBmbjogZSwgbmV4dDogdm9pZCAwLCBkb21haW46IGYgJiYgdS5kb21haW4gfTtvICYmIChvLm5leHQgPSB0KSwgbiB8fCAobiA9IHQsIGkoKSksIG8gPSB0OwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvZiI6IDMwLCAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnRhc2siOiA3MiB9XSwgNjA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuY29yZSIpLAogICAgICAgICAgaSA9IGUoIi4vJC5mYWlscyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIHIgPSAoby5PYmplY3QgfHwge30pW2VdIHx8IE9iamVjdFtlXSwKICAgICAgICAgICAgcyA9IHt9O3NbZV0gPSB0KHIpLCBuKG4uUyArIG4uRiAqIGkoZnVuY3Rpb24gKCkgewogICAgICAgICAgcigxKTsKICAgICAgICB9KSwgIk9iamVjdCIsIHMpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmNvcmUiOiAzMSwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mYWlscyI6IDM4IH1dLCA2MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZSksIGNvbmZpZ3VyYWJsZTogISgyICYgZSksIHdyaXRhYmxlOiAhKDQgJiBlKSwgdmFsdWU6IHQgfTsKICAgICAgfTsKICAgIH0sIHt9XSwgNjI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5yZWRlZmluZSIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgciBpbiB0KSB7CiAgICAgICAgICBuKGUsIHIsIHRbcl0pOwogICAgICAgIH1yZXR1cm4gZTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5yZWRlZmluZSI6IDYzIH1dLCA2MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IGUoIi4vJC5oaWRlIik7CiAgICB9LCB7ICIuLyQuaGlkZSI6IDQzIH1dLCA2NDogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHQuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBlID09PSB0ID8gMCAhPT0gZSB8fCAxIC8gZSA9PT0gMSAvIHQgOiBlICE9IGUgJiYgdCAhPSB0OwogICAgICB9OwogICAgfSwge31dLCA2NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuZ2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaXMtb2JqZWN0IiksCiAgICAgICAgICBpID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgcyA9IGZ1bmN0aW9uIHMoZSwgdCkgewogICAgICAgIGlmIChpKGUpLCAhbyh0KSAmJiBudWxsICE9PSB0KSB0aHJvdyBUeXBlRXJyb3IodCArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07dC5leHBvcnRzID0geyBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbiAodCwgciwgbykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbyA9IGUoIi4vJC5jdHgiKShGdW5jdGlvbi5jYWxsLCBuKE9iamVjdC5wcm90b3R5cGUsICJfX3Byb3RvX18iKS5zZXQsIDIpLCBvKHQsIFtdKSwgciA9ICEodCBpbnN0YW5jZW9mIEFycmF5KTsKICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgciA9ICEwOwogICAgICAgICAgfXJldHVybiBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gcyhlLCB0KSwgciA/IGUuX19wcm90b19fID0gdCA6IG8oZSwgdCksIGU7CiAgICAgICAgICB9OwogICAgICAgIH0oe30sICExKSA6IHZvaWQgMCksIGNoZWNrOiBzIH07CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5pcy1vYmplY3QiOiA0OSB9XSwgNjY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmNvcmUiKSwKICAgICAgICAgIG8gPSBlKCIuLyQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZGVzY3JpcHRvcnMiKSwKICAgICAgICAgIHMgPSBlKCIuLyQud2tzIikoInNwZWNpZXMiKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gbltlXTtpICYmIHQgJiYgIXRbc10gJiYgby5zZXREZXNjKHQsIHMsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSB9KTsKICAgICAgfTsKICAgIH0sIHsgIi4vJCI6IDU2LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLndrcyI6IDc4IH1dLCA2NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kIikuc2V0RGVzYywKICAgICAgICAgIG8gPSBlKCIuLyQuaGFzIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJ0b1N0cmluZ1RhZyIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICAgZSAmJiAhbyhlID0gciA/IGUgOiBlLnByb3RvdHlwZSwgaSkgJiYgbihlLCBpLCB7IGNvbmZpZ3VyYWJsZTogITAsIHZhbHVlOiB0IH0pOwogICAgICB9OwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuaGFzIjogNDIsICIuLyQud2tzIjogNzggfV0sIDY4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBvID0gIl9fY29yZS1qc19zaGFyZWRfXyIsCiAgICAgICAgICBpID0gbltvXSB8fCAobltvXSA9IHt9KTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBpW2VdIHx8IChpW2VdID0ge30pOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxIH1dLCA2OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmFuLW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5hLWZ1bmN0aW9uIiksCiAgICAgICAgICBpID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcyA9IG4oZSkuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMCA9PT0gcyB8fCB2b2lkIDAgPT0gKHIgPSBuKHMpW2ldKSA/IHQgOiBvKHIpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmEtZnVuY3Rpb24iOiAyNiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC53a3MiOiA3OCB9XSwgNzA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSkgdGhyb3cgVHlwZUVycm9yKHIgKyAiOiB1c2UgdGhlICduZXcnIG9wZXJhdG9yISIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCA3MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGEgPSBTdHJpbmcobyh0KSksCiAgICAgICAgICAgICAgYyA9IG4ociksCiAgICAgICAgICAgICAgdSA9IGEubGVuZ3RoO3JldHVybiAwID4gYyB8fCBjID49IHUgPyBlID8gIiIgOiB2b2lkIDAgOiAoaSA9IGEuY2hhckNvZGVBdChjKSwgNTUyOTYgPiBpIHx8IGkgPiA1NjMxOSB8fCBjICsgMSA9PT0gdSB8fCAocyA9IGEuY2hhckNvZGVBdChjICsgMSkpIDwgNTYzMjAgfHwgcyA+IDU3MzQzID8gZSA/IGEuY2hhckF0KGMpIDogaSA6IGUgPyBhLnNsaWNlKGMsIGMgKyAyKSA6IChpIC0gNTUyOTYgPDwgMTApICsgKHMgLSA1NjMyMCkgKyA2NTUzNik7CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQudG8taW50ZWdlciI6IDczIH1dLCA3MjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBzID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYSA9IGUoIi4vJC5pbnZva2UiKSwKICAgICAgICAgIGMgPSBlKCIuLyQuaHRtbCIpLAogICAgICAgICAgdSA9IGUoIi4vJC5kb20tY3JlYXRlIiksCiAgICAgICAgICBsID0gZSgiLi8kLmdsb2JhbCIpLAogICAgICAgICAgZiA9IGwucHJvY2VzcywKICAgICAgICAgIGQgPSBsLnNldEltbWVkaWF0ZSwKICAgICAgICAgIHAgPSBsLmNsZWFySW1tZWRpYXRlLAogICAgICAgICAgYiA9IGwuTWVzc2FnZUNoYW5uZWwsCiAgICAgICAgICBoID0gMCwKICAgICAgICAgIHYgPSB7fSwKICAgICAgICAgIHkgPSAib25yZWFkeXN0YXRlY2hhbmdlIiwKICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKCkgewogICAgICAgIHZhciBlID0gK3RoaXM7aWYgKHYuaGFzT3duUHJvcGVydHkoZSkpIHsKICAgICAgICAgIHZhciB0ID0gdltlXTtkZWxldGUgdltlXSwgdCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIGcgPSBmdW5jdGlvbiBnKGUpIHsKICAgICAgICBfLmNhbGwoZS5kYXRhKTsKICAgICAgfTtkICYmIHAgfHwgKGQgPSBmdW5jdGlvbiBkKGUpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIHIgPSAxOyBhcmd1bWVudHMubGVuZ3RoID4gcjspIHsKICAgICAgICAgIHQucHVzaChhcmd1bWVudHNbcisrXSk7CiAgICAgICAgfXJldHVybiB2WysraF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBhKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogRnVuY3Rpb24oZSksIHQpOwogICAgICAgIH0sIG4oaCksIGg7CiAgICAgIH0sIHAgPSBmdW5jdGlvbiBwKGUpIHsKICAgICAgICBkZWxldGUgdltlXTsKICAgICAgfSwgInByb2Nlc3MiID09IGUoIi4vJC5jb2YiKShmKSA/IG4gPSBmdW5jdGlvbiBuKGUpIHsKICAgICAgICBmLm5leHRUaWNrKHMoXywgZSwgMSkpOwogICAgICB9IDogYiA/IChvID0gbmV3IGIoKSwgaSA9IG8ucG9ydDIsIG8ucG9ydDEub25tZXNzYWdlID0gZywgbiA9IHMoaS5wb3N0TWVzc2FnZSwgaSwgMSkpIDogbC5hZGRFdmVudExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHBvc3RNZXNzYWdlICYmICFsLmltcG9ydFNjcmlwdHMgPyAobiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGwucG9zdE1lc3NhZ2UoZSArICIiLCAiKiIpOwogICAgICB9LCBsLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBnLCAhMSkpIDogbiA9IHkgaW4gdSgic2NyaXB0IikgPyBmdW5jdGlvbiAoZSkgewogICAgICAgIGMuYXBwZW5kQ2hpbGQodSgic2NyaXB0IikpW3ldID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgYy5yZW1vdmVDaGlsZCh0aGlzKSwgXy5jYWxsKGUpOwogICAgICAgIH07CiAgICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHNldFRpbWVvdXQocyhfLCBlLCAxKSwgMCk7CiAgICAgIH0pLCB0LmV4cG9ydHMgPSB7IHNldDogZCwgY2xlYXI6IHAgfTsKICAgIH0sIHsgIi4vJC5jb2YiOiAzMCwgIi4vJC5jdHgiOiAzMiwgIi4vJC5kb20tY3JlYXRlIjogMzUsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaHRtbCI6IDQ0LCAiLi8kLmludm9rZSI6IDQ1IH1dLCA3MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gTWF0aC5jZWlsLAogICAgICAgICAgbyA9IE1hdGguZmxvb3I7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gaXNOYU4oZSA9ICtlKSA/IDAgOiAoZSA+IDAgPyBvIDogbikoZSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuaW9iamVjdCIpLAogICAgICAgICAgbyA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbihvKGUpKTsKICAgICAgfTsKICAgIH0sIHsgIi4vJC5kZWZpbmVkIjogMzMsICIuLyQuaW9iamVjdCI6IDQ2IH1dLCA3NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWludGVnZXIiKSwKICAgICAgICAgIG8gPSBNYXRoLm1pbjt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlID4gMCA/IG8obihlKSwgOTAwNzE5OTI1NDc0MDk5MSkgOiAwOwogICAgICB9OwogICAgfSwgeyAiLi8kLnRvLWludGVnZXIiOiA3MyB9XSwgNzY6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KG4oZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmRlZmluZWQiOiAzMyB9XSwgNzc6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IDAsCiAgICAgICAgICBvID0gTWF0aC5yYW5kb20oKTt0LmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIuY29uY2F0KHZvaWQgMCA9PT0gZSA/ICIiIDogZSwgIilfIiwgKCsrbiArIG8pLnRvU3RyaW5nKDM2KSk7CiAgICAgIH07CiAgICB9LCB7fV0sIDc4OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuc2hhcmVkIikoIndrcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC51aWQiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuZ2xvYmFsIikuU3ltYm9sO3QuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG5bZV0gfHwgKG5bZV0gPSBpICYmIGlbZV0gfHwgKGkgfHwgbykoIlN5bWJvbC4iICsgZSkpOwogICAgICB9OwogICAgfSwgeyAiLi8kLmdsb2JhbCI6IDQxLCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnVpZCI6IDc3IH1dLCA3OTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLmNsYXNzb2YiKSwKICAgICAgICAgIG8gPSBlKCIuLyQud2tzIikoIml0ZXJhdG9yIiksCiAgICAgICAgICBpID0gZSgiLi8kLml0ZXJhdG9ycyIpO3QuZXhwb3J0cyA9IGUoIi4vJC5jb3JlIikuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB2b2lkIDAgIT0gZSA/IGVbb10gfHwgZVsiQEBpdGVyYXRvciJdIHx8IGlbbihlKV0gOiB2b2lkIDA7CiAgICAgIH07CiAgICB9LCB7ICIuLyQuY2xhc3NvZiI6IDI5LCAiLi8kLmNvcmUiOiAzMSwgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vJC53a3MiOiA3OCB9XSwgODA6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZSgiLi8kLmFkZC10by11bnNjb3BhYmxlcyIpLAogICAgICAgICAgbyA9IGUoIi4vJC5pdGVyLXN0ZXAiKSwKICAgICAgICAgIGkgPSBlKCIuLyQuaXRlcmF0b3JzIiksCiAgICAgICAgICBzID0gZSgiLi8kLnRvLWlvYmplY3QiKTt0LmV4cG9ydHMgPSBlKCIuLyQuaXRlci1kZWZpbmUiKShBcnJheSwgIkFycmF5IiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0aGlzLl90ID0gcyhlKSwgdGhpcy5faSA9IDAsIHRoaXMuX2sgPSB0OwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl90LAogICAgICAgICAgICB0ID0gdGhpcy5faywKICAgICAgICAgICAgciA9IHRoaXMuX2krKztyZXR1cm4gIWUgfHwgciA+PSBlLmxlbmd0aCA/ICh0aGlzLl90ID0gdm9pZCAwLCBvKDEpKSA6ICJrZXlzIiA9PSB0ID8gbygwLCByKSA6ICJ2YWx1ZXMiID09IHQgPyBvKDAsIGVbcl0pIDogbygwLCBbciwgZVtyXV0pOwogICAgICB9LCAidmFsdWVzIiksIGkuQXJndW1lbnRzID0gaS5BcnJheSwgbigia2V5cyIpLCBuKCJ2YWx1ZXMiKSwgbigiZW50cmllcyIpOwogICAgfSwgeyAiLi8kLmFkZC10by11bnNjb3BhYmxlcyI6IDI3LCAiLi8kLml0ZXItZGVmaW5lIjogNTIsICIuLyQuaXRlci1zdGVwIjogNTQsICIuLyQuaXRlcmF0b3JzIjogNTUsICIuLyQudG8taW9iamVjdCI6IDc0IH1dLCA4MTogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgIHZhciBuID0gZSgiLi8kLnRvLWlvYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgcmV0dXJuIGUobih0KSwgcik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LCB7ICIuLyQub2JqZWN0LXNhcCI6IDYwLCAiLi8kLnRvLWlvYmplY3QiOiA3NCB9XSwgODI6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICB2YXIgbiA9IGUoIi4vJC50by1vYmplY3QiKTtlKCIuLyQub2JqZWN0LXNhcCIpKCJnZXRQcm90b3R5cGVPZiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDgzOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQudG8tb2JqZWN0Iik7ZSgiLi8kLm9iamVjdC1zYXAiKSgia2V5cyIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZShuKHQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5vYmplY3Qtc2FwIjogNjAsICIuLyQudG8tb2JqZWN0IjogNzYgfV0sIDg0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgdmFyIG4gPSBlKCIuLyQuZXhwb3J0Iik7bihuLlMsICJPYmplY3QiLCB7IHNldFByb3RvdHlwZU9mOiBlKCIuLyQuc2V0LXByb3RvIikuc2V0IH0pOwogICAgfSwgeyAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLnNldC1wcm90byI6IDY1IH1dLCA4NTogW2Z1bmN0aW9uIChlLCB0LCByKSB7fSwge31dLCA4NjogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4sCiAgICAgICAgICBvID0gZSgiLi8kIiksCiAgICAgICAgICBpID0gZSgiLi8kLmxpYnJhcnkiKSwKICAgICAgICAgIHMgPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBhID0gZSgiLi8kLmN0eCIpLAogICAgICAgICAgYyA9IGUoIi4vJC5jbGFzc29mIiksCiAgICAgICAgICB1ID0gZSgiLi8kLmV4cG9ydCIpLAogICAgICAgICAgbCA9IGUoIi4vJC5pcy1vYmplY3QiKSwKICAgICAgICAgIGYgPSBlKCIuLyQuYW4tb2JqZWN0IiksCiAgICAgICAgICBkID0gZSgiLi8kLmEtZnVuY3Rpb24iKSwKICAgICAgICAgIHAgPSBlKCIuLyQuc3RyaWN0LW5ldyIpLAogICAgICAgICAgYiA9IGUoIi4vJC5mb3Itb2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuc2V0LXByb3RvIikuc2V0LAogICAgICAgICAgdiA9IGUoIi4vJC5zYW1lLXZhbHVlIiksCiAgICAgICAgICB5ID0gZSgiLi8kLndrcyIpKCJzcGVjaWVzIiksCiAgICAgICAgICBfID0gZSgiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiKSwKICAgICAgICAgIGcgPSBlKCIuLyQubWljcm90YXNrIiksCiAgICAgICAgICBtID0gIlByb21pc2UiLAogICAgICAgICAgaiA9IHMucHJvY2VzcywKICAgICAgICAgICQgPSAicHJvY2VzcyIgPT0gYyhqKSwKICAgICAgICAgIF9PID0gc1ttXSwKICAgICAgICAgIHcgPSBmdW5jdGlvbiB3KGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBfTyhmdW5jdGlvbiAoKSB7fSk7cmV0dXJuIGUgJiYgKHQuY29uc3RydWN0b3IgPSBPYmplY3QpLCBfTy5yZXNvbHZlKHQpID09PSB0OwogICAgICB9LAogICAgICAgICAgayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiB0KGUpIHsKICAgICAgICAgIHZhciByID0gbmV3IF9PKGUpO3JldHVybiBoKHIsIHQucHJvdG90eXBlKSwgcjsKICAgICAgICB9dmFyIHIgPSAhMTt0cnkgewogICAgICAgICAgaWYgKHIgPSBfTyAmJiBfTy5yZXNvbHZlICYmIHcoKSwgaCh0LCBfTyksIHQucHJvdG90eXBlID0gby5jcmVhdGUoX08ucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiB0IH0gfSksIHQucmVzb2x2ZSg1KS50aGVuKGZ1bmN0aW9uICgpIHt9KSBpbnN0YW5jZW9mIHQgfHwgKHIgPSAhMSksIHIgJiYgZSgiLi8kLmRlc2NyaXB0b3JzIikpIHsKICAgICAgICAgICAgdmFyIG4gPSAhMTtfTy5yZXNvbHZlKG8uc2V0RGVzYyh7fSwgInRoZW4iLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgbiA9ICEwOwogICAgICAgICAgICAgIH0gfSkpLCByID0gbjsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICByID0gITE7CiAgICAgICAgfXJldHVybiByOwogICAgICB9KCksCiAgICAgICAgICB4ID0gZnVuY3Rpb24geChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGkgJiYgZSA9PT0gX08gJiYgdCA9PT0gbiA/ICEwIDogdihlLCB0KTsKICAgICAgfSwKICAgICAgICAgIEMgPSBmdW5jdGlvbiBDKGUpIHsKICAgICAgICB2YXIgdCA9IGYoZSlbeV07cmV0dXJuIHZvaWQgMCAhPSB0ID8gdCA6IGU7CiAgICAgIH0sCiAgICAgICAgICBFID0gZnVuY3Rpb24gRShlKSB7CiAgICAgICAgdmFyIHQ7cmV0dXJuIGwoZSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHQgPSBlLnRoZW4pID8gdCA6ICExOwogICAgICB9LAogICAgICAgICAgUyA9IGZ1bmN0aW9uIFMoZSkgewogICAgICAgIHZhciB0LCByO3RoaXMucHJvbWlzZSA9IG5ldyBlKGZ1bmN0aW9uIChlLCBuKSB7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSB0IHx8IHZvaWQgMCAhPT0gcikgdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO3QgPSBlLCByID0gbjsKICAgICAgICB9KSwgdGhpcy5yZXNvbHZlID0gZCh0KSwgdGhpcy5yZWplY3QgPSBkKHIpOwogICAgICB9LAogICAgICAgICAgVCA9IGZ1bmN0aW9uIFQoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBlKCk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHQgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBNID0gZnVuY3Rpb24gTShlLCB0KSB7CiAgICAgICAgaWYgKCFlLm4pIHsKICAgICAgICAgIGUubiA9ICEwO3ZhciByID0gZS5jO2coZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0gZS52LCBvID0gMSA9PSBlLnMsIGkgPSAwLCBhID0gZnVuY3Rpb24gYSh0KSB7CiAgICAgICAgICAgICAgdmFyIHIsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIHMgPSBvID8gdC5vayA6IHQuZmFpbCwKICAgICAgICAgICAgICAgICAgYSA9IHQucmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgYyA9IHQucmVqZWN0O3RyeSB7CiAgICAgICAgICAgICAgICBzID8gKG8gfHwgKGUuaCA9ICEwKSwgciA9IHMgPT09ICEwID8gbiA6IHMobiksIHIgPT09IHQucHJvbWlzZSA/IGMoVHlwZUVycm9yKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpIDogKGkgPSBFKHIpKSA/IGkuY2FsbChyLCBhLCBjKSA6IGEocikpIDogYyhuKTsKICAgICAgICAgICAgICB9IGNhdGNoICh1KSB7CiAgICAgICAgICAgICAgICBjKHUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgci5sZW5ndGggPiBpOykgewogICAgICAgICAgICAgIGEocltpKytdKTsKICAgICAgICAgICAgfXIubGVuZ3RoID0gMCwgZS5uID0gITEsIHQgJiYgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQsCiAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgIG8gPSBlLnA7TihvKSAmJiAoJCA/IGouZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIiwgbiwgbykgOiAodCA9IHMub251bmhhbmRsZWRyZWplY3Rpb24pID8gdCh7IHByb21pc2U6IG8sIHJlYXNvbjogbiB9KSA6IChyID0gcy5jb25zb2xlKSAmJiByLmVycm9yICYmIHIuZXJyb3IoIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsIG4pKSwgZS5hID0gdm9pZCAwOwogICAgICAgICAgICB9LCAxKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIE4gPSBmdW5jdGlvbiBOKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IGUuX2QsCiAgICAgICAgICAgIG4gPSByLmEgfHwgci5jLAogICAgICAgICAgICBvID0gMDtpZiAoci5oKSByZXR1cm4gITE7Zm9yICg7IG4ubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGlmICh0ID0gbltvKytdLCB0LmZhaWwgfHwgIU4odC5wcm9taXNlKSkgcmV0dXJuICExOwogICAgICAgIH1yZXR1cm4gITA7CiAgICAgIH0sCiAgICAgICAgICBSID0gZnVuY3Rpb24gUihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzO3QuZCB8fCAodC5kID0gITAsIHQgPSB0LnIgfHwgdCwgdC52ID0gZSwgdC5zID0gMiwgdC5hID0gdC5jLnNsaWNlKCksIE0odCwgITApKTsKICAgICAgfSwKICAgICAgICAgIEQgPSBmdW5jdGlvbiBEKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgciA9IHRoaXM7aWYgKCFyLmQpIHsKICAgICAgICAgIHIuZCA9ICEwLCByID0gci5yIHx8IHI7dHJ5IHsKICAgICAgICAgICAgaWYgKHIucCA9PT0gZSkgdGhyb3cgVHlwZUVycm9yKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOyh0ID0gRShlKSkgPyBnKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgcjogciwgZDogITEgfTt0cnkgewogICAgICAgICAgICAgICAgdC5jYWxsKGUsIGEoRCwgbiwgMSksIGEoUiwgbiwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHsKICAgICAgICAgICAgICAgIFIuY2FsbChuLCBvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pIDogKHIudiA9IGUsIHIucyA9IDEsIE0ociwgITEpKTsKICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgUi5jYWxsKHsgcjogciwgZDogITEgfSwgbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9O2sgfHwgKF9PID0gZnVuY3Rpb24gTyhlKSB7CiAgICAgICAgZChlKTt2YXIgdCA9IHRoaXMuX2QgPSB7IHA6IHAodGhpcywgX08sIG0pLCBjOiBbXSwgYTogdm9pZCAwLCBzOiAwLCBkOiAhMSwgdjogdm9pZCAwLCBoOiAhMSwgbjogITEgfTt0cnkgewogICAgICAgICAgZShhKEQsIHQsIDEpLCBhKFIsIHQsIDEpKTsKICAgICAgICB9IGNhdGNoIChyKSB7CiAgICAgICAgICBSLmNhbGwodCwgcik7CiAgICAgICAgfQogICAgICB9LCBlKCIuLyQucmVkZWZpbmUtYWxsIikoX08ucHJvdG90eXBlLCB7IHRoZW46IGZ1bmN0aW9uIHRoZW4oZSwgdCkgewogICAgICAgICAgdmFyIHIgPSBuZXcgUyhfKHRoaXMsIF9PKSksCiAgICAgICAgICAgICAgbiA9IHIucHJvbWlzZSwKICAgICAgICAgICAgICBvID0gdGhpcy5fZDtyZXR1cm4gci5vayA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlIDogITAsIHIuZmFpbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdCwgby5jLnB1c2gociksIG8uYSAmJiBvLmEucHVzaChyKSwgby5zICYmIE0obywgITEpLCBuOwogICAgICAgIH0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaChlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgZSk7CiAgICAgICAgfSB9KSksIHUodS5HICsgdS5XICsgdS5GICogIWssIHsgUHJvbWlzZTogX08gfSksIGUoIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyIpKF9PLCBtKSwgZSgiLi8kLnNldC1zcGVjaWVzIikobSksIG4gPSBlKCIuLyQuY29yZSIpW21dLCB1KHUuUyArIHUuRiAqICFrLCBtLCB7IHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KGUpIHsKICAgICAgICAgIHZhciB0ID0gbmV3IFModGhpcyksCiAgICAgICAgICAgICAgciA9IHQucmVqZWN0O3JldHVybiByKGUpLCB0LnByb21pc2U7CiAgICAgICAgfSB9KSwgdSh1LlMgKyB1LkYgKiAoIWsgfHwgdyghMCkpLCBtLCB7IHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoZSkgewogICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfTyAmJiB4KGUuY29uc3RydWN0b3IsIHRoaXMpKSByZXR1cm4gZTt2YXIgdCA9IG5ldyBTKHRoaXMpLAogICAgICAgICAgICAgIHIgPSB0LnJlc29sdmU7cmV0dXJuIHIoZSksIHQucHJvbWlzZTsKICAgICAgICB9IH0pLCB1KHUuUyArIHUuRiAqICEoayAmJiBlKCIuLyQuaXRlci1kZXRlY3QiKShmdW5jdGlvbiAoZSkgewogICAgICAgIF9PLmFsbChlKVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0pKSwgbSwgeyBhbGw6IGZ1bmN0aW9uIGFsbChlKSB7CiAgICAgICAgICB2YXIgdCA9IEModGhpcyksCiAgICAgICAgICAgICAgciA9IG5ldyBTKHQpLAogICAgICAgICAgICAgIG4gPSByLnJlc29sdmUsCiAgICAgICAgICAgICAgaSA9IHIucmVqZWN0LAogICAgICAgICAgICAgIHMgPSBbXSwKICAgICAgICAgICAgICBhID0gVChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGIoZSwgITEsIHMucHVzaCwgcyk7dmFyIHIgPSBzLmxlbmd0aCwKICAgICAgICAgICAgICAgIGEgPSBBcnJheShyKTtyID8gby5lYWNoLmNhbGwocywgZnVuY3Rpb24gKGUsIG8pIHsKICAgICAgICAgICAgICB2YXIgcyA9ICExO3QucmVzb2x2ZShlKS50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBzIHx8IChzID0gITAsIGFbb10gPSBlLCAtLXIgfHwgbihhKSk7CiAgICAgICAgICAgICAgfSwgaSk7CiAgICAgICAgICAgIH0pIDogbihhKTsKICAgICAgICAgIH0pO3JldHVybiBhICYmIGkoYS5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9LCByYWNlOiBmdW5jdGlvbiByYWNlKGUpIHsKICAgICAgICAgIHZhciB0ID0gQyh0aGlzKSwKICAgICAgICAgICAgICByID0gbmV3IFModCksCiAgICAgICAgICAgICAgbiA9IHIucmVqZWN0LAogICAgICAgICAgICAgIG8gPSBUKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYihlLCAhMSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB0LnJlc29sdmUoZSkudGhlbihyLnJlc29sdmUsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pO3JldHVybiBvICYmIG4oby5lcnJvciksIHIucHJvbWlzZTsKICAgICAgICB9IH0pOwogICAgfSwgeyAiLi8kIjogNTYsICIuLyQuYS1mdW5jdGlvbiI6IDI2LCAiLi8kLmFuLW9iamVjdCI6IDI4LCAiLi8kLmNsYXNzb2YiOiAyOSwgIi4vJC5jb3JlIjogMzEsICIuLyQuY3R4IjogMzIsICIuLyQuZGVzY3JpcHRvcnMiOiAzNCwgIi4vJC5leHBvcnQiOiAzNywgIi4vJC5mb3Itb2YiOiAzOSwgIi4vJC5nbG9iYWwiOiA0MSwgIi4vJC5pcy1vYmplY3QiOiA0OSwgIi4vJC5pdGVyLWRldGVjdCI6IDUzLCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5taWNyb3Rhc2siOiA1OSwgIi4vJC5yZWRlZmluZS1hbGwiOiA2MiwgIi4vJC5zYW1lLXZhbHVlIjogNjQsICIuLyQuc2V0LXByb3RvIjogNjUsICIuLyQuc2V0LXNwZWNpZXMiOiA2NiwgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNwZWNpZXMtY29uc3RydWN0b3IiOiA2OSwgIi4vJC5zdHJpY3QtbmV3IjogNzAsICIuLyQud2tzIjogNzggfV0sIDg3OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGUoIi4vJC5zdHJpbmctYXQiKSghMCk7ZSgiLi8kLml0ZXItZGVmaW5lIikoU3RyaW5nLCAiU3RyaW5nIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl90ID0gU3RyaW5nKGUpLCB0aGlzLl9pID0gMDsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICB0ID0gdGhpcy5fdCwKICAgICAgICAgICAgciA9IHRoaXMuX2k7cmV0dXJuIHIgPj0gdC5sZW5ndGggPyB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6ICEwIH0gOiAoZSA9IG4odCwgciksIHRoaXMuX2kgKz0gZS5sZW5ndGgsIHsgdmFsdWU6IGUsIGRvbmU6ICExIH0pOwogICAgICB9KTsKICAgIH0sIHsgIi4vJC5pdGVyLWRlZmluZSI6IDUyLCAiLi8kLnN0cmluZy1hdCI6IDcxIH1dLCA4ODogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBlKCIuLyQiKSwKICAgICAgICAgIG8gPSBlKCIuLyQuZ2xvYmFsIiksCiAgICAgICAgICBpID0gZSgiLi8kLmhhcyIpLAogICAgICAgICAgcyA9IGUoIi4vJC5kZXNjcmlwdG9ycyIpLAogICAgICAgICAgYSA9IGUoIi4vJC5leHBvcnQiKSwKICAgICAgICAgIGMgPSBlKCIuLyQucmVkZWZpbmUiKSwKICAgICAgICAgIHUgPSBlKCIuLyQuZmFpbHMiKSwKICAgICAgICAgIGwgPSBlKCIuLyQuc2hhcmVkIiksCiAgICAgICAgICBmID0gZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksCiAgICAgICAgICBkID0gZSgiLi8kLnVpZCIpLAogICAgICAgICAgcCA9IGUoIi4vJC53a3MiKSwKICAgICAgICAgIGIgPSBlKCIuLyQua2V5b2YiKSwKICAgICAgICAgIGggPSBlKCIuLyQuZ2V0LW5hbWVzIiksCiAgICAgICAgICB2ID0gZSgiLi8kLmVudW0ta2V5cyIpLAogICAgICAgICAgeSA9IGUoIi4vJC5pcy1hcnJheSIpLAogICAgICAgICAgXyA9IGUoIi4vJC5hbi1vYmplY3QiKSwKICAgICAgICAgIGcgPSBlKCIuLyQudG8taW9iamVjdCIpLAogICAgICAgICAgbSA9IGUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksCiAgICAgICAgICBqID0gbi5nZXREZXNjLAogICAgICAgICAgJCA9IG4uc2V0RGVzYywKICAgICAgICAgIE8gPSBuLmNyZWF0ZSwKICAgICAgICAgIHcgPSBoLmdldCwKICAgICAgICAgIGsgPSBvLlN5bWJvbCwKICAgICAgICAgIHggPSBvLkpTT04sCiAgICAgICAgICBDID0geCAmJiB4LnN0cmluZ2lmeSwKICAgICAgICAgIEUgPSAhMSwKICAgICAgICAgIFMgPSBwKCJfaGlkZGVuIiksCiAgICAgICAgICBUID0gbi5pc0VudW0sCiAgICAgICAgICBNID0gbCgic3ltYm9sLXJlZ2lzdHJ5IiksCiAgICAgICAgICBOID0gbCgic3ltYm9scyIpLAogICAgICAgICAgUiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGssCiAgICAgICAgICBEID0gT2JqZWN0LnByb3RvdHlwZSwKICAgICAgICAgIFAgPSBzICYmIHUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiA3ICE9IE8oJCh7fSwgImEiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gJCh0aGlzLCAiYSIsIHsgdmFsdWU6IDcgfSkuYTsKICAgICAgICAgIH0gfSkpLmE7CiAgICAgIH0pID8gZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgICB2YXIgbiA9IGooRCwgdCk7biAmJiBkZWxldGUgRFt0XSwgJChlLCB0LCByKSwgbiAmJiBlICE9PSBEICYmICQoRCwgdCwgbik7CiAgICAgIH0gOiAkLAogICAgICAgICAgQSA9IGZ1bmN0aW9uIEEoZSkgewogICAgICAgIHZhciB0ID0gTltlXSA9IE8oay5wcm90b3R5cGUpO3JldHVybiB0Ll9rID0gZSwgcyAmJiBFICYmIFAoRCwgZSwgeyBjb25maWd1cmFibGU6ICEwLCBzZXQ6IGZ1bmN0aW9uIHNldCh0KSB7CiAgICAgICAgICAgIGkodGhpcywgUykgJiYgaSh0aGlzW1NdLCBlKSAmJiAodGhpc1tTXVtlXSA9ICExKSwgUCh0aGlzLCBlLCBtKDEsIHQpKTsKICAgICAgICAgIH0gfSksIHQ7CiAgICAgIH0sCiAgICAgICAgICBMID0gZnVuY3Rpb24gTChlKSB7CiAgICAgICAgcmV0dXJuICJzeW1ib2wiID09ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpOwogICAgICB9LAogICAgICAgICAgSSA9IGZ1bmN0aW9uIEkoZSwgdCwgcikgewogICAgICAgIHJldHVybiByICYmIGkoTiwgdCkgPyAoci5lbnVtZXJhYmxlID8gKGkoZSwgUykgJiYgZVtTXVt0XSAmJiAoZVtTXVt0XSA9ICExKSwgciA9IE8ociwgeyBlbnVtZXJhYmxlOiBtKDAsICExKSB9KSkgOiAoaShlLCBTKSB8fCAkKGUsIFMsIG0oMSwge30pKSwgZVtTXVt0XSA9ICEwKSwgUChlLCB0LCByKSkgOiAkKGUsIHQsIHIpOwogICAgICB9LAogICAgICAgICAgRiA9IGZ1bmN0aW9uIEYoZSwgdCkgewogICAgICAgIF8oZSk7Zm9yICh2YXIgciwgbiA9IHYodCA9IGcodCkpLCBvID0gMCwgaSA9IG4ubGVuZ3RoOyBpID4gbzspIHsKICAgICAgICAgIEkoZSwgciA9IG5bbysrXSwgdFtyXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9LAogICAgICAgICAgViA9IGZ1bmN0aW9uIFYoZSwgdCkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IHQgPyBPKGUpIDogRihPKGUpLCB0KTsKICAgICAgfSwKICAgICAgICAgIHogPSBmdW5jdGlvbiB6KGUpIHsKICAgICAgICB2YXIgdCA9IFQuY2FsbCh0aGlzLCBlKTtyZXR1cm4gdCB8fCAhaSh0aGlzLCBlKSB8fCAhaShOLCBlKSB8fCBpKHRoaXMsIFMpICYmIHRoaXNbU11bZV0gPyB0IDogITA7CiAgICAgIH0sCiAgICAgICAgICBVID0gZnVuY3Rpb24gVShlLCB0KSB7CiAgICAgICAgdmFyIHIgPSBqKGUgPSBnKGUpLCB0KTtyZXR1cm4gIXIgfHwgIWkoTiwgdCkgfHwgaShlLCBTKSAmJiBlW1NdW3RdIHx8IChyLmVudW1lcmFibGUgPSAhMCksIHI7CiAgICAgIH0sCiAgICAgICAgICBIID0gZnVuY3Rpb24gSChlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgfHwgdCA9PSBTIHx8IG4ucHVzaCh0KTsKICAgICAgICB9cmV0dXJuIG47CiAgICAgIH0sCiAgICAgICAgICBCID0gZnVuY3Rpb24gQihlKSB7CiAgICAgICAgZm9yICh2YXIgdCwgciA9IHcoZyhlKSksIG4gPSBbXSwgbyA9IDA7IHIubGVuZ3RoID4gbzspIHsKICAgICAgICAgIGkoTiwgdCA9IHJbbysrXSkgJiYgbi5wdXNoKE5bdF0pOwogICAgICAgIH1yZXR1cm4gbjsKICAgICAgfSwKICAgICAgICAgIEogPSBmdW5jdGlvbiBKKGUpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBlICYmICFMKGUpKSB7CiAgICAgICAgICBmb3IgKHZhciB0LCByLCBuID0gW2VdLCBvID0gMSwgaSA9IGFyZ3VtZW50czsgaS5sZW5ndGggPiBvOykgewogICAgICAgICAgICBuLnB1c2goaVtvKytdKTsKICAgICAgICAgIH1yZXR1cm4gdCA9IG5bMV0sICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgKHIgPSB0KSwgIXIgJiYgeSh0KSB8fCAodCA9IGZ1bmN0aW9uIHQoZSwgX3QyKSB7CiAgICAgICAgICAgIHJldHVybiByICYmIChfdDIgPSByLmNhbGwodGhpcywgZSwgX3QyKSksIEwoX3QyKSA/IHZvaWQgMCA6IF90MjsKICAgICAgICAgIH0pLCBuWzFdID0gdCwgQy5hcHBseSh4LCBuKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBXID0gdShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBrKCk7cmV0dXJuICJbbnVsbF0iICE9IEMoW2VdKSB8fCAie30iICE9IEMoeyBhOiBlIH0pIHx8ICJ7fSIgIT0gQyhPYmplY3QoZSkpOwogICAgICB9KTtSIHx8IChrID0gZnVuY3Rpb24gaygpIHsKICAgICAgICBpZiAoTCh0aGlzKSkgdGhyb3cgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKTtyZXR1cm4gQShkKGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdm9pZCAwKSk7CiAgICAgIH0sIGMoay5wcm90b3R5cGUsICJ0b1N0cmluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fazsKICAgICAgfSksIEwgPSBmdW5jdGlvbiBMKGUpIHsKICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIGs7CiAgICAgIH0sIG4uY3JlYXRlID0gViwgbi5pc0VudW0gPSB6LCBuLmdldERlc2MgPSBVLCBuLnNldERlc2MgPSBJLCBuLnNldERlc2NzID0gRiwgbi5nZXROYW1lcyA9IGguZ2V0ID0gSCwgbi5nZXRTeW1ib2xzID0gQiwgcyAmJiAhZSgiLi8kLmxpYnJhcnkiKSAmJiBjKEQsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsIHosICEwKSk7dmFyIFkgPSB7ICJmb3IiOiBmdW5jdGlvbiBfZm9yKGUpIHsKICAgICAgICAgIHJldHVybiBpKE0sIGUgKz0gIiIpID8gTVtlXSA6IE1bZV0gPSBrKGUpOwogICAgICAgIH0sIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKGUpIHsKICAgICAgICAgIHJldHVybiBiKE0sIGUpOwogICAgICAgIH0sIHVzZVNldHRlcjogZnVuY3Rpb24gdXNlU2V0dGVyKCkgewogICAgICAgICAgRSA9ICEwOwogICAgICAgIH0sIHVzZVNpbXBsZTogZnVuY3Rpb24gdXNlU2ltcGxlKCkgewogICAgICAgICAgRSA9ICExOwogICAgICAgIH0gfTtuLmVhY2guY2FsbCgiaGFzSW5zdGFuY2UsaXNDb25jYXRTcHJlYWRhYmxlLGl0ZXJhdG9yLG1hdGNoLHJlcGxhY2Usc2VhcmNoLHNwZWNpZXMsc3BsaXQsdG9QcmltaXRpdmUsdG9TdHJpbmdUYWcsdW5zY29wYWJsZXMiLnNwbGl0KCIsIiksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBwKGUpO1lbZV0gPSBSID8gdCA6IEEodCk7CiAgICAgIH0pLCBFID0gITAsIGEoYS5HICsgYS5XLCB7IFN5bWJvbDogayB9KSwgYShhLlMsICJTeW1ib2wiLCBZKSwgYShhLlMgKyBhLkYgKiAhUiwgIk9iamVjdCIsIHsgY3JlYXRlOiBWLCBkZWZpbmVQcm9wZXJ0eTogSSwgZGVmaW5lUHJvcGVydGllczogRiwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBVLCBnZXRPd25Qcm9wZXJ0eU5hbWVzOiBILCBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6IEIgfSksIHggJiYgYShhLlMgKyBhLkYgKiAoIVIgfHwgVyksICJKU09OIiwgeyBzdHJpbmdpZnk6IEogfSksIGYoaywgIlN5bWJvbCIpLCBmKE1hdGgsICJNYXRoIiwgITApLCBmKG8uSlNPTiwgIkpTT04iLCAhMCk7CiAgICB9LCB7ICIuLyQiOiA1NiwgIi4vJC5hbi1vYmplY3QiOiAyOCwgIi4vJC5kZXNjcmlwdG9ycyI6IDM0LCAiLi8kLmVudW0ta2V5cyI6IDM2LCAiLi8kLmV4cG9ydCI6IDM3LCAiLi8kLmZhaWxzIjogMzgsICIuLyQuZ2V0LW5hbWVzIjogNDAsICIuLyQuZ2xvYmFsIjogNDEsICIuLyQuaGFzIjogNDIsICIuLyQuaXMtYXJyYXkiOiA0OCwgIi4vJC5rZXlvZiI6IDU3LCAiLi8kLmxpYnJhcnkiOiA1OCwgIi4vJC5wcm9wZXJ0eS1kZXNjIjogNjEsICIuLyQucmVkZWZpbmUiOiA2MywgIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6IDY3LCAiLi8kLnNoYXJlZCI6IDY4LCAiLi8kLnRvLWlvYmplY3QiOiA3NCwgIi4vJC51aWQiOiA3NywgIi4vJC53a3MiOiA3OCB9XSwgODk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICBlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO3ZhciBuID0gZSgiLi8kLml0ZXJhdG9ycyIpO24uTm9kZUxpc3QgPSBuLkhUTUxDb2xsZWN0aW9uID0gbi5BcnJheTsKICAgIH0sIHsgIi4vJC5pdGVyYXRvcnMiOiA1NSwgIi4vZXM2LmFycmF5Lml0ZXJhdG9yIjogODAgfV0sIDkwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZ1bmN0aW9uIHQoZSkgewogICAgICAgICAgdGhpcy5nID0gW10sIHRoaXMuayA9IGU7CiAgICAgICAgfWZ1bmN0aW9uIHIoZSkgewogICAgICAgICAgIWZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICAgIHZhciBuID0gZS50YWtlUmVjb3JkcygpO24ubGVuZ3RoICYmIGUuayhuLCBlKSwgZS5mID0gc2V0VGltZW91dChyLCB0Ll9wZXJpb2QpOwogICAgICAgICAgfSgpOwogICAgICAgIH1mdW5jdGlvbiBuKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4gPSB7IHR5cGU6IG51bGwsIHRhcmdldDogbnVsbCwgYWRkZWROb2RlczogW10sIHJlbW92ZWROb2RlczogW10sIHByZXZpb3VzU2libGluZzogbnVsbCwgbmV4dFNpYmxpbmc6IG51bGwsIGF0dHJpYnV0ZU5hbWU6IG51bGwsIGF0dHJpYnV0ZU5hbWVzcGFjZTogbnVsbCwgb2xkVmFsdWU6IG51bGwgfTtmb3IgKHIgaW4gdCkgewogICAgICAgICAgICBuW3JdICE9PSBlICYmIHRbcl0gIT09IGUgJiYgKG5bcl0gPSB0W3JdKTsKICAgICAgICAgIH1yZXR1cm4gbjsKICAgICAgICB9ZnVuY3Rpb24gbyhlLCB0KSB7CiAgICAgICAgICB2YXIgciA9IGEoZSwgdCk7cmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgICAgYyA9IG4ubGVuZ3RoO3QuYSAmJiByLmEgJiYgaShuLCBlLCByLmEsIHQuZCksICh0LmIgfHwgdC5lKSAmJiAobyA9IHMobiwgZSwgciwgdCkpLCAobyB8fCBuLmxlbmd0aCAhPT0gYykgJiYgKHIgPSBhKGUsIHQpKTsKICAgICAgICAgIH07CiAgICAgICAgfWZ1bmN0aW9uIGkodCwgciwgbywgaSkgewogICAgICAgICAgZm9yICh2YXIgcywgYSwgYyA9IHt9LCB1ID0gci5hdHRyaWJ1dGVzLCBsID0gdS5sZW5ndGg7IGwtLTspIHsKICAgICAgICAgICAgcyA9IHVbbF0sIGEgPSBzLm5hbWUsIGkgJiYgaVthXSA9PT0gZSB8fCAocy52YWx1ZSAhPT0gb1thXSAmJiB0LnB1c2gobih7IHR5cGU6ICJhdHRyaWJ1dGVzIiwgdGFyZ2V0OiByLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSwgYXR0cmlidXRlTmFtZXNwYWNlOiBzLm5hbWVzcGFjZVVSSSB9KSksIGNbYV0gPSAhMCk7CiAgICAgICAgICB9Zm9yIChhIGluIG8pIHsKICAgICAgICAgICAgY1thXSB8fCB0LnB1c2gobih7IHRhcmdldDogciwgdHlwZTogImF0dHJpYnV0ZXMiLCBhdHRyaWJ1dGVOYW1lOiBhLCBvbGRWYWx1ZTogb1thXSB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfWZ1bmN0aW9uIHModCwgciwgbywgcykgewogICAgICAgICAgZnVuY3Rpb24gYShlLCByLCBvLCBhLCBjKSB7CiAgICAgICAgICAgIHZhciBsID0gZS5sZW5ndGggLSAxO2MgPSAtIH4oKGwgLSBjKSAvIDIpO2ZvciAodmFyIGYsIGQsIHA7IHAgPSBlLnBvcCgpOykgewogICAgICAgICAgICAgIGYgPSBvW3AuaF0sIGQgPSBhW3AuaV0sIHMuYiAmJiBjICYmIE1hdGguYWJzKHAuaCAtIHAuaSkgPj0gbCAmJiAodC5wdXNoKG4oeyB0eXBlOiAiY2hpbGRMaXN0IiwgdGFyZ2V0OiByLCBhZGRlZE5vZGVzOiBbZl0sIHJlbW92ZWROb2RlczogW2ZdLCBuZXh0U2libGluZzogZi5uZXh0U2libGluZywgcHJldmlvdXNTaWJsaW5nOiBmLnByZXZpb3VzU2libGluZyB9KSksIGMtLSksIHMuYSAmJiBkLmEgJiYgaSh0LCBmLCBkLmEsIHMuZCksIHMuYyAmJiAzID09PSBmLm5vZGVUeXBlICYmIGYubm9kZVZhbHVlICE9PSBkLmMgJiYgdC5wdXNoKG4oeyB0eXBlOiAiY2hhcmFjdGVyRGF0YSIsIHRhcmdldDogZiB9KSksIHMuZSAmJiB1KGYsIGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9ZnVuY3Rpb24gdShyLCBvKSB7CiAgICAgICAgICAgIGZvciAodmFyIGQsIHAsIGIsIGgsIHYsIHkgPSByLmNoaWxkTm9kZXMsIF8gPSBvLmIsIGcgPSB5Lmxlbmd0aCwgbSA9IF8gPyBfLmxlbmd0aCA6IDAsIGogPSAwLCAkID0gMCwgTyA9IDA7IGcgPiAkIHx8IG0gPiBPOykgewogICAgICAgICAgICAgIGggPSB5WyRdLCB2ID0gKGIgPSBfW09dKSAmJiBiLmosIGggPT09IHYgPyAocy5hICYmIGIuYSAmJiBpKHQsIGgsIGIuYSwgcy5kKSwgcy5jICYmIGIuYyAhPT0gZSAmJiBoLm5vZGVWYWx1ZSAhPT0gYi5jICYmIHQucHVzaChuKHsgdHlwZTogImNoYXJhY3RlckRhdGEiLCB0YXJnZXQ6IGggfSkpLCBwICYmIGEocCwgciwgeSwgXywgaiksIHMuZSAmJiAoaC5jaGlsZE5vZGVzLmxlbmd0aCB8fCBiLmIgJiYgYi5iLmxlbmd0aCkgJiYgdShoLCBiKSwgJCsrLCBPKyspIDogKGwgPSAhMCwgZCB8fCAoZCA9IHt9LCBwID0gW10pLCBoICYmIChkW2IgPSBjKGgpXSB8fCAoZFtiXSA9ICEwLCAtMSA9PT0gKGIgPSBmKF8sIGgsIE8sICJqIikpID8gcy5iICYmICh0LnB1c2gobih7IHR5cGU6ICJjaGlsZExpc3QiLCB0YXJnZXQ6IHIsIGFkZGVkTm9kZXM6IFtoXSwgbmV4dFNpYmxpbmc6IGgubmV4dFNpYmxpbmcsIHByZXZpb3VzU2libGluZzogaC5wcmV2aW91c1NpYmxpbmcgfSkpLCBqKyspIDogcC5wdXNoKHsgaDogJCwgaTogYiB9KSksICQrKyksIHYgJiYgdiAhPT0geVskXSAmJiAoZFtiID0gYyh2KV0gfHwgKGRbYl0gPSAhMCwgLTEgPT09IChiID0gZih5LCB2LCAkKSkgPyBzLmIgJiYgKHQucHVzaChuKHsgdHlwZTogImNoaWxkTGlzdCIsIHRhcmdldDogby5qLCByZW1vdmVkTm9kZXM6IFt2XSwgbmV4dFNpYmxpbmc6IF9bTyArIDFdLCBwcmV2aW91c1NpYmxpbmc6IF9bTyAtIDFdIH0pKSwgai0tKSA6IHAucHVzaCh7IGg6IGIsIGk6IE8gfSkpLCBPKyspKTsKICAgICAgICAgICAgfXAgJiYgYShwLCByLCB5LCBfLCBqKTsKICAgICAgICAgIH12YXIgbDtyZXR1cm4gdShyLCBvKSwgbDsKICAgICAgICB9ZnVuY3Rpb24gYShlLCB0KSB7CiAgICAgICAgICB2YXIgciA9ICEwO3JldHVybiBmdW5jdGlvbiBuKGUpIHsKICAgICAgICAgICAgdmFyIG8gPSB7IGo6IGUgfTtyZXR1cm4gIXQuYyB8fCAzICE9PSBlLm5vZGVUeXBlICYmIDggIT09IGUubm9kZVR5cGUgPyAodC5hICYmIHIgJiYgMSA9PT0gZS5ub2RlVHlwZSAmJiAoby5hID0gbChlLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQuZCAmJiAhdC5kW3IubmFtZV0gfHwgKGVbci5uYW1lXSA9IHIudmFsdWUpLCBlOwogICAgICAgICAgICB9KSksIHIgJiYgKHQuYiB8fCB0LmMgfHwgdC5hICYmIHQuZSkgJiYgKG8uYiA9IHUoZS5jaGlsZE5vZGVzLCBuKSksIHIgPSB0LmUpIDogby5jID0gZS5ub2RlVmFsdWUsIG87CiAgICAgICAgICB9KGUpOwogICAgICAgIH1mdW5jdGlvbiBjKGUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBlLmlkIHx8IChlLm1vX2lkID0gZS5tb19pZCB8fCBkKyspOwogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBjYXRjaCAocikgewogICAgICAgICAgICAgIHJldHVybiBkKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9ZnVuY3Rpb24gdShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByW25dID0gdChlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gbChlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciByID0ge30sIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgewogICAgICAgICAgICByID0gdChyLCBlW25dLCBuLCBlKTsKICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICB9ZnVuY3Rpb24gZihlLCB0LCByLCBuKSB7CiAgICAgICAgICBmb3IgKDsgciA8IGUubGVuZ3RoOyByKyspIHsKICAgICAgICAgICAgaWYgKChuID8gZVtyXVtuXSA6IGVbcl0pID09PSB0KSByZXR1cm4gcjsKICAgICAgICAgIH1yZXR1cm4gLTE7CiAgICAgICAgfXQuX3BlcmlvZCA9IDMwLCB0LnByb3RvdHlwZSA9IHsgb2JzZXJ2ZTogZnVuY3Rpb24gb2JzZXJ2ZShlLCB0KSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSB7IGE6ICEhKHQuYXR0cmlidXRlcyB8fCB0LmF0dHJpYnV0ZUZpbHRlciB8fCB0LmF0dHJpYnV0ZU9sZFZhbHVlKSwgYjogISF0LmNoaWxkTGlzdCwgZTogISF0LnN1YnRyZWUsIGM6ICEoIXQuY2hhcmFjdGVyRGF0YSAmJiAhdC5jaGFyYWN0ZXJEYXRhT2xkVmFsdWUpIH0sIGkgPSB0aGlzLmcsIHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgIGlbc10ubSA9PT0gZSAmJiBpLnNwbGljZShzLCAxKTsKICAgICAgICAgICAgfXQuYXR0cmlidXRlRmlsdGVyICYmIChuLmQgPSBsKHQuYXR0cmlidXRlRmlsdGVyLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHJldHVybiBlW3RdID0gITAsIGU7CiAgICAgICAgICAgIH0pKSwgaS5wdXNoKHsgbTogZSwgbDogbyhlLCBuKSB9KSwgdGhpcy5mIHx8IHIodGhpcyk7CiAgICAgICAgICB9LCB0YWtlUmVjb3JkczogZnVuY3Rpb24gdGFrZVJlY29yZHMoKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUgPSBbXSwgdCA9IHRoaXMuZywgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgICAgdFtyXS5sKGUpOwogICAgICAgICAgICB9cmV0dXJuIGU7CiAgICAgICAgICB9LCBkaXNjb25uZWN0OiBmdW5jdGlvbiBkaXNjb25uZWN0KCkgewogICAgICAgICAgICB0aGlzLmcgPSBbXSwgY2xlYXJUaW1lb3V0KHRoaXMuZiksIHRoaXMuZiA9IG51bGw7CiAgICAgICAgICB9IH07dmFyIGQgPSAxO3JldHVybiB0OwogICAgICB9KHZvaWQgMCk7CiAgICB9LCB7fV0sIDkxOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgT2JqZWN0Lm9ic2VydmUgfHwgZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHMgPSBbImFkZCIsICJ1cGRhdGUiLCAiZGVsZXRlIiwgInJlY29uZmlndXJlIiwgInNldFByb3RvdHlwZSIsICJwcmV2ZW50RXh0ZW5zaW9ucyJdLAogICAgICAgICAgICBhID0gdC5pc0FycmF5IHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IGUuY2FsbCh0KTsKICAgICAgICAgIH07CiAgICAgICAgfShlLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIGMgPSB0LnByb3RvdHlwZS5pbmRleE9mID8gdC5pbmRleE9mIHx8IGZ1bmN0aW9uIChlLCByLCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsIHIsIG4pOwogICAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAgICAgZm9yICh2YXIgbiA9IHIgfHwgMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgaWYgKGVbbl0gPT09IHQpIHJldHVybiBuOwogICAgICAgICAgfXJldHVybiAtMTsKICAgICAgICB9LAogICAgICAgICAgICB1ID0gci5NYXAgIT09IG4gJiYgTWFwLnByb3RvdHlwZS5mb3JFYWNoID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBNYXAoKTsKICAgICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGUgPSBbXSwKICAgICAgICAgICAgICB0ID0gW107cmV0dXJuIHsgc2l6ZTogMCwgaGFzOiBmdW5jdGlvbiBoYXModCkgewogICAgICAgICAgICAgIHJldHVybiBjKGUsIHQpID4gLTE7CiAgICAgICAgICAgIH0sIGdldDogZnVuY3Rpb24gZ2V0KHIpIHsKICAgICAgICAgICAgICByZXR1cm4gdFtjKGUsIHIpXTsKICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQociwgbikgewogICAgICAgICAgICAgIHZhciBvID0gYyhlLCByKTstMSA9PT0gbyA/IChlLnB1c2gociksIHQucHVzaChuKSwgdGhpcy5zaXplKyspIDogdFtvXSA9IG47CiAgICAgICAgICAgIH0sICJkZWxldGUiOiBmdW5jdGlvbiBfZGVsZXRlKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGMoZSwgcik7biA+IC0xICYmIChlLnNwbGljZShuLCAxKSwgdC5zcGxpY2UobiwgMSksIHRoaXMuc2l6ZS0tKTsKICAgICAgICAgICAgfSwgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChyKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICAgICAgICByLmNhbGwoYXJndW1lbnRzWzFdLCB0W25dLCBlW25dLCB0aGlzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gfTsKICAgICAgICB9LAogICAgICAgICAgICBsID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBlLmdldE93blByb3BlcnR5TmFtZXM7dHJ5IHsKICAgICAgICAgICAgYXJndW1lbnRzLmNhbGxlZTsKICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgdmFyIG4gPSAodChjKS5qb2luKCIgIikgKyAiICIpLnJlcGxhY2UoL3Byb3RvdHlwZSB8bGVuZ3RoIHxuYW1lIC9nLCAiIikuc2xpY2UoMCwgLTEpLnNwbGl0KCIgIik7bi5sZW5ndGggJiYgKHQgPSBmdW5jdGlvbiB0KF90MykgewogICAgICAgICAgICAgIHZhciByID0gZS5nZXRPd25Qcm9wZXJ0eU5hbWVzKF90Myk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIF90MykgZm9yICh2YXIgbywgaSA9IDA7IGkgPCBuLmxlbmd0aDspIHsKICAgICAgICAgICAgICAgIChvID0gYyhyLCBuW2krK10pKSA+IC0xICYmIHIuc3BsaWNlKG8sIDEpOwogICAgICAgICAgICAgIH1yZXR1cm4gcjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgfSgpIDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgbyA9IFtdO2lmICgiaGFzT3duUHJvcGVydHkiIGluIHQpIGZvciAociBpbiB0KSB7CiAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkocikgJiYgby5wdXNoKHIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbiA9IGUuaGFzT3duUHJvcGVydHk7Zm9yIChyIGluIHQpIHsKICAgICAgICAgICAgICBuLmNhbGwodCwgcikgJiYgby5wdXNoKHIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9cmV0dXJuIGEodCkgJiYgby5wdXNoKCJsZW5ndGgiKSwgbzsKICAgICAgICB9LAogICAgICAgICAgICBmID0gZS5nZXRQcm90b3R5cGVPZiwKICAgICAgICAgICAgZCA9IGUuZGVmaW5lUHJvcGVydGllcyAmJiBlLmdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICAgICAgICAgICAgcCA9IHIucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHIud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlID0gK25ldyBEYXRlKCksCiAgICAgICAgICAgICAgdCA9IGU7cmV0dXJuIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByKCh0ID0gK25ldyBEYXRlKCkpIC0gZSk7CiAgICAgICAgICAgIH0sIDE3KTsKICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICBiID0gZnVuY3Rpb24gYihlLCB0LCByKSB7CiAgICAgICAgICB2YXIgbiA9IG8uZ2V0KGUpO24gPyAodihuLCBlKSwgbShlLCBuLCB0LCByKSkgOiAobiA9IGgoZSksIG0oZSwgbiwgdCwgciksIDEgPT09IG8uc2l6ZSAmJiBwKHkpKTsKICAgICAgICB9LAogICAgICAgICAgICBoID0gZnVuY3Rpb24gaCh0LCByKSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICBpID0gbCh0KSwKICAgICAgICAgICAgICBzID0gW10sCiAgICAgICAgICAgICAgYSA9IDAsCiAgICAgICAgICAgICAgciA9IHsgaGFuZGxlcnM6IHUoKSwgZnJvemVuOiBlLmlzRnJvemVuID8gZS5pc0Zyb3plbih0KSA6ICExLCBleHRlbnNpYmxlOiBlLmlzRXh0ZW5zaWJsZSA/IGUuaXNFeHRlbnNpYmxlKHQpIDogITAsIHByb3RvOiBmICYmIGYodCksIHByb3BlcnRpZXM6IGksIHZhbHVlczogcywgbm90aWZpZXI6IGcodCwgcikgfTtpZiAoZCkgZm9yIChuID0gci5kZXNjcmlwdG9ycyA9IFtdOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIG5bYV0gPSBkKHQsIGlbYV0pLCBzW2FdID0gdFtpW2ErK11dOwogICAgICAgICAgfSBlbHNlIGZvciAoOyBhIDwgaS5sZW5ndGg7KSB7CiAgICAgICAgICAgIHNbYV0gPSB0W2lbYSsrXV07CiAgICAgICAgICB9cmV0dXJuIG8uc2V0KHQsIHIpLCByOwogICAgICAgIH0sCiAgICAgICAgICAgIHYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IGQgPyBmdW5jdGlvbiAoZSwgdCwgciwgbiwgbykgewogICAgICAgICAgICB2YXIgaSA9IHQucHJvcGVydGllc1tyXSwKICAgICAgICAgICAgICAgIHMgPSBlW2ldLAogICAgICAgICAgICAgICAgYSA9IHQudmFsdWVzW3JdLAogICAgICAgICAgICAgICAgYyA9IHQuZGVzY3JpcHRvcnNbcl07InZhbHVlIiBpbiBvICYmIChhID09PSBzID8gMCA9PT0gYSAmJiAxIC8gYSAhPT0gMSAvIHMgOiBhID09PSBhIHx8IHMgPT09IHMpICYmIChqKGUsIHQsIHsgbmFtZTogaSwgdHlwZTogInVwZGF0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IGEgfSwgbiksIHQudmFsdWVzW3JdID0gcyksICFjLmNvbmZpZ3VyYWJsZSB8fCBvLmNvbmZpZ3VyYWJsZSAmJiBvLndyaXRhYmxlID09PSBjLndyaXRhYmxlICYmIG8uZW51bWVyYWJsZSA9PT0gYy5lbnVtZXJhYmxlICYmIG8uZ2V0ID09PSBjLmdldCAmJiBvLnNldCA9PT0gYy5zZXQgfHwgKGooZSwgdCwgeyBuYW1lOiBpLCB0eXBlOiAicmVjb25maWd1cmUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBhIH0sIG4pLCB0LmRlc2NyaXB0b3JzW3JdID0gbyk7CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgdmFyIG8gPSB0LnByb3BlcnRpZXNbcl0sCiAgICAgICAgICAgICAgICBpID0gZVtvXSwKICAgICAgICAgICAgICAgIHMgPSB0LnZhbHVlc1tyXTsocyA9PT0gaSA/IDAgPT09IHMgJiYgMSAvIHMgIT09IDEgLyBpIDogcyA9PT0gcyB8fCBpID09PSBpKSAmJiAoaihlLCB0LCB7IG5hbWU6IG8sIHR5cGU6ICJ1cGRhdGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBzIH0sIG4pLCB0LnZhbHVlc1tyXSA9IGkpOwogICAgICAgICAgfSwKICAgICAgICAgICAgICByID0gZCA/IGZ1bmN0aW9uIChlLCByLCBuLCBvLCBpKSB7CiAgICAgICAgICAgIGZvciAodmFyIHMsIGEgPSByLmxlbmd0aDsgbiAmJiBhLS07KSB7CiAgICAgICAgICAgICAgbnVsbCAhPT0gclthXSAmJiAocyA9IGQoZSwgclthXSksIG4tLSwgcyA/IHQoZSwgbywgYSwgaSwgcykgOiAoaihlLCBvLCB7IG5hbWU6IHJbYV0sIHR5cGU6ICJkZWxldGUiLCBvYmplY3Q6IGUsIG9sZFZhbHVlOiBvLnZhbHVlc1thXSB9LCBpKSwgby5wcm9wZXJ0aWVzLnNwbGljZShhLCAxKSwgby52YWx1ZXMuc3BsaWNlKGEsIDEpLCBvLmRlc2NyaXB0b3JzLnNwbGljZShhLCAxKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQsIHIsIG4sIG8pIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHQubGVuZ3RoOyByICYmIGktLTspIHsKICAgICAgICAgICAgICBudWxsICE9PSB0W2ldICYmIChqKGUsIG4sIHsgbmFtZTogdFtpXSwgdHlwZTogImRlbGV0ZSIsIG9iamVjdDogZSwgb2xkVmFsdWU6IG4udmFsdWVzW2ldIH0sIG8pLCBuLnByb3BlcnRpZXMuc3BsaWNlKGksIDEpLCBuLnZhbHVlcy5zcGxpY2UoaSwgMSksIHItLSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07cmV0dXJuIGZ1bmN0aW9uIChuLCBvLCBpKSB7CiAgICAgICAgICAgIGlmIChuLmhhbmRsZXJzLnNpemUgJiYgIW4uZnJvemVuKSB7CiAgICAgICAgICAgICAgdmFyIHMsCiAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgICAgIHAsCiAgICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgICAgIHksCiAgICAgICAgICAgICAgICAgIF8gPSBuLnZhbHVlcywKICAgICAgICAgICAgICAgICAgZyA9IG4uZGVzY3JpcHRvcnMsCiAgICAgICAgICAgICAgICAgIG0gPSAwO2lmIChuLmV4dGVuc2libGUpIHsKICAgICAgICAgICAgICAgIGlmIChzID0gbi5wcm9wZXJ0aWVzLnNsaWNlKCksIGEgPSBzLmxlbmd0aCwgdSA9IGwobyksIGcpIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgeSA9IGQobywgYiksIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKG9bYl0pLCBnLnB1c2goeSkpIDogKHNbcF0gPSBudWxsLCBhLS0sIHQobywgbiwgcCwgaSwgeSkpOwogICAgICAgICAgICAgICAgICB9cihvLCBzLCBhLCBuLCBpKSwgZS5pc0V4dGVuc2libGUobykgfHwgKG4uZXh0ZW5zaWJsZSA9ICExLCBqKG8sIG4sIHsgdHlwZTogInByZXZlbnRFeHRlbnNpb25zIiwgb2JqZWN0OiBvIH0sIGkpLCBuLmZyb3plbiA9IGUuaXNGcm96ZW4obykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IG0gPCB1Lmxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgICBiID0gdVttKytdLCBwID0gYyhzLCBiKSwgaCA9IG9bYl0sIC0xID09PSBwID8gKGoobywgbiwgeyBuYW1lOiBiLCB0eXBlOiAiYWRkIiwgb2JqZWN0OiBvIH0sIGkpLCBuLnByb3BlcnRpZXMucHVzaChiKSwgXy5wdXNoKGgpKSA6IChzW3BdID0gbnVsbCwgYS0tLCB0KG8sIG4sIHAsIGkpKTsKICAgICAgICAgICAgICAgICAgfXIobywgcywgYSwgbiwgaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghbi5mcm96ZW4pIHsKICAgICAgICAgICAgICAgIGZvciAoOyBtIDwgcy5sZW5ndGg7IG0rKykgewogICAgICAgICAgICAgICAgICBiID0gc1ttXSwgdChvLCBuLCBtLCBpLCBkKG8sIGIpKTsKICAgICAgICAgICAgICAgIH1lLmlzRnJvemVuKG8pICYmIChuLmZyb3plbiA9ICEwKTsKICAgICAgICAgICAgICB9ZiAmJiAodiA9IGYobyksIHYgIT09IG4ucHJvdG8gJiYgKGoobywgbiwgeyB0eXBlOiAic2V0UHJvdG90eXBlIiwgbmFtZTogIl9fcHJvdG9fXyIsIG9iamVjdDogbywgb2xkVmFsdWU6IG4ucHJvdG8gfSksIG4ucHJvdG8gPSB2KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgICAgICB5ID0gZnVuY3Rpb24geSgpIHsKICAgICAgICAgIG8uc2l6ZSAmJiAoby5mb3JFYWNoKHYpLCBpLmZvckVhY2goXyksIHAoeSkpOwogICAgICAgIH0sCiAgICAgICAgICAgIF8gPSBmdW5jdGlvbiBfKGUsIHQpIHsKICAgICAgICAgIHZhciByID0gZS5jaGFuZ2VSZWNvcmRzO3IubGVuZ3RoICYmIChlLmNoYW5nZVJlY29yZHMgPSBbXSwgdChyKSk7CiAgICAgICAgfSwKICAgICAgICAgICAgZyA9IGZ1bmN0aW9uIGcoZSwgdCkgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyICYmICh0ID0gby5nZXQoZSkpLCB0ICYmIHQubm90aWZpZXIgfHwgeyBub3RpZnk6IGZ1bmN0aW9uIG5vdGlmeSh0KSB7CiAgICAgICAgICAgICAgdC50eXBlO3ZhciByID0gby5nZXQoZSk7aWYgKHIpIHsKICAgICAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgICAgIGkgPSB7IG9iamVjdDogZSB9O2ZvciAobiBpbiB0KSB7CiAgICAgICAgICAgICAgICAgICJvYmplY3QiICE9PSBuICYmIChpW25dID0gdFtuXSk7CiAgICAgICAgICAgICAgICB9aihlLCByLCBpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHBlcmZvcm1DaGFuZ2U6IGZ1bmN0aW9uIHBlcmZvcm1DaGFuZ2UodCwgcikgewogICAgICAgICAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBub24tc3RyaW5nIGNoYW5nZVR5cGUiKTtpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IHBlcmZvcm0gbm9uLWZ1bmN0aW9uIik7dmFyIGksCiAgICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICAgIGEgPSBvLmdldChlKSwKICAgICAgICAgICAgICAgICAgYyA9IGFyZ3VtZW50c1syXSwKICAgICAgICAgICAgICAgICAgdSA9IGMgPT09IG4gPyByKCkgOiByLmNhbGwoYyk7aWYgKGEgJiYgdihhLCBlLCB0KSwgYSAmJiB1ICYmICJvYmplY3QiID09ICh0eXBlb2YgdSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodSkpKSB7CiAgICAgICAgICAgICAgICBzID0geyBvYmplY3Q6IGUsIHR5cGU6IHQgfTtmb3IgKGkgaW4gdSkgewogICAgICAgICAgICAgICAgICAib2JqZWN0IiAhPT0gaSAmJiAidHlwZSIgIT09IGkgJiYgKHNbaV0gPSB1W2ldKTsKICAgICAgICAgICAgICAgIH1qKGUsIGEsIHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSB9OwogICAgICAgIH0sCiAgICAgICAgICAgIG0gPSBmdW5jdGlvbiBtKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHZhciBvID0gaS5nZXQocik7byB8fCBpLnNldChyLCBvID0geyBvYnNlcnZlZDogdSgpLCBjaGFuZ2VSZWNvcmRzOiBbXSB9KSwgby5vYnNlcnZlZC5zZXQoZSwgeyBhY2NlcHRMaXN0OiBuLnNsaWNlKCksIGRhdGE6IHQgfSksIHQuaGFuZGxlcnMuc2V0KHIsIG8pOwogICAgICAgIH0sCiAgICAgICAgICAgIGogPSBmdW5jdGlvbiBqKGUsIHQsIHIsIG4pIHsKICAgICAgICAgIHQuaGFuZGxlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbyA9IHQub2JzZXJ2ZWQuZ2V0KGUpLmFjY2VwdExpc3Q7KCJzdHJpbmciICE9IHR5cGVvZiBuIHx8IC0xID09PSBjKG8sIG4pKSAmJiBjKG8sIHIudHlwZSkgPiAtMSAmJiB0LmNoYW5nZVJlY29yZHMucHVzaChyKTsKICAgICAgICAgIH0pOwogICAgICAgIH07byA9IHUoKSwgaSA9IHUoKSwgZS5vYnNlcnZlID0gZnVuY3Rpb24gKHQsIHIsIG8pIHsKICAgICAgICAgIGlmICghdCB8fCAib2JqZWN0IiAhPSAodHlwZW9mIHQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qub2JzZXJ2ZSBjYW5ub3Qgb2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIG5vbi1mdW5jdGlvbiIpO2lmIChlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4ocikpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5vYnNlcnZlIGNhbm5vdCBkZWxpdmVyIHRvIGEgZnJvemVuIGZ1bmN0aW9uIG9iamVjdCIpO2lmIChvID09PSBuKSBvID0gcztlbHNlIGlmICghbyB8fCAib2JqZWN0IiAhPSAodHlwZW9mIG8gPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG8pKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhpcmQgYXJndW1lbnQgdG8gT2JqZWN0Lm9ic2VydmUgbXVzdCBiZSBhbiBhcnJheSBvZiBzdHJpbmdzLiIpO3JldHVybiBiKHQsIHIsIG8pLCB0OwogICAgICAgIH0sIGUudW5vYnNlcnZlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSBlIHx8ICJvYmplY3QiICE9ICh0eXBlb2YgZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IHVub2JzZXJ2ZSBub24tb2JqZWN0Iik7aWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC51bm9ic2VydmUgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHIsCiAgICAgICAgICAgICAgbiA9IGkuZ2V0KHQpO3JldHVybiBuICYmIChyID0gbi5vYnNlcnZlZC5nZXQoZSkpICYmIChuLm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIHAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfKG4sIHQpOwogICAgICAgICAgfSksIDEgPT09IG4ub2JzZXJ2ZWQuc2l6ZSAmJiBuLm9ic2VydmVkLmhhcyhlKSA/IGlbImRlbGV0ZSJdKHQpIDogbi5vYnNlcnZlZFsiZGVsZXRlIl0oZSksIDEgPT09IHIuZGF0YS5oYW5kbGVycy5zaXplID8gb1siZGVsZXRlIl0oZSkgOiByLmRhdGEuaGFuZGxlcnNbImRlbGV0ZSJdKHQpKSwgZTsKICAgICAgICB9LCBlLmdldE5vdGlmaWVyID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmIChudWxsID09PSB0IHx8ICJvYmplY3QiICE9ICh0eXBlb2YgdCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YodCkpICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5nZXROb3RpZmllciBjYW5ub3QgZ2V0Tm90aWZpZXIgbm9uLW9iamVjdCIpO3JldHVybiBlLmlzRnJvemVuICYmIGUuaXNGcm96ZW4odCkgPyBudWxsIDogZyh0KTsKICAgICAgICB9LCBlLmRlbGl2ZXJDaGFuZ2VSZWNvcmRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3QuZGVsaXZlckNoYW5nZVJlY29yZHMgY2Fubm90IGRlbGl2ZXIgdG8gbm9uLWZ1bmN0aW9uIik7dmFyIHQgPSBpLmdldChlKTt0ICYmICh0Lm9ic2VydmVkLmZvckVhY2goZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdihlLmRhdGEsIHQpOwogICAgICAgICAgfSksIF8odCwgZSkpOwogICAgICAgIH07CiAgICAgIH0oT2JqZWN0LCBBcnJheSwgdGhpcyk7CiAgICB9LCB7fV0sIDkyOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pLCByLkRhdGFPYmplY3RPYnNlcnZlciA9IHIuRGF0YU9iamVjdFJlcG9ydGVyID0gci5TeW5jaGVyID0gdm9pZCAwLCBlKCJtdXRhdGlvbm9ic2VydmVyLXNoaW0iKSwgZSgib2JqZWN0Lm9ic2VydmUiKSwgZSgiYXJyYXkub2JzZXJ2ZSIpO3ZhciBvID0gZSgiLi9zeW5jaGVyL1N5bmNoZXIiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0UmVwb3J0ZXIiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiKSwKICAgICAgICAgIHUgPSBuKGMpO3IuU3luY2hlciA9IGlbImRlZmF1bHQiXSwgci5EYXRhT2JqZWN0UmVwb3J0ZXIgPSBhWyJkZWZhdWx0Il0sIHIuRGF0YU9iamVjdE9ic2VydmVyID0gdVsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9zeW5jaGVyL0RhdGFPYmplY3RPYnNlcnZlciI6IDk1LCAiLi9zeW5jaGVyL0RhdGFPYmplY3RSZXBvcnRlciI6IDk2LCAiLi9zeW5jaGVyL1N5bmNoZXIiOiA5OSwgImFycmF5Lm9ic2VydmUiOiAxLCAibXV0YXRpb25vYnNlcnZlci1zaGltIjogOTAsICJvYmplY3Qub2JzZXJ2ZSI6IDkxIH1dLCA5MzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL1N5bmNPYmplY3QiKSwKICAgICAgICAgIHAgPSBuKGQpLAogICAgICAgICAgYiA9IGUoIi4vRGF0YU9iamVjdENoaWxkIiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCIuLi91dGlscy91dGlscy5qcyIpLAogICAgICAgICAgeSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBhID0gdGhpczthLl9zeW5jaGVyID0gdCwgYS5fdXJsID0gciwgYS5fc2NoZW1hID0gbiwgYS5fc3RhdHVzID0gbywgYS5fc3luY09iaiA9IG5ldyBwWyJkZWZhdWx0Il0oaSksIGEuX2NoaWxkcmVucyA9IHMsIGEuX3ZlcnNpb24gPSAwLCBhLl9jaGlsZElkID0gMCwgYS5fY2hpbGRyZW5PYmplY3RzID0ge30sIGEuX2NoaWxkcmVuTGlzdGVuZXJzID0gW10sIGEuX293bmVyID0gdC5fb3duZXIsIGEuX2J1cyA9IHQuX2J1czsKICAgICAgICB9cmV0dXJuICgwLCBmWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICAgICAgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gdC5fdXJsICsgIi9jaGlsZHJlbi8iO3QuX2NoaWxkcmVucyAmJiB0Ll9jaGlsZHJlbnMuZm9yRWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHZhciBvID0gciArIG4sCiAgICAgICAgICAgICAgICAgIGkgPSB0Ll9idXMuYWRkTGlzdGVuZXIobywgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgIGlmIChyLmZyb20gIT09IGUuX293bmVyKSBzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0LUNoaWxkcmVuLVJDVjogIiwgciksIHIudHlwZSkge2Nhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICAgICAgdC5fb25DaGlsZENyZWF0ZShyKTticmVhaztjYXNlICJkZWxldGUiOgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHIpO2JyZWFrO2RlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdC5fY2hhbmdlQ2hpbGRyZW4ocik7fQogICAgICAgICAgICAgIH0pO3QuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2goaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXM7ZS5fY2hpbGRyZW5MaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGUucmVtb3ZlKCk7CiAgICAgICAgICAgIH0pLCAoMCwgYVsiZGVmYXVsdCJdKShlLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGlsZHJlbk9iamVjdHNbdF0uX3JlbGVhc2VMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAicGF1c2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHRocm93ICJOb3QgaW1wbGVtZW50ZWQiOwogICAgICAgICAgfSB9LCB7IGtleTogInJlc3VtZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3RvcCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdGhyb3cgIk5vdCBpbXBsZW1lbnRlZCI7CiAgICAgICAgICB9IH0sIHsga2V5OiAiYWRkQ2hpbGQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7ci5fY2hpbGRJZCsrO3ZhciBuID0gci5fb3duZXIgKyAiIyIgKyByLl9jaGlsZElkLAogICAgICAgICAgICAgICAgbyA9IHIuX3VybCArICIvY2hpbGRyZW4vIiArIGUsCiAgICAgICAgICAgICAgICBzID0geyB0eXBlOiAiY3JlYXRlIiwgZnJvbTogci5fb3duZXIsIHRvOiBvLCBib2R5OiB7IHJlc291cmNlOiBuLCB2YWx1ZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHIuX2J1cy5wb3N0TWVzc2FnZShzKTtjb25zb2xlLmxvZygiY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAiICsgci5fb3duZXIgKyAiICk6ICIsIHMpO3ZhciBhID0gbmV3IGhbImRlZmF1bHQiXShyLCBuLCB0LCByLl9vd25lciwgaSk7YS5vbkNoYW5nZShmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgci5fb25DaGFuZ2UoZSwgeyBwYXRoOiBvLCBjaGlsZElkOiBuIH0pOwogICAgICAgICAgICAgIH0pLCByLl9jaGlsZHJlbk9iamVjdHNbbl0gPSBhLCBlKGEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkFkZENoaWxkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoaWxkQ3JlYXRlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5yZXNvdXJjZTtjb25zb2xlLmxvZygiY3JlYXRlLW9ic2VydmVyLWNoaWxkKCAiICsgdC5fb3duZXIgKyAiICk6ICIsIGUpO3ZhciBuID0gbmV3IGhbImRlZmF1bHQiXSh0LCByLCBlLmJvZHkudmFsdWUpO3QuX2NoaWxkcmVuT2JqZWN0c1tyXSA9IG4sIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDIwMCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgICB9KTt2YXIgbyA9IHsgdHlwZTogZS50eXBlLCBmcm9tOiBlLmZyb20sIHVybDogZS50bywgdmFsdWU6IGUuYm9keS52YWx1ZSwgY2hpbGRJZDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSB9O3QuX29uQWRkQ2hpbGRyZW5IYW5kbGVyICYmIChjb25zb2xlLmxvZygiQURELUNISUxEUkVOLUVWRU5UOiAiLCBvKSwgdC5fb25BZGRDaGlsZHJlbkhhbmRsZXIobykpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbisrLCAib24iID09PSByLl9zdGF0dXMpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsgdHlwZTogInVwZGF0ZSIsIGZyb206IHIuX3VybCwgdG86IHIuX3VybCArICIvY2hhbmdlcyIsIGJvZHk6IHsgdmVyc2lvbjogci5fdmVyc2lvbiwgc291cmNlOiByLl9vd25lciwgYXR0cmlidXRlOiBlLmZpZWxkIH0gfTtlLm9UeXBlID09PSBkLk9iamVjdFR5cGUuT0JKRUNUID8gZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSAmJiAobi5ib2R5LnZhbHVlID0gZS5kYXRhKSA6IChuLmJvZHkuYXR0cmlidXRlVHlwZSA9IGUub1R5cGUsIG4uYm9keS52YWx1ZSA9IGUuZGF0YSwgZS5jVHlwZSAhPT0gZC5DaGFuZ2VUeXBlLlVQREFURSAmJiAobi5ib2R5Lm9wZXJhdGlvbiA9IGUuY1R5cGUpKSwgdCAmJiAobi50byA9IHQucGF0aCwgbi5ib2R5LnJlc291cmNlID0gdC5jaGlsZElkKSwgci5fYnVzLnBvc3RNZXNzYWdlKG4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX2NoYW5nZU9iamVjdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcztpZiAoci5fdmVyc2lvbiArIDEgPT09IHQuYm9keS52ZXJzaW9uKSB7CiAgICAgICAgICAgICAgci5fdmVyc2lvbisrO3ZhciBuID0gdC5ib2R5LmF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgbyA9ICgwLCB2LmRlZXBDbG9uZSkodC5ib2R5LnZhbHVlKSwKICAgICAgICAgICAgICAgICAgaSA9IGUuZmluZEJlZm9yZShuKTtpZiAodC5ib2R5LmF0dHJpYnV0ZVR5cGUgPT09IGQuT2JqZWN0VHlwZS5BUlJBWSkgewogICAgICAgICAgICAgICAgaWYgKHQuYm9keS5vcGVyYXRpb24gPT09IGQuQ2hhbmdlVHlwZS5BREQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBpLm9iaiwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBpLmxhc3Q7QXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShzLCBbYSwgMF0uY29uY2F0KG8pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5ib2R5Lm9wZXJhdGlvbiA9PT0gZC5DaGFuZ2VUeXBlLlJFTU9WRSkgewogICAgICAgICAgICAgICAgICB2YXIgYyA9IGkub2JqLAogICAgICAgICAgICAgICAgICAgICAgdSA9IGkubGFzdDtjLnNwbGljZSh1LCBvKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpLm9ialtpLmxhc3RdID0gbzsKICAgICAgICAgICAgICB9IGVsc2UgdC5ib2R5LnZhbHVlID8gaS5vYmpbaS5sYXN0XSA9IG8gOiBkZWxldGUgaS5vYmpbaS5sYXN0XTsKICAgICAgICAgICAgfSBlbHNlIGNvbnNvbGUubG9nKCJVTlNZTkNIUk9OSVpFRCBWRVJTSU9OOiAoZGF0YSA9PiAiICsgci5fdmVyc2lvbiArICIsIG1zZyA9PiAiICsgdC5ib2R5LnZlcnNpb24gKyAiKSIpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9jaGFuZ2VDaGlsZHJlbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztjb25zb2xlLmxvZygiQ2hhbmdlIGNoaWxkcmVuOiAiLCB0Ll9vd25lciwgZSk7dmFyIHIgPSBlLmJvZHkucmVzb3VyY2UsCiAgICAgICAgICAgICAgICBuID0gdC5fY2hpbGRyZW5PYmplY3RzW3JdO24gPyB0Ll9jaGFuZ2VPYmplY3Qobi5fc3luY09iaiwgZSkgOiBjb25zb2xlLmxvZygiTm8gY2hpbGRyZW4gZm91bmQgZm9yOiAiLCByKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cmwiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VybDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzY2hlbWEiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVtYTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdGF0dXMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXR1czsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRyZW5zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbk9iamVjdHM7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IHksIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4uL3V0aWxzL3V0aWxzLmpzIjogMTAwLCAiLi9EYXRhT2JqZWN0Q2hpbGQiOiA5NCwgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjogOSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIgfV0sIDk0OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoIi4vU3luY09iamVjdCIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCwgciwgbiwgbywgcykgewogICAgICAgICAgKDAsIGlbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIGEgPSB0aGlzO2EuX3BhcmVudCA9IHQsIGEuX2NoaWxkSWQgPSByLCBhLl9vd25lciA9IG8sIGEuX21zZ0lkID0gcywgYS5fc3luY09iaiA9IG5ldyB1WyJkZWZhdWx0Il0obiksIGEuX2J1cyA9IHQuX2J1cywgYS5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX293bmVyICYmIChlLl9saXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl9vd25lciwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAicmVzcG9uc2UiID09PSB0LnR5cGUgJiYgdC5pZCA9PT0gZS5fbXNnSWQgJiYgKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0Q2hpbGQub25SZXNwb25zZToiLCB0KSwgZS5fb25SZXNwb25zZSh0KSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfcmVsZWFzZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyICYmIGUuX2xpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2RlbGV0ZSBlLl9wYXJlbnQuX2NoaWxkcmVuW2UuX2NoaWxkSWRdLCBlLl9yZWxlYXNlTGlzdGVuZXJzKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25DaGFuZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25SZXNwb25zZUhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIl9vblJlc3BvbnNlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogZS50eXBlLCB1cmw6IGUuYm9keS5zb3VyY2UsIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgdC5fb25SZXNwb25zZUhhbmRsZXIocik7CiAgICAgICAgICB9IH0sIHsga2V5OiAiY2hpbGRJZCIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRJZDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkYXRhIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zeW5jT2JqLmRhdGE7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpO3JbImRlZmF1bHQiXSA9IGwsIHQuZXhwb3J0cyA9IHJbImRlZmF1bHQiXTsKICAgIH0sIHsgIi4vU3luY09iamVjdCI6IDk4LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTU6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKSwKICAgICAgICAgIGkgPSBuKG8pLAogICAgICAgICAgcyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLAogICAgICAgICAgYSA9IG4ocyksCiAgICAgICAgICBjID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICB1ID0gbihjKSwKICAgICAgICAgIGwgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIGYgPSBuKGwpLAogICAgICAgICAgZCA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiksCiAgICAgICAgICBwID0gbihkKSwKICAgICAgICAgIGIgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IiksCiAgICAgICAgICBoID0gbihiKSwKICAgICAgICAgIHYgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKSwKICAgICAgICAgIHkgPSBuKHYpLAogICAgICAgICAgXyA9IGUoIi4vRGF0YU9iamVjdCIpLAogICAgICAgICAgZyA9IG4oXyksCiAgICAgICAgICBtID0gZSgiLi9EYXRhT2JqZWN0Q2hpbGQiKSwKICAgICAgICAgIGogPSBuKG0pLAogICAgICAgICAgJCA9IHsgQU5ZOiAiYW55IiwgU1RBUlQ6ICJzdGFydCIsIEVYQUNUOiAiZXhhY3QiIH0sCiAgICAgICAgICBPID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIHMsIGMsIGwpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBmID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBzLmRhdGEsIGMpKSwKICAgICAgICAgICAgICBkID0gZjtyZXR1cm4gZC5fdmVyc2lvbiA9IGwsIGQuX2ZpbHRlcnMgPSB7fSwgZC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGQuX29uRmlsdGVyKGUpOwogICAgICAgICAgfSksICgwLCBpWyJkZWZhdWx0Il0pKHMuY2hpbGRyZW5zKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0ID0gcy5jaGlsZHJlbnNbZV07ZC5fY2hpbGRyZW5PYmplY3RzW2VdID0gbmV3IGpbImRlZmF1bHQiXShkLCBlLCB0KTsKICAgICAgICAgIH0pLCBkLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBmOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fY2hhbmdlTGlzdGVuZXIgPSBlLl9idXMuYWRkTGlzdGVuZXIoZS5fdXJsICsgIi9jaGFuZ2VzIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAidXBkYXRlIiA9PT0gdC50eXBlICYmIChjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZU9iamVjdChlLl9zeW5jT2JqLCB0KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX2NoYW5nZUxpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgfSB9LCB7IGtleTogImRlbGV0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX29ic2VydmVyc1tlLl91cmxdOwogICAgICAgICAgfSB9LCB7IGtleTogInVuc3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICB0ID0geyB0eXBlOiAidW5zdWJzY3JpYmUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLVVOU1VCU0NSSUJFOiAiLCB0KSwgMjAwID09PSB0LmJvZHkuY29kZSAmJiAoZS5fcmVsZWFzZUxpc3RlbmVycygpLCBkZWxldGUgZS5fc3luY2hlci5fb2JzZXJ2ZXJzW2UuX3VybF0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvbkNoYW5nZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0KSB7CiAgICAgICAgICAgIHZhciByID0gZSwKICAgICAgICAgICAgICAgIG4gPSB7IHR5cGU6ICQuRVhBQ1QsIGNhbGxiYWNrOiB0IH0sCiAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKCIqIik7byA9PT0gZS5sZW5ndGggLSAxICYmICgwID09PSBvID8gbi50eXBlID0gJC5BTlkgOiAobi50eXBlID0gJC5TVEFSVCwgciA9IGUuc3Vic3RyKDAsIGUubGVuZ3RoIC0gMSkpKSwgdGhpcy5fZmlsdGVyc1tyXSA9IG47CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRmlsdGVyIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOygwLCBpWyJkZWZhdWx0Il0pKHQuX2ZpbHRlcnMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX2ZpbHRlcnNbcl07bi50eXBlID09PSAkLkFOWSA/IG4uY2FsbGJhY2soZSkgOiBuLnR5cGUgPT09ICQuU1RBUlQgPyAwID09PSBlLmZpZWxkLmluZGV4T2YocikgJiYgbi5jYWxsYmFjayhlKSA6IG4udHlwZSA9PT0gJC5FWEFDVCAmJiBlLmZpZWxkID09PSByICYmIG4uY2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBPLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuL0RhdGFPYmplY3QiOiA5MywgIi4vRGF0YU9iamVjdENoaWxkIjogOTQsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOiA2LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjogNywgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI6IDExLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjogMTIsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjogMTMsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOiAxNCwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjogMTUgfV0sIDk2OiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBvID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIiksCiAgICAgICAgICBpID0gbihvKSwKICAgICAgICAgIHMgPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSwKICAgICAgICAgIGEgPSBuKHMpLAogICAgICAgICAgYyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgdSA9IG4oYyksCiAgICAgICAgICBsID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpLAogICAgICAgICAgaCA9IG4oYiksCiAgICAgICAgICB2ID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIiksCiAgICAgICAgICB5ID0gbih2KSwKICAgICAgICAgIF8gPSBlKCIuL0RhdGFPYmplY3QiKSwKICAgICAgICAgIGcgPSBuKF8pLAogICAgICAgICAgbSA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBqID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBmdW5jdGlvbiB0KGUsIHIsIG4sIG8sIGksIHMpIHsKICAgICAgICAgICgwLCB1WyJkZWZhdWx0Il0pKHRoaXMsIHQpO3ZhciBjID0gKDAsIHBbImRlZmF1bHQiXSkodGhpcywgKDAsIGFbImRlZmF1bHQiXSkodCkuY2FsbCh0aGlzLCBlLCByLCBuLCBvLCBpLCBzKSksCiAgICAgICAgICAgICAgbCA9IGM7cmV0dXJuIGwuX3N1YnNjcmlwdGlvbnMgPSB7fSwgbC5fc3luY09iai5vYnNlcnZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItIiArIHIgKyAiLVNFTkQ6ICIsIGUpLCBsLl9vbkNoYW5nZShlKTsKICAgICAgICAgIH0pLCBsLl9hbGxvY2F0ZUxpc3RlbmVycygpLCBjOwogICAgICAgIH1yZXR1cm4gKDAsIHlbImRlZmF1bHQiXSkodCwgZSksICgwLCBmWyJkZWZhdWx0Il0pKHQsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgKDAsIGhbImRlZmF1bHQiXSkoKDAsIGFbImRlZmF1bHQiXSkodC5wcm90b3R5cGUpLCAiX2FsbG9jYXRlTGlzdGVuZXJzIiwgdGhpcykuY2FsbCh0aGlzKTt2YXIgZSA9IHRoaXM7ZS5fcmVzcG9uc2VMaXN0ZW5lciA9IGUuX2J1cy5hZGRMaXN0ZW5lcihlLl91cmwsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgInJlc3BvbnNlIiA9PT0gdC50eXBlICYmIGUuX29uUmVzcG9uc2UodCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9yZWxlYXNlTGlzdGVuZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICAoMCwgaFsiZGVmYXVsdCJdKSgoMCwgYVsiZGVmYXVsdCJdKSh0LnByb3RvdHlwZSksICJfcmVsZWFzZUxpc3RlbmVycyIsIHRoaXMpLmNhbGwodGhpcyk7dmFyIGUgPSB0aGlzO2UuX3Jlc3BvbnNlTGlzdGVuZXIucmVtb3ZlKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiaW52aXRlT2JzZXJ2ZXJzIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IHQuX3N5bmNoZXIuX293bmVyLCB0bzogdC5fc3luY2hlci5fc3ViVVJMLCBib2R5OiB7IHJlc291cmNlOiB0Ll91cmwsIHNjaGVtYTogdC5fc2NoZW1hLCB2YWx1ZTogdC5fc3luY09iai5kYXRhLCBhdXRob3Jpc2U6IGUgfSB9O3QuX2J1cy5wb3N0TWVzc2FnZShyKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJkZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgICAgICAgIHQgPSB7IHR5cGU6ICJkZWxldGUiLCBmcm9tOiBlLl9vd25lciwgdG86IGUuX3N5bmNoZXIuX3N1YlVSTCwgYm9keTogeyByZXNvdXJjZTogZS5fdXJsIH0gfTtlLl9idXMucG9zdE1lc3NhZ2UodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLURFTEVURTogIiwgdCksIDIwMCA9PT0gdC5ib2R5LmNvZGUgJiYgKGUuX3JlbGVhc2VMaXN0ZW5lcnMoKSwgZGVsZXRlIGUuX3N5bmNoZXIuX3JlcG9ydGVyc1tlLl91cmxdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAib25TdWJzY3JpcHRpb24iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBlOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uUmVzcG9uc2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGU7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uRm9yd2FyZCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcztzd2l0Y2ggKGNvbnNvbGUubG9nKCJEYXRhT2JqZWN0UmVwb3J0ZXItUkNWOiAiLCBlKSwgZS5ib2R5LnR5cGUpIHtjYXNlICJzdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25TdWJzY3JpYmUoZSk7YnJlYWs7Y2FzZSAidW5zdWJzY3JpYmUiOgogICAgICAgICAgICAgICAgdC5fb25VblN1YnNjcmliZShlKTt9CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uU3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IGUuYm9keS5mcm9tLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgYWNjZXB0OiBmdW5jdGlvbiBhY2NlcHQoKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHsgdXJsOiByLCBzdGF0dXM6ICJvbiIgfTt0Ll9zdWJzY3JpcHRpb25zW3JdID0gbjt2YXIgbyA9IHt9O3JldHVybiAoMCwgaVsiZGVmYXVsdCJdKSh0Ll9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0Ll9jaGlsZHJlbk9iamVjdHNbZV0uZGF0YTtvW2VdID0gKDAsIG0uZGVlcENsb25lKShyKTsKICAgICAgICAgICAgICAgIH0pLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiAyMDAsIHNjaGVtYTogdC5fc2NoZW1hLCB2ZXJzaW9uOiB0Ll92ZXJzaW9uLCB2YWx1ZTogeyBkYXRhOiAoMCwgbS5kZWVwQ2xvbmUpKHQuZGF0YSksIGNoaWxkcmVuczogbyB9IH0gfSksIG47CiAgICAgICAgICAgICAgfSwgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICAgICAgICAgICAgdC5fYnVzLnBvc3RNZXNzYWdlKHsgaWQ6IGUuaWQsIHR5cGU6ICJyZXNwb25zZSIsIGZyb206IGUudG8sIHRvOiBlLmZyb20sIGJvZHk6IHsgY29kZTogNDAzLCBkZXNjOiByIH0gfSk7CiAgICAgICAgICAgICAgfSB9O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciAmJiAoY29uc29sZS5sb2coIlNVQlNDUklQVElPTi1FVkVOVDogIiwgbiksIHQuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihuKSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX29uVW5TdWJzY3JpYmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LmZyb20sCiAgICAgICAgICAgICAgICBuID0gdC5fc3Vic2NyaXB0aW9uc1tyXTtkZWxldGUgdC5fc3Vic2NyaXB0aW9uc1tyXTt2YXIgbyA9IHsgdHlwZTogZS5ib2R5LnR5cGUsIHVybDogciwgb2JqZWN0OiBuIH07dC5fb25TdWJzY3JpcHRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiVU4tU1VCU0NSSVBUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25TdWJzY3JpcHRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZXNwb25zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IHR5cGU6IGUudHlwZSwgdXJsOiBlLmZyb20sIGNvZGU6IGUuYm9keS5jb2RlIH07dC5fb25SZXNwb25zZUhhbmRsZXIgJiYgKGNvbnNvbGUubG9nKCJSRVNQT05TRS1FVkVOVDogIiwgciksIHQuX29uUmVzcG9uc2VIYW5kbGVyKHIpKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpcHRpb25zIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25zOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0oZ1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il0gPSBqLCB0LmV4cG9ydHMgPSByWyJkZWZhdWx0Il07CiAgICB9LCB7ICIuLi91dGlscy91dGlscy5qcyI6IDEwMCwgIi4vRGF0YU9iamVjdCI6IDkzLCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjogNiwgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6IDcsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOiAxMSwgImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI6IDEyLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6IDEzLCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjogMTQsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI6IDE1IH1dLCA5NzogW2Z1bmN0aW9uIChlLCB0LCByKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZnVuY3Rpb24gbihlKSB7CiAgICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsgImRlZmF1bHQiOiBlIH07CiAgICAgIH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KTt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByLCBuLCBvKSB7CiAgICAgICAgICAoMCwgaVsiZGVmYXVsdCJdKSh0aGlzLCBlKTt2YXIgcyA9IHRoaXM7cy5fb3duZXIgPSB0LCBzLl91cmwgPSByLCBzLl9idXMgPSBuLCBzLl9jaGlsZHJlbiA9IG8sIHMuX2NoYW5nZXMgPSBbXSwgcy5fYWxsb2NhdGVMaXN0ZW5lcnMoKTsKICAgICAgICB9cmV0dXJuICgwLCBhWyJkZWZhdWx0Il0pKGUsIFt7IGtleTogIl9hbGxvY2F0ZUxpc3RlbmVycyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzO2UuX2xpc3RlbmVyID0gZS5fYnVzLmFkZExpc3RlbmVyKGUuX3VybCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YVByb3Zpc2lvbmFsLSIgKyBlLl91cmwgKyAiLVJDVjogIiwgdCksIGUuX2NoYW5nZXMucHVzaCh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX3JlbGVhc2VMaXN0ZW5lcnMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9saXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJhcHBseSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpczt0Ll9jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLl9jaGFuZ2VPYmplY3QoZS5fc3luY09iaiwgdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogImNoaWxkcmVuIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbjsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gYywgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTg6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSksIHIuT2JqZWN0VHlwZSA9IHIuQ2hhbmdlVHlwZSA9IHZvaWQgMDt2YXIgbyA9IGUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4uL3V0aWxzL3V0aWxzLmpzIiksCiAgICAgICAgICBmID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgICAgKDAsIGFbImRlZmF1bHQiXSkodGhpcywgZSk7dmFyIHIgPSB0aGlzO3IuX29ic2VydmVycyA9IFtdLCByLl9maWx0ZXJzID0ge30sIHQgPyByLl9kYXRhID0gKDAsIGwuZGVlcENsb25lKSh0KSA6IHIuX2RhdGEgPSB7fSwgci5faW50ZXJuYWxPYnNlcnZlKG5ldyBkKCksIHIuX2RhdGEpOwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAib2JzZXJ2ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHRoaXMuX29ic2VydmVycy5wdXNoKGUpOwogICAgICAgICAgfSB9LCB7IGtleTogImZpbmQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IGUuc3BsaXQoIi4iKTtyZXR1cm4gdGhpcy5fZmluZFdpdGhTcGxpdCh0KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJmaW5kQmVmb3JlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB7fSwKICAgICAgICAgICAgICAgIHIgPSBlLnNwbGl0KCIuIik7cmV0dXJuIHQubGFzdCA9IHIucG9wKCksIHQub2JqID0gdGhpcy5fZmluZFdpdGhTcGxpdChyKSwgdDsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfZmluZFdpdGhTcGxpdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fZGF0YTtyZXR1cm4gZS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdCA9IHRbZV07CiAgICAgICAgICAgIH0pLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogIl9maXJlRXZlbnQiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB0aGlzLl9vYnNlcnZlcnMuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHQoZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIl9pc09ic2VydmFibGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICByZXR1cm4gZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IGUuY29uc3RydWN0b3IgPT09IEFycmF5OwogICAgICAgICAgfSB9LCB7IGtleTogIl9pbnRlcm5hbE9ic2VydmUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7aWYgKHIuX2lzT2JzZXJ2YWJsZSh0KSkgewogICAgICAgICAgICAgIHZhciBuID0gZnVuY3Rpb24gbih0KSB7CiAgICAgICAgICAgICAgICByLl9vbkNoYW5nZXMoZSwgdCk7CiAgICAgICAgICAgICAgfTtpZiAodC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICAgICAgICBPYmplY3Qub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBvIGluIHQpIHsKICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHRbb10pICYmIHIuX2ludGVybmFsT2JzZXJ2ZShlWyJuZXciXShvKSwgdFtvXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgICAgICAgQXJyYXkub2JzZXJ2ZSh0LCBuKTtmb3IgKHZhciBpIGluIHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHIuX2lzT2JzZXJ2YWJsZSh0W2ldKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0obmV3IHAodFtpXSwgaSkpO3IuX2ludGVybmFsT2JzZXJ2ZShzLCB0W2ldKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSB9LCB7IGtleTogIl9vbkNoYW5nZXMiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSwgdCkgewogICAgICAgICAgICB2YXIgciA9IHRoaXM7Zm9yICh2YXIgbiBpbiB0KSB7CiAgICAgICAgICAgICAgdmFyIG8gPSB0W25dLm9iamVjdCwKICAgICAgICAgICAgICAgICAgaSA9IHZvaWQgMDtpZiAoby5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmIChpID0gaC5PQkpFQ1QpLCBvLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiAoaSA9IGguQVJSQVkpLCAic3BsaWNlIiA9PT0gdFtuXS50eXBlKSAhZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0W25dLmluZGV4LAogICAgICAgICAgICAgICAgICAgIGEgPSBlWyJuZXciXSgiIiArIHMpLAogICAgICAgICAgICAgICAgICAgIGMgPSBhLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgdSA9IHRbbl0ucmVtb3ZlZC5sZW5ndGg7aWYgKDAgIT09IHUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0W25dLnJlbW92ZWQ7Zi5mb3JFYWNoKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgci5faXNPYnNlcnZhYmxlKHQpICYmIGUucmVtb3ZlSW5kZXgocyArIG4pOwogICAgICAgICAgICAgICAgICB9KSwgci5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGMsIGRhdGE6IHUgfSk7CiAgICAgICAgICAgICAgICB9dmFyIGQgPSB0W25dLmFkZGVkQ291bnQ7aWYgKDAgIT09IGQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBvLnNsaWNlKHMsIHMgKyBkKTtoLmZvckVhY2goZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoci5faXNPYnNlcnZhYmxlKHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGVbIm5ldyJdKG5ldyBwKHQsIHMgKyBuKSk7ci5faW50ZXJuYWxPYnNlcnZlKG8sIHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksIHIuX2ZpcmVFdmVudCh7IGNUeXBlOiBiLkFERCwgb1R5cGU6IGksIGZpZWxkOiBjLCBkYXRhOiAoMCwgbC5kZWVwQ2xvbmUpKGgpIH0pOwogICAgICAgICAgICAgICAgfXMgIT09IG8ubGVuZ3RoIC0gMSAmJiBlLnJlSW5kZXhGcm9tKG8pOwogICAgICAgICAgICAgIH0oKTtlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBzID0gZVsibmV3Il0odFtuXS5uYW1lKSwKICAgICAgICAgICAgICAgICAgICBhID0gcy50b1N0cmluZygpO2lmICgtMSAhPT0gYS5pbmRleE9mKCJTeW1ib2wiKSkgY29udGludWU7dmFyIGMgPSBvW3Rbbl0ubmFtZV07InVwZGF0ZSIgPT09IHRbbl0udHlwZSAmJiB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5VUERBVEUsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSwgImFkZCIgPT09IHRbbl0udHlwZSAmJiAodGhpcy5faW50ZXJuYWxPYnNlcnZlKHMsIGMpLCB0aGlzLl9maXJlRXZlbnQoeyBjVHlwZTogYi5BREQsIG9UeXBlOiBpLCBmaWVsZDogYSwgZGF0YTogKDAsIGwuZGVlcENsb25lKShjKSB9KSksICJkZWxldGUiID09PSB0W25dLnR5cGUgJiYgdGhpcy5fZmlyZUV2ZW50KHsgY1R5cGU6IGIuUkVNT1ZFLCBvVHlwZTogaSwgZmllbGQ6IGEgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGF0YSIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCksCiAgICAgICAgICBkID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5fcGF0aCA9IFtdLCB0aGlzLl9vYnNlcnZhYmxlcyA9IHt9OwogICAgICAgIH1yZXR1cm4gKDAsIHVbImRlZmF1bHQiXSkoZSwgW3sga2V5OiAicmVtb3ZlSW5kZXgiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICBkZWxldGUgdGhpcy5fb2JzZXJ2YWJsZXNbZV07CiAgICAgICAgICB9IH0sIHsga2V5OiAicmVJbmRleEZyb20iLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7KDAsIGlbImRlZmF1bHQiXSkodGhpcy5fb2JzZXJ2YWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuX29ic2VydmFibGVzW3JdLAogICAgICAgICAgICAgICAgICBvID0gZS5pbmRleE9mKG4ub2JqKTtuLmlkeCAhPSBvICYmIChuLmlkeCA9IG8sIGRlbGV0ZSB0Ll9vYnNlcnZhYmxlc1tyXSwgdC5fb2JzZXJ2YWJsZXNbb10gPSBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAibmV3IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgZS5jb25zdHJ1Y3RvciA9PSBwICYmICh0aGlzLl9vYnNlcnZhYmxlc1tlLmlkeF0gPSBlKTt2YXIgdCA9IHRoaXMuY2xvbmUoKTtyZXR1cm4gdC5fcGF0aC5wdXNoKGUpLCB0OwogICAgICAgICAgfSB9LCB7IGtleTogImNsb25lIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBlKCk7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHQuX3BhdGgucHVzaChlKTsKICAgICAgICAgICAgfSksIHQ7CiAgICAgICAgICB9IH0sIHsga2V5OiAidG9TdHJpbmciLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBlID0gIiI7cmV0dXJuIHRoaXMuX3BhdGguZm9yRWFjaChmdW5jdGlvbiAodCwgcikgewogICAgICAgICAgICAgIDAgPT09IHIgPyBlID0gdC50b1N0cmluZygpIDogZSArPSAiLiIgKyB0LnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0pLCBlOwogICAgICAgICAgfSB9XSksIGU7CiAgICAgIH0oKSwKICAgICAgICAgIHAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gZSh0LCByKSB7CiAgICAgICAgICAoMCwgYVsiZGVmYXVsdCJdKSh0aGlzLCBlKSwgdGhpcy5vYmogPSB0LCB0aGlzLmlkeCA9IHI7CiAgICAgICAgfXJldHVybiAoMCwgdVsiZGVmYXVsdCJdKShlLCBbeyBrZXk6ICJ0b1N0cmluZyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWR4LnRvU3RyaW5nKCk7CiAgICAgICAgICB9IH1dKSwgZTsKICAgICAgfSgpLAogICAgICAgICAgYiA9IHIuQ2hhbmdlVHlwZSA9IHsgVVBEQVRFOiAidXBkYXRlIiwgQUREOiAiYWRkIiwgUkVNT1ZFOiAicmVtb3ZlIiB9LAogICAgICAgICAgaCA9IHIuT2JqZWN0VHlwZSA9IHsgT0JKRUNUOiAib2JqZWN0IiwgQVJSQVk6ICJhcnJheSIgfTtyWyJkZWZhdWx0Il0gPSBmOwogICAgfSwgeyAiLi4vdXRpbHMvdXRpbHMuanMiOiAxMDAsICJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOiA3LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgOTk6IFtmdW5jdGlvbiAoZSwgdCwgcikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7ICJkZWZhdWx0IjogZSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIG8gPSBlKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSIpLAogICAgICAgICAgaSA9IG4obyksCiAgICAgICAgICBzID0gZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIiksCiAgICAgICAgICBhID0gbihzKSwKICAgICAgICAgIGMgPSBlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKSwKICAgICAgICAgIHUgPSBuKGMpLAogICAgICAgICAgbCA9IGUoIi4vRGF0YU9iamVjdFJlcG9ydGVyIiksCiAgICAgICAgICBmID0gbihsKSwKICAgICAgICAgIGQgPSBlKCIuL0RhdGFPYmplY3RPYnNlcnZlciIpLAogICAgICAgICAgcCA9IG4oZCksCiAgICAgICAgICBiID0gZSgiLi9EYXRhUHJvdmlzaW9uYWwiKSwKICAgICAgICAgIGggPSBuKGIpLAogICAgICAgICAgdiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBlKHQsIHIsIG4pIHsKICAgICAgICAgICgwLCBhWyJkZWZhdWx0Il0pKHRoaXMsIGUpO3ZhciBvID0gdGhpcztvLl9vd25lciA9IHQsIG8uX2J1cyA9IHIsIG8uX3N1YlVSTCA9IG4ucnVudGltZVVSTCArICIvc20iLCBvLl9yZXBvcnRlcnMgPSB7fSwgby5fb2JzZXJ2ZXJzID0ge30sIG8uX3Byb3Zpc2lvbmFscyA9IHt9LCByLmFkZExpc3RlbmVyKHQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLmZyb20gIT09IHQpIHN3aXRjaCAoY29uc29sZS5sb2coIlN5bmNoZXItUkNWOiAiLCBlKSwgZS50eXBlKSB7Y2FzZSAiZm9yd2FyZCI6CiAgICAgICAgICAgICAgICBvLl9vbkZvcndhcmQoZSk7YnJlYWs7Y2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgIG8uX29uUmVtb3RlQ3JlYXRlKGUpO2JyZWFrO2Nhc2UgImRlbGV0ZSI6CiAgICAgICAgICAgICAgICBvLl9vblJlbW90ZURlbGV0ZShlKTt9CiAgICAgICAgICB9KTsKICAgICAgICB9cmV0dXJuICgwLCB1WyJkZWZhdWx0Il0pKGUsIFt7IGtleTogImNyZWF0ZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShlLCB0LCByKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcztyLnJlcG9ydGVyID0gbi5fb3duZXIsIHIuc2NoZW1hID0gZTt2YXIgbyA9IHsgdHlwZTogImNyZWF0ZSIsIGZyb206IG4uX293bmVyLCB0bzogbi5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgdmFsdWU6IHIsIGF1dGhvcmlzZTogdCB9IH07cmV0dXJuIG5ldyBpWyJkZWZhdWx0Il0oZnVuY3Rpb24gKHQsIGkpIHsKICAgICAgICAgICAgICBuLl9idXMucG9zdE1lc3NhZ2UobywgZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgICAgIGlmIChjb25zb2xlLmxvZygiY3JlYXRlLXJlc3BvbnNlOiAiLCBvKSwgMjAwID09PSBvLmJvZHkuY29kZSkgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IG8uYm9keS5yZXNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgIGEgPSBuZXcgZlsiZGVmYXVsdCJdKG4sIHMsIGUsICJvbiIsIHIsIG8uYm9keS5jaGlsZHJlblJlc291cmNlcyk7bi5fcmVwb3J0ZXJzW3NdID0gYSwgdChhKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpKG8uYm9keS5kZXNjKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAic3Vic2NyaWJlIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgbiA9IHsgdHlwZTogInN1YnNjcmliZSIsIGZyb206IHIuX293bmVyLCB0bzogci5fc3ViVVJMLCBib2R5OiB7IHNjaGVtYTogZSwgcmVzb3VyY2U6IHQgfSB9O3JldHVybiBuZXcgaVsiZGVmYXVsdCJdKGZ1bmN0aW9uIChvLCBpKSB7CiAgICAgICAgICAgICAgci5fYnVzLnBvc3RNZXNzYWdlKG4sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic3Vic2NyaWJlLXJlc3BvbnNlOiAiLCBuKTt2YXIgcyA9IHIuX3Byb3Zpc2lvbmFsc1t0XTtpZiAoZGVsZXRlIHIuX3Byb3Zpc2lvbmFsc1t0XSwgcyAmJiBzLl9yZWxlYXNlTGlzdGVuZXJzKCksIG4uYm9keS5jb2RlIDwgMjAwKSBzID0gbmV3IGhbImRlZmF1bHQiXShyLl9vd25lciwgdCwgci5fYnVzLCBuLmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpLCByLl9wcm92aXNpb25hbHNbdF0gPSBzO2Vsc2UgaWYgKDIwMCA9PT0gbi5ib2R5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgcFsiZGVmYXVsdCJdKHIsIHQsIGUsICJvbiIsIG4uYm9keS52YWx1ZSwgcy5jaGlsZHJlbiwgbi5ib2R5LnZlcnNpb24pO3IuX29ic2VydmVyc1t0XSA9IGEsIG8oYSksIHMuYXBwbHkoYSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaShuLmJvZHkuZGVzYyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm9uTm90aWZpY2F0aW9uIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gZTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25Gb3J3YXJkIiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgICAgciA9IHQuX3JlcG9ydGVyc1tlLmJvZHkudG9dO3IuX29uRm9yd2FyZChlKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVDcmVhdGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5mcm9tLnNsaWNlKDAsIC0xMyksCiAgICAgICAgICAgICAgICBuID0geyB0eXBlOiBlLnR5cGUsIGZyb206IGUuYm9keS5zb3VyY2UsIHVybDogciwgc2NoZW1hOiBlLmJvZHkuc2NoZW1hLCB2YWx1ZTogZS5ib2R5LnZhbHVlLCBpZGVudGl0eTogZS5ib2R5LmlkZW50aXR5LCBhY2s6IGZ1bmN0aW9uIGFjayhyKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IDIwMDtyICYmIChuID0gciksIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IG4gfSB9KTsKICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBuKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG4pKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb25SZW1vdGVEZWxldGUiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICAgICAgICByID0gZS5ib2R5LnJlc291cmNlLAogICAgICAgICAgICAgICAgbiA9IHQuX29ic2VydmVyc1tyXTtpZiAobikgewogICAgICAgICAgICAgIHZhciBvID0geyB0eXBlOiBlLnR5cGUsIHVybDogciwgaWRlbnRpdHk6IGUuYm9keS5pZGVudGl0eSwgYWNrOiBmdW5jdGlvbiBhY2socikgewogICAgICAgICAgICAgICAgICB2YXIgbyA9IDIwMDtyICYmIChvID0gciksIDIwMCA9PT0gbyAmJiBuWyJkZWxldGUiXSgpLCB0Ll9idXMucG9zdE1lc3NhZ2UoeyBpZDogZS5pZCwgdHlwZTogInJlc3BvbnNlIiwgZnJvbTogZS50bywgdG86IGUuZnJvbSwgYm9keTogeyBjb2RlOiBvLCBzb3VyY2U6IHQuX293bmVyIH0gfSk7CiAgICAgICAgICAgICAgICB9IH07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyICYmIChjb25zb2xlLmxvZygiTk9USUZJQ0FUSU9OLUVWRU5UOiAiLCBvKSwgdC5fb25Ob3RpZmljYXRpb25IYW5kbGVyKG8pKTsKICAgICAgICAgICAgfSBlbHNlIHQuX2J1cy5wb3N0TWVzc2FnZSh7IGlkOiBlLmlkLCB0eXBlOiAicmVzcG9uc2UiLCBmcm9tOiBlLnRvLCB0bzogZS5mcm9tLCBib2R5OiB7IGNvZGU6IDQwNCwgc291cmNlOiB0Ll9vd25lciB9IH0pOwogICAgICAgICAgfSB9LCB7IGtleTogIm93bmVyIiwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vd25lcjsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZXBvcnRlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcG9ydGVyczsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJvYnNlcnZlcnMiLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ic2VydmVyczsKICAgICAgICAgIH0gfV0pLCBlOwogICAgICB9KCk7clsiZGVmYXVsdCJdID0gdiwgdC5leHBvcnRzID0gclsiZGVmYXVsdCJdOwogICAgfSwgeyAiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiOiA5NSwgIi4vRGF0YU9iamVjdFJlcG9ydGVyIjogOTYsICIuL0RhdGFQcm92aXNpb25hbCI6IDk3LCAiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOiA5LCAiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjogMTEsICJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOiAxMiB9XSwgMTAwOiBbZnVuY3Rpb24gKGUsIHQsIHIpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogeyAiZGVmYXVsdCI6IGUgfTsKICAgICAgfWZ1bmN0aW9uIG8oZSkgewogICAgICAgIHZhciB0ID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2ksCiAgICAgICAgICAgIHIgPSAiJDEsJDIsJDMiLAogICAgICAgICAgICBuID0gZS5yZXBsYWNlKHQsIHIpLnNwbGl0KCIsIik7blswXSA9PT0gZSAmJiAoblswXSA9ICJodHRwcyIsIG5bMV0gPSBlKTt2YXIgbyA9IHsgdHlwZTogblswXSwgZG9tYWluOiBuWzFdLCBpZGVudGl0eTogblsyXSB9O3JldHVybiBvOwogICAgICB9ZnVuY3Rpb24gaShlKSB7CiAgICAgICAgcmV0dXJuIGUgPyBKU09OLnBhcnNlKCgwLCBhWyJkZWZhdWx0Il0pKGUpKSA6IHZvaWQgMDsKICAgICAgfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6ICEwIH0pO3ZhciBzID0gZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL2pzb24vc3RyaW5naWZ5IiksCiAgICAgICAgICBhID0gbihzKTtyLmRpdmlkZVVSTCA9IG8sIHIuZGVlcENsb25lID0gaTsKICAgIH0sIHsgImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9qc29uL3N0cmluZ2lmeSI6IDIgfV0gfSwge30sIFs5Ml0pKDkyKTsKfSk7Cgp9KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKfSx7fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gYWN0aXZhdGU7Cgp2YXIgX0h5cGVydHlEaXNjb3ZlcnkgPSByZXF1aXJlKCdzZXJ2aWNlLWZyYW1ld29yay9kaXN0L0h5cGVydHlEaXNjb3ZlcnknKTsKCnZhciBfSHlwZXJ0eURpc2NvdmVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9IeXBlcnR5RGlzY292ZXJ5KTsKCnZhciBfU3luY2hlciA9IHJlcXVpcmUoJ3NlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvU3luY2hlcicpOwoKdmFyIF9FdmVudEVtaXR0ZXIyID0gcmVxdWlyZSgnLi91dGlscy9FdmVudEVtaXR0ZXIuanMnKTsKCnZhciBfRXZlbnRFbWl0dGVyMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0V2ZW50RW1pdHRlcjIpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0gLyoqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiovCgovLyBTZXJ2aWNlIEZyYW1ld29yawoKCi8vIFV0aWxzCgoKdmFyIHN0YXR1cyA9IHsKICBuYW1lOiAnc3RhdHVzJywKICBzdGF0dXM6ICdkaXNjb25uZWN0ZWQnCn07CgovKioKKiBIeXBlcnR5IFByZXNlbmNlOwoqIEBhdXRob3IgQXBpemVlIFtkZXZAYXBpemVlLmNvbV0KKiBAdmVyc2lvbiAwLjEuMAoqLwoKdmFyIFVzZXJTdGF0dXMgPSBmdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhVc2VyU3RhdHVzLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gVXNlclN0YXR1cyhoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VyU3RhdHVzKTsKCiAgICBpZiAoIWh5cGVydHlVUkwpIHRocm93IG5ldyBFcnJvcignVGhlIGh5cGVydHlVUkwgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7CiAgICBpZiAoIWJ1cykgdGhyb3cgbmV3IEVycm9yKCdUaGUgTWluaUJ1cyBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKICAgIGlmICghY29uZmlndXJhdGlvbikgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29uZmlndXJhdGlvbiBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTsKCiAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoVXNlclN0YXR1cykuY2FsbCh0aGlzLCBoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24pKTsKCiAgICB2YXIgZG9tYWluID0gKDAsIF91dGlscy5kaXZpZGVVUkwpKGh5cGVydHlVUkwpLmRvbWFpbjsKCiAgICBfdGhpcy5fc3luY2hlciA9IG5ldyBfU3luY2hlci5TeW5jaGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7CgogICAgX3RoaXMuX2h5cGVydHlEaXNjb3ZlcnkgPSBuZXcgX0h5cGVydHlEaXNjb3ZlcnkyLmRlZmF1bHQoaHlwZXJ0eVVSTCwgYnVzKTsKCiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovLycgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWFzL1VzZXJTdGF0dXNEYXRhU2NoZW1hJzsKCiAgICBfdGhpcy5faHlwZXJ0eVVSTCA9IGh5cGVydHlVUkw7CiAgICBfdGhpcy5fZG9tYWluID0gZG9tYWluOwoKICAgIF90aGlzLl9oZWFydGJlYXQgPSBbXTsKCiAgICBfdGhpcy5fc3luY2hlci5vbk5vdGlmaWNhdGlvbihmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgX3RoaXMuX29uTm90aWZpY2F0aW9uKGV2ZW50KTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhVc2VyU3RhdHVzLCBbewogICAga2V5OiAnX29uTm90aWZpY2F0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ob3RpZmljYXRpb24oZXZlbnQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBjb25zb2xlLmluZm8oJ0V2ZW50IFJlY2VpdmVkOiAnLCBldmVudCk7CgogICAgICB0aGlzLnRyaWdnZXIoJ2ludml0YXRpb24nLCBldmVudC5pZGVudGl0eSk7CgogICAgICBldmVudC5hY2soKTsKCiAgICAgIC8vIFN1YnNjcmliZSBIZWxsbyBXb3JsZCBPYmplY3QKICAgICAgdGhpcy5fc3luY2hlci5zdWJzY3JpYmUodGhpcy5fb2JqZWN0RGVzY1VSTCwgZXZlbnQudXJsKS50aGVuKGZ1bmN0aW9uIChzdGF0dXNPYmplY3RPYnNlcnZlcikgewogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0gU3RhdHVzIE9ic2VydmVyIHJlY2VpdmVkIC0tLS0tLS0tLScsIHN0YXR1c09iamVjdE9ic2VydmVyKTsKCiAgICAgICAgX3RoaXMyLnRyaWdnZXIoJ3N0YXR1c0NoYW5nZScsIHsKICAgICAgICAgIGlkZW50aXR5OiBldmVudC5pZGVudGl0eSwKICAgICAgICAgIHN0YXR1czogc3RhdHVzT2JqZWN0T2JzZXJ2ZXIuZGF0YS5zdGF0dXMKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMyLl9tYW5hZ2VQcmVzZW5jZUhlYXJ0YmVhdChldmVudC5pZGVudGl0eSwgc3RhdHVzT2JqZWN0T2JzZXJ2ZXIuZGF0YS5zdGF0dXMpOwoKICAgICAgICBzdGF0dXNPYmplY3RPYnNlcnZlci5vbkNoYW5nZSgnKicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnbWVzc2FnZSByZWNlaXZlZDonLCBldmVudCk7CiAgICAgICAgICBfdGhpczIudHJpZ2dlcignc3RhdHVzQ2hhbmdlJywgewogICAgICAgICAgICBpZGVudGl0eTogZXZlbnQuaWRlbnRpdHksCiAgICAgICAgICAgIHN0YXR1czogc3RhdHVzT2JqZWN0T2JzZXJ2ZXIuZGF0YS5zdGF0dXMKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMyLl9tYW5hZ2VQcmVzZW5jZUhlYXJ0YmVhdChldmVudC5pZGVudGl0eSwgc3RhdHVzT2JqZWN0T2JzZXJ2ZXIuZGF0YS5zdGF0dXMpOwogICAgICAgIH0pOwoKICAgICAgICBjb25zb2xlLmxvZyhldmVudC5pZGVudGl0eS5lbWFpbCwgJ2hhcyBzdWJzY3JpYmUgdG8gbXkgc3RhdHVzIGRhdGEgb2JqZWN0LCBzZW5kIGludml0ZSB0byBsaXN0ZW4gbWluZScpOwogICAgICAgIF90aGlzMi5fc3RhdHVzT2JqZWN0UmVwb3J0ZXIuaW52aXRlT2JzZXJ2ZXJzKFtldmVudC5mcm9tXSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBhIG5ldyBzdGF0dXMgb2JqZWN0IHN5bmNoZXIKICAgICAqIEBwYXJhbSAge1VSTC5Vc2VyVVJMfSBwYXJ0aWNpcGFudHMgTGlzdCBvZiBVc2VyIGFsbG93ZWQKICAgICAqIEByZXR1cm4ge1Byb21pc2V9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnY3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUocGFydGljaXBhbnRzKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgc3RhdHVzLnN0YXR1cyA9ICdjb25uZWN0ZWQnOwogICAgICAgIHN0YXR1cy5vd25lciA9IF90aGlzMy5faHlwZXJ0eVVSTDsKICAgICAgICBzdGF0dXMubmFtZSA9ICdwcmVzZW5jZSc7CgogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gTWFwcGluZyBQYXJ0aWNwYW50cyAtLS0tLS0tLS0tLS0tLS0tLS0tLScpOwogICAgICAgIF90aGlzMy5fbWFwcGluZ1VzZXIocGFydGljaXBhbnRzKS50aGVuKGZ1bmN0aW9uIChoeXBlcnRpZXMpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMuY3JlYXRlU3luY2hlcihoeXBlcnRpZXMsIHN0YXR1cyk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoc3RhdHVzT2JqZWN0UmVwb3J0ZXIpIHsKICAgICAgICAgIF90aGlzMy5fc3RhdHVzT2JqZWN0UmVwb3J0ZXIgPSBzdGF0dXNPYmplY3RSZXBvcnRlcjsKICAgICAgICAgIF90aGlzMy5fc3RhdHVzT2JqZWN0UmVwb3J0ZXIub25TdWJzY3JpcHRpb24oZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0gU3RhdHVzIFJlcG9ydGVyIHJlY2VpdmVkIHN1YnNjcmlwdGlvbiByZXF1ZXN0IC0tLS0tLS0tLScsIGV2ZW50KTsKICAgICAgICAgICAgZXZlbnQuYWNjZXB0KCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMzLl9zZW5kSGVhcnRiZWF0KCk7CiAgICAgICAgICB9LCAxMDAwMCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ2NyZWF0ZVN5bmNoZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVN5bmNoZXIoaHlwZXJ0aWVzLCBzdGF0dXMpIHsKICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBDcmVhdGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsIGh5cGVydGllcywgc3RhdHVzKTsKICAgICAgcmV0dXJuIHRoaXMuX3N5bmNoZXIuY3JlYXRlKHRoaXMuX29iamVjdERlc2NVUkwsIGh5cGVydGllcywgc3RhdHVzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdqb2luJywKICAgIHZhbHVlOiBmdW5jdGlvbiBqb2luKHJlc291cmNlKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBzdWJzY3JpYmUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpOwoKICAgICAgICBfdGhpczQuX3N5bmNoZXIuc3Vic2NyaWJlKF90aGlzNC5fb2JqZWN0RGVzY1VSTCwgcmVzb3VyY2UpLnRoZW4oZnVuY3Rpb24gKGRhdGFPYmplY3RPYnNlcnZlcikgewogICAgICAgICAgY29uc29sZS5pbmZvKCdEYXRhIE9iamVjdCBPYnNlcnZlcjogJywgZGF0YU9iamVjdE9ic2VydmVyKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2V0U3RhdHVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTdGF0dXMobmV3U3RhdHVzKSB7CiAgICAgIGNvbnNvbGUubG9nKCdjaGFuZ2Ugc3RhdHVzIHRvJywgbmV3U3RhdHVzKTsKICAgICAgdGhpcy5fc3RhdHVzT2JqZWN0UmVwb3J0ZXIuZGF0YS5zdGF0dXMgPSBuZXdTdGF0dXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnX3NlbmRIZWFydGJlYXQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZW5kSGVhcnRiZWF0KCkgewogICAgICBjb25zb2xlLmxvZygnc2VuZCBoZWFydGJlYXQnKTsKICAgICAgdGhpcy5fc3RhdHVzT2JqZWN0UmVwb3J0ZXIuZGF0YS5kYXRlID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX21hbmFnZVByZXNlbmNlSGVhcnRiZWF0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFuYWdlUHJlc2VuY2VIZWFydGJlYXQoaWRlbnRpdHksIHN0YXRlKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgY29uc29sZS5sb2coJ19tYW5hZ2VQcmVzZW5jZUhlYXJ0YmVhdCBmb3InLCBpZGVudGl0eSk7CiAgICAgIGlmIChzdGF0ZSAhPT0gJ2Rpc2Nvbm5lY3RlZCcpIHsKICAgICAgICBpZiAoaWRlbnRpdHkgaW4gdGhpcy5faGVhcnRiZWF0KSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5faGVhcnRiZWF0W2lkZW50aXR5XSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2hlYXJ0YmVhdFtpZGVudGl0eV0gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGlkZW50aXR5LCAnaGFzIGRpc2Nvbm5lY3QnKTsKICAgICAgICAgIF90aGlzNS50cmlnZ2VyKCdzdGF0dXNDaGFuZ2UnLCB7CiAgICAgICAgICAgIGlkZW50aXR5OiBpZGVudGl0eSwKICAgICAgICAgICAgc3RhdHVzOiAnZGlzY29ubmVjdGVkJwogICAgICAgICAgfSk7CiAgICAgICAgfSwgMjAwMDApOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX21hcHBpbmdVc2VyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFwcGluZ1VzZXIodXNlckxpc3QpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBfbWFwcGluZ1VzZXIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsIHVzZXJMaXN0KTsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIGh5cGVydGllcyA9IFtdOwogICAgICAgIHZhciBjb3VudCA9IDA7CgogICAgICAgIGlmICh1c2VyTGlzdC5sZW5ndGggPT09IDApIHJlamVjdChoeXBlcnRpZXMpOwoKICAgICAgICB2YXIgcmVzdWx0VXNlcnMgPSBmdW5jdGlvbiByZXN1bHRVc2VycygpIHsKICAgICAgICAgIGlmIChjb3VudCA9PT0gdXNlckxpc3QubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnSGF2ZSAnICsgaHlwZXJ0aWVzLmxlbmd0aCArICd1c2VycyBmb3VuZDsnKTsKICAgICAgICAgICAgcmVzb2x2ZShoeXBlcnRpZXMpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBhY3RpdmVVc2VycyA9IGZ1bmN0aW9uIGFjdGl2ZVVzZXJzKHVzZXIpIHsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICBoeXBlcnRpZXMucHVzaCh1c2VyLmh5cGVydHlVUkwpOwogICAgICAgICAgcmVzdWx0VXNlcnMoKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgaW5hY3RpdmVVc2VycyA9IGZ1bmN0aW9uIGluYWN0aXZlVXNlcnMoKSB7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgcmVzdWx0VXNlcnMoKTsKICAgICAgICB9OwoKICAgICAgICB1c2VyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyh1c2VyKTsKICAgICAgICAgIGlmICh1c2VyLmVtYWlsLmxlbmd0aCkgewogICAgICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBfbWFwcGluZ1VzZXIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsIHVzZXJMaXN0KTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzNi5faHlwZXJ0eURpc2NvdmVyeS5kaXNjb3Zlckh5cGVydHlQZXJVc2VyKHVzZXIuZW1haWwsIHVzZXIuZG9tYWluKS50aGVuKGFjdGl2ZVVzZXJzKS5jYXRjaChpbmFjdGl2ZVVzZXJzKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVXNlclN0YXR1czsKfShfRXZlbnRFbWl0dGVyMy5kZWZhdWx0KTsKCmZ1bmN0aW9uIGFjdGl2YXRlKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikgewoKICByZXR1cm4gewogICAgbmFtZTogJ1VzZXJTdGF0dXMnLAogICAgaW5zdGFuY2U6IG5ldyBVc2VyU3RhdHVzKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbikKICB9Owp9Cgp9LHsiLi91dGlscy9FdmVudEVtaXR0ZXIuanMiOjUsIi4vdXRpbHMvdXRpbHMuanMiOjYsInNlcnZpY2UtZnJhbWV3b3JrL2Rpc3QvSHlwZXJ0eURpc2NvdmVyeSI6Miwic2VydmljZS1mcmFtZXdvcmsvZGlzdC9TeW5jaGVyIjozfV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgovKioKKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0EKKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRAoqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAoqIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WCiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBCiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwoqIENvcHlyaWdodCAyMDE2IEFwaXplZQoqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOCioKKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKi8KCi8qKgogKiBFdmVudEVtaXR0ZXIKICogQWxsIGNsYXNzZXMgd2hpY2ggZXh0ZW5kcyB0aGlzLCBjYW4gaGF2ZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0cmlnZ2VyIGV2ZW50czsKICovCgp2YXIgRXZlbnRFbWl0dGVyID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFdmVudEVtaXR0ZXIpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEV2ZW50RW1pdHRlciwgW3sKICAgIGtleTogImFkZEV2ZW50TGlzdGVuZXIiLAoKCiAgICAvKioKICAgICAqIGFkZEV2ZW50TGlzdGVuZXIgbGlzdGVuIGZvciBhbiBldmVudFR5cGUKICAgICAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICBldmVudFR5cGUgLSBsaXN0ZW5pbmcgZm9yIHRoaXMgdHlwZSBvZiBldmVudAogICAgICogQHBhcmFtICB7RnVuY3Rpb259ICAgICAgIGNiICAgICAgICAtIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbiB0aGUgZXZlbnQgaXQgaXMgaW52b2tlZAogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGNiKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzW2V2ZW50VHlwZV0gPSBjYjsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgZXZlbnRUeXBlCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IGV2ZW50VHlwZSAtIGV2ZW50IHdpbGwgYmUgaW52b2tlZAogICAgICogQHBhcmFtICB7b2JqZWN0fSBwYXJhbXMgLSBwYXJhbWV0ZXJzIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBhZGRFdmVudExpc3RlbmVyCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidHJpZ2dlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJpZ2dlcihldmVudFR5cGUsIHBhcmFtcykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKF90aGlzW2V2ZW50VHlwZV0pIHsKICAgICAgICBfdGhpc1tldmVudFR5cGVdKHBhcmFtcyk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBFdmVudEVtaXR0ZXI7Cn0oKTsKCmV4cG9ydHMuZGVmYXVsdCA9IEV2ZW50RW1pdHRlcjsKCn0se31dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKHByb2Nlc3MpewondXNlIHN0cmljdCc7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZGl2aWRlVVJMID0gZGl2aWRlVVJMOwpleHBvcnRzLmRlZXBDbG9uZSA9IGRlZXBDbG9uZTsKZXhwb3J0cy5nZXRDb25maWcgPSBnZXRDb25maWc7CmV4cG9ydHMuZ2V0VXNlck1lZGlhID0gZ2V0VXNlck1lZGlhOwpleHBvcnRzLnNlcmlhbGl6ZSA9IHNlcmlhbGl6ZTsKZXhwb3J0cy5nZXRUZW1wbGF0ZSA9IGdldFRlbXBsYXRlOwovKioKICogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBCiAqIENvcHlyaWdodCAyMDE2IElORVNDLUlECiAqIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTAogKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVgogKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0EKICogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBRwogKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWUKICogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU4KICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqKi8KCi8vIGpzaGludCBicm93c2VyOnRydWUsIGpxdWVyeTogdHJ1ZQovLyBqc2hpbnQgdmFyc3RtdDogdHJ1ZQovKiBnbG9iYWwgSGFuZGxlYmFycyAqLwoKLyoqCiAqIFN1cHBvcnQgbW9kdWxlIHdpdGggc29tZSBmdW5jdGlvbnMgd2lsbCBiZSB1c2VmdWwKICogQG1vZHVsZSB1dGlscwogKi8KCi8qKgogKiBAdHlwZWRlZiBkaXZpZGVVUkwKICogQHR5cGUgT2JqZWN0CiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFRoZSB0eXBlIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gZG9tYWluIFRoZSBkb21haW4gb2YgVVJMCiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpZGVudGl0eSBUaGUgaWRlbnRpdHkgb2YgVVJMCiAqLwoKLyoqCiAqIERpdmlkZSBhbiB1cmwgaW4gdHlwZSwgZG9tYWluIGFuZCBpZGVudGl0eQogKiBAcGFyYW0gIHtVUkwuVVJMfSB1cmwgLSB1cmwgYWRkcmVzcwogKiBAcmV0dXJuIHtkaXZpZGVVUkx9IHRoZSByZXN1bHQgb2YgZGl2aWRlVVJMCiAqLwpmdW5jdGlvbiBkaXZpZGVVUkwodXJsKSB7CgogIC8vIGxldCByZSA9IC8oW2EtekEtWi1dKik/OlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIpKihcL1tcL1xkXHdcLi1dKikqKD86W1w/XSkqKC4rKSovZ2k7CiAgdmFyIHJlID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2k7CiAgdmFyIHN1YnN0ID0gJyQxLCQyLCQzJzsKICB2YXIgcGFydHMgPSB1cmwucmVwbGFjZShyZSwgc3Vic3QpLnNwbGl0KCcsJyk7CgogIC8vIElmIHRoZSB1cmwgaGFzIG5vIHByb3RvY29sLCB0aGUgZGVmYXVsdCBwcm90b2NvbCBzZXQgaXMgaHR0cHMKICBpZiAocGFydHNbMF0gPT09IHVybCkgewogICAgcGFydHNbMF0gPSAnaHR0cHMnOwogICAgcGFydHNbMV0gPSB1cmw7CiAgfQoKICB2YXIgcmVzdWx0ID0gewogICAgdHlwZTogcGFydHNbMF0sCiAgICBkb21haW46IHBhcnRzWzFdLAogICAgaWRlbnRpdHk6IHBhcnRzWzJdCiAgfTsKCiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqCiAqIE1ha2UgYSBDT1BZIG9mIHRoZSBvcmlnaW5hbCBkYXRhCiAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAtIG9iamVjdCB0byBiZSBjbG9uZWQKICogQHJldHVybiB7T2JqZWN0fQogKi8KZnVuY3Rpb24gZGVlcENsb25lKG9iaikgewogIC8vVE9ETzogc2ltcGxlIGJ1dCBpbmVmZmljaWVudCBKU09OIGRlZXAgY2xvbmUuLi4KICBpZiAob2JqKSByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfQoKLyoqCiAqIEdldCB0aGUgY29uZmlndXJhdGlvbiBmcm9tIGFuIGpzb24gZmlsZTsKICogQHBhcmFtICB7SlNPTk9iamVjdH0ganNvbkZpbGUKICogQHJldHVybiB7b2JqZWN0fQogKi8KZnVuY3Rpb24gZ2V0Q29uZmlnKEpTT05PYmplY3QpIHsKICBjb25zb2xlLmxvZyhwcm9jZXNzLmVudi5lbnZpcm9ubWVudCk7CiAgcmV0dXJuIEpTT05PYmplY3RbcHJvY2Vzcy5lbnYuZW52aXJvbm1lbnRdOwp9CgovKioKICogR2V0IFdlYlJUQyBBUEkgcmVzb3VyY2VzCiAqIEBwYXJhbSAge09iamVjdH0gICAgIG9wdGlvbnMgT2JqZWN0IGNvbnRhaW5pbmcgdGhlIGluZm9ybWF0aW9uIHRoYXQgcmVzb3VyY2VzIHdpbGwgYmUgdXNlZCAoY2FtZXJhLCBtaWMsIHJlc29sdXRpb24sIGV0Yyk7CiAqIEByZXR1cm4ge1Byb21pc2V9CiAqLwpmdW5jdGlvbiBnZXRVc2VyTWVkaWEoY29uc3RyYWludHMpIHsKCiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cykudGhlbihmdW5jdGlvbiAobWVkaWFTdHJlYW0pIHsKICAgICAgcmVzb2x2ZShtZWRpYVN0cmVhbSk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgIHJlamVjdChyZWFzb24pOwogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHNlcmlhbGl6ZSgpIHsKCiAgJC5mbi5zZXJpYWxpemVPYmplY3QgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbyA9IHt9OwogICAgdmFyIGEgPSB0aGlzLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAkLmVhY2goYSwgZnVuY3Rpb24gKCkgewogICAgICBpZiAob1t0aGlzLm5hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoIW9bdGhpcy5uYW1lXS5wdXNoKSB7CiAgICAgICAgICBvW3RoaXMubmFtZV0gPSBbb1t0aGlzLm5hbWVdXTsKICAgICAgICB9CgogICAgICAgIG9bdGhpcy5uYW1lXS5wdXNoKHRoaXMudmFsdWUgfHwgJycpOwogICAgICB9IGVsc2UgewogICAgICAgIG9bdGhpcy5uYW1lXSA9IHRoaXMudmFsdWUgfHwgJyc7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBvOwogIH07CgogICQuZm4uc2VyaWFsaXplT2JqZWN0QXJyYXkgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbyA9IHt9OwogICAgdmFyIGEgPSB0aGlzLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAkLmVhY2goYSwgZnVuY3Rpb24gKCkgewogICAgICBpZiAob1t0aGlzLm5hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoIW9bdGhpcy5uYW1lXS5wdXNoKSB7CiAgICAgICAgICBvW3RoaXMubmFtZV0gPSBbb1t0aGlzLm5hbWVdXTsKICAgICAgICB9CgogICAgICAgIG9bdGhpcy5uYW1lXS5wdXNoKHRoaXMudmFsdWUgfHwgJycpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICghb1t0aGlzLm5hbWVdKSBvW3RoaXMubmFtZV0gPSBbXTsKICAgICAgICBvW3RoaXMubmFtZV0ucHVzaCh0aGlzLnZhbHVlIHx8ICcnKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIG87CiAgfTsKfQoKZnVuY3Rpb24gZ2V0VGVtcGxhdGUocGF0aCwgc2NyaXB0KSB7CgogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgaWYgKEhhbmRsZWJhcnMudGVtcGxhdGVzID09PSB1bmRlZmluZWQgfHwgSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0gPT09IHVuZGVmaW5lZCkgewogICAgICBIYW5kbGViYXJzLnRlbXBsYXRlcyA9IHt9OwogICAgfSBlbHNlIHsKICAgICAgcmVzb2x2ZShIYW5kbGViYXJzLnRlbXBsYXRlc1tuYW1lXSk7CiAgICB9CgogICAgdmFyIHRlbXBsYXRlRmlsZSA9ICQuYWpheCh7CiAgICAgIHVybDogcGF0aCArICcuaGJzJywKICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7CiAgICAgICAgSGFuZGxlYmFycy50ZW1wbGF0ZXNbbmFtZV0gPSBIYW5kbGViYXJzLmNvbXBpbGUoZGF0YSk7CiAgICAgIH0sCgogICAgICBmYWlsOiBmdW5jdGlvbiBmYWlsKHJlYXNvbikgewogICAgICAgIHJldHVybiByZWFzb247CiAgICAgIH0KICAgIH0pOwoKICAgIHZhciBzY3JpcHRGaWxlID0gJC5nZXRTY3JpcHQoc2NyaXB0KTsKCiAgICB2YXIgcmVxdWVzdHMgPSBbXTsKICAgIGlmIChwYXRoKSByZXF1ZXN0cy5wdXNoKHRlbXBsYXRlRmlsZSk7CiAgICBpZiAoc2NyaXB0KSByZXF1ZXN0cy5wdXNoKHNjcmlwdEZpbGUpOwoKICAgIFByb21pc2UuYWxsKHJlcXVlc3RzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgcmVzb2x2ZShIYW5kbGViYXJzLnRlbXBsYXRlc1tuYW1lXSk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgIHJlamVjdChyZWFzb24pOwogICAgfSk7CiAgfSk7Cn0KCn0pLmNhbGwodGhpcyxyZXF1aXJlKCdfcHJvY2VzcycpKQp9LHsiX3Byb2Nlc3MiOjF9XX0se30sWzRdKSg0KQp9KTs=",
      "sourceCodeClassname": "UserStatusHyperty",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "Hyperties",
    "version": "0.1",
    "description": "Description of UserStatusHyperty",
    "objectName": "UserStatusHyperty",
    "configuration": {},
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  }
}